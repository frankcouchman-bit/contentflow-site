<!doctype html>
<html lang="en" class="h-full">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17511593434"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'AW-17511593434');
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>ContentRepurpose.pro — AI Content Repurposing Tool & Generator</title>
  <meta name="description" content="Repurpose blogs, emails, and posts into LinkedIn, X, Instagram and more. AI-powered content repurposing tool & generator. Export to Notion & Trello. BYOK supported." />
  <meta name="keywords" content="content repurposing, content repurpose, repurpose content, repurposing tool, AI content repurposing, AI content generator, content repurposing ideas, repurpose blog to social, repurpose email to LinkedIn, repurpose email to Trello, notion export, trello export, content repurposing for SEO, content repurposing workflow, repurpose content AI, content repurposing software, content repurposing platform, content repurposing app, social media repurposing, LinkedIn post generator, X post generator, Instagram caption generator, newsletter repurposing, batch content generation, BYOK content AI" />
  <link rel="canonical" href="https://contentrepurpose.pro/">
  <meta name="theme-color" content="#0a0d18">
  <meta name="color-scheme" content="dark light">
  <meta name="robots" content="index,follow,max-video-preview:-1,max-image-preview:large,max-snippet:-1">

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="ContentRepurpose.pro — AI Content Repurposing Tool">
  <meta property="og:description" content="Turn one idea into posts for LinkedIn, X, Instagram, and Email. Export with one click. BYOK supported.">
  <meta property="og:url" content="https://contentrepurpose.pro/">
  <meta property="og:image" content="https://contentrepurpose.pro/og-cover.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ContentRepurpose.pro — AI Content Generator">
  <meta name="twitter:description" content="Repurpose your content into multi-channel drafts. Export to Notion & Trello. BYOK supported.">
  <meta name="twitter:image" content="https://contentrepurpose.pro/og-cover.png">

  <!-- Preconnects for perf -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{ --brandA:#7AA2FF; --brandB:#FF2D2D; --ink:#0a0d18; --ink-2:#101425; }
    html,body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .txt-grad{background:linear-gradient(135deg,var(--brandA),var(--brandB));-webkit-background-clip:text;background-clip:text;color:transparent}
    .bg-grad{background:linear-gradient(135deg,var(--brandA),var(--brandB))}
    .card{border-radius:1.25rem;border:1px solid rgba(15,23,42,.10);background:rgba(255,255,255,.80);box-shadow:0 12px 40px rgba(2,6,23,.08)}
    .badge{display:inline-flex;align-items:center;gap:.5rem;padding:.35rem .6rem;border-radius:9999px;border:1px solid rgba(255,255,255,.15);font-size:.75rem;background:rgba(255,255,255,.65)}
    .chip{font-size:.7rem;padding:.2rem .5rem;border-radius:9999px;border:1px solid rgba(148,163,184,.35)}
    .btn{padding:.6rem .9rem;border-radius:.9rem;border:1px solid rgba(148,163,184,.35)}
    .btn-primary{background:black;color:white}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    #click-guard{position:fixed;inset:0;pointer-events:none}

    /* Glass & dark */
    .glass{backdrop-filter: blur(12px); background:rgba(255,255,255,.62)}
    @media (prefers-color-scheme:dark){
      body{background:var(--ink);color:#e9eef6}
      .card{background:rgba(14,16,22,.6);border-color:rgba(255,255,255,.08);box-shadow:0 24px 96px rgba(122,162,255,.08),0 14px 60px rgba(255,45,45,.06)}
      .badge{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.12)}
    }

    /* Decorative visuals */
    .halo{
      position:absolute; filter: blur(60px); opacity:.55; pointer-events:none; transform:translateZ(0);
      background:radial-gradient(50% 50% at 50% 50%, rgba(122,162,255,.8), rgba(255,45,45,.65) 60%, transparent 70%);
      width:42rem; height:42rem; border-radius:50%;
      animation: float 16s ease-in-out infinite;
    }
    .halo.h2{ width:34rem; height:34rem; left:auto; right:-12rem; top:-6rem; animation-duration:18s; opacity:.5 }
    .halo.h3{ width:28rem; height:28rem; left:-10rem; top:26rem; animation-duration:22s; opacity:.45 }
    @keyframes float{ 0%,100%{ transform: translate3d(0,0,0) } 50%{ transform: translate3d(0,-20px,0) } }
    .orbit{
      position:absolute; inset:-32px; border-radius:24px; pointer-events:none;
      background: conic-gradient(from 0deg, rgba(122,162,255,.25), rgba(255,45,45,.18), rgba(122,162,255,.25));
      -webkit-mask: radial-gradient(closest-side, transparent 88%, black 89%);
              mask: radial-gradient(closest-side, transparent 88%, black 89%);
      animation: spin 18s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg) } }

    .mock{border-radius:1rem;border:1px solid rgba(255,255,255,.12); background:linear-gradient(180deg,rgba(255,255,255,.75),rgba(255,255,255,.6));}
    @media (prefers-color-scheme:dark){ .mock{ background:linear-gradient(180deg,rgba(17,20,31,.88),rgba(17,20,31,.72)); } }

    .marquee{ display:grid; grid-auto-flow:column; gap:2rem; align-items:center; animation: scrollx 26s linear infinite }
    .marquee:hover{ animation-play-state: paused }
    @keyframes scrollx{ from{ transform: translateX(0) } to{ transform: translateX(-50%) } }

    /* Mobile helpers */
    .nav-sheet{position:fixed; inset:0 0 auto 0; background:rgba(0,0,0,.6); backdrop-filter:blur(8px); display:none}
    .nav-panel{position:absolute; top:0; right:0; width:82vw; max-width:380px; height:100%; background:rgba(14,16,22,.96); border-left:1px solid rgba(255,255,255,.08); padding:1rem}
    .nav-open .nav-sheet{display:block}
    .touch-target{min-height:44px; min-width:44px}

    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    /* Promo bar */
    .promo-bar{position:sticky; top:0; z-index:50; backdrop-filter:saturate(120%) blur(8px)}
    .promo-close{background:transparent;border:0}

    /* Upgrade modal */
    dialog.upgrade{border:1px solid rgba(255,255,255,.12); background:rgba(14,16,22,.96); color:#fff}
    dialog.upgrade::backdrop{background:rgba(0,0,0,.5)}

    /* Utility to hide guest marketing when member */
    .marketing{ /* marker class; we toggle display via JS */ }
  </style>

  <!-- JSON-LD: Organization -->
  <script type="application/ld+json">{
    "@context":"https://schema.org",
    "@type":"Organization",
    "name":"ContentRepurpose.pro",
    "url":"https://contentrepurpose.pro/",
    "logo":"https://contentrepurpose.pro/logo.svg",
    "sameAs":[
      "https://x.com/contentflow",
      "https://www.linkedin.com/company/contentflowai"
    ]
  }</script>

  <!-- JSON-LD: WebSite + Sitelinks search -->
  <script type="application/ld+json">{
    "@context":"https://schema.org",
    "@type":"WebSite",
    "url":"https://contentrepurpose.pro/",
    "name":"ContentRepurpose.pro",
    "potentialAction":{
      "@type":"SearchAction",
      "target":"https://contentrepurpose.pro/search?q={q}",
      "query-input":"required name=q"
    }
  }</script>

  <!-- JSON-LD: SoftwareApplication -->
  <script type="application/ld+json">{
    "@context":"https://schema.org",
    "@type":"SoftwareApplication",
    "name":"ContentRepurpose.pro",
    "applicationCategory":"ContentCreationApplication",
    "operatingSystem":"Web",
    "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}
  }</script>
</head>

<body class="min-h-full" data-auth="guest">
  <div id="click-guard" aria-hidden="true"></div>

  <!-- === Promo Bar (dismissible) === -->
  <div id="promoBar" class="promo-bar bg-white/80 dark:bg-black/50 border-b border-white/30">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-2 flex items-center justify-between gap-3 text-sm">
      <div class="flex items-center gap-2">
        <span class="px-2 py-0.5 rounded-full text-xs bg-black text-white dark:bg-white dark:text-black">New</span>
        <span><strong>First Users</strong> — <span class="txt-grad font-semibold">90% off Creator</span> with code <strong>CONTENTOFF90</strong></span>
      </div>
      <div class="flex items-center gap-2 shrink-0">
        <a href="#pricing" class="px-3 py-1 rounded-lg border hover:bg-white/60 dark:hover:bg-white/10">Claim offer</a>
        <button id="promoClose" class="promo-close touch-target text-lg leading-none px-2" aria-label="Close">✕</button>
      </div>
    </div>
  </div>

  <!-- Decorative halos -->
  <div class="halo" style="left:-14rem; top:-10rem;"></div>
  <div class="halo h2"></div>
  <div class="halo h3"></div>

  <!-- NAV -->
  <header class="sticky top-0 z-40 backdrop-blur bg-white/55 dark:bg-black/20 border-b border-white/30">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-4 flex items-center justify-between">
      <a href="/" class="flex items-center gap-3" aria-label="ContentRepurpose home">
        <!-- Inline SVG logo -->
        <svg width="36" height="36" viewBox="0 0 48 48" class="rounded-xl" aria-hidden="true">
          <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7AA2FF"/><stop offset="100%" stop-color="#FF2D2D"/></linearGradient></defs>
          <rect x="0" y="0" width="48" height="48" rx="12" fill="url(#g)"/>
          <path d="M14 16h10a6 6 0 0 1 0 12H20v4h-6V16zm6 6v4h4a2 2 0 1 0 0-4h-4z" fill="white"/>
          <path d="M28 16h6v16h-6z" fill="white" opacity=".9"/>
        </svg>
        <span class="font-semibold tracking-tight">Content<span class="txt-grad">Repurpose</span></span>
      </a>

      <!-- Desktop nav -->
      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="#demo" class="hover:opacity-80 marketing" data-nav="demo">Live Demo</a>
        <a href="#templates" class="hover:opacity-80 marketing">Templates</a>
        <a href="#use-cases" class="hover:opacity-80 marketing">Use cases</a>
        <a href="#best-picks" class="hover:opacity-80 marketing">Best picks</a>
        <a href="#pricing" class="hover:opacity-80 marketing">Pricing</a>
        <a href="/blog" class="hover:opacity-80 marketing">Blog</a>
        <span id="planbadge" class="px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/50">Plan: Free</span>
        <button id="manageBilling" class="px-3 py-1 rounded-lg border hidden">Manage billing</button>
        <div class="flex items-center gap-2">
          <button id="loginBtn" class="px-3 py-1 rounded-lg border">Sign in</button>
          <button id="logoutBtn" class="px-3 py-1 rounded-lg border hidden">Sign out</button>
        </div>
      </nav>

      <!-- Mobile burger -->
      <button id="navToggle" class="md:hidden touch-target px-3 py-2 rounded-lg border" aria-expanded="false" aria-controls="mobileNav" aria-label="Open menu">
        ☰
      </button>
    </div>

    <!-- Mobile sheet -->
    <div id="mobileNav" class="nav-sheet" aria-hidden="true">
      <div class="nav-panel text-sm text-white">
        <div class="flex items-center justify-between">
          <span class="font-semibold">Menu</span>
          <button id="navClose" class="touch-target px-3 py-2 rounded-lg border border-white/20" aria-label="Close menu">✕</button>
        </div>
        <nav class="mt-4 grid gap-2">
          <a href="#demo" class="px-3 py-2 rounded-lg hover:bg-white/10 marketing">Live Demo</a>
          <a href="#templates" class="px-3 py-2 rounded-lg hover:bg-white/10 marketing">Templates</a>
          <a href="#use-cases" class="px-3 py-2 rounded-lg hover:bg-white/10 marketing">Use cases</a>
          <a href="#best-picks" class="px-3 py-2 rounded-lg hover:bg-white/10 marketing">Best picks</a>
          <a href="#pricing" class="px-3 py-2 rounded-lg hover:bg-white/10 marketing">Pricing</a>
          <a href="/blog" class="px-3 py-2 rounded-lg hover:bg-white/10 marketing">Blog</a>
        </nav>
        <div class="mt-6 grid gap-2">
          <span id="planbadge_m" class="px-3 py-1 rounded-full text-xs bg-white/10 border border-white/20 w-fit">Plan: Free</span>
          <button id="manageBilling_m" class="px-3 py-2 rounded-lg border border-white/20 hidden">Manage billing</button>
          <button id="loginBtn_m" class="px-3 py-2 rounded-lg border border-white/20">Sign in</button>
          <button id="logoutBtn_m" class="px-3 py-2 rounded-lg border border-white/20 hidden">Sign out</button>
        </div>
      </div>
    </div>
  </header>

  <!-- === MARKETING WRAPPER (hidden for signed-in members) === -->
  <div id="marketing" class="marketing">
    <!-- HERO (Live Demo high on page) -->
    <section class="relative">
      <div class="max-w-7xl mx-auto px-4 md:px-5 pt-8 md:pt-14 grid lg:grid-cols-2 gap-8 md:gap-10 items-center">
        <div>
          <div id="heroBadgeWrap" class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/40">
            <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
            <span id="heroBadge">Demo — <strong class="mx-1">5 runs / month</strong> (no login)</span>
          </div>
          <h1 class="mt-4 text-3xl md:text-5xl font-black leading-tight tracking-tight">
            AI <span class="txt-grad">Content Repurposing Tool</span> — turn one idea into everywhere content.
          </h1>
          <p class="mt-4 text-slate-600 dark:text-slate-300 max-w-xl">
            Paste content → get <strong>LinkedIn</strong>, <strong>X</strong>, <strong>Email</strong> &amp; <strong>Instagram</strong> drafts.
            Export to <strong>Notion</strong> or <strong>Trello</strong> with one click. BYOK supported.
          </p>
          <div class="mt-6 flex flex-wrap gap-3">
            <a href="#demo" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90">Try the Live Demo</a>
            <a href="#pricing" class="px-4 py-3 rounded-xl font-semibold border border-slate-300/60 hover:bg-white/50">See pricing</a>
            <button id="heroSignIn" class="px-4 py-3 rounded-xl font-semibold border border-slate-300/60">Sign in</button>
          </div>
          <div class="mt-6 flex items-center gap-3 text-xs text-slate-500 dark:text-slate-400">
            <span class="badge">AI Content Generator</span>
            <span class="badge">Repurposing Tool</span>
            <span class="badge">SEO-ready</span>
            <span class="badge">BYOK</span>
          </div>

          <!-- Trust strip -->
          <div class="mt-8 overflow-hidden">
            <div class="flex items-center gap-4 text-[11px] uppercase tracking-widest text-slate-500">
              <span class="chip">Creators</span>
              <span class="chip">Marketers</span>
              <span class="chip">Newsletters</span>
              <span class="chip">Teams</span>
            </div>
            <div class="relative mt-4">
              <div class="marquee opacity-70">
                <div class="chip">LinkedIn-first</div>
                <div class="chip">Editorial-friendly</div>
                <div class="chip">Email copy</div>
                <div class="chip">Instagram captions</div>
                <div class="chip">Notion export</div>
                <div class="chip">Trello sync</div>
                <div class="chip">Keyword-aware</div>
                <div class="chip">Tone controls</div>
                <!-- duplicate for seamless scroll -->
                <div class="chip">LinkedIn-first</div>
                <div class="chip">Editorial-friendly</div>
                <div class="chip">Email copy</div>
                <div class="chip">Instagram captions</div>
                <div class="chip">Notion export</div>
                <div class="chip">Trello sync</div>
                <div class="chip">Keyword-aware</div>
                <div class="chip">Tone controls</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Visual mockups -->
        <div class="relative">
          <div class="orbit" aria-hidden="true"></div>
          <div class="grid gap-4">
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">Command</div>
              <pre class="mono text-xs bg-black/85 text-emerald-200 rounded-xl p-4 h-40 overflow-auto" aria-label="CLI Preview">repurpose generate --channels linkedin,x,email,instagram
✓ outline created
✓ 3 social variants
✓ email subject + body ready
✓ instagram caption + hashtags</pre>
            </div>
            <div class="grid md:grid-cols-2 gap-4">
              <div class="mock p-4 card">
                <div class="text-xs text-slate-400">LinkedIn</div>
                <div class="mt-2 h-24 text-sm text-slate-200/90 leading-relaxed">
                  • Hook that earns the scroll<br>
                  • 6–10 crisp lines, one CTA<br>
                  • On-brand tone &amp; keywords
                </div>
              </div>
              <div class="mock p-4 card">
                <div class="text-xs text-slate-400">X (Twitter)</div>
                <div class="mt-2 h-24 text-sm text-slate-200/90 leading-relaxed">
                  Two fast variants<br>
                  Always &le; 280 chars<br>
                  Ready to post ✨
                </div>
              </div>
            </div>
            <div class="grid md:grid-cols-2 gap-4">
              <div class="mock p-4 card">
                <div class="text-xs text-slate-400">Email</div>
                <div class="mt-2 h-20 text-sm text-slate-200/90 leading-relaxed">
                  Subject &amp; body prepped<br>
                  Preview &amp; send from your client
                </div>
              </div>
              <div class="mock p-4 card">
                <div class="text-xs text-slate-400">Instagram</div>
                <div class="mt-2 h-20 text-sm text-slate-200/90 leading-relaxed">
                  Caption + 3–5 hashtags<br>
                  Short, skimmable, on-brand
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Live activity strip -->
      <div class="mt-8 md:mt-10">
        <div class="max-w-7xl mx-auto px-4 md:px-5">
          <div class="card p-4 md:p-5">
            <div class="flex items-center justify-between flex-wrap gap-3">
              <div class="flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                <strong class="tracking-tight">Generations today</strong>
                <span id="liveCount" class="chip">–</span>
              </div>
              <div class="text-xs text-slate-500">Real results update every 30s</div>
            </div>
            <div class="mt-3 overflow-hidden">
              <div id="liveFeed" class="flex gap-3 whitespace-nowrap text-[13px] will-change-transform" style="animation: scrollx 28s linear infinite"></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- === LIVE DEMO === -->
    <section id="demo" class="mt-12 md:mt-20">
      <div class="max-w-7xl mx-auto px-4 md:px-5">
        <div class="card p-5 md:p-6">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <h2 class="text-xl md:text-2xl font-bold tracking-tight">Live Demo — no login</h2>
            <div class="text-xs text-slate-500">Limited to <strong>5</strong> runs / month (IP-based)</div>
          </div>

          <form id="demoForm" class="mt-4 grid gap-4">
            <div class="grid md:grid-cols-2 gap-4">
              <label class="grid gap-2">
                <span class="text-sm text-slate-500">Paste source content</span>
                <textarea id="demoInput" class="w-full h-40 rounded-xl border border-slate-300/60 bg-white/70 dark:bg-white/5 p-3"
                  placeholder="Paste a paragraph, email, or notes…"></textarea>
              </label>

              <div class="grid gap-2">
                <span class="text-sm text-slate-500">Channels</span>
                <div class="grid grid-cols-2 gap-2">
                  <label class="flex items-center gap-2 px-3 py-2 rounded-lg border">
                    <input type="checkbox" class="accent-black" value="linkedin" checked> LinkedIn
                  </label>
                  <label class="flex items-center gap-2 px-3 py-2 rounded-lg border">
                    <input type="checkbox" class="accent-black" value="x" checked> X (Twitter)
                  </label>
                  <label class="flex items-center gap-2 px-3 py-2 rounded-lg border">
                    <input type="checkbox" class="accent-black" value="email" checked> Email
                  </label>
                  <label class="flex items-center gap-2 px-3 py-2 rounded-lg border">
                    <input type="checkbox" class="accent-black" value="instagram"> Instagram
                  </label>
                </div>
                <div class="grid md:grid-cols-2 gap-2">
                  <input id="demoTone" class="px-3 py-2 rounded-lg border" placeholder="Tone (e.g., friendly, punchy)" />
                  <input id="demoKeywords" class="px-3 py-2 rounded-lg border" placeholder="Optional keywords (comma separated)" />
                </div>
                <div class="flex gap-2">
                  <button id="demoRun" class="btn btn-primary font-semibold">Generate</button>
                  <a href="#pricing" class="btn">Unlock more</a>
                </div>
              </div>
            </div>

            <div id="demoResults" class="mt-2 grid md:grid-cols-2 gap-4 hidden">
              <div class="p-3 rounded-xl border">
                <div class="text-xs text-slate-400">LinkedIn</div>
                <pre id="outLinkedin" class="mono text-[12px] whitespace-pre-wrap"></pre>
              </div>
              <div class="p-3 rounded-xl border">
                <div class="text-xs text-slate-400">X (Twitter)</div>
                <pre id="outX" class="mono text-[12px] whitespace-pre-wrap"></pre>
              </div>
              <div class="p-3 rounded-xl border">
                <div class="text-xs text-slate-400">Email</div>
                <pre id="outEmail" class="mono text-[12px] whitespace-pre-wrap"></pre>
              </div>
              <div class="p-3 rounded-xl border">
                <div class="text-xs text-slate-400">Instagram</div>
                <pre id="outInsta" class="mono text-[12px] whitespace-pre-wrap"></pre>
              </div>
            </div>

            <div id="demoMsg" class="text-sm text-slate-500"></div>
          </form>
        </div>
      </div>
    </section>

    <!-- === TEMPLATES === -->
    <section id="templates" class="mt-16">
      <div class="max-w-7xl mx-auto px-4 md:px-5">
        <h2 class="text-xl md:text-2xl font-bold tracking-tight">Templates</h2>
        <p class="text-slate-500 mt-1">Kickstart with proven structures for each channel.</p>

        <div class="grid md:grid-cols-3 gap-4 mt-5">
          <div class="card p-4">
            <div class="text-sm font-semibold">LinkedIn: Problem → Insight → CTA</div>
            <ul class="mt-2 text-sm text-slate-500 list-disc pl-5">
              <li>Hook with a bold claim</li>
              <li>3–5 punchy lines</li>
              <li>Invite comments or DMs</li>
            </ul>
          </div>
          <div class="card p-4">
            <div class="text-sm font-semibold">X: Thread (3–5 tweets)</div>
            <ul class="mt-2 text-sm text-slate-500 list-disc pl-5">
              <li>One-liner opener</li>
              <li>Value nuggets</li>
              <li>CTA or summary</li>
            </ul>
          </div>
          <div class="card p-4">
            <div class="text-sm font-semibold">Email: Teaser → Value → CTA</div>
            <ul class="mt-2 text-sm text-slate-500 list-disc pl-5">
              <li>Subject + preheader</li>
              <li>Skimmable body</li>
              <li>Single link click</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- === USE CASES === -->
    <section id="use-cases" class="mt-16">
      <div class="max-w-7xl mx-auto px-4 md:px-5">
        <h2 class="text-xl md:text-2xl font-bold tracking-tight">Popular use cases</h2>
        <div class="grid md:grid-cols-3 gap-4 mt-5">
          <div class="card p-4">
            <div class="font-semibold">Blog → Social bundle</div>
            <p class="text-slate-500 text-sm mt-1">Turn long-form into LinkedIn + X + IG in one go.</p>
          </div>
          <div class="card p-4">
            <div class="font-semibold">Email → LinkedIn post</div>
            <p class="text-slate-500 text-sm mt-1">Make your newsletter a scroll-stopper.</p>
          </div>
          <div class="card p-4">
            <div class="font-semibold">Meeting notes → Trello</div>
            <p class="text-slate-500 text-sm mt-1">Auto-create cards with action items.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- === SEO: Keyword Cloud (guest only) === -->
    <section id="keywords" class="mt-16">
      <div class="max-w-7xl mx-auto px-4 md:px-5">
        <h2 class="text-xl md:text-2xl font-bold tracking-tight">We help you repurpose content</h2>
        <p class="text-slate-500 text-sm">Targeted topics we cover across the app:</p>
        <div class="mt-4 flex flex-wrap gap-2">
          <!-- Seed + LSI chips -->
          <span class="chip">ai content repurposing</span>
          <span class="chip">content repurpose</span>
          <span class="chip">repurpose content</span>
          <span class="chip">content repurposing tool</span>
          <span class="chip">content repurposing ai</span>
          <span class="chip">content repurposing ideas</span>
          <span class="chip">repurpose content ai</span>
          <span class="chip">repurpose blog to linkedin</span>
          <span class="chip">repurpose blog to x</span>
          <span class="chip">repurpose blog to instagram</span>
          <span class="chip">email to linkedin</span>
          <span class="chip">email to trello</span>
          <span class="chip">notion export</span>
          <span class="chip">trello export</span>
          <span class="chip">batch content generation</span>
          <span class="chip">social media repurposing</span>
          <span class="chip">linkedin post generator</span>
          <span class="chip">x post generator</span>
          <span class="chip">instagram caption generator</span>
          <span class="chip">newsletter repurposing</span>
          <span class="chip">ai content generator</span>
          <span class="chip">content repurposing platform</span>
          <span class="chip">content repurposing software</span>
          <span class="chip">repurpose podcast</span>
          <span class="chip">turn transcript to posts</span>
          <span class="chip">seo content repurposing</span>
          <span class="chip">short-form repurposing</span>
          <span class="chip">long-form to threads</span>
          <span class="chip">content calendar trello</span>
          <span class="chip">notion content calendar</span>
          <span class="chip">byok llm</span>
          <span class="chip">openrouter models</span>
          <span class="chip">gemma llama mistral</span>
          <span class="chip">brand tone</span>
          <span class="chip">hashtag suggestions</span>
          <span class="chip">hooks & headlines</span>
          <span class="chip">call-to-action</span>
          <span class="chip">repurpose video notes</span>
          <span class="chip">thought leadership</span>
          <span class="chip">growth marketing</span>
          <span class="chip">b2b linkedin</span>
          <span class="chip">ugc captions</span>
          <span class="chip">ai marketing tools</span>
          <span class="chip">content automation</span>
          <span class="chip">repurpose content workflow</span>
          <span class="chip">content snippets</span>
          <span class="chip">content templates</span>
          <span class="chip">repurpose case study</span>
          <span class="chip">repurpose webinar</span>
          <span class="chip">repurpose whitepaper</span>
          <span class="chip">repurpose email</span>
          <span class="chip">repurpose notes</span>
          <span class="chip">content repurposing strategy</span>
          <span class="chip">social cross-posting</span>
          <span class="chip">editorial calendar</span>
          <span class="chip">ai outline</span>
          <span class="chip">rewrite & shorten</span>
          <span class="chip">tone & style control</span>
        </div>
      </div>
    </section>

    <!-- === FAQs (guest only) === -->
    <section id="faqs" class="mt-16">
      <div class="max-w-7xl mx-auto px-4 md:px-5">
        <h2 class="text-xl md:text-2xl font-bold tracking-tight">Frequently asked questions</h2>
        <div class="mt-5 grid md:grid-cols-2 gap-4">
          <div class="card p-4">
            <div class="font-semibold">What is ContentRepurpose?</div>
            <p class="text-slate-500 text-sm mt-1">An AI repurposing tool that turns one source (blog, email, notes) into channel-ready drafts for LinkedIn, X, Instagram and Email. Exports to Notion and Trello.</p>
          </div>
          <div class="card p-4">
            <div class="font-semibold">Do I need to log in for the demo?</div>
            <p class="text-slate-500 text-sm mt-1">No. The Live Demo gives 5 runs per month without login. Sign in for saved presets, exports, batch inputs, and more.</p>
          </div>
          <div class="card p-4">
            <div class="font-semibold">How do exports work?</div>
            <p class="text-slate-500 text-sm mt-1">Connect Notion or Trello once, then export any result as a page or card with a single click.</p>
          </div>
          <div class="card p-4">
            <div class="font-semibold">Can I use my own model key (BYOK)?</div>
            <p class="text-slate-500 text-sm mt-1">Yes. Add your OpenRouter key to run models like Gemma, Llama, or Mistral directly under your quota.</p>
          </div>
          <div class="card p-4">
            <div class="font-semibold">Is there a Free plan?</div>
            <p class="text-slate-500 text-sm mt-1">Yes. Free users can try the core generator and save 1 preset. Upgrade for higher limits, batch inputs, and business features.</p>
          </div>
          <div class="card p-4">
            <div class="font-semibold">Do you support teams?</div>
            <p class="text-slate-500 text-sm mt-1">Yes. Business Teams include seats, invites, and member management. Owner controls usage and exports.</p>
          </div>
        </div>
      </div>

      <!-- FAQPage JSON-LD -->
      <script type="application/ld+json">{
        "@context":"https://schema.org",
        "@type":"FAQPage",
        "mainEntity":[
          {"@type":"Question","name":"What is ContentRepurpose?","acceptedAnswer":{"@type":"Answer","text":"An AI repurposing tool that turns one source into channel-ready drafts for LinkedIn, X, Instagram and Email — with one-click export to Notion and Trello."}},
          {"@type":"Question","name":"Do I need to log in for the demo?","acceptedAnswer":{"@type":"Answer","text":"No. The Live Demo gives 5 runs per month without login. Sign in for saved presets, exports, batch inputs, and more."}},
          {"@type":"Question","name":"How do exports work?","acceptedAnswer":{"@type":"Answer","text":"Connect Notion or Trello once, then export any result as a page or card with a single click."}},
          {"@type":"Question","name":"Can I use my own model key (BYOK)?","acceptedAnswer":{"@type":"Answer","text":"Yes. Add your OpenRouter key to run models like Gemma, Llama, or Mistral directly under your quota."}},
          {"@type":"Question","name":"Is there a Free plan?","acceptedAnswer":{"@type":"Answer","text":"Yes. Free users can try the core generator and save 1 preset. Upgrade for higher limits, batch inputs, and business features."}},
          {"@type":"Question","name":"Do you support teams?","acceptedAnswer":{"@type":"Answer","text":"Yes. Business Teams include seats, invites, and member management. Owner controls usage and exports."}}
        ]
      }</script>
    </section>

    <!-- === PRICING (guest only) === -->
    <section id="pricing" class="mt-16">
      <div class="max-w-7xl mx-auto px-4 md:px-5">
        <h2 class="text-xl md:text-2xl font-bold tracking-tight">Pricing</h2>
        <p class="text-slate-500 text-sm">Use code <strong>CONTENTOFF90</strong> for <span class="txt-grad font-semibold">90% off</span> Creator — limited first users.</p>

        <div class="grid md:grid-cols-3 gap-4 mt-5">
          <div class="card p-5">
            <div class="text-lg font-semibold">Free</div>
            <ul class="mt-3 text-sm text-slate-500 space-y-2">
              <li>✓ Core generator</li>
              <li>✓ 1 saved preset</li>
              <li>— Batch inputs</li>
              <li>— Business Teams</li>
            </ul>
            <div class="mt-4">
              <button class="btn w-full" data-action="signup">Get started</button>
            </div>
          </div>

          <div class="card p-5 border-2 border-white/60">
            <div class="text-lg font-semibold flex items-center justify-between">
              <span>Creator</span>
              <span class="chip">-90% with code</span>
            </div>
            <ul class="mt-3 text-sm text-slate-500 space-y-2">
              <li>✓ Higher daily/monthly runs</li>
              <li>✓ Batch inputs</li>
              <li>✓ Export to Notion/Trello</li>
              <li>— Business Teams</li>
            </ul>
            <div class="mt-4">
              <button class="btn btn-primary w-full" data-plan="creator" data-checkout>Upgrade</button>
            </div>
          </div>

          <div class="card p-5">
            <div class="text-lg font-semibold">Business</div>
            <ul class="mt-3 text-sm text-slate-500 space-y-2">
              <li>✓ Everything in Creator</li>
              <li>✓ Team seats & invites</li>
              <li>✓ Org management</li>
              <li>✓ White label options</li>
            </ul>
            <div class="mt-4">
              <button class="btn w-full" data-plan="business" data-checkout>Start Business</button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div> <!-- /#marketing -->
  <!-- =========================
       MEMBER DASHBOARD (signed-in)
  ========================== -->
  <section id="memberView" class="hidden">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-8">
      <!-- Header -->
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
        <div>
          <h2 class="text-2xl md:text-3xl font-extrabold tracking-tight">Dashboard</h2>
          <p class="text-slate-500 dark:text-slate-300">Welcome back, <span id="userEmail" class="font-medium"></span></p>
        </div>
        <div class="flex items-center gap-3">
          <span id="memberPlanBadge" class="px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/50">Plan: Free</span>
          <button id="manageBilling2" class="px-3 py-1 rounded-lg border hidden" type="button">Manage billing</button>
          <button id="logoutBtn2" class="px-3 py-1 rounded-lg border" type="button">Sign out</button>
        </div>
      </div>

      <!-- Top Quota Cards -->
      <div id="quotaCards" class="grid sm:grid-cols-2 lg:grid-cols-4 gap-5 mb-6"></div>

      <!-- Generator -->
      <div class="card p-6">
        <div class="flex items-center justify-between gap-3 flex-wrap">
          <h3 class="text-xl font-bold tracking-tight">Create new content</h3>
          <div class="flex items-center gap-3 flex-wrap">
            <label class="text-xs flex items-center gap-2">
              <input id="whitelabel" type="checkbox" class="hidden">
              <span id="wlLabel" class="chip hidden">White-label export</span>
            </label>
            <button id="exportPack" class="btn hidden" type="button">Export Project Pack (.md)</button>
            <span id="quotaMember" class="px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/50">Today: 0/5</span>
          </div>
        </div>

        <textarea id="source_m" class="mt-4 w-full h-40 p-3 rounded-xl border border-slate-200/70 focus:outline-none focus:ring-2 focus:ring-slate-300 dark:bg-black/30" placeholder="Paste a paragraph or idea…"></textarea>

        <!-- BYOK quick settings -->
        <details class="mt-4">
          <summary class="cursor-pointer text-sm text-slate-500">BYOK settings (optional)</summary>
          <div class="grid md:grid-cols-3 gap-3 mt-3">
            <input id="model_m" class="p-2 rounded-xl border border-slate-200/70 dark:bg-black/30" placeholder="Preferred model (optional)" />
            <select id="byok_provider_m" class="p-2 rounded-xl border border-slate-200/70 dark:bg-black/30">
              <option value="">Provider (auto)</option>
              <option value="openrouter">OpenRouter</option>
              <option value="openai">OpenAI</option>
              <option value="anthropic">Anthropic</option>
              <option value="together">Together</option>
              <option value="groq">Groq</option>
              <option value="custom">Custom (OpenAI-compatible)</option>
            </select>
            <input id="byok_key_m" class="p-2 rounded-xl border border-slate-200/70 dark:bg-black/30" placeholder="Your API key (BYOK)" />
            <input id="byok_base_m" class="p-2 rounded-xl border border-slate-200/70 dark:bg-black/30 md:col-span-2" placeholder="Custom base URL (if custom provider)" />
            <button id="save_m" class="px-4 py-2 rounded-xl font-semibold border border-slate-300/60 hover:bg-white/50" type="button">Save to my account</button>
          </div>
          <p class="text-xs text-slate-500 mt-2">Your BYOK is used only when you click “Generate with your BYOK”.</p>
        </details>

        <div class="mt-4 flex flex-wrap items-center gap-3">
          <button id="run_m" class="px-4 py-2 rounded-xl font-semibold text-white bg-black hover:opacity-90" type="button">Generate</button>
          <button id="run-byok_m" class="px-4 py-2 rounded-xl font-semibold text-white bg-emerald-600 hover:opacity-90" type="button">Generate with your BYOK</button>
          <button id="clear_m" class="px-4 py-2 rounded-xl font-semibold border border-slate-300/60 hover:bg:white/50" type="button">Clear</button>
          <span id="status_m" class="text-sm text-slate-500" role="status" aria-live="polite"></span>
        </div>
      </div>

      <!-- Batch Inputs (Starter+) -->
      <div class="card p-6 mt-6">
        <div class="flex items-center justify-between gap-3 flex-wrap">
          <h3 class="text-lg font-bold">Batch inputs</h3>
          <span id="batchNote" class="text-xs text-slate-500">Upgrade to enable batch runs.</span>
        </div>
        <textarea id="batch_inputs" class="mt-3 w-full h-32 p-3 rounded-xl border border-slate-200/70 focus:outline-none focus:ring-2 focus:ring-slate-300 dark:bg-black/30" placeholder="One idea per line (each line runs as a separate generation)…" disabled></textarea>
        <div class="mt-3 flex items-center gap-2">
          <button id="run_batch" class="btn hidden" type="button">Run batch</button>
          <div class="text-xs text-slate-500">Progress:</div>
        </div>
        <ul id="batch_progress" class="mt-2 text-sm space-y-1"></ul>
      </div>

      <!-- Outputs + Publish -->
      <div class="grid lg:grid-cols-2 gap-5 mt-6">
        <!-- LinkedIn -->
        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight inline-flex items-center gap-2">LinkedIn</strong>
            <div class="flex items-center gap-2">
              <button id="copy-li_m" class="px-3 py-1 rounded-full text-xs border" type="button">Copy</button>
              <button id="publish-li_m" class="px-3 py-1 rounded-full text-xs border" type="button">Publish</button>
              <button id="li-notion" class="px-3 py-1 rounded-full text-xs border hidden" type="button">Export to Notion</button>
              <button id="li-trello" class="px-3 py-1 rounded-full text-xs border hidden" type="button">Send to Trello</button>
              <button id="li-buffer" class="px-3 py-1 rounded-full text-xs border hidden" type="button">Queue in Buffer</button>
            </div>
          </div>
          <pre id="out-li_m" class="whitespace-pre-wrap text-sm mt-3"></pre>
        </div>

        <!-- X -->
        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight inline-flex items-center gap-2">X (Twitter)</strong>
            <div class="flex items-center gap-2">
              <button id="copy-x_m" class="px-3 py-1 rounded-full text-xs border" type="button">Copy</button>
              <button id="publish-x_m" class="px-3 py-1 rounded-full text-xs border" type="button">Publish</button>
              <button id="x-notion" class="px-3 py-1 rounded-full text-xs border hidden" type="button">Export to Notion</button>
              <button id="x-trello" class="px-3 py-1 rounded-full text-xs border hidden" type="button">Send to Trello</button>
              <button id="x-buffer" class="px-3 py-1 rounded-full text-xs border hidden" type="button">Queue in Buffer</button>
            </div>
          </div>
          <pre id="out-x_m" class="whitespace-pre-wrap text-sm mt-3"></pre>
        </div>

        <!-- Email -->
        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight inline-flex items-center gap-2">Email</strong>
            <div class="flex items-center gap-2">
              <button id="copy-em_m" class="px-3 py-1 rounded-full text-xs border" type="button">Copy</button>
              <button id="publish-em_m" class="px-3 py-1 rounded-full text-xs border" type="button">Preview &amp; Send</button>
              <button id="em-notion" class="px-3 py-1 rounded-full text-xs border hidden" type="button">Export to Notion</button>
              <button id="em-trello" class="px-3 py-1 rounded-full text-xs border hidden" type="button">Send to Trello</button>
              <button id="em-buffer" class="px-3 py-1 rounded-full text-xs border hidden" type="button">Queue in Buffer</button>
            </div>
          </div>
          <div class="text-xs text-slate-400">Subject:</div>
          <pre id="out-em-subj_m" class="whitespace-pre-wrap text-sm mt-1"></pre>
          <div class="text-xs text-slate-400 mt-3">Body:</div>
          <pre id="out-em-body_m" class="whitespace-pre-wrap text-sm mt-1"></pre>
        </div>

        <!-- Instagram -->
        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight inline-flex items-center gap-2">Instagram</strong>
            <div class="flex items-center gap-2">
              <button id="copy-ig_m" class="px-3 py-1 rounded-full text-xs border" type="button">Copy</button>
              <button id="publish-ig_m" class="px-3 py-1 rounded-full text-xs border" type="button">Open Creator Studio</button>
              <button id="ig-notion" class="px-3 py-1 rounded-full text-xs border hidden" type="button">Export to Notion</button>
              <button id="ig-trello" class="px-3 py-1 rounded-full text-xs border hidden" type="button">Send to Trello</button>
              <button id="ig-buffer" class="px-3 py-1 rounded-full text-xs border hidden" type="button">Queue in Buffer</button>
            </div>
          </div>
          <pre id="out-ig_m" class="whitespace-pre-wrap text-sm mt-3"></pre>
        </div>
      </div>

      <!-- Saved Presets + Growth -->
      <div class="grid md:grid-cols-2 gap-5 mt-6">
        <!-- Saved Presets (enforce Free: 1 preset) -->
        <div class="card p-5">
          <div class="flex items-center justify-between gap-2">
            <strong>Saved presets</strong>
            <button id="addPreset" class="px-3 py-1 rounded-xl border" type="button">Save current</button>
          </div>
          <p class="text-xs text-slate-500 mt-2">Free: 1 • Solo Creator: 10 • Creator/Business: Unlimited</p>
          <ul id="presetList" class="mt-3 text-sm space-y-2"></ul>
        </div>

        <!-- Growth / Referrals -->
        <div class="card p-5">
          <strong>Grow your daily quota</strong>
          <p class="text-sm text-slate-500 mt-2">Share your invite to unlock bonus runs (visual; enforcement handled by Worker).</p>
          <div class="mt-3 grid gap-2">
            <input id="refLink" class="p-2 rounded-xl border border-slate-200/70 dark:bg-black/30" readonly value="">
            <div class="flex flex-wrap gap-2">
              <button id="shareLi" class="px-3 py-2 rounded-xl border" type="button">Share on LinkedIn</button>
              <button id="shareX" class="px-3 py-2 rounded-xl border" type="button">Share on X</button>
              <button id="copyRef" class="px-3 py-2 rounded-xl border" type="button">Copy link</button>
            </div>
          </div>
          <p id="refNote" class="text-xs text-slate-500 mt-2">Referrals this month: <span id="refCount">0</span></p>
        </div>
      </div>

      <!-- Plan Features -->
      <div class="card p-6 mt-6">
        <h3 class="text-lg font-bold">Your plan includes</h3>
        <ul id="featureList" class="mt-3 text-sm space-y-1"></ul>
      </div>

      <!-- Integrations (Creator+/Business) -->
      <div class="card p-6 mt-6" id="integrationsCard">
        <h3 class="text-lg font-bold">Integrations</h3>
        <div class="grid md:grid-cols-3 gap-4 mt-3">
          <div class="p-4 rounded-xl border">
            <div class="flex items-center justify-between">
              <strong>Notion</strong><span id="notionState" class="chip">Disconnected</span>
            </div>
            <p class="text-xs text-slate-500 mt-1">Export pages to your workspace.</p>
            <div class="mt-3 flex gap-2">
              <button id="connectNotion" class="btn" type="button">Connect</button>
              <button id="disconnectNotion" class="btn hidden" type="button">Disconnect</button>
            </div>
          </div>
          <div class="p-4 rounded-xl border">
            <div class="flex items-center justify-between">
              <strong>Trello</strong><span id="trelloState" class="chip">Disconnected</span>
            </div>
            <p class="text-xs text-slate-500 mt-1">Send drafts as cards.</p>
            <div class="mt-3 flex gap-2">
              <button id="connectTrello" class="btn" type="button">Connect</button>
              <button id="disconnectTrello" class="btn hidden" type="button">Disconnect</button>
            </div>
          </div>
          <div class="p-4 rounded-xl border">
            <div class="flex items-center justify-between">
              <strong>Buffer</strong><span id="bufferState" class="chip">Disconnected</span>
            </div>
            <p class="text-xs text-slate-500 mt-1">Queue posts to social profiles.</p>
            <div class="mt-3 flex gap-2">
              <button id="connectBuffer" class="btn" type="button">Connect</button>
              <button id="disconnectBuffer" class="btn hidden" type="button">Disconnect</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Team (Business) -->
      <div class="card p-6 mt-6" id="teamCard">
        <h3 class="text-lg font-bold">Team (Business)</h3>
        <div class="mt-2 flex gap-2">
          <input id="inviteEmail" class="p-2 rounded-xl border flex-1" placeholder="teammate@company.com">
          <button id="inviteBtn" class="btn" type="button">Invite member</button>
        </div>
        <ul id="seatList" class="mt-3 text-sm space-y-1"></ul>
        <div class="mt-4 text-xs text-slate-500">Content Calendar (Coming Soon)</div>
      </div>
    </div>
  </section>

  <!-- =========================
       FOOTER (shared)
  ========================== -->
  <footer class="py-10 text-center text-xs text-slate-500">
    © <span id="year"></span> ContentRepurpose
    • <a class="underline hover:opacity-80" href="https://contentrepurpose.pro/privacy">Privacy</a>
    • <a class="underline hover:opacity-80" href="https://contentrepurpose.pro/terms">Terms</a>
  </footer>

  <!-- =========================
       MODALS
  ========================== -->

  <!-- Auth Modal -->
  <dialog id="auth" class="rounded-2xl p-0 w-[520px] max-w-[92vw] bg-neutral-900 text-white border border-white/10">
    <form method="dialog">
      <div class="p-6 space-y-3">
        <h3 class="text-xl text-white font-bold">Sign in</h3>
        <p class="text-white/70 text-sm">Use Google or request a magic link.</p>
        <button id="googleBtn" class="w-full px-4 py-2 rounded-xl bg-white text-black font-semibold" type="button">Continue with Google</button>
        <div class="flex items-center gap-3 text-xs text-white/50"><span class="flex-1 h-px bg-white/10"></span>or<span class="flex-1 h-px bg-white/10"></span></div>
        <div class="grid gap-2">
          <input id="emailInput" type="email" placeholder="you@company.com" class="p-2 rounded-xl border border-white/15 bg-white/5">
          <button id="magicBtn" class="px-4 py-2 rounded-xl bg-white/10" type="button">Send magic link</button>
        </div>
        <div class="text-xs text-white/50">We never store your BYOK.</div>
      </div>
    </form>
  </dialog>

  <!-- Email Preview Modal -->
  <dialog id="emailPreview" class="rounded-2xl p-0 w-[720px] max-w-[96vw] bg-neutral-900 text-white border border-white/10">
    <form method="dialog" class="p-6 space-y-3">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-bold">Preview email</h3>
        <button value="cancel" class="px-3 py-1 rounded-lg border border-white/20">Close</button>
      </div>
      <label class="text-sm">Subject</label>
      <input id="emailSubjEdit" class="w-full p-2 rounded-xl border border-white/15 bg-white/5" />
      <label class="text-sm">Body</label>
      <textarea id="emailBodyEdit" class="w-full h-52 p-2 rounded-xl border border-white/15 bg-white/5"></textarea>
      <div class="flex justify-end gap-2">
        <button id="emailSendBtn" class="px-4 py-2 rounded-xl bg-white text-black font-semibold" type="button">Open in email client</button>
      </div>
    </form>
  </dialog>

  <!-- Trello Picker Modal -->
  <dialog id="trelloModal" class="rounded-2xl p-0 w-[520px] max-w-[92vw] bg-neutral-900 text-white border border-white/10">
    <form method="dialog" class="p-6 space-y-3">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-bold">Send to Trello</h3>
        <button value="cancel" class="px-3 py-1 rounded-lg border border-white/20">Close</button>
      </div>
      <input id="trelloBoardId" class="w-full p-2 rounded-xl border border-white/15 bg-white/5" placeholder="Board ID (paste for now)" />
      <input id="trelloListId" class="w-full p-2 rounded-xl border border-white/15 bg-white/5" placeholder="List ID" />
      <button id="trelloConfirm" class="w-full px-4 py-2 rounded-xl bg-white text-black font-semibold" type="button">Send</button>
    </form>
  </dialog>

  <!-- Buffer Picker Modal -->
  <dialog id="bufferModal" class="rounded-2xl p-0 w-[520px] max-w-[92vw] bg-neutral-900 text-white border border-white/10">
    <form method="dialog" class="p-6 space-y-3">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-bold">Queue in Buffer</h3>
        <button value="cancel" class="px-3 py-1 rounded-lg border border-white/20">Close</button>
      </div>
      <select id="bufferProfile" class="w-full p-2 rounded-xl border border-white/15 bg-white/5"></select>
      <button id="bufferConfirm" class="w-full px-4 py-2 rounded-xl bg-white text-black font-semibold" type="button">Queue</button>
    </form>
  </dialog>

  <!-- Upgrade Modal (shown when Free tries to save > 1 preset) -->
  <dialog id="upgradeModal" class="rounded-2xl p-0 w-[560px] max-w-[92vw] bg-neutral-900 text-white border border-white/10">
    <form method="dialog" class="p-6 space-y-3">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-bold">Unlock more presets</h3>
        <button value="cancel" class="px-3 py-1 rounded-lg border border-white/20">Close</button>
      </div>
      <p class="text-white/80 text-sm">
        Free plan lets you save <strong>1</strong> preset. Upgrade to Creator for more — use code
        <span class="font-semibold">CONTENTOFF90</span> for <span class="txt-grad font-semibold">90% off</span> (limited).
      </p>
      <div class="flex flex-wrap gap-2 mt-2">
        <button class="px-4 py-2 rounded-xl bg-white text-black font-semibold" data-checkout data-plan="creator" type="button">Upgrade to Creator</button>
        <a href="#pricing" class="px-4 py-2 rounded-xl border border-white/20" role="button">See pricing</a>
      </div>
    </form>
  </dialog>

  <!-- Toast -->
  <div id="toast" class="toast hidden fixed bottom-6 left-1/2 -translate-x-1/2 z-50">
    <div id="toastMsg" class="px-3 py-2 rounded-lg bg-black text-white text-sm shadow-lg"></div>
  </div>
  <!-- APP SCRIPT (module so top-level await is valid) -->
  <script type="module">
    /* =========================
       CONFIG & GLOBAL HELPERS
    ========================== */
    const WORKER_BASE = "https://contentflow-worker.frank-couchman.workers.dev";
    const STRIPE_PUBLISHABLE_KEY = "pk_test_12345_placeholder"; // replace in prod

    // --- Supabase via ESM ---
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const SUPABASE_URL  = "https://ynkoavaeadlzlwylmfmu.supabase.co";
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlua29hdmFlYWRsemx3eWxtZm11Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5OTAxNDgsImV4cCI6MjA3MzU2NjE0OH0.1yM5yDo0MI9Upzt4GkLyf1mqvDXfb3DXvC0ouOLtRoU";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON);

    // Track current plan + preset count for gating
    let LAST_STATUS = null;
    let CURRENT_PLAN = "free";
    let CURRENT_PRESET_COUNT = 0;

    supabase.auth.onAuthStateChange(() => {
      paintAuth();
      refreshAll();
      loadMemberBYOK();
    });

    // Stripe
    let stripe = null;
    if (window.Stripe) {
      try { stripe = window.Stripe(STRIPE_PUBLISHABLE_KEY); } catch {}
    }

    // Helpers
    const $  = (s) => document.querySelector(s);
    const $$ = (s) => Array.from(document.querySelectorAll(s));
    const byId = (id) => document.getElementById(id);
    byId("year") && (byId("year").textContent = new Date().getFullYear());
    const showToast = (msg) => {
      const t = byId("toast"), m = byId("toastMsg");
      if (!t || !m) return;
      m.textContent = msg;
      t.classList.remove("hidden");
      setTimeout(()=>t.classList.add("hidden"), 1800);
    };

    const PLAN_LABEL = (p)=>{
      if (!p || p==="free") return "Free";
      if (p==="starter") return "Solo Creator";
      if (p==="creator") return "Creator";
      if (p==="business") return "Business";
      return "Free";
    };

    const SOFT_DAILY_PLATFORM = { free:5, starter:10, creator:30, business:80 };
    const PRICES = {
      starter:  "price_1S7y58JYjIKHzKcjzL7cIKiB",
      creator:  "price_1S7y77JYjIKHzKcjKQYjiqZH",
      business: "price_1S7y8OJYjIKHzKcjqA9uJdyh"
    };

    // Feature lists
    const PLAN_FEATURES = {
      free: [
        "5/day platform runs (signed-in)",
        "BYOK: 5/day",
        "CSV/Markdown export",
        "1 saved preset"
      ],
      starter: [
        "200 generations / month",
        "Batch inputs",
        "10 saved presets",
        "Priority models"
      ],
      creator: [
        "500 generations / month",
        "Unlimited presets",
        "Project pack export",
        "Notion export + Trello boards",
        "New workflows early"
      ],
      business: [
        "Unlimited (fair use)",
        "3 seats",
        "White-label export",
        "Priority support",
        "All Creator integrations",
        "Team presets & shared calendar"
      ]
    };

    // Optional plan override for demos
    (function planOverrideFromURL(){
      const params = new URLSearchParams(location.search);
      const incoming = (params.get("plan")||"").toLowerCase();
      if (incoming && ["starter","creator","business"].includes(incoming)) {
        try { localStorage.setItem("plan", incoming); } catch {}
        history.replaceState({}, "", location.pathname);
      }
    })();

    function paintPlanBadge(plan){
      const label = PLAN_LABEL(plan);
      byId("planbadge") && (byId("planbadge").textContent = `Plan: ${label}`);
      const mb = byId("memberPlanBadge");
      if (mb) mb.textContent = `Plan: ${label}`;
      const pm = byId("planbadge_m");
      if (pm) pm.textContent = `Plan: ${label}`;
    }

    /* =========================
       VIEW + NAV
    ========================== */
    function showView(isAuthenticated){
      const guest  = byId("guestView");
      const member = byId("memberView");
      if (isAuthenticated){
        document.body.setAttribute("data-auth","member");
        guest?.classList.add("hidden");
        member?.classList.remove("hidden");
        ["loginBtn","heroSignIn"].forEach(id=> byId(id)?.classList.add("hidden"));
        ["logoutBtn","logoutBtn2"].forEach(id=> byId(id)?.classList.remove("hidden"));
        byId("heroBadgeWrap")?.classList.add("hidden");
        byId("marketing") && byId("marketing").classList.add("hidden");
      } else {
        document.body.setAttribute("data-auth","guest");
        member?.classList.add("hidden");
        guest?.classList.remove("hidden");
        ["loginBtn","heroSignIn"].forEach(id=> byId(id)?.classList.remove("hidden"));
        ["logoutBtn","logoutBtn2"].forEach(id=> byId(id)?.classList.add("hidden"));
        byId("heroBadgeWrap")?.classList.remove("hidden");
        byId("marketing") && byId("marketing").classList.remove("hidden");
      }
    }

    function applyViewOverride(isAuthenticated){
      if (isAuthenticated) return;
      let o = "";
      try { o = (localStorage.getItem("viewOverride")||"").toLowerCase(); } catch {}
      if (o === "member") showView(true);
      else if (o === "guest") showView(false);
    }

    // Mobile nav
    (function initMobileNav(){
      const sheet = byId("mobileNav");
      const openBtn = byId("navToggle");
      const closeBtn = byId("navClose");
      const close = ()=>{ document.documentElement.classList.remove("nav-open"); sheet?.setAttribute("aria-hidden","true"); openBtn?.setAttribute("aria-expanded","false"); };
      const open  = ()=>{ document.documentElement.classList.add("nav-open"); sheet?.setAttribute("aria-hidden","false"); openBtn?.setAttribute("aria-expanded","true"); };
      openBtn && openBtn.addEventListener("click", ()=> document.documentElement.classList.contains("nav-open") ? close() : open());
      closeBtn && closeBtn.addEventListener("click", close);
      sheet && sheet.addEventListener("click", (e)=>{ if (e.target === sheet) close(); });
      byId("manageBilling_m")?.addEventListener("click", ()=> byId("manageBilling")?.click());
      byId("loginBtn_m")?.addEventListener("click", ()=> byId("loginBtn")?.click());
      byId("logoutBtn_m")?.addEventListener("click", ()=> byId("logoutBtn")?.click());
      sheet?.querySelectorAll("a").forEach(a=> a.addEventListener("click", close));
    })();

    /* =========================
       PROMO BANNER (if present)
    ========================== */
    (function promoInit(){
      const banner = byId("promoBanner");
      const close  = byId("promoClose");
      if (!banner) return;
      try {
        const dismissed = localStorage.getItem("promoBannerDismissed");
        if (dismissed) banner.remove();
      } catch {}
      close && close.addEventListener("click", ()=>{
        banner.remove();
        try { localStorage.setItem("promoBannerDismissed","1"); } catch {}
      });
    })();

    /* =========================
       AUTH
    ========================== */
    async function getAuth(){
      if (!supabase) return { token:null, userId:null, email:null };
      const { data:{ session } } = await supabase.auth.getSession();
      return {
        token:  session?.access_token || null,
        userId: session?.user?.id || null,
        email:  session?.user?.email || null
      };
    }

    async function paintAuth(){
      const { token, userId, email } = await getAuth();
      const isAuthed = !!userId;
      showView(isAuthed);
      if (!isAuthed) applyViewOverride(false);
      const heroBadge = byId("heroBadge");
      if (heroBadge) heroBadge.textContent = isAuthed ? "Signed-in — welcome back" : "Demo — 5 runs / month (no login)";
      const ue = byId("userEmail");
      if (ue) ue.textContent = isAuthed ? (email || "member") : "";
      return { token, userId, email };
    }

    byId("loginBtn")?.addEventListener("click", (e)=>{ e.preventDefault(); byId("auth")?.showModal(); });
    byId("heroSignIn")?.addEventListener("click", (e)=>{ e.preventDefault(); byId("auth")?.showModal(); });

    const doSignOut = async()=>{
      if (!supabase?.auth) { showToast("Auth not initialized"); return; }
      await supabase.auth.signOut();
      try { localStorage.removeItem("viewOverride"); } catch {}
      await paintAuth();
      await refreshAll();
    };
    byId("logoutBtn")?.addEventListener("click", doSignOut);
    byId("logoutBtn2")?.addEventListener("click", doSignOut);

    byId("googleBtn")?.addEventListener("click", async (e)=>{
      e.preventDefault();
      if (!supabase) return alert("Auth not initialized");
      const { error } = await supabase.auth.signInWithOAuth({
        provider: "google",
        options: { redirectTo: location.href }
      });
      if (error) alert(error.message || String(error));
    });

    byId("magicBtn")?.addEventListener("click", async (e)=>{
      e.preventDefault();
      if (!supabase) return alert("Auth not initialized");
      const email = (byId("emailInput")?.value||"").trim();
      if (!email) return alert("Enter an email");
      const { error } = await supabase.auth.signInWithOtp({ email, options:{ emailRedirectTo: location.href }});
      if (error) return alert(error.message || String(error));
      alert("Magic link sent. Check your inbox.");
      byId("auth")?.close();
    });

    /* =========================
       BILLING
    ========================== */
    async function getAuthHeaders(){
      const { token, userId } = await getAuth();
      const headers = { "Content-Type":"application/json" };
      if (token) headers["Authorization"] = `Bearer ${token}`;
      if (userId) headers["X-User-Id"] = userId;
      return headers;
    }

    async function openCheckout(priceId){
      const { token } = await getAuth();
      if (!token) { byId("auth")?.showModal(); return; }
      const r = await fetch(`${WORKER_BASE}/api/billing/checkout`, {
        method: "POST",
        headers: await getAuthHeaders(),
        body: JSON.stringify({
          price: priceId,
          success_url: "https://contentrepurpose.pro/?billing=success",
          cancel_url: "https://contentrepurpose.pro/?billing=cancel"
        })
      }).catch(()=>null);
      const j = await r?.json().catch(()=> ({}));
      if (j?.url) { location.href = j.url; return; }
      alert(j?.error?.message || "Could not start checkout.");
    }

    async function openPortal(){
      const { token } = await getAuth();
      if (!token) { byId("auth")?.showModal(); return; }
      const r = await fetch(`${WORKER_BASE}/api/billing/portal`, {
        method: "POST",
        headers: await getAuthHeaders(),
        body: JSON.stringify({ return_url: location.href })
      }).catch(()=>null);
      const j = await r?.json().catch(()=> ({}));
      if (j?.url) { location.href = j.url; return; }
      alert(j?.error?.message || "Could not open billing portal.");
    }

    $$(".subBtn").forEach(btn=>{
      btn.addEventListener("click", ()=> openCheckout(btn.getAttribute("data-price")));
    });
    // Upgrade modal CTA
    document.querySelectorAll("[data-checkout][data-plan]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const plan = btn.getAttribute("data-plan");
        if (!PRICES[plan]) return;
        openCheckout(PRICES[plan]);
      });
    });
    byId("manageBilling")?.addEventListener("click", openPortal);
    byId("manageBilling2")?.addEventListener("click", openPortal);

    /* =========================
       PLAN / QUOTAS / STATS
    ========================== */
    async function getPlanStatus(){
      const headers = await getAuthHeaders();
      try {
        const r = await fetch(`${WORKER_BASE}/api/billing/status`, { headers });
        if (r.ok) return await r.json();
      } catch {}
      try {
        const r2 = await fetch(`${WORKER_BASE}/api/quota`, { headers });
        if (r2.ok) return await r2.json();
      } catch {}
      return null;
    }

    const planKeyFromStatus = (s)=>{
      const p = (s?.plan || s?.monthly?.plan || "free").toLowerCase();
      return ["starter","creator","business"].includes(p) ? p : "free";
    };

    function paintFeatureList(planKey){
      const ul = byId("featureList");
      if (!ul) return;
      const feats = PLAN_FEATURES[planKey] || PLAN_FEATURES.free;
      ul.innerHTML = feats.map(f=>`<li>• ${f}</li>`).join("");
    }

    function paintManageButtons(isSubscribed){
      byId("manageBilling")?.classList.toggle("hidden", !isSubscribed);
      byId("manageBilling2")?.classList.toggle("hidden", !isSubscribed);
      byId("manageBilling_m")?.classList.toggle("hidden", !isSubscribed);
    }

    function paintTopBadges(status){
      const planKey = planKeyFromStatus(status||{});
      CURRENT_PLAN = planKey;
      paintPlanBadge(planKey);
      const q = byId("quota");
      if (q) {
        const usedM = status?.platform?.monthly?.used ?? status?.platform?.used ?? status?.monthly?.used ?? status?.used ?? 0;
        const capM  = status?.platform?.monthly?.cap ?? status?.monthly?.cap ?? 5;
        q.textContent = `This month: ${usedM}/${capM ?? "∞"}`;
      }
    }

    function tileHtml(title, used, cap, sub){
      const isInf = cap === Number.MAX_SAFE_INTEGER || cap === Infinity || cap === null;
      const pct = isInf ? 0 : Math.max(0, Math.min(100, Math.round((used / (cap||1)) * 100)));
      const capTxt = isInf ? "∞" : cap;
      return `
        <div class="card p-5">
          <div class="flex items-center justify-between">
            <strong>${title}</strong>
            <span class="text-sm text-slate-500">${used}/${capTxt}</span>
          </div>
          <div class="mt-3 h-2 rounded-full bg-slate-200/60 dark:bg-white/10 overflow-hidden" aria-hidden="true">
            <div class="h-2 bg-grad" style="width:${isInf ? "100" : pct}%"></div>
          </div>
          <p class="text-xs text-slate-500 mt-2">${sub||""}</p>
        </div>`;
    }

    function paintQuotaTiles(status){
      const wrap = byId("quotaCards");
      if (!wrap) return;

      const pk = planKeyFromStatus(status);
      const softDaily = SOFT_DAILY_PLATFORM[pk] ?? 5;

      const pDailyUsed = status?.platform?.daily?.used ?? status?.used ?? 0;
      const pDailyCap  = (pk === "free") ? 5 : softDaily;

      const pMonthly = status?.platform?.monthly || status?.monthly || {
        used: 0,
        cap: (pk==='business'? Infinity : (pk==='creator'?500:(pk==='starter'?200:Infinity)))
      };

      const bDaily   = status?.byok?.daily   || (pk==="free" ? { used: 0, cap: 5 } : { used: 0, cap: null });
      const bMonthly = status?.byok?.monthly || { used:0, cap: (pk==='free'?5:(pk==='starter'?50:(pk==='creator'?150:(pk==='business'?300:0)))) };

      wrap.innerHTML = [
        tileHtml("Platform — Today", pDailyUsed||0, pDailyCap, PLAN_LABEL(pk)),
        tileHtml("Platform — This month", pMonthly.used||0, (pMonthly.cap ?? (pk==='business'?Infinity:(pk==='creator'?500:(pk==='starter'?200:Infinity)))), "Generations"),
        tileHtml("BYOK — Today", bDaily.used||0, (pk==='free'?5:(bDaily.cap ?? "∞")), "Your key only"),
        tileHtml("BYOK — This month", bMonthly.used||0, (bMonthly.cap ?? 0), "Your key only")
      ].join("");

      const quotaMember = byId("quotaMember");
      if (quotaMember) quotaMember.textContent = `Today: ${pDailyUsed||0}/${pDailyCap}`;

      paintFeatureList(pk);
    }

    function gateFeaturesByPlan(plan){
      const isStarter = plan==="starter", isCreator = plan==="creator", isBiz = plan==="business";
      byId("integrationsCard")?.classList.toggle("hidden", !(isCreator||isBiz));
      byId("exportPack")?.classList.toggle("hidden", !(isCreator||isBiz));
      byId("wlLabel")?.classList.toggle("hidden", !isBiz);
      byId("teamCard")?.classList.toggle("hidden", !isBiz);

      // Show Notion/Trello buttons only for Creator+
      ["li","x","em","ig"].forEach(p=>{
        ["-notion","-trello"].forEach(s=>{
          const el = byId(`${p}${s}`);
          if (el) el.classList.toggle("hidden", !(isCreator||isBiz));
        });
      });

      // Batch
      const note = byId("batchNote");
      if (note) note.textContent =
        isBiz ? "Business: up to 50 lines/run" :
        isCreator ? "Creator: up to 20 lines/run" :
        isStarter ? "Starter: up to 5 lines/run" :
        "Upgrade to enable batch runs.";
      byId("run_batch")?.classList.toggle("hidden", !(isStarter||isCreator||isBiz));
      const bi = byId("batch_inputs");
      if (bi) {
        if (isStarter||isCreator||isBiz) bi.removeAttribute("disabled");
        else bi.setAttribute("disabled","true");
      }
    }

    async function applyReferralIfPresent(){
      const u = new URL(location.href);
      const ref = u.searchParams.get("ref");
      if (!ref) return;
      const headers = await getAuthHeaders();
      try { await fetch(`${WORKER_BASE}/api/ref/apply?ref=${encodeURIComponent(ref)}`, { headers }); } catch {}
      u.searchParams.delete("ref");
      history.replaceState({}, "", u.pathname + (u.searchParams.toString()?("?"+u.searchParams.toString()):""));
    }

    // Live stats (Generations today)
    async function fetchLiveStats(){
      const headers = await getAuthHeaders();
      const candidates = [
        `${WORKER_BASE}/api/stats`,
        `${WORKER_BASE}/api/stats/today`,
      ];
      for (const url of candidates){
        try{
          const r = await fetch(url, { headers });
          if (!r.ok) continue;
          const j = await r.json();
          const count = j?.today_count ?? j?.today?.count ?? j?.count ?? j?.today ?? null;
          const examples = j?.examples ?? [];
          return { count, examples };
        }catch{}
      }
      return { count:null, examples:[] };
    }

    function paintLiveStats({ count, examples }){
      const cEl = byId("liveCount");
      const feed = byId("liveFeed");
      if (cEl) cEl.textContent = (typeof count === "number" && count>=0) ? String(count) : "–";

      if (feed){
        if (!examples || !examples.length){
          feed.innerHTML = `
            <span class="chip">LinkedIn • SaaS launch tips</span>
            <span class="chip">Email • Weekly digest intro</span>
            <span class="chip">X • 2 short variants</span>
            <span class="chip">Instagram • Caption + hashtags</span>
          `;
        } else {
          const pills = examples.slice(0,24).map(e=>{
            const channel = (e.channel||"").toString().trim() || "Post";
            const text = (e.text||e.preview||e.title||"").toString().trim().slice(0,64);
            const safe = (text||"").replace(/</g,"&lt;").replace(/>/g,"&gt;");
            return `<span class="chip">${channel} • ${safe}${text.length>=64?"…":""}</span>`;
          }).join("");
          feed.innerHTML = pills + pills;
        }
      }
    }

    async function refreshLiveStats(){
      try{
        const data = await fetchLiveStats();
        paintLiveStats(data);
      }catch{
        paintLiveStats({ count:null, examples:[] });
      }
    }

    async function refreshAll(){
      await paintAuth();
      const status = await getPlanStatus();
      LAST_STATUS = status || {};
      CURRENT_PLAN = planKeyFromStatus(LAST_STATUS);
      paintTopBadges(LAST_STATUS);
      paintQuotaTiles(LAST_STATUS);
      const isSub = !!(LAST_STATUS?.is_subscribed || ["starter","creator","business"].includes((LAST_STATUS?.plan||"").toLowerCase()));
      paintManageButtons(isSub);
      gateFeaturesByPlan((LAST_STATUS?.plan||"free").toLowerCase());

      try{
        const email = LAST_STATUS?.email || "";
        const uid = LAST_STATUS?.userId || (email ? email.split('@')[0] : 'guest');
        const code = btoa(uid).replace(/=+$/,'');
        const link = `${location.origin}${location.pathname}?ref=${encodeURIComponent(code)}`;
        const refInput = byId("refLink");
        if (refInput) refInput.value = link;
        const refCount = byId("refCount");
        if (refCount && typeof LAST_STATUS?.referrals_this_month === "number") refCount.textContent = String(LAST_STATUS.referrals_this_month);
      }catch{}
    }

    // Boot
    (async () => {
      try {
        await applyReferralIfPresent();
        await refreshAll();
        await refreshLiveStats();
        let liveTimer = setInterval(()=>{ if (!document.hidden) refreshLiveStats(); }, 30000);
        document.addEventListener("visibilitychange", ()=>{ if (!document.hidden) refreshLiveStats(); });
      } catch (e) { console.error(e); }
    })();

    /* =========================
       PRESETS (Member) — Free plan limit = 1
    ========================== */
    async function renderPresets(){
      const headers = await getAuthHeaders();
      const r = await fetch(`${WORKER_BASE}/api/presets/list`, { headers }).catch(()=>null);
      const j = await r?.json().catch(()=> ({}));
      const list = (j?.presets || []);
      CURRENT_PRESET_COUNT = list.length;
      const ul = byId("presetList");
      if (!ul) return;
      if (!list.length){ ul.innerHTML = `<li class="text-slate-500">No presets saved yet.</li>`; return; }
      ul.innerHTML = "";
      list.forEach(p=>{
        const li = document.createElement("li");
        li.className = "flex items-center justify-between gap-2";
        li.innerHTML = `
          <span class="truncate">${(p.title || "Untitled").replace(/</g,"&lt;")}</span>
          <span class="flex items-center gap-2">
            <button class="px-2 py-1 chip" data-load="${p.id}">Load</button>
            <button class="px-2 py-1 chip" data-del="${p.id}">Delete</button>
          </span>
        `;
        ul.appendChild(li);
      });
      ul.querySelectorAll("[data-del]").forEach(btn=>{
        btn.addEventListener("click", async ()=>{
          const id = btn.getAttribute("data-del");
          const headers = await getAuthHeaders();
          await fetch(`${WORKER_BASE}/api/presets/delete`, { method:"POST", headers, body: JSON.stringify({ id }) }).catch(()=>null);
          renderPresets();
        });
      });
      ul.querySelectorAll("[data-load]").forEach(btn=>{
        btn.addEventListener("click", async ()=>{
          const r2 = await fetch(`${WORKER_BASE}/api/presets/list`, { headers }).catch(()=>null);
          const j2 = await r2?.json().catch(()=> ({}));
          const pres = (j2?.presets || []).find(x => x.id === btn.getAttribute("data-load"));
          if (!pres) return;
          const d = pres.data || {};
          byId("out-li_m") && (byId("out-li_m").textContent = d.linkedin ?? "");
          byId("out-x_m")  && (byId("out-x_m").textContent  = Array.isArray(d.x) ? d.x.join("\n\n—\n\n") : (d.x ?? ""));
          if (d.email?.subject != null) byId("out-em-subj_m") && (byId("out-em-subj_m").textContent = d.email.subject);
          if (d.email?.body != null)    byId("out-em-body_m") && (byId("out-em-body_m").textContent = d.email.body);
          byId("out-ig_m") && (byId("out-ig_m").textContent = d.instagram ?? "");
          showToast("Preset loaded ✓");
        });
      });
    }

    byId("addPreset")?.addEventListener("click", async ()=>{
      // Gate: Free plan can save only 1 preset
      if (CURRENT_PLAN === "free" && CURRENT_PRESET_COUNT >= 1){
        byId("upgradeModal")?.showModal();
        return;
      }

      const data = {
        linkedin:  byId("out-li_m")?.textContent || "",
        x:         (byId("out-x_m")?.textContent || "").split(/\n\s*—\s*\n/).filter(Boolean),
        email:     { subject: byId("out-em-subj_m")?.textContent || "", body: byId("out-em-body_m")?.textContent || "" },
        instagram: byId("out-ig_m")?.textContent || ""
      };
      if (!data.linkedin && !data.instagram && !data.email?.body && !(data.x && data.x.length)){
        alert("Generate or paste something to save."); return;
      }
      const defaultName = (data.email?.subject || (data.linkedin?.split("\n").find(Boolean)) || "Preset").slice(0,80);
      const title = prompt("Preset name?", defaultName) || defaultName;
      const headers = await getAuthHeaders();
      const r = await fetch(`${WORKER_BASE}/api/presets/save`, { method:"POST", headers, body: JSON.stringify({ title, data }) }).catch(()=>null);
      if (r?.ok){ showToast("Preset saved ✓"); renderPresets(); CURRENT_PRESET_COUNT += 1; }
      else { const j = await r?.json().catch(()=> ({})); alert(j?.error?.message || "Could not save preset."); }
    });

    const _origRefreshAll = refreshAll;
    refreshAll = async function(){ await _origRefreshAll(); const { token } = await getAuth(); if (token) renderPresets(); };

    /* =========================
       BYOK (multi-provider)
    ========================== */
    function readGuestBYOK(){
      return {
        provider: sessionStorage.getItem("BYOK_PROVIDER") || "",
        key:      sessionStorage.getItem("BYOK_KEY") || sessionStorage.getItem("BYOK") || "",
        base:     sessionStorage.getItem("BYOK_BASE") || ""
      };
    }
    byId("save")?.addEventListener("click", ()=>{
      sessionStorage.setItem("MODEL", (byId("model")?.value||"").trim());
      sessionStorage.setItem("BYOK_PROVIDER", (byId("byok_provider")?.value||"").trim());
      sessionStorage.setItem("BYOK_KEY", (byId("byok_key")?.value||"").trim());
      sessionStorage.setItem("BYOK", (byId("byok_key")?.value||"").trim()); // backward compat
      sessionStorage.setItem("BYOK_BASE", (byId("byok_base")?.value||"").trim());
      alert("Saved for this tab.");
    });

    async function saveMemberBYOK(){
      const body = {
        provider: (byId("byok_provider_m")?.value||"").trim(),
        key:      (byId("byok_key_m")?.value||"").trim(),
        base:     (byId("byok_base_m")?.value||"").trim(),
        model:    (byId("model_m")?.value||"").trim()
      };
      // Mirror to sessionStorage
      try {
        sessionStorage.setItem("MODEL", body.model || "");
        sessionStorage.setItem("BYOK_PROVIDER", body.provider || "");
        sessionStorage.setItem("BYOK_KEY", body.key || "");
        sessionStorage.setItem("BYOK", body.key || "");
        sessionStorage.setItem("BYOK_BASE", body.base || "");
      } catch {}
      try{
        const r = await fetch(`${WORKER_BASE}/api/byok/save`, {
          method: "POST",
          headers: await getAuthHeaders(),
          body: JSON.stringify(body)
        });
        if (r.ok) { showToast("BYOK saved to your account ✓"); return; }
      }catch{}
      showToast("BYOK saved for this session ✓");
    }
    byId("save_m")?.addEventListener("click", saveMemberBYOK);

    async function loadMemberBYOK(){
      const { userId } = await getAuth();
      if (!userId) return;
      try{
        const r = await fetch(`${WORKER_BASE}/api/byok/get`, { headers: await getAuthHeaders() });
        const j = await r.json();
        if (j?.provider || j?.key || j?.base){
          byId("byok_provider_m") && (byId("byok_provider_m").value = j.provider || "");
          byId("byok_key_m") && (byId("byok_key_m").value = j.key || "");
          byId("byok_base_m") && (byId("byok_base_m").value = j.base || "");
          byId("model_m") && (byId("model_m").value = j.model || "");
          sessionStorage.setItem("MODEL", j.model || "");
          sessionStorage.setItem("BYOK_PROVIDER", j.provider || "");
          sessionStorage.setItem("BYOK_KEY", j.key || "");
          sessionStorage.setItem("BYOK", j.key || "");
          sessionStorage.setItem("BYOK_BASE", j.base || "");
        }
      }catch{}
    }

    function applyBYOKHeaders(headers, { provider, key, base }){
      if (!key) return;
      headers["X-BYOK-Provider"] = provider || "";
      headers["X-User-API-Key"] = key;
      if (base) headers["X-User-API-Base"] = base;
      headers["X-User-OpenRouter-Key"] = key; // compatibility
    }

    /* =========================
       GUEST GENERATION
    ========================== */
    byId("run")?.addEventListener("click", ()=> runGen({ useBYOK:false }));
    byId("run-byok")?.addEventListener("click", ()=> runGen({ useBYOK:true }));
    byId("clear")?.addEventListener("click", ()=>{
      ["#out-li","#out-x","#out-em-subj","#out-em-body","#out-ig"].forEach(sel=> { const el = document.querySelector(sel); if (el) el.textContent = ""; });
      byId("source") && (byId("source").value = "");
      byId("status") && (byId("status").textContent = "");
      byId("dl-md") && (byId("dl-md").disabled = true);
      byId("dl-csv") && (byId("dl-csv").disabled = true);
    });

    byId("copy-li")?.addEventListener("click", ()=> navigator.clipboard.writeText(byId("out-li")?.textContent || ""));
    byId("copy-x")?.addEventListener("click",  ()=> navigator.clipboard.writeText(byId("out-x")?.textContent || ""));
    byId("copy-em")?.addEventListener("click", ()=>{
      const subj = byId("out-em-subj")?.textContent || "";
      const body = byId("out-em-body")?.textContent || "";
      navigator.clipboard.writeText(`Subject: ${subj}\n\n${body}`);
    });
    byId("copy-ig")?.addEventListener("click",  ()=> navigator.clipboard.writeText(byId("out-ig")?.textContent || ""));

    const csvEsc = s => '"' + String(s ?? "").replace(/"/g,'""') + '"';
    function buildCSV(o){
      const rows = [["channel","content"]];
      if (o.linkedin) rows.push(["linkedin", o.linkedin]);
      if (o.x) rows.push(["x", Array.isArray(o.x)?o.x.join("\n\n—\n\n"):o.x]);
      if (o.email) rows.push(["email", typeof o.email==='object'?`Subject: ${o.email.subject || ''}\n\n${o.email.body || ''}`: o.email]);
      if (o.instagram) rows.push(["instagram", o.instagram]);
      return rows.map(r=>r.map(csvEsc).join(",")).join("\n");
    }
    function buildMarkdown(o){
      const lines = [
        "# Content Pack","",
        "## LinkedIn",(o.linkedin||"").trim(),"",
        "## X (Twitter)", (Array.isArray(o.x)?o.x.join("\n\n—\n\n"):o.x||"").trim(),"",
        "## Email", (o.email?.body||o.email||"").trim(),"",
        "## Instagram", (o.instagram||"").trim(),"" ];
      return lines.join("\n");
    }
    function extractJSON(text){
      if (!text) return null;
      const raw = String(text).trim();
      try { return JSON.parse(raw); } catch {}
      const first = raw.indexOf('{');
      const last = raw.lastIndexOf('}');
      if (first !== -1 && last !== -1 && last>first){
        const slice = raw.slice(first, last+1);
        try { return JSON.parse(slice); } catch {}
      }
      return null;
    }
    function parseOutput(content){
      const j = extractJSON(content);
      if (j && (j.linkedin || j.x || j.email || j.instagram)) return j;
      const text = String(content||"").trim();
      const out = {};
      const liMatch = text.match(/"linkedin"\s*:\s*"([\s\S]*?)"\s*(,|$)/i);
      const xMatch  = text.match(/"x"\s*:\s*(\[[\s\S]*?\]|"[\s\S]*?")\s*(,|$)/i);
      const emMatch = text.match(/"email"\s*:\s*(\{[\s\S]*?\}|"[\s\S]*?")\s*(,|$)/i);
      const igMatch = text.match(/"instagram"\s*:\s*"([\s\S]*?)"\s*(,|$)/i);
      if (liMatch) out.linkedin = liMatch[1].replace(/\\n/g,"\n");
      if (xMatch)  out.x = xMatch[1].startsWith('[') ? JSON.parse(xMatch[1]) : xMatch[1].replace(/\\n/g,"\n");
      if (emMatch){
        if (emMatch[1].startsWith('{')){
          try{ out.email = JSON.parse(emMatch[1]); } catch{ out.email = { subject:"", body: emMatch[1] }; }
        } else out.email = { subject:"", body: emMatch[1].replace(/\\n/g,"\n") };
      }
      if (igMatch) out.instagram = igMatch[1].replace(/\\n/g,"\n");
      if (out.linkedin || out.x || out.email || out.instagram) return out;
      return { linkedin: text };
    }
    function download(filename, mime, text){
      const blob = new Blob([text], { type: mime });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = filename; document.body.appendChild(a); a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 0);
    }

    async function runGen({ useBYOK=false }){
      const sourceEl = byId("source");
      if (!sourceEl) return;
      const source = sourceEl.value.trim();
      if (!source) { alert("Paste some content first."); return; }

      byId("status") && (byId("status").textContent = useBYOK? "Generating with your key…" : "Generating…");
      ["#out-li","#out-x","#out-em-subj","#out-em-body","#out-ig"].forEach(sel=> { const el=document.querySelector(sel); if (el) el.textContent=""; });
      byId("dl-md") && (byId("dl-md").disabled = true);
      byId("dl-csv") && (byId("dl-csv").disabled = true);

      const model = sessionStorage.getItem("MODEL") || "";
      const byok  = readGuestBYOK();

      const headers = await getAuthHeaders();
      if (useBYOK && byok.key) applyBYOKHeaders(headers, byok);

      const SYSTEM = { role: "system", content: `You are a senior content strategist. Return pure JSON only with keys: linkedin, x, email, instagram.
- linkedin: 6–10 lines, one CTA.
- x: <= 280 chars total; provide an array with 2 short variants if possible.
- email: object with keys {subject, body} — 3–5 sentences.
- instagram: 1–2 short paragraphs + 3–5 hashtags.
STRICT: No Markdown, no triple backticks, no prose — JSON object only.` };

      const messages = [ SYSTEM, { role:"user", content: `Source:\n${source}\nChannels: LinkedIn,X,Email,Instagram` } ];

      try{
        const r = await fetch(`${WORKER_BASE}/api/generate`, {
          method:"POST",
          headers,
          body: JSON.stringify({ plan: (useBYOK? "pro":"free"), messages, temperature:0.7, model: model || undefined })
        });
        const data = await r.json().catch(()=> ({}));
        if (!r.ok) { byId("status") && (byId("status").textContent = data?.error?.message || "Error"); return; }
        const content = data?.choices?.[0]?.message?.content || "";
        const out = parseOutput(content);

        byId("out-li") && (byId("out-li").textContent = out.linkedin || "");
        byId("li-lines") && (byId("li-lines").textContent = String(out.linkedin||"").split(/\n/).filter(Boolean).length);
        const xText = Array.isArray(out.x) ? out.x.join("\n\n—\n\n") : (out.x || "");
        byId("out-x") && (byId("out-x").textContent = xText);
        byId("out-em-subj") && (byId("out-em-subj").textContent = out?.email?.subject || "");
        byId("out-em-body") && (byId("out-em-body").textContent = (out?.email?.body || "").trim());
        byId("out-ig") && (byId("out-ig").textContent = out.instagram || "");

        const md = buildMarkdown(out);
        const csv = buildCSV(out);
        byId("dl-md") && (byId("dl-md").disabled = false);
        byId("dl-csv") && (byId("dl-csv").disabled = false);
        byId("dl-md")?.addEventListener("click", ()=> download("content-pack.md","text/markdown", md), { once:true });
        byId("dl-csv")?.addEventListener("click", ()=> download("content-pack.csv","text/csv", csv), { once:true });

        byId("status") && (byId("status").textContent = "Done ✓");
      }catch(e){
        byId("status") && (byId("status").textContent = "Error");
      }
    }

    /* =========================
       MEMBER GENERATION (Dashboard)
    ========================== */
    byId("run_m")?.addEventListener("click", ()=> runGenMember({ useBYOK:false }));
    byId("run-byok_m")?.addEventListener("click", ()=> runGenMember({ useBYOK:true }));
    byId("clear_m")?.addEventListener("click", ()=>{
      ["#out-li_m","#out-x_m","#out-em-subj_m","#out-em-body_m","#out-ig_m"].forEach(sel=> { const el = document.querySelector(sel); if (el) el.textContent = ""; });
      byId("source_m") && (byId("source_m").value = "");
      byId("status_m") && (byId("status_m").textContent = "");
      byId("dl-md_m") && (byId("dl-md_m").disabled = true);
      byId("dl-csv_m") && (byId("dl-csv_m").disabled = true);
    });

    ["li","x","em","ig"].forEach(k=>{
      const id = `copy-${k}_m`;
      byId(id)?.addEventListener("click", ()=>{
        if (k==="em"){
          const subj = byId("out-em-subj_m")?.textContent || "";
          const body = byId("out-em-body_m")?.textContent || "";
          navigator.clipboard.writeText(`Subject: ${subj}\n\n${body}`);
        } else {
          navigator.clipboard.writeText(byId(`out-${k}_m`)?.textContent || "");
        }
      });
    });

    async function runGenMember({ useBYOK=false }){
      const sourceEl = byId("source_m");
      if (!sourceEl) return;
      const source = sourceEl.value.trim();
      if (!source) { alert("Paste some content first."); return; }

      byId("status_m") && (byId("status_m").textContent = useBYOK? "Generating with your key…" : "Generating…");
      ["#out-li_m","#out-x_m","#out-em-subj_m","#out-em-body_m","#out-ig_m"].forEach(sel=> { const el=document.querySelector(sel); if (el) el.textContent=""; });
      byId("dl-md_m") && (byId("dl-md_m").disabled = true);
      byId("dl-csv_m") && (byId("dl-csv_m").disabled = true);

      const model = (byId("model_m")?.value || sessionStorage.getItem("MODEL") || "").trim();
      const headers = await getAuthHeaders();

      if (useBYOK){
        const byok = {
          provider: (byId("byok_provider_m")?.value||"").trim(),
          key:      (byId("byok_key_m")?.value||"").trim(),
          base:     (byId("byok_base_m")?.value||"").trim()
        };
        if (byok.key) applyBYOKHeaders(headers, byok);
      }

      const SYSTEM = { role: "system", content: `You are ContentRepurpose, a senior content strategist. Return pure JSON only with keys: linkedin, x, email, instagram.
- linkedin: 6–10 lines, one CTA.
- x: <= 280 chars total; provide an array with 2 short variants if possible.
- email: object with keys {subject, body} — 3–5 sentences.
- instagram: 1–2 short paragraphs + 3–5 hashtags.
STRICT: JSON object only.` };

      const messages = [ SYSTEM, { role:"user", content: `Source:\n${source}\nChannels: LinkedIn,X,Email,Instagram` } ];

      try{
        const r = await fetch(`${WORKER_BASE}/api/generate`, {
          method:"POST",
          headers,
          body: JSON.stringify({ plan:(useBYOK?"pro":"free"), messages, temperature:0.7, model: model || undefined })
        });
        const data = await r.json().catch(()=> ({}));
        if (!r.ok) { byId("status_m") && (byId("status_m").textContent = data?.error?.message || "Error"); return; }
        const content = data?.choices?.[0]?.message?.content || "";
        const out = parseOutput(content);

        byId("out-li_m") && (byId("out-li_m").textContent = out.linkedin || "");
        const xText = Array.isArray(out.x) ? out.x.join("\n\n—\n\n") : (out.x || "");
        byId("out-x_m") && (byId("out-x_m").textContent = xText);
        byId("out-em-subj_m") && (byId("out-em-subj_m").textContent = out?.email?.subject || "");
        byId("out-em-body_m") && (byId("out-em-body_m").textContent = (out?.email?.body || "").trim());
        byId("out-ig_m") && (byId("out-ig_m").textContent = out.instagram || "");

        const md = buildMarkdown(out);
        const csv = buildCSV(out);
        byId("dl-md_m") && (byId("dl-md_m").disabled = false);
        byId("dl-csv_m") && (byId("dl-csv_m").disabled = false);
        byId("dl-md_m")?.addEventListener("click", ()=> download("content-pack.md","text/markdown", md), { once:true });
        byId("dl-csv_m")?.addEventListener("click", ()=> download("content-pack.csv","text/csv", csv), { once:true });

        byId("status_m") && (byId("status_m").textContent = "Done ✓");
      }catch(e){
        byId("status_m") && (byId("status_m").textContent = "Error");
      }
    }

    /* =========================
       BATCH INPUTS (Member)
    ========================== */
    function batchCapForPlan(plan){
      if (plan==="business") return 50;
      if (plan==="creator")  return 20;
      if (plan==="starter")  return 5;
      return 0; // free cannot
    }

    async function runBatch(){
      const cap = batchCapForPlan(CURRENT_PLAN);
      if (!cap){ byId("upgradeModal")?.showModal(); return; }

      const ta = byId("batch_inputs");
      if (!ta) return;
      const lines = (ta.value||"").split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
      if (!lines.length){ alert("Add one topic per line."); return; }

      let work = lines;
      if (lines.length > cap){
        work = lines.slice(0, cap);
        showToast(`Used first ${cap} lines on your plan.`);
      }

      const headers = await getAuthHeaders();
      const model = (byId("model_m")?.value || sessionStorage.getItem("MODEL") || "").trim();
      const SYSTEM = { role:"system", content:`You are ContentRepurpose. Return JSON {linkedin,x,email,instagram}. Keep outputs short and punchy.` };

      const agg = { linkedin:[], x:[], email:[], instagram:[] };
      byId("status_m") && (byId("status_m").textContent = `Batch running ${work.length}…`);

      for (let i=0;i<work.length;i++){
        const topic = work[i];
        const messages = [ SYSTEM, { role:"user", content:`Source:\n${topic}\nChannels: LinkedIn,X,Email,Instagram` } ];
        try{
          const r = await fetch(`${WORKER_BASE}/api/generate`, {
            method:"POST",
            headers,
            body: JSON.stringify({ plan:"free", messages, temperature:0.7, model: model || undefined })
          });
          const data = await r.json().catch(()=> ({}));
          if (!r.ok) { continue; }
          const out = parseOutput(data?.choices?.[0]?.message?.content || "");
          if (out.linkedin)   agg.linkedin.push(out.linkedin.trim());
          if (Array.isArray(out.x)) agg.x.push(...out.x);
          else if (out.x)     agg.x.push(out.x);
          if (out.email?.body || out.email) agg.email.push(`Subject: ${out.email?.subject || ""}\n${out.email?.body || out.email}`);
          if (out.instagram)  agg.instagram.push(out.instagram.trim());
        }catch{}
        await new Promise(r=>setTimeout(r, 200)); // gentle
      }

      byId("out-li_m") && (byId("out-li_m").textContent = agg.linkedin.join("\n\n—\n\n"));
      byId("out-x_m")  && (byId("out-x_m").textContent  = agg.x.join("\n\n—\n\n"));
      if (agg.email.length){
        const first = agg.email[0].split("\n");
        byId("out-em-subj_m") && (byId("out-em-subj_m").textContent = (first[0]||"").replace(/^Subject:\s*/,''));
        byId("out-em-body_m") && (byId("out-em-body_m").textContent = agg.email.join("\n\n—\n\n"));
      }
      byId("out-ig_m") && (byId("out-ig_m").textContent = agg.instagram.join("\n\n—\n\n"));

      const md = buildMarkdown({
        linkedin: byId("out-li_m")?.textContent || "",
        x:        byId("out-x_m")?.textContent  || "",
        email:    byId("out-em-body_m")?.textContent || "",
        instagram:byId("out-ig_m")?.textContent || ""
      });
      const csv = buildCSV({
        linkedin: byId("out-li_m")?.textContent || "",
        x:        byId("out-x_m")?.textContent  || "",
        email:    { subject: byId("out-em-subj_m")?.textContent || "", body: byId("out-em-body_m")?.textContent || "" },
        instagram:byId("out-ig_m")?.textContent || ""
      });
      byId("dl-md_m") && (byId("dl-md_m").disabled = false);
      byId("dl-csv_m") && (byId("dl-csv_m").disabled = false);
      byId("dl-md_m")?.addEventListener("click", ()=> download("content-pack.md","text/markdown", md), { once:true });
      byId("dl-csv_m")?.addEventListener("click", ()=> download("content-pack.csv","text/csv", csv), { once:true });
      byId("status_m") && (byId("status_m").textContent = "Batch done ✓");
    }

    byId("run_batch")?.addEventListener("click", runBatch);

    /* =========================
       INTEGRATIONS (Creator+)
    ========================== */
    async function startTrello(){
      const headers = await getAuthHeaders();
      const r = await fetch(`${WORKER_BASE}/api/integrations/trello/oauth/start`, { headers }).catch(()=>null);
      const j = await r?.json().catch(()=> ({}));
      if (j?.url) location.href = j.url;
      else alert(j?.error?.message || "Could not start Trello.");
    }
    async function startNotion(){
      const headers = await getAuthHeaders();
      const r = await fetch(`${WORKER_BASE}/api/integrations/notion/oauth/start`, { headers }).catch(()=>null);
      const j = await r?.json().catch(()=> ({}));
      if (j?.url) location.href = j.url;
      else alert(j?.error?.message || "Could not start Notion.");
    }
    byId("connectTrello")?.addEventListener("click", startTrello);
    byId("connectNotion")?.addEventListener("click", startNotion);

    /* =========================
       REFERRAL COPY
    ========================== */
    byId("copyRef")?.addEventListener("click", ()=>{
      const v = byId("refLink")?.value || "";
      if (!v) return;
      navigator.clipboard.writeText(v);
      showToast("Referral link copied ✓");
    });

    /* =========================
       UPGRADE MODAL CLOSE
    ========================== */
    byId("modalClose")?.addEventListener("click", ()=> byId("upgradeModal")?.close());
  </script>
</body>
</html>
