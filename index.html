<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>ContentRepurpose.pro — AI Content Repurposing Tool & Generator</title>
  <meta name="description" content="Content repurposing AI that turns one idea into LinkedIn, X, Email & Instagram drafts. Export to Notion & Trello. BYOK supported." />
  <link rel="canonical" href="https://contentrepurpose.pro/">
  <meta name="theme-color" content="#0a0d18">
  <meta name="color-scheme" content="dark light">
  <meta name="robots" content="index,follow,max-video-preview:-1,max-image-preview:large,max-snippet:-1">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="ContentRepurpose.pro — AI Content Repurposing Tool">
  <meta property="og:description" content="Repurpose content with AI. Paste once → get LinkedIn, X, Email & Instagram drafts. Export to Notion & Trello. BYOK supported.">
  <meta property="og:url" content="https://contentrepurpose.pro/">
  <meta property="og:image" content="/og-cover.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ContentRepurpose.pro — AI Content Generator">
  <meta name="twitter:description" content="Content repurposing AI for multi-channel drafts. Export to Notion & Trello. BYOK supported.">
  <meta name="twitter:image" content="/og-cover.png">

  <!-- Fonts + Tailwind -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Global CSS -->
  <style>
    :root{ --brandA:#7AA2FF; --brandB:#FF2D2D; --ink:#0a0d18 }
    html,body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .txt-grad{background:linear-gradient(135deg,var(--brandA),var(--brandB));-webkit-background-clip:text;background-clip:text;color:transparent}
    .bg-grad{background:linear-gradient(135deg,var(--brandA),var(--brandB))}
    .card{border-radius:1.25rem;border:1px solid rgba(15,23,42,.10);background:rgba(255,255,255,.80);box-shadow:0 12px 40px rgba(2,6,23,.08)}
    .badge{display:inline-flex;align-items:center;gap:.5rem;padding:.35rem .6rem;border-radius:9999px;border:1px solid rgba(255,255,255,.15);font-size:.75rem;background:rgba(255,255,255,.65)}
    .chip{font-size:.7rem;padding:.2rem .5rem;border-radius:9999px;border:1px solid rgba(148,163,184,.35)}
    .btn{padding:.6rem .9rem;border-radius:.9rem;border:1px solid rgba(148,163,184,.35)}
    .btn-primary{background:black;color:white}
    .glass{backdrop-filter: blur(12px); background:rgba(255,255,255,.62)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .halo{position:absolute;filter:blur(60px);opacity:.55;pointer-events:none;transform:translateZ(0);
      background:radial-gradient(50% 50% at 50% 50%, rgba(122,162,255,.8), rgba(255,45,45,.65) 60%, transparent 70%);
      width:42rem;height:42rem;border-radius:50%;animation:float 16s ease-in-out infinite;}
    .halo.h2{width:34rem;height:34rem;right:-12rem;top:-6rem;animation-duration:18s;opacity:.5}
    .halo.h3{width:28rem;height:28rem;left:-10rem;top:26rem;animation-duration:22s;opacity:.45}
    @keyframes float{ 0%,100%{ transform: translate3d(0,0,0) } 50%{ transform: translate3d(0,-20px,0) } }
    .orbit{position:absolute;inset:-32px;border-radius:24px;pointer-events:none;
      background: conic-gradient(from 0deg, rgba(122,162,255,.25), rgba(255,45,45,.18), rgba(122,162,255,.25));
      -webkit-mask: radial-gradient(closest-side, transparent 88%, black 89%); mask: radial-gradient(closest-side, transparent 88%, black 89%);
      animation: spin 18s linear infinite;}
    @keyframes spin{ to{ transform: rotate(360deg) } }
    .mock{border-radius:1rem;border:1px solid rgba(255,255,255,.12); background:linear-gradient(180deg,rgba(255,255,255,.75),rgba(255,255,255,.6));}
    @media (prefers-color-scheme:dark){ body{background:var(--ink);color:#e9eef6} .card{background:rgba(14,16,22,.6);border-color:rgba(255,255,255,.08);box-shadow:0 24px 96px rgba(122,162,255,.08),0 14px 60px rgba(255,45,45,.06)} .badge{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.12)} .mock{ background:linear-gradient(180deg,rgba(17,20,31,.88),rgba(17,20,31,.72)); } }
    .marquee{ display:grid; grid-auto-flow:column; gap:2rem; align-items:center; animation: scrollx 26s linear infinite }
    .marquee:hover{ animation-play-state: paused } @keyframes scrollx{ from{ transform: translateX(0) } to{ transform: translateX(-50%) } }
    .nav-sheet{position:fixed; inset:0 0 auto 0; background:rgba(0,0,0,.6); backdrop-filter:blur(8px); display:none}
    .nav-panel{position:absolute; top:0; right:0; width:82vw; max-width:380px; height:100%; background:rgba(14,16,22,.96); border-left:1px solid rgba(255,255,255,.08); padding:1rem}
    .nav-open .nav-sheet{display:block}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .icon { width: 1rem; height: 1rem; display: inline-block; vertical-align: -0.15em; }
    .touch-target{min-height:40px;min-width:40px}

    /* Plan gates */
    .only-guest{display:revert}
    .only-authed{display:none}
    .plan-starter-plus{display:none}
    .plan-creator-plus{display:none}
    .plan-business-only{display:none}
    body[data-auth="authed"] .only-guest{display:none}
    body[data-auth="authed"] .only-authed{display:revert}
    body[data-plan="starter"] .plan-starter-plus,
    body[data-plan="creator"] .plan-starter-plus,
    body[data-plan="business"] .plan-starter-plus{display:revert}
    body[data-plan="creator"] .plan-creator-plus,
    body[data-plan="business"] .plan-creator-plus{display:revert}
    body[data-plan="business"] .plan-business-only{display:revert}

    /* Anchor offset for sticky header */
    [id]{ scroll-margin-top: 96px }
    @media (min-width: 768px){ [id]{ scroll-margin-top: 112px } }
  </style>

  <!-- JSON-LD -->
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","name":"ContentRepurpose.pro","url":"https://contentrepurpose.pro/","logo":"https://contentrepurpose.pro/logo.svg","sameAs":["https://x.com/contentrepurpose","https://www.linkedin.com/company/contentrepurpose"]}</script>
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","url":"https://contentrepurpose.pro/","name":"ContentRepurpose.pro","potentialAction":{"@type":"SearchAction","target":"https://contentrepurpose.pro/search?q={q}","query-input":"required name=q"}}</script>
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"SoftwareApplication","name":"ContentRepurpose.pro","applicationCategory":"ContentCreationApplication","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}}</script>

  <!-- Worker base -->
  <script>
    window.WORKER_BASE = "https://contentflow-worker.frank-couchman.workers.dev";
    window.SITE_ORIGIN = "https://contentrepurpose.pro";
  </script>

  <!-- Supabase v2 auth -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";
    const SUPABASE_URL  = "https://ynkoavaeadlzlwylmfmu.supabase.co";
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlua29hdmFlYWRsemx3eWxtZm11Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5OTAxNDgsImV4cCI6MjA3MzU2NjE0OH0.1yM5yDo0MI9Upzt4GkLyf1mqvDXfb3DXvC0ouOLtRoU";
    window.supabase = createClient(SUPABASE_URL, SUPABASE_ANON, {
      auth:{ persistSession:true, autoRefreshToken:true, detectSessionInUrl:true }
    });
  </script>

  <!-- Utilities (shared in-page) -->
  <script>
    window.__CRP__ = (function(){
      const $  = (s, r=document)=>r.querySelector(s);
      const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));
      const cap = (s)=> (s||"").slice(0,1).toUpperCase() + (s||"").slice(1);
      async function headers(){
        const h = { "Content-Type":"application/json" };
        try{
          const { data } = await window.supabase.auth.getSession();
          const tok = data?.session?.access_token;
          const uid = data?.session?.user?.id;
          if (tok) h.Authorization = `Bearer ${tok}`;
          if (uid) h["X-User-Id"] = uid;
        }catch{}
        return h;
      }
      function toast(msg){
        const t = $('#toast'), m=$('#toastMsg');
        if (!t||!m){ alert(msg); return; }
        m.textContent = msg; t.classList.remove('hidden'); setTimeout(()=>t.classList.add('hidden'), 1600);
      }
      function smoothAnchorInstall(){
        document.addEventListener('click', function(e){
          const a = e.target.closest('a[href]');
          if (!a) return;
          const href = a.getAttribute('href');
          if (!href) return;
          let url; try{ url = new URL(href, location.href); }catch{ return; }
          if (url.pathname.replace(/\/+$/,'') === location.pathname.replace(/\/+$/,'') && url.hash){
            e.preventDefault();
            const el = document.querySelector(url.hash);
            if (el){
              try{ el.scrollIntoView({behavior:'smooth', block:'start'});}catch{ el.scrollIntoView(); }
              document.body.classList.remove('nav-open');
              history.replaceState(null,'',url.hash);
            }
          }
        });
        window.addEventListener('load', ()=>{ if (location.hash && document.querySelector(location.hash)){ setTimeout(()=>{ try{ document.querySelector(location.hash).scrollIntoView({behavior:'smooth'}) }catch{} }, 60); }});
      }
      function planBadge(plan){
        const label = `Plan: ${cap(plan)}`;
        const a = document.getElementById('planbadge');
        const b = document.getElementById('planbadge_m');
        if (a) a.textContent = label; if (b) b.textContent = label;
        const hp = document.getElementById('heroPlanName');
        if (hp) hp.textContent = cap(plan);
      }
      function gatePaint(auth, plan){
        document.body.setAttribute('data-auth', auth ? 'authed' : 'guest');
        document.body.setAttribute('data-plan', plan || 'free');
        planBadge(plan||'free');
        const show = (id,on)=>{ const el=document.getElementById(id); if (el) el.classList.toggle('hidden', !on); };
        show('manageBilling', auth); show('manageBilling_m', auth); show('manageBilling2', auth);
        // Generate buttons swap
        const g1 = document.getElementById('generateBtn');
        const g2 = document.getElementById('generateBtn_member');
        if (g1 && g2){ g1.classList.toggle('hidden', !!auth); g2.classList.toggle('hidden', !auth); }
        const o1 = document.getElementById('optRun_demo');
        const o2 = document.getElementById('optRun');
        if (o1 && o2){ o1.classList.toggle('hidden', !!auth); o2.classList.toggle('hidden', !auth); }
      }
      function openAuth(){ try{ document.getElementById('auth')?.showModal(); }catch{} }
      function wireAuthOpeners(){
        ['loginBtn','loginBtn_m','heroSignIn'].forEach(id=>{
          const el=document.getElementById(id);
          if (el && !el.__wired){ el.addEventListener('click', openAuth); el.__wired=true; }
        });
        document.querySelectorAll('.js-open-auth').forEach(el=>{ if (!el.__wired){ el.addEventListener('click', openAuth); el.__wired=true; }});
      }
      return { $, $$, toast, headers, smoothAnchorInstall, gatePaint, planBadge, openAuth, wireAuthOpeners };
    })();
  </script>
</head>
<body class="min-h-full" data-auth="guest" data-plan="free">
  <!-- Decorative halos -->
  <div class="halo" style="left:-14rem; top:-10rem;"></div>
  <div class="halo h2"></div>
  <div class="halo h3"></div>

  <!-- Top nav (desktop + mobile trigger) -->
  <header class="sticky top-0 z-40 backdrop-blur bg-white/55 dark:bg-black/20 border-b border-white/30">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-4 flex items-center justify-between">
      <a href="/" class="flex items-center gap-3" aria-label="ContentRepurpose home">
        <svg width="36" height="36" viewBox="0 0 48 48" class="rounded-xl" aria-hidden="true">
          <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7AA2FF"/><stop offset="100%" stop-color="#FF2D2D"/></linearGradient></defs>
          <rect x="0" y="0" width="48" height="48" rx="12" fill="url(#g)"/>
          <path d="M14 16h10a6 6 0 0 1 0 12H20v4h-6V16zm6 6v4h4a2 2 0 1 0 0-4h-4z" fill="white"/>
          <path d="M28 16h6v16h-6z" fill="white" opacity=".9"/>
        </svg>
        <span class="font-semibold tracking-tight">Content<span class="txt-grad">Repurpose</span></span>
      </a>

      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="#demo" class="hover:opacity-80">Live Demo</a>
        <a href="https://contentrepurpose.pro/blog/linkedin-post-templates/" class="hover:opacity-80">Templates</a>
        <a href="#use-cases" class="hover:opacity-80">Use cases</a>
        <a href="#best-picks" class="hover:opacity-80">Best picks</a>
        <a href="#optimizer" class="hover:opacity-80">Article Optimizer</a>
        <a href="#pricing" class="hover:opacity-80">Pricing</a>
        <a href="/blog" class="hover:opacity-80">Blog</a>
        <span id="planbadge" class="px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/50">Plan: Free</span>
        <button id="manageBilling" class="px-3 py-1 rounded-lg border hidden">Manage billing</button>
        <div class="flex items-center gap-2">
          <button id="loginBtn" class="px-3 py-1 rounded-lg border only-guest">Sign in</button>
          <button id="logoutBtn" class="px-3 py-1 rounded-lg border only-authed hidden">Sign out</button>
        </div>
      </nav>

      <button id="navToggle" class="md:hidden touch-target px-3 py-2 rounded-lg border" aria-expanded="false" aria-controls="mobileNav" aria-label="Open menu">☰</button>
    </div>

    <!-- Promo strip -->
    <div class="border-t border-white/40 bg-white/70 dark:bg-white/10">
      <div class="max-w-7xl mx-auto px-4 md:px-5 py-2 flex flex-wrap items-center justify-between gap-3 text-sm">
        <div class="flex items-center gap-2">
          <span class="px-2 py-0.5 rounded-full text-[11px] bg-black/80 text-white">LIMITED</span>
          <span>Use <strong class="mono">CONTENTOFF90</strong> for <strong>90% off</strong> the Creator plan.</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="copyPromoBtn" class="px-3 py-1 rounded-lg border">Copy code</button>
          <a href="#pricing" class="px-3 py-1 rounded-lg bg-black text-white">See pricing</a>
        </div>
      </div>
    </div>

    <!-- Mobile sheet -->
    <div id="mobileNav" class="nav-sheet" aria-hidden="true">
      <div class="nav-panel text-sm text-white">
        <div class="flex items-center justify-between">
          <span class="font-semibold">Menu</span>
          <button id="navClose" class="touch-target px-3 py-2 rounded-lg border border-white/20" aria-label="Close menu">✕</button>
        </div>
        <nav class="mt-4 grid gap-2">
          <a href="#demo" class="px-3 py-2 rounded-lg hover:bg-white/10">Live Demo</a>
          <a href="https://contentrepurpose.pro/blog/linkedin-post-templates/" class="px-3 py-2 rounded-lg hover:bg-white/10">Templates</a>
          <a href="#use-cases" class="px-3 py-2 rounded-lg hover:bg-white/10">Use cases</a>
          <a href="#best-picks" class="px-3 py-2 rounded-lg hover:bg-white/10">Best picks</a>
          <a href="#optimizer" class="px-3 py-2 rounded-lg hover:bg-white/10">Article Optimizer</a>
          <a href="#pricing" class="px-3 py-2 rounded-lg hover:bg-white/10">Pricing</a>
          <a href="/blog" class="px-3 py-2 rounded-lg hover:bg-white/10">Blog</a>
        </nav>
        <div class="mt-6 grid gap-2">
          <span id="planbadge_m" class="px-3 py-1 rounded-full text-xs bg-white/10 border border-white/20 w-fit">Plan: Free</span>
          <button id="manageBilling_m" class="px-3 py-2 rounded-lg border border-white/20 hidden">Manage billing</button>
          <button id="loginBtn_m" class="px-3 py-2 rounded-lg border border-white/20 only-guest">Sign in</button>
          <button id="logoutBtn_m" class="px-3 py-2 rounded-lg border border-white/20 only-authed hidden">Sign out</button>
        </div>
      </div>
    </div>
  </header>

  <!-- ===== HERO + CTA rail ===== -->
  <section class="relative" id="hero">
    <div class="max-w-7xl mx-auto px-4 md:px-5 pt-10 md:pt-16 grid lg:grid-cols-2 gap-8 md:gap-10 items-center">
      <!-- Left: copy + CTAs -->
      <div>
        <!-- BADGE: show demo note to guests, plan badge to members -->
        <div id="heroBadgeWrap" class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/40">
          <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
          <span class="only-guest">Demo — <strong class="mx-1">5 runs / month</strong> (no login)</span>
          <span class="only-authed hidden">Signed in — <strong id="heroPlanName">Free</strong> plan active</span>
        </div>

        <h1 class="mt-4 text-3xl md:text-5xl font-black leading-tight tracking-tight">
          AI <span class="txt-grad">Content Repurposing Tool</span> — turn one idea into everywhere content.
        </h1>

        <p class="mt-4 text-slate-600 dark:text-slate-300 max-w-xl">
          Paste content → get <strong>LinkedIn</strong>, <strong>X</strong>, <strong>Email</strong> &amp; <strong>Instagram</strong> drafts.
          Export to <strong>Notion</strong> or <strong>Trello</strong>. BYOK supported.
        </p>

        <!-- CTA rail -->
        <div class="mt-6 flex flex-wrap gap-3">
          <a href="#demo" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90 only-guest">Try the Live Demo</a>
          <a href="#demo" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90 only-authed hidden">Open Generator</a>
          <a href="#pricing" class="px-4 py-3 rounded-xl font-semibold border border-slate-300/60 hover:bg-white/50">See pricing</a>
          <button id="heroSignIn" class="px-4 py-3 rounded-xl font-semibold border border-slate-300/60 only-guest">Sign in</button>
        </div>

        <div class="mt-6 flex items-center gap-3 text-xs text-slate-500 dark:text-slate-400">
          <span class="badge">AI Content Generator</span>
          <span class="badge">Repurposing Tool</span>
          <span class="badge">SEO-ready</span>
          <span class="badge">BYOK</span>
        </div>

        <!-- Trust strip -->
        <div class="mt-8 overflow-hidden">
          <div class="flex items-center gap-4 text-[11px] uppercase tracking-widest text-slate-500">
            <span class="chip">Creators</span>
            <span class="chip">Marketers</span>
            <span class="chip">Newsletters</span>
            <span class="chip">Teams</span>
          </div>
          <div class="relative mt-4">
            <div class="marquee opacity-70">
              <div class="chip">LinkedIn-first</div>
              <div class="chip">Editorial-friendly</div>
              <div class="chip">Email copy</div>
              <div class="chip">Instagram captions</div>
              <div class="chip">Notion export</div>
              <div class="chip">Trello sync</div>
              <div class="chip">Keyword-aware</div>
              <div class="chip">Tone controls</div>
              <!-- duplicate for seamless scroll -->
              <div class="chip">LinkedIn-first</div>
              <div class="chip">Editorial-friendly</div>
              <div class="chip">Email copy</div>
              <div class="chip">Instagram captions</div>
              <div class="chip">Notion export</div>
              <div class="chip">Trello sync</div>
              <div class="chip">Keyword-aware</div>
              <div class="chip">Tone controls</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right: visual mocks -->
      <div class="relative">
        <div class="orbit" aria-hidden="true"></div>
        <div class="grid gap-4">
          <div class="mock p-4 card">
            <div class="text-xs text-slate-400">Command</div>
            <pre class="mono text-xs bg-black/85 text-emerald-200 rounded-xl p-4 h-40 overflow-auto" aria-label="CLI Preview">repurpose generate --channels linkedin,x,email,instagram
? outline created
? 3 social variants
? email subject + body ready
? instagram caption + hashtags</pre>
          </div>
          <div class="grid md:grid-cols-2 gap-4">
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">LinkedIn</div>
              <div class="mt-2 h-24 text-sm text-slate-200/90 leading-relaxed">
                • Hook that earns the scroll<br>
                • 6–10 crisp lines, one CTA<br>
                • On-brand tone &amp; keywords
              </div>
            </div>
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">X (Twitter)</div>
              <div class="mt-2 h-24 text-sm text-slate-200/90 leading-relaxed">
                Two fast variants<br>
                Always ≤ 280 chars<br>
                Ready to post ✓
              </div>
            </div>
          </div>
          <div class="grid md:grid-cols-2 gap-4">
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">Email</div>
              <div class="mt-2 h-20 text-sm text-slate-200/90 leading-relaxed">
                Subject &amp; body prepped<br>
                Preview &amp; send from your client
              </div>
            </div>
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">Instagram</div>
              <div class="mt-2 h-20 text-sm text-slate-200/90 leading-relaxed">
                Caption + 3–5 hashtags<br>
                Short, skimmable, on-brand
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Live activity strip (hero) -->
    <div class="mt-8 md:mt-10">
      <div class="max-w-7xl mx-auto px-4 md:px-5">
        <div class="card p-4 md:p-5">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
              <strong class="tracking-tight">Generations today</strong>
              <span class="chip" data-live-count>–</span>
            </div>
            <div class="text-xs text-slate-500">Real results update every 30s</div>
          </div>
          <div class="mt-3 overflow-hidden">
            <div class="flex gap-3 whitespace-nowrap text-[13px] will-change-transform" style="animation: scrollx 28s linear infinite" data-live-feed></div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- ===== LIVE DEMO / GENERATOR ===== -->
  <section id="demo" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="flex items-end justify-between gap-4 mb-6">
        <div>
          <h2 class="text-2xl md:text-3xl font-black tracking-tight">Generator</h2>
          <!-- Copy changes by auth state -->
          <p class="mt-1 text-slate-500 dark:text-slate-300 text-sm only-guest">
            No login needed — <span class="font-semibold">5 runs/month</span> on the public pool.
          </p>
          <p class="mt-1 text-slate-500 dark:text-slate-300 text-sm only-authed hidden">
            Signed in — your plan limits apply per day/month by tier.
          </p>
        </div>
        <div class="flex items-center gap-3">
          <a href="#pricing" class="btn">See pricing</a>
          <button class="btn btn-primary js-open-auth only-guest" type="button">Sign in</button>
        </div>
      </div>

      <!-- Conversion rail -->
      <div class="card p-4 md:p-5 mb-6">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div class="flex items-center gap-2 text-sm">
            <span class="badge">LIMITED</span>
            <span>Use <strong class="mono">CONTENTOFF90</strong> for <strong>90% off</strong> the Creator plan.</span>
          </div>
          <div class="flex items-center gap-2">
            <button id="copyPromoBtn2" class="btn" type="button">Copy code</button>
            <a class="btn btn-primary" href="#pricing">Upgrade</a>
          </div>
        </div>
      </div>

      <!-- Presets + Batch toolbar (visible to signed-in users) -->
      <div class="card p-4 md:p-5 mb-6 only-authed hidden">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div class="flex items-center gap-2">
            <strong class="tracking-tight">Presets</strong>
            <span class="text-xs text-slate-500">Save your favorite toggle/channel setup</span>
          </div>
          <div class="flex items-center gap-2">
            <button id="presetSave" class="btn" type="button">Save current as preset</button>
            <button id="presetLoad" class="btn" type="button">Load preset…</button>
          </div>
        </div>
        <div id="presetList" class="mt-3 grid sm:grid-cols-2 lg:grid-cols-3 gap-2"></div>
      </div>

      <!-- Generator Form -->
      <div class="card p-5 md:p-6">
        <form id="demoForm" class="grid gap-6" autocomplete="off">
          <!-- Source selector -->
          <fieldset>
            <legend class="text-sm font-semibold">Source</legend>

            <!-- Batch input toggle -->
            <div class="mt-1 flex flex-wrap items-center gap-3">
              <label class="flex items-center gap-2">
                <input id="batchToggle" type="checkbox">
                Batch input (one idea per line)
              </label>
              <span class="chip plan-starter-plus">Starter: up to 5 lines/run</span>
              <span class="chip plan-creator-plus">Creator: up to 30 lines/run</span>
              <span class="chip plan-business-only">Business: team-scale batches</span>
            </div>

            <div class="mt-3 grid md:grid-cols-3 gap-3">
              <label class="tab flex items-center justify-between">
                <span class="flex items-center gap-2">
                  <input type="radio" name="sourceType" value="paragraph" checked>
                  Paragraph / Notes
                </span>
                <span class="chip">fastest</span>
              </label>
              <label class="tab flex items-center">
                <input type="radio" name="sourceType" value="blog" class="mr-2">
                Full Blog (paste content)
              </label>
              <label class="tab flex items-center">
                <input type="radio" name="sourceType" value="url" class="mr-2">
                URL (we’ll fetch & adapt)
              </label>
            </div>

            <div class="mt-3">
              <textarea id="sourceText" class="w-full rounded-xl border p-4 min-h-[160px]" placeholder="Paste your paragraph, blog, or URL here. For batch, use one idea per line."></textarea>
              <div class="mt-2 text-[12px] text-slate-500">
                <span class="chip only-guest">Demo: single input only</span>
                <span class="chip only-authed hidden plan-starter-plus">Starter: up to 5 lines</span>
                <span class="chip only-authed hidden plan-creator-plus">Creator: up to 30 lines</span>
              </div>
            </div>
          </fieldset>

          <!-- Optimizer options -->
          <fieldset id="optimizer" class="scroll-mt-28">
            <legend class="text-sm font-semibold">Article Optimizer (optional)</legend>
            <p class="mt-1 text-xs text-slate-500">Enhance long-form input (blog or paragraph). Adds headings, FAQs, meta, and SEO checks.</p>
            <div class="mt-2 grid sm:grid-cols-2 lg:grid-cols-3 gap-2">
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_humanize" checked> Humanize content</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_lengthen"> Lengthen by ~30%</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_faqs"> Add FAQs (+ JSON-LD)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_headings" checked> Auto-headings (H2/H3)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_svg"> Add platform-fit SVG image ideas</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_seo"> Check SEO basics (title/meta/alt-text)</label>
            </div>
            <div class="mt-2 text-[12px] text-slate-500">
              <span class="chip">Starter: up to 5/day</span>
              <span class="chip">Creator: up to 15/day</span>
              <span class="chip">Business: up to 30/day</span>
            </div>
          </fieldset>

          <!-- Channels -->
          <fieldset>
            <legend class="text-sm font-semibold">Channels to generate</legend>
            <div class="mt-2 grid sm:grid-cols-2 lg:grid-cols-4 gap-2">
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_linkedin" checked> LinkedIn</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_x" checked> X (Twitter)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_email" checked> Email</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_instagram"> Instagram</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_reddit" checked> Reddit</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_facebook"> Facebook</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_quora"> Quora</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_tiktok"> TikTok</label>
            </div>
          </fieldset>

          <!-- Channel-specific extras -->
          <div class="grid md:grid-cols-2 gap-6">
            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">LinkedIn</legend>
              <label class="flex items-center gap-2 mt-2">
                <input type="checkbox" name="li_article">
                Also generate a LinkedIn Article
              </label>
              <p class="mt-2 text-xs text-slate-500">Article appears in the output below when enabled.</p>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">X (Twitter)</legend>
              <div class="mt-2 flex items-center gap-3">
                <label class="flex items-center gap-2"><input type="checkbox" name="x_sequence" checked> Output as sequence</label>
                <label class="flex items-center gap-2">
                  Max posts:
                  <select name="x_posts" class="border rounded-lg px-2 py-1">
                    <option>2</option><option selected>4</option><option>6</option>
                  </select>
                </label>
              </div>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">Reddit</legend>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="rdt_communities" checked> Suggest best communities (with rules & flair tips)</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="rdt_comments" checked> Include 3 starter comment angles</label>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">TikTok</legend>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="tt_hooks" checked> Provide 3 hook variants</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="tt_onscreen" checked> Include on-screen text plan</label>
            </fieldset>
          </div>

          <!-- Actions -->
          <div class="flex flex-wrap items-center gap-3">
            <button id="generateBtn" type="submit" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90 only-guest">
              Generate (demo)
            </button>
            <button id="generateBtn_member" type="submit" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90 only-authed hidden">
              Generate
            </button>
            <button type="button" id="clearBtn" class="px-4 py-3 rounded-xl font-semibold border">Clear</button>

            <!-- Quota copy varies -->
            <div class="text-sm text-slate-500 only-guest">
              You have <span id="demoQuota">—</span> demo runs left this month.
            </div>
            <div class="text-sm text-slate-500 only-authed hidden">
              You have <span id="memberQuota">—</span> runs left today.
            </div>

            <a href="#pricing" class="text-sm underline hover:opacity-80 ml-auto">Need more? See plans</a>
          </div>
        </form>
      </div>

      <!-- OUTPUT -->
      <div id="demoOutput" class="mt-8 grid gap-6" aria-live="polite" aria-busy="false">
        <!-- Channel cards will be injected here -->
      </div>

      <!-- ===== QUICK PUBLISH (Authed only; Free can SEE, guests cannot) ===== -->
      <div class="mt-10 card p-5 only-authed hidden">
        <div class="flex items-center justify-between flex-wrap gap-3">
          <strong class="tracking-tight">Quick publish</strong>
          <div class="text-xs text-slate-500">Works with your last generation’s outputs.</div>
        </div>
        <div class="mt-4 grid sm:grid-cols-2 lg:grid-cols-4 gap-3">
          <button id="qp-x" class="btn" type="button">Post to X</button>
          <button id="qp-reddit" class="btn" type="button">Open Reddit submit</button>
          <button id="qp-linkedin" class="btn" type="button">Copy for LinkedIn & open</button>
          <button id="qp-email" class="btn" type="button">Send email draft</button>
        </div>

        <!-- Creator+ integrations -->
        <div class="mt-4 grid sm:grid-cols-2 gap-3 plan-creator-plus">
          <button id="li-notion" class="btn" type="button">Export to Notion</button>
          <button id="li-trello" class="btn" type="button">Send to Trello</button>
        </div>
        <div class="mt-2 text-xs text-slate-500 plan-creator-plus">
          Notion/Trello require connecting once from this device. Find them in Settings → Integrations.
        </div>
      </div>

      <!-- ===== SCHEDULER (Starter+) ===== -->
      <div class="mt-10 card p-5 plan-starter-plus">
        <div class="flex items-center justify-between flex-wrap gap-3">
          <strong class="tracking-tight">Scheduler</strong>
          <div class="text-xs text-slate-500">Queue & calendar. Starter gets single-profile; Creator+ supports multi-profile.</div>
        </div>

        <!-- Composer -->
        <div class="mt-4 grid md:grid-cols-4 gap-3">
          <label class="grid gap-1">
            <span class="text-xs text-slate-500">Channel</span>
            <select id="schedChannel" class="border rounded-lg px-3 py-2">
              <option value="linkedin">LinkedIn</option>
              <option value="x">X (Twitter)</option>
              <option value="instagram">Instagram</option>
              <option value="facebook">Facebook</option>
              <option value="reddit">Reddit</option>
              <option value="email">Email</option>
            </select>
          </label>
          <label class="grid gap-1">
            <span class="text-xs text-slate-500">When</span>
            <input id="schedWhen" type="datetime-local" class="border rounded-lg px-3 py-2" />
          </label>
          <div class="md:col-span-2 grid grid-cols-2 gap-2 items-end">
            <button id="schedAdd" class="btn btn-primary" type="button">Add to queue</button>
            <button id="schedUseLast" class="btn" type="button">Add from last output</button>
          </div>
        </div>

        <label class="grid gap-1 mt-3">
          <span class="text-xs text-slate-500">Text</span>
          <textarea id="schedText" class="border rounded-lg px-3 py-2 min-h-[120px]" placeholder="Paste content (or generate first and use 'Add from last output')"></textarea>
        </label>

        <!-- Queue -->
        <div class="mt-5">
          <div class="flex items-center justify-between">
            <strong class="text-sm">Queue</strong>
            <div class="flex items-center gap-2">
              <button id="schedPublish" class="btn" type="button">Publish selected</button>
              <button id="schedClear" class="btn" type="button">Clear all</button>
            </div>
          </div>
          <div id="schedEmpty" class="text-sm text-slate-500 mt-3">Nothing scheduled yet.</div>
          <div id="schedList" class="mt-3 grid gap-3"></div>
        </div>
      </div>

      <!-- ===== ANALYTICS ===== -->
      <div class="mt-10 grid md:grid-cols-3 gap-6">
        <!-- Starter+: basics -->
        <div class="card p-5 plan-starter-plus">
          <strong class="tracking-tight">Analytics (basics)</strong>
          <div class="text-xs text-slate-500 mt-1">Per-day posts &amp; estimated reach.</div>
          <div id="anaBasic" class="mt-3 text-sm text-slate-400">Connect accounts to see data.</div>
        </div>
        <!-- Creator+: per-channel -->
        <div class="card p-5 plan-creator-plus">
          <strong class="tracking-tight">Analytics Pro</strong>
          <div class="text-xs text-slate-500 mt-1">Breakdown by channel.</div>
          <div id="anaPro" class="mt-3 text-sm text-slate-400">Coming online as you post.</div>
        </div>
        <!-- Business: team -->
        <div class="card p-5 plan-business-only">
          <strong class="tracking-tight">Team Analytics</strong>
          <div class="text-xs text-slate-500 mt-1">Org-wide view, shared calendar.</div>
          <div id="anaTeam" class="mt-3 text-sm text-slate-400">Invite teammates to populate.</div>
        </div>
      </div>
    </div>
  </section>
  <!-- ===== BEST PICKS (Plan suggestions that actually convert) ===== -->
  <section id="best-picks" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="text-center mb-10">
        <h2 class="text-3xl md:text-4xl font-black tracking-tight">Best picks for you</h2>
        <p class="mt-2 text-slate-600 dark:text-slate-300">Choose based on how you create and publish.</p>
      </div>

      <div class="grid lg:grid-cols-3 gap-6">
        <!-- Solo / just getting momentum -->
        <article class="card p-6 flex flex-col">
          <div class="text-sm px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 border w-fit">Recommended</div>
          <h3 class="mt-3 text-xl font-bold">Starter — Solo Creator</h3>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">
            Best if you post a few times per week and want a reliable queue + basic analytics.
          </p>
          <ul class="mt-4 text-sm space-y-2">
            <li>• 200 generations / month</li>
            <li>• Batch inputs (up to 5 lines/run)</li>
            <li>• 10 saved presets</li>
            <li>• Scheduler (queue &amp; calendar)</li>
            <li>• Analytics (basics)</li>
            <li>• Article Optimizer: up to 5/day</li>
          </ul>
          <div class="mt-6 grid gap-2">
            <button
              data-price="price_1S7y58JYjIKHzKcjzL7cIKiB"
              class="w-full btn btn-primary js-checkout subBtn"
              type="button">Get Starter</button>
            <a href="#pricing" class="text-sm underline text-center">Compare all plans</a>
          </div>
        </article>

        <!-- Power user / multi-channel -->
        <article class="card p-6 flex flex-col ring-1 ring-black/5 relative">
          <span class="absolute -top-3 left-1/2 -translate-x-1/2 text-xs px-3 py-1 rounded-full bg-grad text-white shadow">Best value</span>
          <h3 class="mt-1 text-xl font-bold">Creator — Multichannel</h3>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">
            Ideal if you publish across LinkedIn, X, email, and need Notion/Trello + deeper analytics.
          </p>
          <ul class="mt-4 text-sm space-y-2">
            <li>• 500 generations / month</li>
            <li>• Unlimited presets &amp; project packs</li>
            <li>• Notion export &amp; Trello boards</li>
            <li>• Buffer push drafts</li>
            <li>• Scheduler (multi-profile)</li>
            <li>• Analytics Pro (per-channel)</li>
            <li>• Article Optimizer: up to 15/day</li>
          </ul>
          <div class="mt-6 grid gap-2">
            <button
              data-price="price_1S7y77JYjIKHzKcjKQYjiqZH"
              class="w-full btn btn-primary js-checkout subBtn"
              type="button">Get Creator</button>
            <a href="#pricing" class="text-sm underline text-center">Compare all plans</a>
          </div>
        </article>

        <!-- Teams / org workflows -->
        <article class="card p-6 flex flex-col">
          <div class="text-sm px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 border w-fit">Teams</div>
          <h3 class="mt-3 text-xl font-bold">Business — Teams &amp; Clients</h3>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">
            For teams who need seats, org analytics, and white-label exports.
          </p>
          <ul class="mt-4 text-sm space-y-2">
            <li>• Unlimited (fair use)</li>
            <li>• 3 seats included</li>
            <li>• Team presets &amp; shared calendar</li>
            <li>• White-label exports</li>
            <li>• Priority support</li>
            <li>• Article Optimizer: up to 30/day</li>
          </ul>
          <div class="mt-6 grid gap-2">
            <button
              data-price="price_1S7y8OJYjIKHzKcjqA9uJdyh"
              class="w-full btn js-checkout subBtn"
              type="button">Get Business</button>
            <a href="#pricing" class="text-sm underline text-center">Compare all plans</a>
          </div>
        </article>
      </div>
    </div>
  </section>

  <!-- ===== USE CASES (anchor target that actually scrolls) ===== -->
  <section id="use-cases" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="text-center mb-10">
        <h2 class="text-3xl md:text-4xl font-black tracking-tight">Use cases</h2>
        <p class="mt-2 text-slate-600 dark:text-slate-300">How creators and teams use ContentRepurpose.</p>
      </div>

      <div class="grid md:grid-cols-3 gap-6">
        <a href="https://contentrepurpose.pro/blog/paste-once-multi-channel/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>Paste once → multi-channel</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Turn a single idea into LinkedIn, X, email &amp; IG variants.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/ai-social-media-post-generator/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>AI post generator</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">On-brand, keyword-aware social posts in one go.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/notion-trello-export/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>Notion &amp; Trello workflows</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Push drafts to tools your team already lives in.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/content-repurposing-for-seo/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>Repurpose for SEO</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Refresh old content with better structure &amp; metadata.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/linkedin-post-templates/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>LinkedIn templates</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Battle-tested formats for hooks and clean flow.</p>
        </a>

        <a href="#demo" class="card p-5 block hover:opacity-90">
          <strong>Try it live</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Open the generator with your own text.</p>
        </a>
      </div>
    </div>
  </section>

  <!-- ===== OPTIMIZER CTA (scrolls to #optimizer in the Generator) ===== -->
  <section id="optimizer-cta" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-10">
      <div class="card p-5 md:p-6 flex flex-wrap items-center justify-between gap-4">
        <div>
          <strong class="block text-lg">Article Optimizer</strong>
          <p class="text-sm text-slate-500 dark:text-slate-400">
            Improve structure, add FAQs/JSON-LD, expand by ~30%, and get a better title/meta.
          </p>
        </div>
        <a href="#optimizer" class="btn btn-primary">Open Optimizer</a>
      </div>
    </div>
  </section>

  <!-- ===== PRICING (anchor target) ===== -->
  <section id="pricing" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="text-center mb-10">
        <h2 class="text-3xl md:text-4xl font-black tracking-tight">Simple, honest pricing</h2>
        <p class="mt-2 text-slate-600 dark:text-slate-300">Start free. Add power when you need it.</p>
      </div>

      <!-- Conversion rail -->
      <div class="card p-4 md:p-5 mb-6 flex flex-wrap items-center justify-between gap-3">
        <div class="flex items-center gap-2 text-sm">
          <span class="badge">LIMITED</span>
          <span>Use <strong class="mono">CONTENTOFF90</strong> for <strong>90% off</strong> your first month of <strong>Creator</strong>.</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="copyPromoBtn_pr" class="btn" type="button">Copy code</button>
          <a href="#demo" class="btn only-guest">Try Demo</a>
          <button id="manageBilling2" class="btn hidden only-authed" type="button">Manage billing</button>
          <button class="btn btn-primary js-open-auth only-guest" type="button">Sign in</button>
        </div>
      </div>

      <div class="grid lg:grid-cols-4 gap-6">
        <!-- FREE -->
        <div class="card p-6 flex flex-col">
          <div class="text-sm px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 border w-fit">Free</div>
          <h3 class="mt-3 text-xl font-bold">Demo + Account</h3>
          <div class="mt-2 text-3xl font-extrabold">$0<span class="text-sm text-slate-500">/forever</span></div>
          <ul class="mt-4 text-sm space-y-2">
            <li>• Demo (no login): <strong>5 runs / month</strong></li>
            <li>• Free account: <strong>5 runs / day</strong></li>
            <li>• 1× <strong>Article Optimizer</strong> (after verification)</li>
            <li>• BYOK: <strong>5 / day</strong></li>
            <li>• CSV/Markdown export</li>
          </ul>
          <a href="#demo" class="mt-6 block text-center btn">Start free</a>
        </div>

        <!-- STARTER -->
        <div class="card p-6 flex flex-col">
          <div class="text-sm px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 border w-fit">Starter</div>
          <h3 class="mt-3 text-xl font-bold">Solo Creator</h3>
          <div class="mt-2 text-3xl font-extrabold">$9<span class="text-sm text-slate-500">/mo</span></div>
          <ul class="mt-4 text-sm space-y-2">
            <li>• <strong>200 generations / month</strong></li>
            <li>• Batch inputs (up to 5 lines/run)</li>
            <li>• 10 saved presets</li>
            <li>• Priority models</li>
            <li>• BYOK: 50 / month (+5 daily headroom)</li>
            <li>• <strong>Scheduler</strong> (queue &amp; calendar)</li>
            <li>• <strong>Analytics</strong> (basics)</li>
            <li>• <strong>Article Optimizer</strong>: up to 5 / day</li>
          </ul>
          <button
            data-price="price_1S7y58JYjIKHzKcjzL7cIKiB"
            class="mt-6 w-full btn btn-primary js-checkout subBtn"
            type="button">Get Starter</button>
        </div>

        <!-- CREATOR (featured) -->
        <div class="card p-6 flex flex-col ring-1 ring-black/5 relative">
          <span class="absolute -top-3 left-1/2 -translate-x-1/2 text-xs px-3 py-1 rounded-full bg-grad text-white shadow">Best value</span>
          <h3 class="mt-1 text-xl font-bold">Creator</h3>
          <div class="mt-2 text-3xl font-extrabold">$19<span class="text-sm text-slate-500">/mo</span></div>
          <ul class="mt-4 text-sm space-y-2">
            <li>• <strong>500 generations / month</strong></li>
            <li>• Unlimited presets</li>
            <li>• Project pack export</li>
            <li>• Notion export &amp; Trello boards</li>
            <li>• Push drafts to Buffer</li>
            <li>• New workflows early</li>
            <li>• BYOK: 150 / month (+10 daily)</li>
            <li>• <strong>Scheduler</strong> (multi-profile)</li>
            <li>• <strong>Analytics Pro</strong> (per-channel)</li>
            <li>• <strong>Article Optimizer</strong>: up to 15 / day</li>
          </ul>
          <button
            data-price="price_1S7y77JYjIKHzKcjKQYjiqZH"
            class="mt-6 w-full btn btn-primary js-checkout subBtn"
            type="button">Get Creator</button>
        </div>

        <!-- BUSINESS -->
        <div class="card p-6 flex flex-col">
          <div class="text-sm px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 border w-fit">Team</div>
          <h3 class="mt-3 text-xl font-bold">Business</h3>
          <div class="mt-2 text-3xl font-extrabold">$49<span class="text-sm text-slate-500">/mo</span></div>
          <ul class="mt-4 text-sm space-y-2">
            <li>• <strong>Unlimited</strong> (fair use)</li>
            <li>• 3 seats included</li>
            <li>• White-label export</li>
            <li>• Priority support</li>
            <li>• All Creator integrations</li>
            <li>• Team presets &amp; shared calendar</li>
            <li>• BYOK: 300 / month (+30 daily)</li>
            <li>• <strong>Team Analytics</strong> (org-wide)</li>
            <li>• <strong>Article Optimizer</strong>: up to 30 / day</li>
          </ul>
          <button
            data-price="price_1S7y8OJYjIKHzKcjqA9uJdyh"
            class="mt-6 w-full btn js-checkout subBtn"
            type="button">Get Business</button>
        </div>
      </div>

      <!-- Why upgrade -->
      <div class="grid md:grid-cols-3 gap-6 mt-10">
        <div class="stat">
          <div class="k">Faster queues</div>
          <p class="text-sm text-slate-500 dark:text-slate-400">Paid lanes hit priority models with fewer rate limits.</p>
        </div>
        <div class="stat">
          <div class="k">Scheduler</div>
          <p class="text-sm text-slate-500 dark:text-slate-400">Queue multi-channel posts and see your week at a glance.</p>
        </div>
        <div class="stat">
          <div class="k">Integrations</div>
          <p class="text-sm text-slate-500 dark:text-slate-400">Push to Notion, Trello, and Buffer in one click.</p>
        </div>
      </div>

      <!-- ===== FAQ ===== -->
      <div id="faq" class="mt-14">
        <h3 class="text-2xl md:text-3xl font-black tracking-tight">Frequently asked questions</h3>
        <div class="mt-6 grid md:grid-cols-2 gap-4">
          <details class="card p-4">
            <summary class="font-semibold cursor-pointer">What counts as a “generation”?</summary>
            <p class="mt-2 text-sm text-slate-500 dark:text-slate-300">
              Any click on <em>Generate</em> that returns content (demo or signed-in). Batch mode counts per line.
            </p>
          </details>

          <details class="card p-4">
            <summary class="font-semibold cursor-pointer">Is the Article Optimizer included?</summary>
            <p class="mt-2 text-sm text-slate-500 dark:text-slate-300">
              Yes for all paid plans (daily caps by tier). Free users get one verified run.
            </p>
          </details>

          <details class="card p-4">
            <summary class="font-semibold cursor-pointer">What is BYOK?</summary>
            <p class="mt-2 text-sm text-slate-500 dark:text-slate-300">
              Bring Your Own Key — use your own model API key for extra capacity. We never store your key in plaintext.
            </p>
          </details>

          <details class="card p-4">
            <summary class="font-semibold cursor-pointer">Can I cancel anytime?</summary>
            <p class="mt-2 text-sm text-slate-500 dark:text-slate-300">
              Absolutely. Manage billing from your dashboard; your plan remains active until the end of the cycle.
            </p>
          </details>

          <details class="card p-4">
            <summary class="font-semibold cursor-pointer">Do you support teams?</summary>
            <p class="mt-2 text-sm text-slate-500 dark:text-slate-300">
              Yes — the Business plan includes 3 seats, shared calendar, org analytics, and white-label exports.
            </p>
          </details>

          <details class="card p-4">
            <summary class="font-semibold cursor-pointer">Which platforms can you export to?</summary>
            <p class="mt-2 text-sm text-slate-500 dark:text-slate-300">
              Notion and Trello on Creator+, plus Buffer queueing for LinkedIn, X, Facebook, and Instagram.
            </p>
          </details>
        </div>
      </div>
    </div>

    <!-- FAQ JSON-LD -->
    <script type="application/ld+json">
    {
      "@context":"https://schema.org",
      "@type":"FAQPage",
      "mainEntity":[
        {"@type":"Question","name":"What counts as a “generation”?","acceptedAnswer":{"@type":"Answer","text":"Any click on Generate that returns content (demo or signed-in). Batch mode counts per line."}},
        {"@type":"Question","name":"Is the Article Optimizer included?","acceptedAnswer":{"@type":"Answer","text":"Yes for all paid plans (daily caps by tier). Free users get one verified run."}},
        {"@type":"Question","name":"What is BYOK?","acceptedAnswer":{"@type":"Answer","text":"Bring Your Own Key — use your own model API key for extra capacity. We never store your key in plaintext."}},
        {"@type":"Question","name":"Can I cancel anytime?","acceptedAnswer":{"@type":"Answer","text":"Yes. Manage billing from your dashboard; your plan remains active until the end of the cycle."}},
        {"@type":"Question","name":"Do you support teams?","acceptedAnswer":{"@type":"Answer","text":"Yes — the Business plan includes 3 seats, shared calendar, org analytics, and white-label exports."}},
        {"@type":"Question","name":"Which platforms can you export to?","acceptedAnswer":{"@type":"Answer","text":"Notion and Trello on Creator+, plus Buffer queueing for LinkedIn, X, Facebook, and Instagram."}}
      ]
    }
    </script>
  </section>
  <!-- ===== TEMPLATES HUB (links to your internal template library) ===== -->
  <section id="templates" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="text-center mb-10">
        <h2 class="text-3xl md:text-4xl font-black tracking-tight">Templates & Playbooks</h2>
        <p class="mt-2 text-slate-600 dark:text-slate-300">Battle-tested formats for hooks, flows, and CTAs.</p>
      </div>

      <div class="grid md:grid-cols-3 gap-6">
        <a href="https://contentrepurpose.pro/blog/linkedin-post-templates/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>LinkedIn post templates</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Hooks, structures, and examples for scroll-stoppers.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/ai-social-media-post-generator/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>AI social media post generator</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">How to go multi-channel with one prompt.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/repurpose-blog-post-for-social-media/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>Repurpose a blog post for social</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Turn long-form into platform-native posts fast.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/paste-once-multi-channel/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>Paste once, publish everywhere</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">A single source becomes a week of content.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/notion-trello-export/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>Notion & Trello export</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Ship drafts to your team’s actual workflow.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/ai-content-repurposing/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>AI content repurposing</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Frameworks, benefits, and examples.</p>
        </a>
      </div>

      <!-- Quick path to all templates -->
      <div class="text-center mt-8">
        <a href="https://contentrepurpose.pro/blog/linkedin-post-templates/" class="btn btn-primary" target="_blank" rel="noopener">
          Browse all LinkedIn templates
        </a>
      </div>
    </div>
  </section>

  <!-- ===== BLOG RAIL (editorial for topical authority) ===== -->
  <section id="resources" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="text-center mb-10">
        <h2 class="text-3xl md:text-4xl font-black tracking-tight">Guides & Resources</h2>
        <p class="mt-2 text-slate-600 dark:text-slate-300">Deep dives on strategy, SEO, and workflows.</p>
      </div>

      <div class="grid md:grid-cols-3 gap-6">
        <a href="https://contentrepurpose.pro/blog/content-repurposing-101/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>Content Repurposing 101</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Foundations for multiplying your reach.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/content-repurposing-strategy/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>Repurposing strategy</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Cadence, channels, and measurement.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/how-to-repurpose-content/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>How to repurpose content</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Repeatable steps for consistent output.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/content-repurposing-ideas/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>Repurposing ideas</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Formats, angles, and prompts.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/repurpose-one-piece-multiple-platforms/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>One piece → many platforms</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Keep voice consistent across channels.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/ai-content-repurposing-examples-workflows/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>Examples & workflows</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Realistic sequences you can copy.</p>
        </a>

        <a href="http://contentrepurpose.pro/blog/free-ai-linkedin-post-generator/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>Free AI LinkedIn post generator</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Try templates + AI on LinkedIn posts.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/ai-search-ranking-with-repurposed-content/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>SEO ranking with repurposed content</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Topical clusters and internal links.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/ai-content-repurposing-benefits-risks-roi-2025/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>Benefits, risks & ROI (2025)</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Deciding when AI pays for itself.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/best-ai-content-repurposing-tools-2025/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>Best AI repurposing tools (2025)</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Compare capabilities and pricing.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/ai-vs-manual-content-repurposing/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>AI vs manual repurposing</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Where humans shine — and where AI is faster.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/contentrepurpose-vs-missinglettr/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>ContentRepurpose vs Missinglettr</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Why we win for multi-channel drafts.</p>
        </a>

        <a href="https://contentrepurpose.pro/blog/contentrepurpose-vs-writesonic/" class="card p-5 block hover:opacity-90" target="_blank" rel="noopener">
          <strong>ContentRepurpose vs Writesonic</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Cleaner outputs, simpler workflow.</p>
        </a>
      </div>
    </div>
  </section>

  <!-- ===== FOOTER ===== -->
  <footer class="mt-20 border-t border-white/30" id="site-footer">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-10 text-sm flex flex-wrap items-center justify-between gap-3">
      <div class="opacity-80">© <span id="year">2025</span> ContentRepurpose.pro</div>
      <nav class="flex items-center gap-4 opacity-80">
        <a href="#pricing" class="hover:opacity-100">Pricing</a>
        <a href="/blog" class="hover:opacity-100">Blog</a>
        <a href="mailto:hello@contentrepurpose.pro" class="hover:opacity-100">Contact</a>
      </nav>
    </div>
  </footer>
<!-- ===== APP SCRIPT (Auth + Anchors + Generator + Optimizer + Presets + Scheduler + Integrations) ===== -->
<script type="module" id="crp-app-js">
/* ContentRepurpose.pro — unified front-end boot */

if (!window.__CRP_V3_BOOT__) {
  window.__CRP_V3_BOOT__ = true;

  /* =============== Short helpers =============== */
  const $  = (sel, el=document) => el.querySelector(sel);
  const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));
  const byId = (id) => document.getElementById(id);
  const cap   = (s)=> (s||"").slice(0,1).toUpperCase() + (s||"").slice(1);
  const sleep = (ms)=> new Promise(r=>setTimeout(r, ms));
  const SITE_ORIGIN = window.SITE_ORIGIN || location.origin;
  const WORKER_BASE = window.WORKER_BASE || "https://contentflow-worker.frank-couchman.workers.dev";

  function toast(msg){
    try{ const t=byId("toast"), m=byId("toastMsg");
      if (!t||!m) return alert(msg);
      m.textContent = msg; t.classList.remove("hidden");
      setTimeout(()=> t.classList.add("hidden"), 1600);
    }catch{ alert(msg); }
  }
  const once = (el, evt, fn)=>{ if(!el) return; const k="__once_"+evt; if(el[k]) return; el.addEventListener(evt, fn); el[k]=true; };

  /* =============== Supabase init (magic link + Google) =============== */
  const SUPABASE_URL  = "https://ynkoavaeadlzlwylmfmu.supabase.co";
  const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlua29hdmFlYWRsemx3eWxtZm11Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5OTAxNDgsImV4cCI6MjA3MzU2NjE0OH0.1yM5yDo0MI9Upzt4GkLyf1mqvDXfb3DXvC0ouOLtRoU";

  let supabase = window.supabase;

  async function ensureSupabase(){
    if (window.supabase) { supabase = window.supabase; return; }
    const { createClient } = await import("https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm");
    window.supabase = createClient(SUPABASE_URL, SUPABASE_ANON, { auth:{ persistSession:true, autoRefreshToken:true, detectSessionInUrl:true }});
    supabase = window.supabase;
  }

  async function finishOAuthIfNeeded(){
    try{
      const u = new URL(location.href);
      const code = u.searchParams.get("code");
      const err  = u.searchParams.get("error_description");
      if (err) toast(decodeURIComponent(err));
      if (code){
        const { error } = await supabase.auth.exchangeCodeForSession({ code });
        if (error) toast(error.message);
        ["code","state","scope","provider_id","redirected_from"].forEach(p=> u.searchParams.delete(p));
        history.replaceState({}, "", u.toString());
      }
      if (location.hash.includes("access_token")){
        await supabase.auth.getSession();
        history.replaceState({}, "", location.pathname + location.search);
      }
    }catch{}
  }

  async function getAuthHeaders(){
    const h = { "Content-Type":"application/json" };
    try{
      const { data } = await supabase.auth.getSession();
      const tok = data?.session?.access_token;
      const uid = data?.session?.user?.id;
      if (tok) h["Authorization"] = `Bearer ${tok}`;
      if (uid) h["X-User-Id"] = uid;
    }catch{}
    return h;
  }

  /* =============== Plan gates =============== */
  const PLAN_RANK = { free:0, starter:1, creator:2, business:3 };
  let CURRENT_PLAN = "free";
  let AUTHTED = false;
  let USER_ID = null;

  function paintPlan(plan){
    CURRENT_PLAN = plan;
    const pretty = `Plan: ${cap(plan)}`;
    byId("planbadge")   && (byId("planbadge").textContent = pretty);
    byId("planbadge_m") && (byId("planbadge_m").textContent = pretty);
    byId("heroPlanName")&& (byId("heroPlanName").textContent = cap(plan));
    document.body.setAttribute("data-plan", plan);
    // Gate blocks
    const r = PLAN_RANK[plan] ?? 0;
    $$(".plan-starter-plus").forEach(el=> el.classList.toggle("hidden", r<1));
    $$(".plan-creator-plus").forEach(el=> el.classList.toggle("hidden", r<2));
    $$(".plan-business-only").forEach(el=> el.classList.toggle("hidden", r<3));
  }
  function paintAuth(authed){
    AUTHTED = !!authed;
    document.body.setAttribute("data-auth", authed ? "authed" : "guest");
    $$(".only-guest").forEach(el=> el.classList.toggle("hidden", authed));
    $$(".only-authed").forEach(el=> el.classList.toggle("hidden", !authed));
    ["manageBilling","manageBilling_m","manageBilling2"].forEach(id=>{
      const el = byId(id); if (el) el.classList.toggle("hidden", !authed);
    });
    byId("generateBtn")?.classList.toggle("hidden", authed);
    byId("generateBtn_member")?.classList.toggle("hidden", !authed);
  }

  async function fetchStatusAndPaint(){
    try{
      const r = await fetch(`${WORKER_BASE}/api/billing/status`, { headers: await getAuthHeaders() });
      const j = await r.json();
      AUTHTED = j.scope === "user";
      USER_ID = AUTHTED ? j.userId || null : null;
      paintAuth(AUTHTED);
      paintPlan((j.plan || "free").toLowerCase());

      // quotas
      if (!AUTHTED){
        const cap = j.platform?.monthly?.cap ?? 5;
        const used= j.platform?.monthly?.used ?? 0;
        byId("demoQuota") && (byId("demoQuota").textContent = Math.max(0, cap-used));
      } else {
        const cap = j.platform?.daily?.cap; // null = ∞
        const used= j.platform?.daily?.used ?? 0;
        byId("memberQuota") && (byId("memberQuota").textContent = cap==null ? "∞" : Math.max(0, cap-used));
      }
    }catch{
      paintAuth(false); paintPlan("free");
    }
  }

  /* =============== A11y + Anchors (smooth scroll) =============== */
  function wireAnchors(){
    $$('a[href^="#"]').forEach(a=>{
      once(a, "click", (e)=>{
        const id = a.getAttribute("href");
        if (!id || id==="#") return;
        const el = document.querySelector(id);
        if (el){
          e.preventDefault();
          try{ el.scrollIntoView({ behavior:"smooth", block:"start" }); }catch{ el.scrollIntoView(); }
          history.replaceState(null,"",id);
        } // if section missing, let it behave as normal anchor change
      });
    });
  }

  /* =============== Nav + mobile sheet =============== */
  function wireNav(){
    const toggle = byId("navToggle");
    const sheet  = byId("mobileNav");
    const close  = byId("navClose");
    toggle && once(toggle, "click", ()=> document.body.classList.add("nav-open"));
    close  && once(close,  "click", ()=> document.body.classList.remove("nav-open"));
    // close on any mobile link
    $$("#mobileNav a[href^='#']").forEach(a=> once(a,"click", ()=> document.body.classList.remove("nav-open")));
    // year
    const y = byId("year"); y && (y.textContent = new Date().getFullYear());
  }

  /* =============== Auth dialog buttons =============== */
  function wireAuthUI(){
    const openAuth = ()=> byId("auth")?.showModal();
    // any trigger
    $$(".js-open-auth").forEach(b=> once(b,"click", openAuth));
    ["loginBtn","loginBtn_m","heroSignIn"].forEach(id=> byId(id) && once(byId(id),"click", openAuth));
    // logout
    ["logoutBtn","logoutBtn_m"].forEach(id=>{
      const el = byId(id);
      el && once(el,"click", async ()=>{ try{ await supabase.auth.signOut(); toast("Signed out"); }catch{} });
    });
    // dialog internals
    const send = byId("authSend");
    const emailEl = byId("authEmail");
    const gBtn = byId("authGoogle");
    once(send,"click", async ()=>{
      const email = emailEl?.value?.trim();
      if (!email) return toast("Enter your email");
      try{
        const { error } = await supabase.auth.signInWithOtp({ email, options:{ emailRedirectTo: SITE_ORIGIN }});
        if (error) throw error;
        toast("Check your email for the magic link.");
      }catch(e){ toast(e.message || "Sign-in error"); }
    });
    once(gBtn,"click", async ()=>{
      try{
        const { error } = await supabase.auth.signInWithOAuth({ provider:"google", options:{ redirectTo: SITE_ORIGIN }});
        if (error) throw error;
      }catch(e){ toast(e.message || "Google sign-in failed"); }
    });
    once(emailEl,"keydown",(e)=>{ if (e.key==="Enter"){ e.preventDefault(); send?.click(); }});
  }

  /* =============== Promo buttons =============== */
  ["copyPromoBtn","copyPromoBtn2","copyPromoBtn_pr"].forEach(id=>{
    const el = byId(id);
    el && once(el,"click", async ()=>{ try{ await navigator.clipboard.writeText("CONTENTOFF90"); toast("Code copied ✅"); }catch{ toast("Copy failed"); }});
  });

  /* =============== Generator + Output =============== */
  let LAST_OUTPUT = null;

  function readToggles(form){
    const g = (n)=> form.elements[n];
    return {
      opt: {
        humanize:  g("opt_humanize")?.checked,
        lengthen:  g("opt_lengthen")?.checked,
        faqs:      g("opt_faqs")?.checked,
        headings:  g("opt_headings")?.checked,
        svg:       g("opt_svg")?.checked,
        seo:       g("opt_seo")?.checked
      },
      ch: {
        linkedin:  g("ch_linkedin")?.checked,
        x:         g("ch_x")?.checked,
        email:     g("ch_email")?.checked,
        instagram: g("ch_instagram")?.checked,
        reddit:    g("ch_reddit")?.checked,
        facebook:  g("ch_facebook")?.checked,
        quora:     g("ch_quora")?.checked,
        tiktok:    g("ch_tiktok")?.checked,
      },
      extras: {
        li_article: g("li_article")?.checked,
        x_sequence: g("x_sequence")?.checked,
        x_posts:    g("x_posts")?.value || "4",
        rdt_communities: g("rdt_communities")?.checked,
        rdt_comments:    g("rdt_comments")?.checked,
        tt_hooks:   g("tt_hooks")?.checked,
        tt_onscreen:g("tt_onscreen")?.checked
      }
    };
  }

  function systemPrompt(tog){
    return {
      role:"system",
      content:
`You are a senior social copywriter.
Return ONLY valid JSON with this exact shape:
{
  "outline": string,
  "linkedin": string|null,
  "x": string[]|null,
  "email": { "subject": string, "body": string }|null,
  "instagram": { "caption": string, "hashtags": string[] }|null,
  "reddit": { "title": string, "body": string, "communities": string[], "starter_comments": string[] }|null,
  "facebook": { "primary": string, "meta": { "headline": string, "description": string } }|null,
  "quora": { "answer": string, "followups": string[] }|null,
  "tiktok": { "hooks": string[], "script": string, "onscreen": string[] }|null,
  "linkedin_article_html": string|null
}
Rules:
- Respect toggles exactly (humanize:${tog.opt.humanize}, lengthen:${tog.opt.lengthen}, faqs:${tog.opt.faqs}, headings:${tog.opt.headings}, svg:${tog.opt.svg}, seo:${tog.opt.seo}, x_posts:${tog.extras.x_posts}, x_sequence:${tog.extras.x_sequence}, li_article:${tog.extras.li_article}, rdt_communities:${tog.extras.rdt_communities}, rdt_comments:${tog.extras.rdt_comments}, tt_hooks:${tog.extras.tt_hooks}, tt_onscreen:${tog.extras.tt_onscreen}).
- Keep platform-native, concise. X posts ≤ 280 chars; prefix "Post N:" when sequence.
- Instagram: 3–5 useful hashtags (without '#' prefix; caller will add).
- Reddit communities MUST be plain names like "contentwriting" (NOT "r/contentwriting").`
    };
  }

  function userPrompt(raw, form, tog){
    const srcType = form.elements["sourceType"]?.value || "paragraph";
    const head = srcType==="url" ? "URL" : (srcType==="blog" ? "Full Blog" : "Paragraph/Notes");
    const channels = Object.entries(tog.ch).filter(([,v])=>v).map(([k])=>k).join(", ");
    return {
      role:"user",
      content:
`${head}:
${raw}

Task:
1) Create a one-line outline.
2) Generate ONLY for channels: ${channels || "linkedin,x,email"}.
3) Apply all toggles/extras exactly.`
    };
  }

  function parseJsonLoose(txt){
    if (!txt) return null;
    let s = String(txt).trim();
    s = s.replace(/^```(?:json)?/i, "").replace(/```$/i, "").trim();
    const first = s.indexOf("{"); const last = s.lastIndexOf("}");
    if (first>=0 && last>first) s = s.slice(first, last+1);
    try{ return JSON.parse(s); }catch{}
    s = s.replace(/,\s*([}\]])/g, "$1");
    try{ return JSON.parse(s); }catch{}
    return null;
  }

  function paintOutput(j){
    const outWrap = byId("demoOutput");
    if (!outWrap) return;
    outWrap.innerHTML = "";
    LAST_OUTPUT = {}; // reset

    const addCard = (title, text, cacheKey=null) => {
      const inner = `<div class="flex justify-between items-center gap-2 flex-wrap">
        <strong class="tracking-tight">${title}</strong>
        <button class="btn copy" type="button">Copy</button>
      </div>
      <pre class="whitespace-pre-wrap text-sm mt-3 content">${text}</pre>`;
      const wrap = document.createElement("div");
      wrap.className = "card p-5";
      wrap.innerHTML = inner;
      outWrap.appendChild(wrap);
      const copyBtn = $(".btn.copy", wrap);
      const pre = $(".content", wrap);
      copyBtn && once(copyBtn, "click", async ()=>{ try{ await navigator.clipboard.writeText(pre?.innerText || ""); toast("Copied ✅"); }catch{ toast("Copy failed"); }});
      if (cacheKey) LAST_OUTPUT[cacheKey] = pre?.innerText || "";
    };

    if (j.outline) addCard("Outline", j.outline);

    if (j.linkedin) addCard("LinkedIn", j.linkedin, "linkedin");

    if (Array.isArray(j.x) && j.x.length){
      const seq = j.x.map((t,i)=> (t?.trim()?`Post ${i+1}: ${t.trim()}`:"")).filter(Boolean).join("\n\n");
      addCard("X (Twitter)", seq, "x");
    }

    if (j.email && (j.email.subject || j.email.body)){
      addCard("Email", `Subject: ${j.email.subject||""}\n\n${j.email.body||""}`, "email");
    }

    if (j.instagram){
      const tags = (j.instagram.hashtags||[]).map(h=> h.startsWith("#")?h:"#"+h).join(" ");
      addCard("Instagram", `${j.instagram.caption||""}\n\n${tags}`, "instagram");
    }

    if (j.reddit){
      // Ensure names NOT prefixed with r/
      const subs = (j.reddit.communities||[]).map(s=> String(s).replace(/^r\//i,"")).filter(Boolean);
      const starters = (j.reddit.starter_comments||[]).map(c=>`• ${c}`).join("\n");
      addCard("Reddit", `Title: ${j.reddit.title||""}\n\n${j.reddit.body||""}\n\nSuggested communities: ${subs.map(s=>"r/"+s).join(", ")}\n\nStarter comments:\n${starters||"—"}`, "reddit");
    }

    if (j.facebook){
      addCard("Facebook", `Primary:\n${j.facebook.primary||""}\n\nPreview:\n${(j.facebook.meta?.headline||"")}\n${(j.facebook.meta?.description||"")}`, "facebook");
    }

    if (j.quora){
      const follow = (j.quora.followups||[]).map(f=>`• ${f}`).join("\n");
      addCard("Quora", `Answer:\n${j.quora.answer||""}\n\nFollow-ups:\n${follow||"—"}`, "quora");
    }

    if (j.tiktok){
      const hooks = (j.tiktok.hooks||[]).map(h=>`• ${h}`).join("\n");
      const ons = (j.tiktok.onscreen||[]).map(o=>`• ${o}`).join("\n");
      addCard("TikTok", `Script:\n${j.tiktok.script||""}\n\nHooks:\n${hooks||"—"}\n\nOn-screen plan:\n${ons||"—"}`, "tiktok");
    }

    // If we got a LinkedIn Article HTML, surface it inside the Optimizer pane as preview too
    if (j.linkedin_article_html){
      const pane = byId("optimizerPane");
      if (pane){
        const a = document.createElement("div");
        a.className="card p-4";
        a.innerHTML = `<strong class="tracking-tight">LinkedIn Article (preview)</strong>
          <div class="mt-3 prose prose-invert max-w-none" style="white-space:normal">${j.linkedin_article_html}</div>`;
        pane.prepend(a);
      }
    }
  }

  function wireGenerator(){
    const form = byId("demoForm");
    const src  = byId("sourceText");
    const outWrap = byId("demoOutput");
    const clearBtn = byId("clearBtn");
    const genBtnGuest  = byId("generateBtn");
    const genBtnMember = byId("generateBtn_member");
    if (!form || !src || !outWrap) return;

    once(clearBtn, "click", ()=>{ src.value=""; outWrap.innerHTML=""; LAST_OUTPUT=null; });

    once(form, "submit", async (e)=>{
      e.preventDefault();               // IMPORTANT: do not navigate/append query params
      const raw = (src.value||"").trim();
      if (!raw) return toast("Paste some content first");

      const btn = AUTHTED ? genBtnMember : genBtnGuest;
      btn.disabled = true; const oldTxt = btn.textContent; btn.textContent="Generating…";
      outWrap.innerHTML = `<div class="card p-5 text-sm text-slate-500">Working…</div>`;

      try{
        const tog = readToggles(form);
        const messages = [ systemPrompt(tog), userPrompt(raw, form, tog) ];
        const lane = (!AUTHTED || CURRENT_PLAN==="free") ? "free" : "pro";

        const r = await fetch(`${WORKER_BASE}/api/generate`,{
          method:"POST",
          headers: await getAuthHeaders(),
          body: JSON.stringify({ plan: lane, temperature: 0.5, messages })
        });
        const data = await r.json();
        if (!r.ok) throw new Error(data?.error?.message || "Generation failed");

        const content = data?.choices?.[0]?.message?.content || "";
        const j = parseJsonLoose(content);
        if (!j) throw new Error("Model did not return JSON");
        paintOutput(j);
        toast("Done ✅");
        fetchStatusAndPaint().catch(()=>{});
      }catch(e){
        outWrap.innerHTML = `<div class="card p-5 text-sm text-red-500">Error: ${e.message || e}</div>`;
      }finally{
        btn.disabled = false; btn.textContent = oldTxt;
      }
    });
  }

  /* =============== Optimizer panel reveal (anchor-aware) =============== */
  function wireOptimizerReveal(){
    const go = (e)=>{
      const target = byId("optimizer");
      if (target){
        e && e.preventDefault();
        try{ target.scrollIntoView({ behavior:"smooth", block:"start" }); }catch{ target.scrollIntoView(); }
        history.replaceState(null, "", "#optimizer");
      }
    };
    $$('#openOptimizer, a[href="#optimizer"]').forEach(b=> once(b,"click", go));
    // If user lands with #optimizer already in URL
    if (location.hash==="#optimizer") setTimeout(()=> go(), 60);
  }

  /* =============== Quick Publish + Email preview =============== */
  function wireQuickPublish(){
    const btnX   = byId("qp-x");
    const btnRd  = byId("qp-reddit");
    const btnLi  = byId("qp-linkedin");
    const btnEm  = byId("qp-email");
    if (btnX) once(btnX,"click", ()=>{
      if (!LAST_OUTPUT?.x && !LAST_OUTPUT?.linkedin) return toast("Generate first");
      const text = (LAST_OUTPUT?.x || LAST_OUTPUT?.linkedin || "").split(/\n+/).map(s=>s.trim()).filter(Boolean).join(" — ");
      const url = `https://x.com/intent/tweet?text=${encodeURIComponent(text.slice(0,270))}`;
      window.open(url,"_blank");
    });
    if (btnRd) once(btnRd,"click", ()=>{
      const body = LAST_OUTPUT?.reddit || LAST_OUTPUT?.linkedin || LAST_OUTPUT?.x;
      if (!body) return toast("Generate first");
      const firstLine = body.split("\n")[0].replace(/^Post \d+:\s*/,"").slice(0,280);
      const url = `https://www.reddit.com/submit?title=${encodeURIComponent(firstLine)}&text=${encodeURIComponent(body)}`;
      window.open(url,"_blank");
    });
    if (btnLi) once(btnLi,"click", async ()=>{
      const text = LAST_OUTPUT?.linkedin || LAST_OUTPUT?.x; if (!text) return toast("Generate first");
      try{ await navigator.clipboard.writeText(text); toast("Copied for LinkedIn ✅"); }catch{}
      window.open("https://www.linkedin.com/feed/","_blank");
    });
    if (btnEm) once(btnEm,"click", ()=>{
      const raw = LAST_OUTPUT?.email || "";
      const dlg = byId("emailPreview");
      if (!dlg) return;
      const subj = byId("emailSubjEdit");
      const body = byId("emailBodyEdit");
      // naive parse: first line "Subject: ..."
      const parts = raw.split("\n");
      const pSubj = (parts[0]||"").replace(/^Subject:\s*/i,"").slice(0,120);
      const pBody = parts.slice(1).join("\n");
      subj && (subj.value = pSubj);
      body && (body.value = pBody || raw || "");
      dlg.showModal();
    });
    const emailSendBtn = byId("emailSendBtn");
    emailSendBtn && once(emailSendBtn,"click", ()=>{
      const subj = byId("emailSubjEdit")?.value || "";
      const body = byId("emailBodyEdit")?.value || "";
      location.href = `mailto:?subject=${encodeURIComponent(subj)}&body=${encodeURIComponent(body)}`;
    });
  }

  /* =============== Scheduler (Starter+) =============== */
  const SKEY = ()=> `crp:sched:${USER_ID || "anon"}`;
  const loadQueue = ()=> { try{ return JSON.parse(localStorage.getItem(SKEY())||"[]"); }catch{ return []; } };
  const saveQueue = (q)=> { try{ localStorage.setItem(SKEY(), JSON.stringify(q)); }catch{} };

  function renderQueue(){
    const wrap = byId("schedList");
    const empty= byId("schedEmpty");
    if (!wrap) return;
    const q = loadQueue();
    wrap.innerHTML = "";
    if (!q.length){ empty?.classList.remove("hidden"); return; }
    empty?.classList.add("hidden");
    q.forEach((item, idx)=>{
      const div = document.createElement("div");
      div.className = "border rounded-xl p-3 grid md:grid-cols-12 gap-3 items-start";
      div.innerHTML = `
        <label class="md:col-span-1 flex items-start gap-2 text-sm">
          <input type="checkbox" data-idx="${idx}" ${item.selected?"checked":""} />
          <span class="mono text-[11px]">${item.channel}</span>
        </label>
        <div class="md:col-span-3 text-xs text-slate-500">${new Date(item.when).toLocaleString()}</div>
        <div class="md:col-span-7 text-sm whitespace-pre-wrap">${item.text}</div>
        <div class="md:col-span-1 text-right">
          <button class="btn" data-del="${idx}" type="button">Remove</button>
        </div>`;
      wrap.appendChild(div);
    });
    $$('input[type="checkbox"][data-idx]', wrap).forEach(cb=>{
      once(cb,"change", ()=>{
        const q = loadQueue(); const i = Number(cb.getAttribute("data-idx")||"0");
        if (q[i]){ q[i].selected = cb.checked; saveQueue(q); }
      });
    });
    $$('button[data-del]', wrap).forEach(b=>{
      once(b,"click", ()=>{
        const q = loadQueue(); const i = Number(b.getAttribute("data-del")||"0");
        q.splice(i,1); saveQueue(q); renderQueue();
      });
    });
  }

  function wireScheduler(){
    const add = byId("schedAdd");
    const useLast = byId("schedUseLast");
    const ch  = byId("schedChannel");
    const when = byId("schedWhen");
    const text = byId("schedText");
    const pub = byId("schedPublish");
    const clr = byId("schedClear");
    if (!add || !useLast || !ch || !text) return;

    once(add, "click", ()=>{
      const payload = (text.value||"").trim();
      const w = when?.value ? new Date(when.value) : new Date(Date.now()+5*60*1000);
      if (!payload) return toast("Add some text first");
      const q = loadQueue();
      q.push({ channel: ch.value, when: w.toISOString(), text: payload, selected: true });
      saveQueue(q); renderQueue(); toast("Added to queue");
    });

    once(useLast, "click", ()=>{
      if (!LAST_OUTPUT) return toast("Generate first");
      const key = ch.value;
      const val = LAST_OUTPUT[key] || LAST_OUTPUT.linkedin || LAST_OUTPUT.x || "";
      if (!val) return toast("No output for this channel yet");
      byId("schedText").value = val;
      toast("Filled from last output");
    });

    once(pub, "click", ()=>{
      const q = loadQueue();
      const sel = q.filter(i=> i.selected);
      if (!sel.length) return toast("Select some items first");
      sel.forEach(item=>{
        const txt = item.text;
        switch(item.channel){
          case "x":
            window.open(`https://x.com/intent/tweet?text=${encodeURIComponent(txt.slice(0,270))}`,"_blank");
            break;
          case "reddit":
            const f = txt.split("\n")[0].slice(0,280);
            window.open(`https://www.reddit.com/submit?title=${encodeURIComponent(f)}&text=${encodeURIComponent(txt)}`,"_blank");
            break;
          case "linkedin":
            navigator.clipboard.writeText(txt).catch(()=>{});
            window.open("https://www.linkedin.com/feed/","_blank");
            break;
          case "email":
            window.open(`mailto:?subject=${encodeURIComponent(txt.split("\n")[0].slice(0,120))}&body=${encodeURIComponent(txt)}`,"_self");
            break;
          default:
            navigator.clipboard.writeText(txt).catch(()=>{});
            toast(`Copied ${item.channel} text — paste into the app.`);
            break;
        }
      });
      const remain = q.filter(i=> !i.selected);
      saveQueue(remain); renderQueue();
    });

    once(clr, "click", ()=>{ saveQueue([]); renderQueue(); });
    renderQueue();
  }

  /* =============== Presets (save/load/delete) =============== */
  function wirePresets(){
    const saveBtn = byId("presetSave");
    const loadSel = byId("presetLoad");
    const delBtn  = byId("presetDelete");
    const form    = byId("demoForm");
    const src     = byId("sourceText");
    if (!saveBtn || !loadSel || !delBtn || !form) return;

    async function refreshList(){
      try{
        const r = await fetch(`${WORKER_BASE}/api/presets/list`, { headers: await getAuthHeaders() });
        const j = await r.json();
        if (!r.ok) throw new Error(j?.error?.message || "Failed to list presets");
        loadSel.innerHTML = `<option value="">Load preset…</option>`;
        (j.presets||[]).forEach(p=>{
          const opt = document.createElement("option");
          opt.value = p.id; opt.textContent = p.title;
          loadSel.appendChild(opt);
        });
      }catch{}
    }

    once(saveBtn, "click", async ()=>{
      if (!AUTHTED) return toast("Sign in to save presets");
      const title = prompt("Preset name?") || "Preset";
      const data = {
        sourceType: form.elements["sourceType"]?.value || "paragraph",
        toggles: readToggles(form)
      };
      try{
        const r = await fetch(`${WORKER_BASE}/api/presets/save`,{
          method:"POST", headers: await getAuthHeaders(),
          body: JSON.stringify({ title, data })
        });
        const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message||"Failed to save");
        toast("Preset saved ✅"); refreshList();
      }catch(e){ toast(e.message||"Save failed"); }
    });

    once(loadSel, "change", async ()=>{
      const id = loadSel.value; if (!id) return;
      try{
        const r = await fetch(`${WORKER_BASE}/api/presets/list`, { headers: await getAuthHeaders() });
        const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message||"Load failed");
        const p = (j.presets||[]).find(x=> x.id===id); if (!p) return;
        const d = p.data || {};
        if (d.sourceType) {
          const el = form.elements["sourceType"];
          el && $$('input[name="sourceType"]').forEach(radio => { radio.checked = (radio.value===d.sourceType); });
        }
        const t = d.toggles || {};
        // set checkboxes by name
        const set = (name, val)=> { const el=form.elements[name]; if (el && "checked" in el) el.checked = !!val; };
        set("opt_humanize", t.opt?.humanize); set("opt_lengthen", t.opt?.lengthen);
        set("opt_faqs", t.opt?.faqs); set("opt_headings", t.opt?.headings);
        set("opt_svg", t.opt?.svg); set("opt_seo", t.opt?.seo);
        set("ch_linkedin", t.ch?.linkedin); set("ch_x", t.ch?.x); set("ch_email", t.ch?.email);
        set("ch_instagram", t.ch?.instagram); set("ch_reddit", t.ch?.reddit);
        set("ch_facebook", t.ch?.facebook); set("ch_quora", t.ch?.quora); set("ch_tiktok", t.ch?.tiktok);
        set("li_article", t.extras?.li_article); set("x_sequence", t.extras?.x_sequence);
        if (form.elements["x_posts"]) form.elements["x_posts"].value = t.extras?.x_posts || "4";
        toast("Preset loaded ✅");
      }catch(e){ toast(e.message||"Load failed"); }
    });

    once(delBtn, "click", async ()=>{
      const id = loadSel.value; if (!id) return toast("Choose a preset first");
      try{
        const r = await fetch(`${WORKER_BASE}/api/presets/delete`,{
          method:"POST", headers: await getAuthHeaders(),
          body: JSON.stringify({ id })
        });
        const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message||"Delete failed");
        toast("Preset deleted ✅"); refreshList();
      }catch(e){ toast(e.message||"Delete failed"); }
    });

    // initial fill
    refreshList();
  }

  /* =============== Integrations (Notion/Trello/Buffer) =============== */
  function wireIntegrations(){
    // Notion export (Creator+ gated by UI; we also allow starting OAuth)
    const btnNotion = byId("li-notion");
    btnNotion && once(btnNotion,"click", async ()=>{
      // If not connected yet, kick OAuth
      try{
        const st = await fetch(`${WORKER_BASE}/api/billing/status`, { headers: await getAuthHeaders() }).then(r=>r.json()).catch(()=>({}));
        const connected = !!st?.integrations?.notion?.connected;
        if (!connected){
          const go = await fetch(`${WORKER_BASE}/api/integrations/notion/oauth/start`, { headers: await getAuthHeaders() }).then(r=>r.json());
          if (go?.url) { location.href = go.url; return; }
        }
      }catch{}
      // Export basic blocks from LAST_OUTPUT
      const blocks = [];
      if (LAST_OUTPUT?.linkedin){ blocks.push({ type:"heading", text:"LinkedIn" }, { type:"paragraph", text: LAST_OUTPUT.linkedin }); }
      if (LAST_OUTPUT?.x){ blocks.push({ type:"heading", text:"X (Twitter)" }, { type:"paragraph", text: LAST_OUTPUT.x }); }
      if (!blocks.length) return toast("Generate first");
      try{
        const r = await fetch(`${WORKER_BASE}/api/integrations/notion/export`,{
          method:"POST", headers: await getAuthHeaders(),
          body: JSON.stringify({ title:"Social Drafts", blocks })
        });
        const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message||"Notion export failed");
        toast("Sent to Notion ✅"); j.url && window.open(j.url, "_blank");
      }catch(e){ toast(e.message||"Notion export failed"); }
    });

    // Trello export (Creator+)
    const btnTrello = byId("li-trello");
    const trelloDialog = byId("trelloModal");
    btnTrello && once(btnTrello, "click", async ()=>{
      try{
        const st = await fetch(`${WORKER_BASE}/api/billing/status`, { headers: await getAuthHeaders() }).then(r=>r.json()).catch(()=>({}));
        const connected = !!st?.integrations?.trello?.connected;
        if (!connected){
          const go = await fetch(`${WORKER_BASE}/api/integrations/trello/oauth/start`, { headers: await getAuthHeaders() }).then(r=>r.json());
          if (go?.url){ location.href = go.url; return; }
        }
      }catch{}
      trelloDialog?.showModal();
    });

    const tConfirm = byId("trelloConfirm");
    tConfirm && once(tConfirm, "click", async ()=>{
      const list_id  = byId("trelloListId")?.value?.trim();
      if (!list_id) return toast("Enter Trello List ID");
      const board_id = byId("trelloBoardId")?.value?.trim() || undefined;
      const title = "Social Draft";
      const description = [
        "LinkedIn:\n"+(LAST_OUTPUT?.linkedin||""),
        "\nX:\n"+(LAST_OUTPUT?.x||"")
      ].join("\n");
      try{
        const r = await fetch(`${WORKER_BASE}/api/integrations/trello/export`,{
          method:"POST", headers: await getAuthHeaders(),
          body: JSON.stringify({ board_id, list_id, title, description })
        });
        const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message||"Trello export failed");
        toast("Sent to Trello ✅"); byId("trelloModal")?.close(); j.url && window.open(j.url, "_blank");
      }catch(e){ toast(e.message||"Trello export failed"); }
    });
  }

  /* =============== Pricing checkout + portal =============== */
  function wireBilling(){
    $$(".js-checkout").forEach(btn=>{
      once(btn,"click", async ()=>{
        const price = btn.getAttribute("data-price") || "";
        if (!price) return toast("Missing price id");
        const old = btn.textContent; btn.disabled = true; btn.textContent = "Opening…";
        try{
          const r = await fetch(`${WORKER_BASE}/api/billing/checkout`,{
            method:"POST", headers: await getAuthHeaders(),
            body: JSON.stringify({
              price,
              success_url: `${SITE_ORIGIN}/?billing=success`,
              cancel_url:  `${SITE_ORIGIN}/?billing=cancel`
            })
          });
          const j = await r.json();
          if (!r.ok) throw new Error(j?.error?.message || "Checkout error");
          location.href = j.url;
        }catch(e){ toast(e.message||"Portal error"); btn.disabled=false; btn.textContent=old; }
      });
    });
    ["manageBilling","manageBilling_m","manageBilling2"].forEach(id=>{
      const b = byId(id); if (!b) return;
      once(b, "click", async ()=>{
        const old=b.textContent; b.disabled=true; b.textContent="Opening…";
        try{
          const r = await fetch(`${WORKER_BASE}/api/billing/portal`,{
            method:"POST", headers: await getAuthHeaders(),
            body: JSON.stringify({ return_url: location.href })
          });
          const j = await r.json();
          if (!r.ok) throw new Error(j?.error?.message || "Portal error");
          location.href = j.url;
        }catch(e){ toast(e.message||"Portal error"); b.disabled=false; b.textContent=old; }
      });
    });
  }

  /* =============== Live stats strip =============== */
  async function paintLive(){
    try{
      const r = await fetch(`${WORKER_BASE}/api/stats/today`);
      const j = await r.json();
      if (r.ok && typeof j.today_count === "number"){
        $$('[data-live-count], #liveCount').forEach(el=> el.textContent = String(j.today_count));
      }
    }catch{}
  }

  /* =============== Boot =============== */
  document.addEventListener("DOMContentLoaded", async ()=>{
    await ensureSupabase();
    await finishOAuthIfNeeded();

    wireAnchors();
    wireNav();
    wireAuthUI();
    wireBilling();

    wireGenerator();
    wireQuickPublish();
    wireScheduler();
    wirePresets();
    wireIntegrations();
    wireOptimizerReveal();

    await fetchStatusAndPaint();
    await paintLive();
    setInterval(paintLive, 30000);

    supabase.auth.onAuthStateChange((_event, session)=>{
      AUTHTED = !!session; USER_ID = session?.user?.id || null;
      paintAuth(AUTHTED);
      fetchStatusAndPaint().catch(()=>{});
      try{ $$('dialog[open]#auth').forEach(d=> d.close()); }catch{}
    });

    // Handle billing return notice
    try{
      const u = new URL(location.href);
      const ok   = u.searchParams.get("billing")==="success";
      const fail = u.searchParams.get("billing")==="cancel";
      if (ok)   toast("Billing updated — thank you!");
      if (fail) toast("Billing cancelled");
      if (ok || fail){ u.searchParams.delete("billing"); history.replaceState({}, "", u.toString()); }
    }catch{}
  });
}
</script>

<!-- ===== FINISHER: plan gates default + focus + live region ===== -->
<style id="plan-gates-finisher">
  .only-authed{ display:none; }
  .plan-starter-plus, .plan-creator-plus, .plan-business-only{ display:none; }
  :focus-visible{ outline:2px solid var(--brandA); outline-offset:2px; }
</style>
<script>
  document.addEventListener('DOMContentLoaded', function(){
    try{
      document.body.classList.add('__ready');
      var t = document.getElementById('toast');
      if (t){ t.setAttribute('role','status'); t.setAttribute('aria-live','polite'); }
    }catch{}
  });
</script>
</body>
</html>
