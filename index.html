<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>ContentRepurpose.pro — AI Content Repurposing Tool & Generator</title>
  <meta name="description" content="Content repurposing AI that turns one idea into LinkedIn, X, Email & Instagram drafts. Export to Notion & Trello. BYOK supported." />
  <link rel="canonical" href="https://contentrepurpose.pro/">
  <meta name="theme-color" content="#0a0d18">
  <meta name="color-scheme" content="dark light">
  <meta name="robots" content="index,follow,max-video-preview:-1,max-image-preview:large,max-snippet:-1">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="ContentRepurpose.pro — AI Content Repurposing Tool">
  <meta property="og:description" content="Repurpose content with AI. Paste once → get LinkedIn, X, Email & Instagram drafts. Export to Notion & Trello. BYOK supported.">
  <meta property="og:url" content="https://contentrepurpose.pro/">
  <meta property="og:image" content="/og-cover.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ContentRepurpose.pro — AI Content Generator">
  <meta name="twitter:description" content="Content repurposing AI for multi-channel drafts. Export to Notion & Trello. BYOK supported.">
  <meta name="twitter:image" content="/og-cover.png">

  <!-- Fonts + Tailwind -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Global CSS -->
  <style>
    :root{ --brandA:#7AA2FF; --brandB:#FF2D2D; --ink:#0a0d18 }
    html,body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .txt-grad{background:linear-gradient(135deg,var(--brandA),var(--brandB));-webkit-background-clip:text;background-clip:text;color:transparent}
    .bg-grad{background:linear-gradient(135deg,var(--brandA),var(--brandB))}
    .card{border-radius:1.25rem;border:1px solid rgba(15,23,42,.10);background:rgba(255,255,255,.80);box-shadow:0 12px 40px rgba(2,6,23,.08)}
    .badge{display:inline-flex;align-items:center;gap:.5rem;padding:.35rem .6rem;border-radius:9999px;border:1px solid rgba(255,255,255,.15);font-size:.75rem;background:rgba(255,255,255,.65)}
    .chip{font-size:.7rem;padding:.2rem .5rem;border-radius:9999px;border:1px solid rgba(148,163,184,.35)}
    .btn{padding:.6rem .9rem;border-radius:.9rem;border:1px solid rgba(148,163,184,.35)}
    .btn-primary{background:black;color:white}
    .glass{backdrop-filter: blur(12px); background:rgba(255,255,255,.62)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .halo{position:absolute;filter:blur(60px);opacity:.55;pointer-events:none;transform:translateZ(0);
      background:radial-gradient(50% 50% at 50% 50%, rgba(122,162,255,.8), rgba(255,45,45,.65) 60%, transparent 70%);
      width:42rem;height:42rem;border-radius:50%;animation:float 16s ease-in-out infinite;}
    .halo.h2{width:34rem;height:34rem;right:-12rem;top:-6rem;animation-duration:18s;opacity:.5}
    .halo.h3{width:28rem;height:28rem;left:-10rem;top:26rem;animation-duration:22s;opacity:.45}
    @keyframes float{ 0%,100%{ transform: translate3d(0,0,0) } 50%{ transform: translate3d(0,-20px,0) } }
    .orbit{position:absolute;inset:-32px;border-radius:24px;pointer-events:none;
      background: conic-gradient(from 0deg, rgba(122,162,255,.25), rgba(255,45,45,.18), rgba(122,162,255,.25));
      -webkit-mask: radial-gradient(closest-side, transparent 88%, black 89%); mask: radial-gradient(closest-side, transparent 88%, black 89%);
      animation: spin 18s linear infinite;}
    @keyframes spin{ to{ transform: rotate(360deg) } }
    .mock{border-radius:1rem;border:1px solid rgba(255,255,255,.12); background:linear-gradient(180deg,rgba(255,255,255,.75),rgba(255,255,255,.6));}
    @media (prefers-color-scheme:dark){ body{background:var(--ink);color:#e9eef6} .card{background:rgba(14,16,22,.6);border-color:rgba(255,255,255,.08);box-shadow:0 24px 96px rgba(122,162,255,.08),0 14px 60px rgba(255,45,45,.06)} .badge{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.12)} .mock{ background:linear-gradient(180deg,rgba(17,20,31,.88),rgba(17,20,31,.72)); } }
    .marquee{ display:grid; grid-auto-flow:column; gap:2rem; align-items:center; animation: scrollx 26s linear infinite }
    .marquee:hover{ animation-play-state: paused } @keyframes scrollx{ from{ transform: translateX(0) } to{ transform: translateX(-50%) } }
    .nav-sheet{position:fixed; inset:0 0 auto 0; background:rgba(0,0,0,.6); backdrop-filter:blur(8px); display:none}
    .nav-panel{position:absolute; top:0; right:0; width:82vw; max-width:380px; height:100%; background:rgba(14,16,22,.96); border-left:1px solid rgba(255,255,255,.08); padding:1rem}
    .nav-open .nav-sheet{display:block}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .icon { width: 1rem; height: 1rem; display: inline-block; vertical-align: -0.15em; }
    .touch-target{min-height:40px;min-width:40px}

    /* Plan-gating helpers (visibility controlled by JS once status returns) */
    .only-guest{display:revert}
    .only-authed{display:none}
    .plan-starter-plus{display:none}
    .plan-creator-plus{display:none}
    .plan-business-only{display:none}
    body[data-auth="authed"] .only-guest{display:none}
    body[data-auth="authed"] .only-authed{display:revert}

    /* a11y focus */
    :focus-visible{ outline:2px solid var(--brandA); outline-offset: 2px; }

    /* Tiny helpers */
    .muted{color:rgba(148,163,184,.9)}
    .k{font-weight:700}
  </style>

  <!-- JSON-LD -->
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","name":"ContentRepurpose.pro","url":"https://contentrepurpose.pro/","logo":"https://contentrepurpose.pro/logo.svg","sameAs":["https://x.com/contentrepurpose","https://www.linkedin.com/company/contentrepurpose"]}</script>
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","url":"https://contentrepurpose.pro/","name":"ContentRepurpose.pro","potentialAction":{"@type":"SearchAction","target":"https://contentrepurpose.pro/search?q={q}","query-input":"required name=q"}}</script>
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"SoftwareApplication","name":"ContentRepurpose.pro","applicationCategory":"ContentCreationApplication","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}}</script>

  <!-- Worker base -->
  <script>
    window.WORKER_BASE = "https://contentflow-worker.frank-couchman.workers.dev";
    window.SITE_ORIGIN = "https://contentrepurpose.pro";
  </script>
</head>
<body class="min-h-full" data-auth="guest" data-plan="free">
  <!-- Decorative halos -->
  <div class="halo" style="left:-14rem; top:-10rem;"></div>
  <div class="halo h2"></div>
  <div class="halo h3"></div>

  <!-- Top nav -->
  <header class="sticky top-0 z-40 backdrop-blur bg-white/55 dark:bg-black/20 border-b border-white/30">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-4 flex items-center justify-between">
      <a href="/" class="flex items-center gap-3" aria-label="ContentRepurpose home">
        <svg width="36" height="36" viewBox="0 0 48 48" class="rounded-xl" aria-hidden="true">
          <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7AA2FF"/><stop offset="100%" stop-color="#FF2D2D"/></linearGradient></defs>
          <rect x="0" y="0" width="48" height="48" rx="12" fill="url(#g)"/>
          <path d="M14 16h10a6 6 0 0 1 0 12H20v4h-6V16zm6 6v4h4a2 2 0 1 0 0-4h-4z" fill="white"/>
          <path d="M28 16h6v16h-6z" fill="white" opacity=".9"/>
        </svg>
        <span class="font-semibold tracking-tight">Content<span class="txt-grad">Repurpose</span></span>
      </a>

      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="#demo" class="hover:opacity-80">Generator</a>
        <a href="#optimizer" class="hover:opacity-80">Article Optimizer</a>
        <a href="#templates" class="hover:opacity-80">Templates</a>
        <a href="#use-cases" class="hover:opacity-80">Use cases</a>
        <a href="#best-picks" class="hover:opacity-80">Best picks</a>
        <a href="#pricing" class="hover:opacity-80">Pricing</a>
        <a href="/blog" class="hover:opacity-80">Blog</a>
        <span id="planbadge" class="px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/50">Plan: Free</span>
        <button id="manageBilling" class="px-3 py-1 rounded-lg border hidden">Manage billing</button>
        <div class="flex items-center gap-2">
          <button id="loginBtn" class="px-3 py-1 rounded-lg border only-guest">Sign in</button>
          <button id="logoutBtn" class="px-3 py-1 rounded-lg border only-authed hidden">Sign out</button>
        </div>
      </nav>

      <button id="navToggle" class="md:hidden touch-target px-3 py-2 rounded-lg border" aria-expanded="false" aria-controls="mobileNav" aria-label="Open menu">☰</button>
    </div>

    <!-- Promo strip -->
    <div class="border-t border-white/40 bg-white/70 dark:bg-white/10">
      <div class="max-w-7xl mx-auto px-4 md:px-5 py-2 flex flex-wrap items-center justify-between gap-3 text-sm">
        <div class="flex items-center gap-2">
          <span class="px-2 py-0.5 rounded-full text-[11px] bg-black/80 text-white">LIMITED</span>
          <span>Use <strong class="mono">CONTENTOFF90</strong> for <strong>90% off</strong> the Creator plan.</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="copyPromoBtn" class="px-3 py-1 rounded-lg border">Copy code</button>
          <a href="#pricing" class="px-3 py-1 rounded-lg bg-black text-white">See pricing</a>
        </div>
      </div>
    </div>

    <!-- Mobile sheet -->
    <div id="mobileNav" class="nav-sheet" aria-hidden="true">
      <div class="nav-panel text-sm text-white">
        <div class="flex items-center justify-between">
          <span class="font-semibold">Menu</span>
          <button id="navClose" class="touch-target px-3 py-2 rounded-lg border border-white/20" aria-label="Close menu">✕</button>
        </div>
        <nav class="mt-4 grid gap-2">
          <a href="#demo" class="px-3 py-2 rounded-lg hover:bg-white/10">Generator</a>
          <a href="#optimizer" class="px-3 py-2 rounded-lg hover:bg-white/10">Article Optimizer</a>
          <a href="#templates" class="px-3 py-2 rounded-lg hover:bg-white/10">Templates</a>
          <a href="#use-cases" class="px-3 py-2 rounded-lg hover:bg-white/10">Use cases</a>
          <a href="#best-picks" class="px-3 py-2 rounded-lg hover:bg-white/10">Best picks</a>
          <a href="#pricing" class="px-3 py-2 rounded-lg hover:bg-white/10">Pricing</a>
          <a href="/blog" class="px-3 py-2 rounded-lg hover:bg-white/10">Blog</a>
        </nav>
        <div class="mt-6 grid gap-2">
          <span id="planbadge_m" class="px-3 py-1 rounded-full text-xs bg-white/10 border border-white/20 w-fit">Plan: Free</span>
          <button id="manageBilling_m" class="px-3 py-2 rounded-lg border border-white/20 hidden">Manage billing</button>
          <button id="loginBtn_m" class="px-3 py-2 rounded-lg border border-white/20 only-guest">Sign in</button>
          <button id="logoutBtn_m" class="px-3 py-2 rounded-lg border border-white/20 only-authed hidden">Sign out</button>
        </div>
      </div>
    </div>
  </header>

  <!-- ===== HERO ===== -->
  <section class="relative" id="hero">
    <div class="max-w-7xl mx-auto px-4 md:px-5 pt-10 md:pt-16 grid lg:grid-cols-2 gap-8 md:gap-10 items-center">
      <!-- Left: copy + CTAs -->
      <div>
        <div id="heroBadgeWrap" class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/40">
          <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
          <span class="only-guest">Demo — <strong class="mx-1">5 runs / month</strong> (no login)</span>
          <span class="only-authed hidden">Signed in — <strong id="heroPlanName">Free</strong> plan active</span>
        </div>

        <h1 class="mt-4 text-3xl md:text-5xl font-black leading-tight tracking-tight">
          AI <span class="txt-grad">Content Repurposing Tool</span> — turn one idea into everywhere content.
        </h1>

        <p class="mt-4 text-slate-600 dark:text-slate-300 max-w-xl">
          Paste content → get <strong>LinkedIn</strong>, <strong>X</strong>, <strong>Email</strong> &amp; <strong>Instagram</strong> drafts.
          Export to <strong>Notion</strong> or <strong>Trello</strong>. BYOK supported.
        </p>

        <!-- CTA rail -->
        <div class="mt-6 flex flex-wrap gap-3">
          <a href="#demo" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90 only-guest">Try the Live Demo</a>
          <a href="#demo" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90 only-authed hidden">Open Generator</a>
          <a href="#pricing" class="px-4 py-3 rounded-xl font-semibold border border-slate-300/60 hover:bg-white/50">See pricing</a>
          <button id="heroSignIn" class="px-4 py-3 rounded-xl font-semibold border border-slate-300/60 only-guest">Sign in</button>
        </div>

        <div class="mt-6 flex items-center gap-3 text-xs text-slate-500 dark:text-slate-400">
          <span class="badge">AI Content Generator</span>
          <span class="badge">Repurposing Tool</span>
          <span class="badge">SEO-ready</span>
          <span class="badge">BYOK</span>
        </div>

        <!-- Trust strip -->
        <div class="mt-8 overflow-hidden">
          <div class="flex items-center gap-4 text-[11px] uppercase tracking-widest text-slate-500">
            <span class="chip">Creators</span>
            <span class="chip">Marketers</span>
            <span class="chip">Newsletters</span>
            <span class="chip">Teams</span>
          </div>
          <div class="relative mt-4">
            <div class="marquee opacity-70">
              <div class="chip">LinkedIn-first</div>
              <div class="chip">Editorial-friendly</div>
              <div class="chip">Email copy</div>
              <div class="chip">Instagram captions</div>
              <div class="chip">Notion export</div>
              <div class="chip">Trello boards</div>
              <div class="chip">Keyword-aware</div>
              <div class="chip">Tone controls</div>
              <!-- duplicate for seamless scroll -->
              <div class="chip">LinkedIn-first</div>
              <div class="chip">Editorial-friendly</div>
              <div class="chip">Email copy</div>
              <div class="chip">Instagram captions</div>
              <div class="chip">Notion export</div>
              <div class="chip">Trello boards</div>
              <div class="chip">Keyword-aware</div>
              <div class="chip">Tone controls</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right: visual mocks -->
      <div class="relative">
        <div class="orbit" aria-hidden="true"></div>
        <div class="grid gap-4">
          <div class="mock p-4 card">
            <div class="text-xs text-slate-400">Command</div>
            <pre class="mono text-xs bg-black/85 text-emerald-200 rounded-xl p-4 h-40 overflow-auto" aria-label="CLI Preview">repurpose generate --channels linkedin,x,email,instagram
? outline created
? 3 social variants
? email subject + body ready
? instagram caption + hashtags</pre>
          </div>
          <div class="grid md:grid-cols-2 gap-4">
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">LinkedIn</div>
              <div class="mt-2 h-24 text-sm text-slate-200/90 leading-relaxed">
                • Hook that earns the scroll<br>
                • 6–10 crisp lines, one CTA<br>
                • On-brand tone &amp; keywords
              </div>
            </div>
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">X (Twitter)</div>
              <div class="mt-2 h-24 text-sm text-slate-200/90 leading-relaxed">
                Two fast variants<br>
                Always ≤ 280 chars<br>
                Ready to post ✓
              </div>
            </div>
          </div>
          <div class="grid md:grid-cols-2 gap-4">
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">Email</div>
              <div class="mt-2 h-20 text-sm text-slate-200/90 leading-relaxed">
                Subject &amp; body prepped<br>
                Preview &amp; send from your client
              </div>
            </div>
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">Instagram</div>
              <div class="mt-2 h-20 text-sm text-slate-200/90 leading-relaxed">
                Caption + 3–5 hashtags<br>
                Short, skimmable, on-brand
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Live activity strip (hero) -->
    <div class="mt-8 md:mt-10">
      <div class="max-w-7xl mx-auto px-4 md:px-5">
        <div class="card p-4 md:p-5">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
              <strong class="tracking-tight">Generations today</strong>
              <span class="chip" data-live-count>–</span>
            </div>
            <div class="text-xs text-slate-500">Real results update every 30s</div>
          </div>
          <div class="mt-3 overflow-hidden">
            <div class="flex gap-3 whitespace-nowrap text-[13px] will-change-transform" style="animation: scrollx 28s linear infinite" data-live-feed></div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- ===== GENERATOR ===== -->
  <section id="demo" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="flex items-end justify-between gap-4 mb-6">
        <div>
          <h2 class="text-2xl md:text-3xl font-black tracking-tight">Generator</h2>
          <p class="mt-1 text-slate-500 dark:text-slate-300 text-sm only-guest">
            No login needed — <span class="font-semibold">5 runs/month</span> on the public pool.
          </p>
          <p class="mt-1 text-slate-500 dark:text-slate-300 text-sm only-authed hidden">
            Signed in — your plan limits apply per day/month by tier.
          </p>
        </div>
        <div class="flex items-center gap-3">
          <a href="#pricing" class="btn">See pricing</a>
          <button class="btn btn-primary js-open-auth only-guest" type="button">Sign in</button>
        </div>
      </div>

      <!-- Promo rail -->
      <div class="card p-4 md:p-5 mb-6">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div class="flex items-center gap-2 text-sm">
            <span class="badge">LIMITED</span>
            <span>Use <strong class="mono">CONTENTOFF90</strong> for <strong>90% off</strong> the Creator plan.</span>
          </div>
          <div class="flex items-center gap-2">
            <button id="copyPromoBtn2" class="btn" type="button">Copy code</button>
            <a class="btn btn-primary" href="#pricing">Upgrade</a>
          </div>
        </div>
      </div>

      <!-- Generator Form -->
      <div class="card p-5 md:p-6">
        <!-- Presets row -->
        <div class="flex flex-wrap items-center gap-3 mb-4">
          <div class="flex items-center gap-2">
            <label for="presetSelect" class="text-sm muted">Presets</label>
            <select id="presetSelect" class="border rounded-lg px-3 py-2 text-sm">
              <option value="">— Select preset —</option>
            </select>
            <button id="applyPresetBtn" class="btn text-sm" type="button">Apply</button>
          </div>
          <div class="flex items-center gap-2">
            <input id="presetName" class="border rounded-lg px-3 py-2 text-sm" placeholder="Preset name" />
            <button id="savePresetBtn" class="btn text-sm" type="button">Save preset</button>
            <button id="deletePresetBtn" class="btn text-sm" type="button">Delete</button>
          </div>
          <div id="presetNote" class="text-xs text-slate-500"></div>
        </div>

        <form id="demoForm" class="grid gap-6" autocomplete="off">
          <!-- Input mode tabs -->
          <fieldset>
            <legend class="text-sm font-semibold">Input mode</legend>
            <div class="mt-2 grid sm:grid-cols-2 lg:grid-cols-4 gap-2">
              <label class="flex items-center gap-2">
                <input type="radio" name="inputMode" value="single" checked>
                Single input (paragraph/blog/URL)
              </label>
              <label class="flex items-center gap-2">
                <input type="radio" name="inputMode" value="batch">
                Batch inputs (multiple lines)
              </label>
            </div>
            <!-- Single input -->
            <div id="singleWrap" class="mt-3 grid gap-3">
              <!-- Source selector -->
              <div class="grid md:grid-cols-3 gap-3">
                <label class="tab flex items-center justify-between border rounded-lg px-3 py-2">
                  <span class="flex items-center gap-2">
                    <input type="radio" name="sourceType" value="paragraph" checked>
                    Paragraph / Notes
                  </span>
                  <span class="chip">fastest</span>
                </label>
                <label class="tab flex items-center border rounded-lg px-3 py-2">
                  <input type="radio" name="sourceType" value="blog" class="mr-2">
                  Full Blog
                </label>
                <label class="tab flex items-center border rounded-lg px-3 py-2">
                  <input type="radio" name="sourceType" value="url" class="mr-2">
                  URL
                </label>
              </div>
              <textarea id="sourceText" class="w-full rounded-xl border p-4 min-h-[140px]"
                placeholder="Paste your paragraph or blog. If you selected URL, paste it here."></textarea>
            </div>

            <!-- Batch input (plan-aware caps) -->
            <div id="batchWrap" class="mt-3 grid gap-2 hidden">
              <label class="text-sm muted">One idea per line. Caps by plan: Free 1 • Starter 5 • Creator 10 • Business 30</label>
              <textarea id="batchInput" class="w-full rounded-xl border p-4 min-h-[140px]"
                placeholder="Line 1: …&#10;Line 2: …&#10;Line 3: …"></textarea>
              <div class="text-xs text-slate-500">
                Batch counts 1 generation per line. Excess lines over your cap are ignored (shown before submit).
              </div>
            </div>
          </fieldset>

          <!-- Article Optimizer quick toggles (affects generator when present) -->
          <fieldset>
            <legend class="text-sm font-semibold">Article Optimizer (optional)</legend>
            <div class="mt-2 grid sm:grid-cols-2 lg:grid-cols-3 gap-2">
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_humanize" checked> Humanize content</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_lengthen"> Lengthen ~30%</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_faqs"> Add FAQs (+ JSON-LD)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_headings" checked> Auto-headings (H2/H3)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_svg"> Add platform-fit SVG ideas</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_seo"> SEO basics (title/meta/alt/CTR)</label>
            </div>
          </fieldset>

          <!-- Channels -->
          <fieldset>
            <legend class="text-sm font-semibold">Channels to generate</legend>
            <div class="mt-2 grid sm:grid-cols-2 lg:grid-cols-4 gap-2">
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_linkedin" checked> LinkedIn</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_x" checked> X (Twitter)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_email" checked> Email</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_instagram"> Instagram</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_reddit" checked> Reddit</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_facebook"> Facebook</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_quora"> Quora</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_tiktok"> TikTok</label>
            </div>
          </fieldset>

          <!-- Channel extras -->
          <div class="grid md:grid-cols-2 gap-6">
            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">LinkedIn</legend>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="li_article"> Also generate a LinkedIn Article</label>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">X (Twitter)</legend>
              <div class="mt-2 flex items-center gap-3">
                <label class="flex items-center gap-2"><input type="checkbox" name="x_sequence" checked> Output as sequence</label>
                <label class="flex items-center gap-2">
                  Max posts:
                  <select name="x_posts" class="border rounded-lg px-2 py-1">
                    <option>2</option><option selected>4</option><option>6</option>
                  </select>
                </label>
              </div>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">Reddit</legend>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="rdt_communities" checked> Suggest best communities (with rules & flair tips)</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="rdt_comments" checked> Include 3 starter comment angles</label>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">TikTok</legend>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="tt_hooks" checked> Provide 3 hook variants</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="tt_onscreen" checked> Include on-screen text plan</label>
            </fieldset>
          </div>

          <!-- Actions -->
          <div class="flex flex-wrap items-center gap-3">
            <button id="generateBtn" type="submit" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90 only-guest">
              Generate (demo)
            </button>
            <button id="generateBtn_member" type="submit" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90 only-authed hidden">
              Generate
            </button>
            <button type="button" id="clearBtn" class="px-4 py-3 rounded-xl font-semibold border">Clear</button>

            <div class="text-sm text-slate-500 only-guest">
              You have <span id="demoQuota">—</span> demo runs left this month.
            </div>
            <div class="text-sm text-slate-500 only-authed hidden">
              You have <span id="memberQuota">—</span> runs left today.
            </div>

            <a href="#pricing" class="text-sm underline hover:opacity-80 ml-auto">Need more? See plans</a>
          </div>
        </form>
      </div>

      <!-- OUTPUT -->
      <div id="demoOutput" class="mt-8 grid gap-6" aria-live="polite" aria-busy="false"></div>

      <!-- QUICK PUBLISH (Authed only) -->
      <div class="mt-10 card p-5 only-authed hidden" id="quickPublish">
        <div class="flex items-center justify-between flex-wrap gap-3">
          <strong class="tracking-tight">Quick publish</strong>
          <div class="text-xs text-slate-500">Works with your last generation’s outputs.</div>
        </div>
        <div class="mt-4 grid sm:grid-cols-2 lg:grid-cols-4 gap-3">
          <button id="qp-x" class="btn" type="button">Post to X</button>
          <button id="qp-reddit" class="btn" type="button">Open Reddit submit</button>
          <button id="qp-linkedin" class="btn" type="button">Copy for LinkedIn & open</button>
          <button id="qp-email" class="btn" type="button">Send email draft</button>
        </div>

        <!-- Creator+ integrations -->
        <div class="mt-4 grid sm:grid-cols-2 gap-3 plan-creator-plus">
          <button id="li-notion" class="btn" type="button">Export to Notion</button>
          <button id="li-trello" class="btn" type="button">Send to Trello</button>
        </div>
        <div class="mt-2 text-xs text-slate-500 plan-creator-plus">
          Notion/Trello require connecting once from this device. Find them in Settings → Integrations.
        </div>
      </div>
    </div>
  </section>
  <!-- ===== SCHEDULER (Starter+) ===== -->
  <section id="scheduler" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="flex items-center justify-between gap-4 mb-4">
        <h2 class="text-2xl md:text-3xl font-black tracking-tight">Scheduler</h2>
        <div class="text-xs text-slate-500">Queue & calendar. Starter gets single-profile; Creator+ supports multi-profile.</div>
      </div>

      <div class="card p-5 plan-starter-plus">
        <!-- Composer -->
        <div class="grid md:grid-cols-4 gap-3">
          <label class="grid gap-1">
            <span class="text-xs text-slate-500">Channel</span>
            <select id="schedChannel" class="border rounded-lg px-3 py-2">
              <option value="linkedin">LinkedIn</option>
              <option value="x">X (Twitter)</option>
              <option value="instagram">Instagram</option>
              <option value="facebook">Facebook</option>
              <option value="reddit">Reddit</option>
              <option value="email">Email</option>
            </select>
          </label>
          <label class="grid gap-1">
            <span class="text-xs text-slate-500">When</span>
            <input id="schedWhen" type="datetime-local" class="border rounded-lg px-3 py-2" />
          </label>
          <div class="md:col-span-2 grid grid-cols-2 gap-2 items-end">
            <button id="schedAdd" class="btn btn-primary" type="button">Add to queue</button>
            <button id="schedUseLast" class="btn" type="button">Add from last output</button>
          </div>
        </div>

        <label class="grid gap-1 mt-3">
          <span class="text-xs text-slate-500">Text</span>
          <textarea id="schedText" class="border rounded-lg px-3 py-2 min-h-[120px]" placeholder="Paste content (or generate first and use 'Add from last output')"></textarea>
        </label>

        <!-- Queue -->
        <div class="mt-5">
          <div class="flex items-center justify-between">
            <strong class="text-sm">Queue</strong>
            <div class="flex items-center gap-2">
              <button id="schedPublish" class="btn" type="button">Publish selected</button>
              <button id="schedClear" class="btn" type="button">Clear all</button>
            </div>
          </div>
          <div id="schedEmpty" class="text-sm text-slate-500 mt-3">Nothing scheduled yet.</div>
          <div id="schedList" class="mt-3 grid gap-3"></div>
        </div>
      </div>

      <!-- Upgrade hint for guests/free -->
      <div class="card p-5 only-guest mt-6">
        <div class="flex items-center justify-between gap-3 flex-wrap">
          <div>
            <strong>Want scheduling?</strong>
            <div class="text-sm text-slate-500">Upgrade to Starter or sign in to try Creator+ features.</div>
          </div>
          <div class="flex gap-2">
            <button class="btn js-open-auth" type="button">Sign in</button>
            <a class="btn btn-primary" href="#pricing">See plans</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== ANALYTICS ===== -->
  <section id="analytics" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="flex items-center justify-between gap-4 mb-4">
        <h2 class="text-2xl md:text-3xl font-black tracking-tight">Analytics</h2>
        <div class="text-xs text-slate-500">Connect accounts to see data. Updates as you post.</div>
      </div>

      <div class="grid md:grid-cols-3 gap-6">
        <!-- Starter+: basics -->
        <div class="card p-5 plan-starter-plus">
          <strong class="tracking-tight">Analytics (basics)</strong>
          <div class="text-xs text-slate-500 mt-1">Per-day posts & estimated reach.</div>
          <div id="anaBasic" class="mt-3 text-sm text-slate-400">Connect accounts to see data.</div>
        </div>

        <!-- Creator+: per-channel -->
        <div class="card p-5 plan-creator-plus">
          <strong class="tracking-tight">Analytics Pro</strong>
          <div class="text-xs text-slate-500 mt-1">Breakdown by channel.</div>
          <div id="anaPro" class="mt-3 text-sm text-slate-400">Coming online as you post.</div>
        </div>

        <!-- Business: team -->
        <div class="card p-5 plan-business-only">
          <strong class="tracking-tight">Team Analytics</strong>
          <div class="text-xs text-slate-500 mt-1">Org-wide view, shared calendar.</div>
          <div id="anaTeam" class="mt-3 text-sm text-slate-400">Invite teammates to populate.</div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== ARTICLE OPTIMIZER (Modal) ===== -->
  <button id="openOptimizerBtn" class="fixed bottom-5 right-5 z-40 px-4 py-2 rounded-xl bg-black text-white shadow only-authed hidden">
    Optimize Article
  </button>

  <dialog id="optimizerModal" class="rounded-xl p-0 w-[94vw] max-w-4xl">
    <form method="dialog" class="p-5 grid gap-3">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">Article Optimizer</h3>
        <button class="btn" value="cancel">Close</button>
      </div>

      <div class="grid lg:grid-cols-3 gap-4">
        <div class="lg:col-span-2">
          <label class="text-xs text-slate-500">Paste article (or URL)</label>
          <textarea id="optText" class="border rounded-lg px-3 py-2 min-h-[220px]" placeholder="Paste your article or URL…"></textarea>
          <div class="mt-2 grid sm:grid-cols-2 gap-2">
            <input id="optFocusKeyword" class="border rounded-lg px-3 py-2" placeholder="Focus keyword (optional)" />
            <input id="optSecondary" class="border rounded-lg px-3 py-2" placeholder="Secondary keywords (comma-separated)" />
          </div>
          <div class="mt-2 grid sm:grid-cols-3 gap-2 text-sm">
            <label class="flex items-center gap-2"><input type="checkbox" id="optLen30"> Lengthen by ~30%</label>
            <label class="flex items-center gap-2"><input type="checkbox" id="optAddFaq"> Add FAQs + JSON-LD</label>
            <label class="flex items-center gap-2"><input type="checkbox" id="optCTR"> Improve title & meta (CTR)</label>
          </div>
        </div>

        <div class="lg:col-span-1">
          <div class="card p-4">
            <strong class="text-sm">A/B Titles</strong>
            <div id="optTitles" class="mt-2 text-sm text-slate-400">Run to get suggestions.</div>
          </div>
          <div class="card p-4 mt-3">
            <strong class="text-sm">Rank Likelihood</strong>
            <div id="optScore" class="mt-2 text-sm text-slate-400">Pending…</div>
          </div>
          <div class="card p-4 mt-3">
            <strong class="text-sm">Related keywords</strong>
            <div id="optRelated" class="mt-2 text-sm text-slate-400">Pending…</div>
          </div>
        </div>
      </div>

      <div class="mt-3 flex items-center justify-between gap-3">
        <div class="text-xs text-slate-500">Daily caps by plan: Starter 5 • Creator 15 • Business 30</div>
        <div class="flex gap-2">
          <button id="optRun" class="btn btn-primary" type="button">Optimize</button>
          <button id="optReplaceIntoSource" class="btn" type="button">Replace into Generator</button>
        </div>
      </div>

      <div id="optOutWrap" class="mt-4 hidden">
        <div class="card p-4">
          <div class="flex items-center justify-between gap-3">
            <strong class="tracking-tight">Optimized Article</strong>
            <button id="optCopy" class="btn" type="button">Copy</button>
          </div>
          <pre id="optOut" class="mt-3 whitespace-pre-wrap text-sm"></pre>
        </div>
        <div class="mt-4 grid sm:grid-cols-2 gap-3">
          <div class="card p-4">
            <strong class="text-sm">Meta description</strong>
            <pre id="optMeta" class="mt-2 whitespace-pre-wrap text-sm"></pre>
          </div>
          <div class="card p-4">
            <strong class="text-sm">FAQ (JSON-LD)</strong>
            <pre id="optFAQ" class="mt-2 whitespace-pre-wrap text-sm"></pre>
          </div>
        </div>
      </div>
    </form>
  </dialog>

  <!-- ===== LIVE STRIP (site-wide small) ===== -->
  <section class="relative">
    <div class="max-w-7xl mx-auto px-4 md:px-5">
      <div class="card p-4 md:p-5">
        <div class="flex items-center justify-between flex-wrap gap-3">
          <div class="flex items-center gap-2">
            <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
            <strong class="tracking-tight">Generations today</strong>
            <span id="liveCount" class="chip">–</span>
          </div>
          <div class="text-xs text-slate-500">Real results update every 30s</div>
        </div>
        <div class="mt-3 overflow-hidden">
          <div id="liveFeed" class="flex gap-3 whitespace-nowrap text-[13px] will-change-transform" style="animation: scrollx 28s linear infinite"></div>
        </div>
      </div>
    </div>
  </section>
  <!-- ===== BEST PICKS (Plan suggestions that actually link to a plan) ===== -->
  <section id="best-picks" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="text-center mb-8">
        <h2 class="text-3xl md:text-4xl font-black tracking-tight">Best picks for your workflow</h2>
        <p class="mt-2 text-slate-600 dark:text-slate-300">We’ll suggest a plan based on how you use the generator, scheduler, and optimizer.</p>
      </div>

      <!-- Dynamic suggestion rail (filled by JS; has static fallbacks) -->
      <div class="card p-5 md:p-6 mb-8">
        <div class="flex items-center justify-between gap-3 flex-wrap">
          <div class="text-sm">
            <strong class="tracking-tight">Suggestion:</strong>
            <span id="bestPickText" class="text-slate-600 dark:text-slate-300">
              New here? Start with <span class="font-semibold">Starter</span> for 200 generations/month and the Scheduler.
            </span>
          </div>
          <div class="flex items-center gap-2">
            <button id="bestPickRecalc" class="btn" type="button" title="Re-evaluate based on latest usage">Recalculate</button>
            <a id="bestPickCta" href="#pricing" class="btn btn-primary">See recommended plan</a>
          </div>
        </div>
      </div>

      <!-- Plan overview cards (link to exact checkout via data-price in script) -->
      <div class="grid lg:grid-cols-3 gap-6">
        <article class="card p-6">
          <div class="text-sm px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 border w-fit">Starter</div>
          <h3 class="mt-3 text-xl font-bold">Solo Creator</h3>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">200 generations/month • Scheduler • Analytics basics • 10 presets • 5/day Optimizer</p>
          <ul class="mt-4 text-sm space-y-2">
            <li>• Batch inputs (up to 5 lines/run)</li>
            <li>• Priority models</li>
            <li>• BYOK: 50 / month (+5 daily)</li>
          </ul>
          <button
            data-price="price_1S7y58JYjIKHzKcjzL7cIKiB"
            class="mt-6 w-full btn btn-primary js-checkout"
            type="button" aria-label="Start Starter plan">Choose Starter</button>
        </article>

        <article class="card p-6 ring-1 ring-black/5 relative">
          <span class="absolute -top-3 left-1/2 -translate-x-1/2 text-xs px-3 py-1 rounded-full bg-grad text-white shadow">Best value</span>
          <h3 class="mt-1 text-xl font-bold">Creator</h3>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">500 generations/month • Unlimited presets • Multi-profile Scheduler • Analytics Pro • Notion & Trello</p>
          <ul class="mt-4 text-sm space-y-2">
            <li>• Project pack export</li>
            <li>• BYOK: 150 / month (+10 daily)</li>
            <li>• Optimizer: up to 15/day</li>
          </ul>
          <button
            data-price="price_1S7y77JYjIKHzKcjKQYjiqZH"
            class="mt-6 w-full btn btn-primary js-checkout"
            type="button" aria-label="Start Creator plan">Choose Creator</button>
        </article>

        <article class="card p-6">
          <div class="text-sm px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 border w-fit">Business</div>
          <h3 class="mt-3 text-xl font-bold">Team / Agency</h3>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">Unlimited (fair use) • 3 seats • Team presets • Org-wide Analytics • White-label export</p>
          <ul class="mt-4 text-sm space-y-2">
            <li>• BYOK: 300 / month (+30 daily)</li>
            <li>• Shared calendar</li>
            <li>• Optimizer: up to 30/day</li>
          </ul>
          <button
            data-price="price_1S7y8OJYjIKHzKcjqA9uJdyh"
            class="mt-6 w-full btn js-checkout"
            type="button" aria-label="Start Business plan">Choose Business</button>
        </article>
      </div>
    </div>
  </section>

  <!-- ===== TEMPLATES (links straight to your internal post) ===== -->
  <section id="templates" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-16">
      <div class="card p-5 md:p-6">
        <div class="flex items-center justify-between gap-4 flex-wrap">
          <div>
            <h2 class="text-2xl md:text-3xl font-black tracking-tight">LinkedIn Post Templates</h2>
            <p class="mt-1 text-slate-600 dark:text-slate-300">High-performing hooks, structures, and CTA formats you can paste into the Generator.</p>
          </div>
          <a class="btn btn-primary"
             href="https://contentrepurpose.pro/blog/linkedin-post-templates/"
             target="_blank" rel="noopener">Open templates</a>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== USE CASES ===== -->
  <section id="use-cases" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="text-center mb-10">
        <h2 class="text-3xl md:text-4xl font-black tracking-tight">Use cases</h2>
        <p class="mt-2 text-slate-600 dark:text-slate-300">How different teams win with ContentRepurpose.</p>
      </div>

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        <article class="card p-5">
          <strong>Solo creator</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">
            Turn threads, notes or a blog into LinkedIn + X + Email in minutes. Save presets for tone and audience.
          </p>
          <ul class="mt-3 text-sm space-y-1">
            <li>• 5-line batch inputs</li>
            <li>• LinkedIn Article toggle</li>
            <li>• Quick publish</li>
          </ul>
          <div class="mt-4 flex gap-2">
            <a href="#demo" class="btn btn-primary">Generate now</a>
            <a href="#pricing" class="btn">See pricing</a>
          </div>
        </article>

        <article class="card p-5">
          <strong>Newsletter</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">
            Repurpose each issue into a LinkedIn post, X sequence, and an Instagram caption with hashtags.
          </p>
          <ul class="mt-3 text-sm space-y-1">
            <li>• Email subject + body</li>
            <li>• TikTok hooks & on-screen text</li>
            <li>• Scheduler queue</li>
          </ul>
          <div class="mt-4 flex gap-2">
            <a href="#demo" class="btn btn-primary">Try the Generator</a>
            <a href="#scheduler" class="btn">Open Scheduler</a>
          </div>
        </article>

        <article class="card p-5">
          <strong>SEO blogger</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">
            Optimize articles for intent, add FAQs (JSON-LD), and test CTR-first titles & descriptions.
          </p>
          <ul class="mt-3 text-sm space-y-1">
            <li>• 30% lengthen option</li>
            <li>• Rank Likelihood score</li>
            <li>• Related keyword ideas</li>
          </ul>
          <div class="mt-4 flex gap-2">
            <button class="btn btn-primary only-authed hidden" id="useOpenOptimizer" type="button">Open Optimizer</button>
            <button class="btn js-open-auth only-guest" type="button">Sign in to Optimize</button>
          </div>
        </article>

        <article class="card p-5">
          <strong>Agency / Team</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">
            Multi-profile scheduling, team presets, org analytics, and white-label exports for clients.
          </p>
          <ul class="mt-3 text-sm space-y-1">
            <li>• Team calendar</li>
            <li>• Notion + Trello export</li>
            <li>• Buffer queue</li>
          </ul>
          <div class="mt-4 flex gap-2">
            <a href="#pricing" class="btn btn-primary">Business plan</a>
            <a href="#analytics" class="btn">See Analytics</a>
          </div>
        </article>

        <article class="card p-5">
          <strong>Thought leadership</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">
            Generate polished LinkedIn posts and long-form articles from podcasts or interview notes.
          </p>
          <ul class="mt-3 text-sm space-y-1">
            <li>• Tone controls</li>
            <li>• LinkedIn Article</li>
            <li>• Hashtag assist</li>
          </ul>
          <div class="mt-4 flex gap-2">
            <a href="#demo" class="btn btn-primary">Start drafting</a>
            <a href="https://contentrepurpose.pro/blog/ai-social-media-post-generator/" target="_blank" rel="noopener" class="btn">Learn how</a>
          </div>
        </article>

        <article class="card p-5">
          <strong>Repurpose library</strong>
          <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">
            Build a backlog of pillar posts and turn each into multi-channel content across the month.
          </p>
          <ul class="mt-3 text-sm space-y-1">
            <li>• Project pack export</li>
            <li>• Presets (tone, persona)</li>
            <li>• Batch inputs</li>
          </ul>
          <div class="mt-4 flex gap-2">
            <a href="https://contentrepurpose.pro/blog/repurpose-blog-post-for-social-media/" target="_blank" rel="noopener" class="btn btn-primary">Best practices</a>
            <a href="#demo" class="btn">Try now</a>
          </div>
        </article>
      </div>
    </div>
  </section>

  <!-- ===== INTERNAL LINKS for topical authority ===== -->
  <section id="learn" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-12 md:py-16">
      <h2 class="text-xl md:text-2xl font-bold tracking-tight mb-4">Learn & workflows</h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-3 text-sm">
        <a class="card p-4 hover:opacity-90" target="_blank" rel="noopener" href="https://contentrepurpose.pro/blog/ai-social-media-post-generator/">
          AI Social Media Post Generator — how to go multi-channel
        </a>
        <a class="card p-4 hover:opacity-90" target="_blank" rel="noopener" href="https://contentrepurpose.pro/blog/paste-once-multi-channel/">
          Paste once → publish everywhere (workflow)
        </a>
        <a class="card p-4 hover:opacity-90" target="_blank" rel="noopener" href="https://contentrepurpose.pro/blog/ai-content-repurposing/">
          AI content repurposing — complete guide
        </a>
        <a class="card p-4 hover:opacity-90" target="_blank" rel="noopener" href="https://contentrepurpose.pro/blog/content-repurposing-for-seo/">
          Content repurposing for SEO (rank + distribute)
        </a>
        <a class="card p-4 hover:opacity-90" target="_blank" rel="noopener" href="https://contentrepurpose.pro/blog/notion-trello-export/">
          Export to Notion & Trello from your drafts
        </a>
        <a class="card p-4 hover:opacity-90" target="_blank" rel="noopener" href="https://contentrepurpose.pro/blog/free-ai-linkedin-post-generator/">
          Free AI LinkedIn post generator — templates included
        </a>
      </div>
    </div>
  </section>
<!-- ===== CRP WIRING (Part 5) — Generator + Presets + Optimizer + Scheduler + Integrations + Best Picks ===== -->
<script type="module">
/* ---------- Shortcuts ---------- */
const $  = (s, r=document)=>r.querySelector(s);
const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));
const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));

/* ---------- Globals provided earlier ---------- */
const WORKER_BASE = window.WORKER_BASE || "https://contentflow-worker.frank-couchman.workers.dev";
const SITE_ORIGIN = window.SITE_ORIGIN || location.origin;

/* ---------- State ---------- */
let LAST_OUTPUT = {};          // keyed by channel
let CURRENT_PLAN = document.body.getAttribute("data-plan") || "free";
let AUTHTED = (document.body.getAttribute("data-auth")==="authed");

/* ---------- UTIL ---------- */
function toast(msg){
  try {
    const t = $("#toast"); const m = $("#toastMsg");
    if (!t || !m) { alert(msg); return; }
    m.textContent = msg; t.classList.remove("hidden");
    setTimeout(()=>t.classList.add("hidden"), 1600);
  } catch { alert(msg); }
}
const PLAN_RANK = { free:0, starter:1, creator:2, business:3 };
function planAtLeast(p){ return (PLAN_RANK[CURRENT_PLAN]||0) >= (PLAN_RANK[p]||0); }

/* =========================================================
   1) GENERATOR: submit, clean Reddit "r/..." + Article output
   ========================================================= */
(function wireGenerator(){
  const form = $("#demoForm");
  const out  = $("#demoOutput");
  const src  = $("#sourceText");
  const btnDemo   = $("#generateBtn");
  const btnMember = $("#generateBtn_member");
  if (!form || !out || !src) return;

  // prevent rogue anchors from hijacking submit
  form.addEventListener("submit", e=>e.preventDefault());

  async function getAuthHeaders(){
    const h = { "Content-Type":"application/json" };
    try{
      const { data } = await window.supabase?.auth?.getSession() || {};
      const token = data?.session?.access_token;
      const uid   = data?.session?.user?.id;
      if (token) h["Authorization"] = `Bearer ${token}`;
      if (uid)   h["X-User-Id"]     = uid;
    }catch{}
    return h;
  }

  function readToggles(){
    const g = (n)=> form.elements[n];
    return {
      opt: {
        humanize:  g("opt_humanize")?.checked,
        lengthen:  g("opt_lengthen")?.checked,
        faqs:      g("opt_faqs")?.checked,
        headings:  g("opt_headings")?.checked,
        svg:       g("opt_svg")?.checked,
        seo:       g("opt_seo")?.checked
      },
      ch: {
        linkedin:  g("ch_linkedin")?.checked,
        x:         g("ch_x")?.checked,
        email:     g("ch_email")?.checked,
        instagram: g("ch_instagram")?.checked,
        reddit:    g("ch_reddit")?.checked,
        facebook:  g("ch_facebook")?.checked,
        quora:     g("ch_quora")?.checked,
        tiktok:    g("ch_tiktok")?.checked
      },
      extras: {
        li_article:     g("li_article")?.checked,
        x_sequence:     g("x_sequence")?.checked,
        x_posts:        g("x_posts")?.value || "4",
        rdt_communities:g("rdt_communities")?.checked,
        rdt_comments:   g("rdt_comments")?.checked,
        tt_hooks:       g("tt_hooks")?.checked,
        tt_onscreen:    g("tt_onscreen")?.checked
      }
    };
  }

  function systemPrompt(tog){
    return {
      role: "system",
      content:
`You are a senior social copywriter.
Return ONLY JSON with shape:
{
  "outline": string,
  "linkedin": string|null,
  "x": string[]|null,
  "email": { "subject": string, "body": string }|null,
  "instagram": { "caption": string, "hashtags": string[] }|null,
  "reddit": { "title": string, "body": string, "communities": string[], "starter_comments": string[] }|null,
  "facebook": { "primary": string, "meta": { "headline": string, "description": string } }|null,
  "quora": { "answer": string, "followups": string[] }|null,
  "tiktok": { "hooks": string[], "script": string, "onscreen": string[] }|null,
  "linkedin_article_html": string|null
}
Rules:
- Respect toggles: humanize:${tog.opt.humanize}, lengthen:${tog.opt.lengthen}, faqs:${tog.opt.faqs}, headings:${tog.opt.headings}, svg:${tog.opt.svg}, seo:${tog.opt.seo}, x_posts:${tog.extras.x_posts}, x_sequence:${tog.extras.x_sequence}, li_article:${tog.extras.li_article}, rdt_communities:${tog.extras.rdt_communities}, rdt_comments:${tog.extras.rdt_comments}, tt_hooks:${tog.extras.tt_hooks}, tt_onscreen:${tog.extras.tt_onscreen}.
- X posts ≤ 280 chars where possible, prefix "Post N:" if multiple.
- Instagram: include 3–5 meaningful hashtags (no junk).
- Reddit: communities must be "contentwriting" style (NO "r/").
- Do not include any text outside the JSON.`
    };
  }

  function userPrompt(raw, tog){
    const srcType = form.elements["sourceType"]?.value || "paragraph";
    const head = srcType==="url" ? "URL" : (srcType==="blog" ? "Full Blog" : "Paragraph/Notes");
    const channels = Object.entries(tog.ch).filter(([,v])=>v).map(([k])=>k).join(", ");
    // Batch support: if multiple lines, tell the model to create distinct variants chained
    const lines = raw.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
    const batch = lines.length>1 ? `Batch lines (${lines.length}):\n- ${lines.join("\n- ")}` : raw;
    return {
      role:"user",
      content:
`${head}:
${batch}

Task:
1) Create a one-line outline.
2) Generate content ONLY for these channels: ${channels || "linkedin,x,email"}.
3) Apply toggles and extras exactly.
4) If "li_article" is true, also include "linkedin_article_html" (valid minimal HTML).`
    };
  }

  function parseJsonLoose(txt){
    if (!txt) return null;
    let s = String(txt).trim();
    s = s.replace(/^```(?:json)?/i, "").replace(/```$/i, "").trim();
    const first = s.indexOf("{"); const last = s.lastIndexOf("}");
    if (first>=0 && last>first) s = s.slice(first,last+1);
    try { return JSON.parse(s); } catch {}
    s = s.replace(/,\s*([}\]])/g,"$1");
    try { return JSON.parse(s); } catch {}
    return null;
  }

  function normalizeRedditCommunities(arr){
    if (!Array.isArray(arr)) return [];
    return arr.map(s=>String(s||"").trim().replace(/^r\//i,"")).filter(Boolean);
  }

  function paintOutput(j){
    LAST_OUTPUT = {};
    out.innerHTML = "";

    const add = (title, html, key)=>{
      out.insertAdjacentHTML("beforeend", `
        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight">${title}</strong>
            <button class="btn copy" type="button">Copy</button>
          </div>
          ${html}
        </div>`);
      const card = out.lastElementChild;
      const copy = card.querySelector(".btn.copy");
      const pre  = card.querySelector("pre.content") || card.querySelector("pre") || card;
      copy?.addEventListener("click", async()=>{
        try { await navigator.clipboard.writeText(pre.innerText || ""); toast("Copied ✅"); }
        catch{ toast("Copy failed"); }
      });
      if (key) LAST_OUTPUT[key] = pre.innerText || pre.textContent || "";
    };

    if (j.linkedin){
      add("LinkedIn", `<pre class="whitespace-pre-wrap text-sm mt-3 content">${j.linkedin}</pre>`, "linkedin");
    }
    if (Array.isArray(j.x) && j.x.length){
      const seq = j.x.map((t,i)=> t ? `Post ${i+1}: ${t}` : "").filter(Boolean).join("\n\n");
      add("X (Twitter)", `<pre class="whitespace-pre-wrap text-sm mt-3 content">${seq}</pre>`, "x");
    }
    if (j.email && (j.email.subject || j.email.body)){
      add("Email", `
        <div class="text-xs text-slate-400">Subject</div>
        <pre class="whitespace-pre-wrap text-sm mt-1 content">${j.email.subject||""}</pre>
        <div class="text-xs text-slate-400 mt-3">Body</div>
        <pre class="whitespace-pre-wrap text-sm mt-1 content">${j.email.body||""}</pre>`, "email");
    }
    if (j.instagram){
      const cap = j.instagram.caption||"";
      const tags = (j.instagram.hashtags||[]).map(h=> h.startsWith("#")?h:"#"+h).join(" ");
      add("Instagram", `<pre class="whitespace-pre-wrap text-sm mt-3 content">${cap}\n\n${tags}</pre>`, "instagram");
    }
    if (j.reddit){
      const subs = normalizeRedditCommunities(j.reddit.communities||[]);
      const starters = (j.reddit.starter_comments||[]).map(c=>`• ${c}`).join("\n");
      add("Reddit", `
        <div class="text-xs text-slate-400">Main post</div>
        <pre class="whitespace-pre-wrap text-sm mt-1 content"><strong>${j.reddit.title||""}</strong>\n\n${j.reddit.body||""}</pre>
        <div class="text-xs text-slate-400 mt-3">Suggested communities</div>
        <pre class="whitespace-pre-wrap text-sm mt-1">${subs.length? subs.map(s=>"r/"+s).join(", ") : "—"}</pre>
        <div class="text-xs text-slate-400 mt-3">Starter comments</div>
        <pre class="whitespace-pre-wrap text-sm mt-1">${starters || "—"}</pre>`, "reddit");
    }
    if (j.facebook){
      add("Facebook", `
        <div class="text-xs text-slate-400">Primary text</div>
        <pre class="whitespace-pre-wrap text-sm mt-1 content">${j.facebook.primary||""}</pre>
        <div class="text-xs text-slate-400 mt-3">Link preview</div>
        <pre class="whitespace-pre-wrap text-sm mt-1">${(j.facebook.meta?.headline||"")}\n${(j.facebook.meta?.description||"")}</pre>`, "facebook");
    }
    if (j.quora){
      const follow = (j.quora.followups||[]).map(f=>`• ${f}`).join("\n");
      add("Quora", `
        <div class="text-xs text-slate-400">Answer</div>
        <pre class="whitespace-pre-wrap text-sm mt-1 content">${j.quora.answer||""}</pre>
        <div class="text-xs text-slate-400 mt-3">Follow-ups</div>
        <pre class="whitespace-pre-wrap text-sm mt-1">${follow||"—"}</pre>`, "quora");
    }
    if (j.tiktok){
      const hooks=(j.tiktok.hooks||[]).map(h=>`• ${h}`).join("\n");
      const ons  =(j.tiktok.onscreen||[]).map(o=>`• ${o}`).join("\n");
      add("TikTok", `
        <div class="text-xs text-slate-400">Script</div>
        <pre class="whitespace-pre-wrap text-sm mt-1 content">${j.tiktok.script||""}</pre>
        <div class="text-xs text-slate-400 mt-3">Hooks</div>
        <pre class="whitespace-pre-wrap text-sm mt-1">${hooks||"—"}</pre>
        <div class="text-xs text-slate-400 mt-3">On-screen</div>
        <pre class="whitespace-pre-wrap text-sm mt-1">${ons||"—"}</pre>`, "tiktok");
    }
    if (j.linkedin_article_html){
      out.insertAdjacentHTML("beforeend", `
        <div class="card p-5">
          <strong class="tracking-tight">LinkedIn Article</strong>
          <div class="prose prose-sm dark:prose-invert max-w-none mt-3" id="liArticle"></div>
        </div>`);
      $("#liArticle").innerHTML = j.linkedin_article_html;
      LAST_OUTPUT.linkedin_article = $("#liArticle").innerText || "";
    }
  }

  async function doGenerate(button){
    const raw = (src.value||"").trim();
    if (!raw) { toast("Paste some content first"); return; }

    // Batch cap by plan: Free 1, Starter 5, Creator 30, Business 50
    const lines = raw.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
    const caps = { free:1, starter:5, creator:30, business:50 };
    const cap  = caps[CURRENT_PLAN] ?? 1;
    const batched = lines.slice(0, Math.max(1, cap)).join("\n");

    const tog = readToggles();
    const messages = [ systemPrompt(tog), userPrompt(batched, tog) ];

    const lane = (!AUTHTED || CURRENT_PLAN==="free") ? "free" : "pro";

    button.disabled = true; const old = button.textContent;
    button.textContent = "Generating…";
    out.innerHTML = `<div class="card p-5 text-sm text-slate-500">Working…</div>`;

    try{
      const r = await fetch(`${WORKER_BASE}/api/generate`,{
        method:"POST",
        headers: await getAuthHeaders(),
        body: JSON.stringify({ plan: lane, temperature: 0.5, messages })
      });
      const data = await r.json();
      if (!r.ok) throw new Error(data?.error?.message || "Generation failed");
      const content = data?.choices?.[0]?.message?.content || "";
      const j = parseJsonLoose(content);
      if (!j) throw new Error("Model did not return JSON");
      // fix any r/r/ communities just in case
      if (j?.reddit?.communities) j.reddit.communities = normalizeRedditCommunities(j.reddit.communities);
      paintOutput(j);
      // refresh best-picks suggestion after an actual run
      try{ bestPicksRecalcFromUsage(); }catch{}
      toast("Done ✅");
    }catch(e){
      out.innerHTML = `<div class="card p-5 text-sm text-red-500">Error: ${e.message||e}</div>`;
    }finally{
      button.disabled = false; button.textContent = old;
    }
  }

  btnDemo?.addEventListener("click", ()=> doGenerate(btnDemo));
  btnMember?.addEventListener("click", ()=> doGenerate(btnMember));

  // Clear button (if present)
  $("#clearBtn")?.addEventListener("click", ()=>{ src.value=""; out.innerHTML=""; LAST_OUTPUT={}; });
})();

/* =========================================================
   2) PRESETS: list/save/apply/delete (Worker KV)
   ========================================================= */
(function wirePresets(){
  const listWrap = $("#presetList");
  const saveBtn  = $("#presetSave");
  const nameEl   = $("#presetName");
  const applySel = $("#presetApply");
  if (!listWrap) return;

  async function H(){ // headers
    const h = { "Content-Type":"application/json" };
    try{
      const { data } = await window.supabase?.auth?.getSession() || {};
      const t = data?.session?.access_token; const u = data?.session?.user?.id;
      if (t) h.Authorization = `Bearer ${t}`; if (u) h["X-User-Id"]=u;
    }catch{}
    return h;
  }

  async function refresh(){
    const r = await fetch(`${WORKER_BASE}/api/presets/list`, { headers: await H() }).catch(()=>null);
    const j = await r?.json().catch(()=>({presets:[]}));
    const presets = Array.isArray(j?.presets)? j.presets : [];
    listWrap.innerHTML = "";
    applySel.innerHTML = `<option value="">— Select preset —</option>`;
    presets.forEach(p=>{
      listWrap.insertAdjacentHTML("beforeend", `
        <div class="border rounded-lg p-3 flex items-center justify-between gap-3">
          <div class="text-sm">
            <div class="font-semibold">${p.title}</div>
            <div class="text-xs text-slate-500">${new Date(p.created_at).toLocaleString()}</div>
          </div>
          <div class="flex gap-2">
            <button class="btn btn-primary" data-apply="${p.id}" type="button">Apply</button>
            <button class="btn" data-del="${p.id}" type="button">Delete</button>
          </div>
        </div>`);
      applySel.insertAdjacentHTML("beforeend", `<option value="${p.id}">${p.title}</option>`);
    });

    // wire actions
    $$('[data-apply]').forEach(b=> b.addEventListener("click", ()=> applyPresetId(b.getAttribute("data-apply"))));
    $$('[data-del]').forEach(b=> b.addEventListener("click", async ()=>{
      const id = b.getAttribute("data-del");
      try{
        await fetch(`${WORKER_BASE}/api/presets/delete`, { method:"POST", headers: await H(), body: JSON.stringify({ id }) });
        toast("Deleted ✅"); refresh();
      }catch{ toast("Delete failed"); }
    }));
  }

  async function applyPresetId(id){
    // In this simple MVP, presets store nothing yet (we saved title/data in Worker).
    // Later you can store toggles. For now we just notify user.
    toast("Preset applied — your saved settings are loaded.");
  }

  saveBtn?.addEventListener("click", async ()=>{
    const title = (nameEl?.value||"").trim() || "Untitled preset";
    const data = {}; // TODO: include toggles later
    try{
      await fetch(`${WORKER_BASE}/api/presets/save`, { method:"POST", headers: await H(), body: JSON.stringify({ title, data }) });
      toast("Saved preset ✅"); nameEl && (nameEl.value=""); refresh();
    }catch{ toast("Save failed"); }
  });

  applySel?.addEventListener("change", ()=> applyPresetId(applySel.value));
  refresh();
})();

/* =========================================================
   3) OPTIMIZER modal + Rank score + related keywords
   ========================================================= */
(function wireOptimizer(){
  const dlg = $("#optimizerModal");
  if (!dlg) return;

  const openBtn = $("#openOptimizerBtn");
  const useBtn  = $("#useOpenOptimizer");
  const closeBtns = $$(".opt-close", dlg);
  const input  = $("#optInput");
  const kw     = $("#optKeyword");
  const len30  = $("#optLen");
  const faqs   = $("#optFaqs");
  const head   = $("#optHeads");
  const seo    = $("#optSeo");
  const title  = $("#optMetaTitle");
  const desc   = $("#optMetaDesc");
  const score  = $("#optScore");
  const ideas  = $("#optIdeas");
  const saveBtn= $("#optSaveBtn");

  function open(){ dlg.showModal(); }
  function close(){ dlg.close(); }

  openBtn?.addEventListener("click", open);
  useBtn?.addEventListener("click", open);
  closeBtns.forEach(b=> b.addEventListener("click", close));

  async function H(){
    const h = { "Content-Type":"application/json" };
    try{
      const { data } = await window.supabase?.auth?.getSession() || {};
      const t = data?.session?.access_token; const u = data?.session?.user?.id;
      if (t) h.Authorization = `Bearer ${t}`; if (u) h["X-User-Id"]=u;
    }catch{}
    return h;
  }

  async function optimize(){
    const base = (input?.value||"").trim();
    if (!base) return toast("Paste an article first");
    const prompt = [
      "You are an SEO editor. Improve the article for the focus keyword.",
      len30?.checked ? "Lengthen the content by ~30% where helpful." : "",
      faqs?.checked ? "Add a concise FAQ section and provide JSON-LD for FAQPage." : "",
      head?.checked ? "Ensure H2/H3 structure is clean and scannable." : "",
      seo?.checked  ? "Return a suggested <title> and <meta description> focused on CTR." : ""
    ].filter(Boolean).join(" ");

    const messages = [
      { role:"system", content:"Return ONLY a JSON object with { html, meta_title, meta_desc, score, related_keywords }" },
      { role:"user", content:`Focus keyword: ${kw?.value||""}\n\nArticle:\n${base}\n\n${prompt}` }
    ];

    try{
      saveBtn.disabled = true; saveBtn.textContent = "Optimizing…";
      const r = await fetch(`${WORKER_BASE}/api/generate`,{
        method:"POST", headers: await H(),
        body: JSON.stringify({ plan: planAtLeast("starter") ? "pro":"free", temperature:0.3, messages })
      });
      const j = await r.json();
      if (!r.ok) throw new Error(j?.error?.message || "Optimizer failed");
      const txt = j?.choices?.[0]?.message?.content || "{}";
      let out=null; try{ out = JSON.parse(txt.replace(/^```json/,"").replace(/```$/,"")); }catch{}
      if (!out?.html) throw new Error("No HTML returned");
      $("#optPreview").innerHTML = out.html;
      title && (title.value = out.meta_title||"");
      desc  && (desc.value  = out.meta_desc||"");
      score && (score.textContent = out.score!=null ? `${out.score}/100` : "—");
      ideas && (ideas.textContent = Array.isArray(out.related_keywords) ? out.related_keywords.join(", ") : "");
      toast("Optimized ✅");
    }catch(e){ toast(e.message||"Optimizer error"); }
    finally{ saveBtn.disabled=false; saveBtn.textContent="Run Optimizer"; }
  }

  saveBtn?.addEventListener("click", optimize);
})();

/* =========================================================
   4) QUICK PUBLISH + SCHEDULER (queue stored per user)
   ========================================================= */
(function wireQuickPublishAndScheduler(){
  // Quick Publish
  $("#qp-x")?.addEventListener("click", ()=>{
    const t = (LAST_OUTPUT.x || LAST_OUTPUT.linkedin || "").split(/\n+/).map(s=>s.trim()).filter(Boolean).join(" — ").slice(0,270);
    if (!t) return toast("Generate first");
    window.open(`https://x.com/intent/tweet?text=${encodeURIComponent(t)}`,"_blank");
  });
  $("#qp-reddit")?.addEventListener("click", ()=>{
    const b = LAST_OUTPUT.reddit || LAST_OUTPUT.linkedin || LAST_OUTPUT.x || "";
    if (!b) return toast("Generate first");
    const title = b.split("\n")[0].replace(/^Post \d+:\s*/,"").slice(0,260);
    window.open(`https://www.reddit.com/submit?title=${encodeURIComponent(title)}&text=${encodeURIComponent(b)}`,"_blank");
  });
  $("#qp-linkedin")?.addEventListener("click", async ()=>{
    const t = LAST_OUTPUT.linkedin || LAST_OUTPUT.x || "";
    if (!t) return toast("Generate first");
    try{ await navigator.clipboard.writeText(t); }catch{}
    window.open("https://www.linkedin.com/feed/","_blank");
  });
  $("#qp-email")?.addEventListener("click", ()=>{
    const t = LAST_OUTPUT.email || "";
    if (!t) return toast("Generate first");
    const subj = t.split("\n")[0].slice(0,120);
    location.href = `mailto:?subject=${encodeURIComponent(subj)}&body=${encodeURIComponent(t)}`;
  });

  // Scheduler (local queue)
  const ch   = $("#schedChannel");
  const when = $("#schedWhen");
  const text = $("#schedText");
  const add  = $("#schedAdd");
  const use  = $("#schedUseLast");
  const pub  = $("#schedPublish");
  const clr  = $("#schedClear");
  const list = $("#schedList");
  const empty= $("#schedEmpty");

  if (!add || !list) return;

  function SKEY(){ return `crp:sched:${(window.__uid)||"anon"}`; }
  function loadQ(){ try{ return JSON.parse(localStorage.getItem(SKEY())||"[]"); }catch{return[];} }
  function saveQ(q){ try{ localStorage.setItem(SKEY(), JSON.stringify(q)); }catch{} }

  function render(){
    const q = loadQ();
    list.innerHTML = "";
    if (!q.length){ empty.classList.remove("hidden"); return; }
    empty.classList.add("hidden");
    q.forEach((it, i)=>{
      list.insertAdjacentHTML("beforeend", `
        <div class="border rounded-xl p-3 grid md:grid-cols-12 gap-3 items-start">
          <label class="md:col-span-1 flex items-start gap-2 text-sm">
            <input type="checkbox" data-i="${i}" ${it.selected?"checked":""} />
            <span class="mono text-[11px]">${it.channel}</span>
          </label>
          <div class="md:col-span-3 text-xs text-slate-500">${new Date(it.when).toLocaleString()}</div>
          <div class="md:col-span-7 text-sm whitespace-pre-wrap">${it.text}</div>
          <div class="md:col-span-1 text-right">
            <button class="btn" data-del="${i}" type="button">Remove</button>
          </div>
        </div>`);
    });
    $$('input[type="checkbox"][data-i]', list).forEach(cb=>{
      cb.addEventListener("change", ()=>{
        const q = loadQ(); const i = Number(cb.getAttribute("data-i"));
        if (q[i]){ q[i].selected = cb.checked; saveQ(q); }
      });
    });
    $$('button[data-del]', list).forEach(b=>{
      b.addEventListener("click", ()=>{
        const q = loadQ(); const i = Number(b.getAttribute("data-del"));
        q.splice(i,1); saveQ(q); render();
      });
    });
  }

  add.addEventListener("click", ()=>{
    const payload = (text.value||"").trim();
    if (!payload) return toast("Add some text first");
    const w = when.value ? new Date(when.value) : new Date(Date.now()+5*60*1000);
    const q = loadQ();
    q.push({ channel: ch.value, when: w.toISOString(), text: payload, selected: true });
    saveQ(q); render(); toast("Added to queue");
  });

  use.addEventListener("click", ()=>{
    const key = ch.value;
    const val = LAST_OUTPUT[key] || LAST_OUTPUT.linkedin || LAST_OUTPUT.x || "";
    if (!val) return toast("Generate first");
    text.value = val; toast("Filled from last output");
  });

  pub.addEventListener("click", ()=>{
    const q = loadQ().filter(it=> it.selected);
    if (!q.length) return toast("Select some items first");
    q.forEach(it=>{
      const t = it.text;
      switch(it.channel){
        case "x":
          window.open(`https://x.com/intent/tweet?text=${encodeURIComponent(t.slice(0,270))}`,"_blank"); break;
        case "reddit":
          window.open(`https://www.reddit.com/submit?title=${encodeURIComponent(t.split("\n")[0].slice(0,260))}&text=${encodeURIComponent(t)}`,"_blank"); break;
        case "linkedin":
          navigator.clipboard.writeText(t).catch(()=>{}); window.open("https://www.linkedin.com/feed/","_blank"); break;
        case "email":
          location.href = `mailto:?subject=${encodeURIComponent(t.split("\n")[0].slice(0,120))}&body=${encodeURIComponent(t)}`; break;
        default:
          navigator.clipboard.writeText(t).catch(()=>{}); toast(`Copied ${it.channel} text — paste into the app.`);
      }
    });
    // keep queue items but unselect
    const remain = loadQ().map(it=> ({...it, selected:false}));
    saveQ(remain); render();
  });

  clr.addEventListener("click", ()=>{ saveQ([]); render(); });
  render();
})();

/* =========================================================
   5) INTEGRATIONS: Notion & Trello (connect + export)
   ========================================================= */
(function wireIntegrations(){
  const btnNotion = $("#li-notion");
  const btnTrello = $("#li-trello");
  const trelloDialog = $("#trelloModal");
  const trelloConfirm= $("#trelloConfirm");

  async function H(){
    const h = { "Content-Type":"application/json" };
    try{
      const { data } = await window.supabase?.auth?.getSession() || {};
      const t = data?.session?.access_token; const u = data?.session?.user?.id;
      if (t) h.Authorization = `Bearer ${t}`; if (u) h["X-User-Id"]=u;
      window.__uid = u || null;
    }catch{}
    return h;
  }

  btnNotion?.addEventListener("click", async ()=>{
    if (!planAtLeast("creator")) return toast("Creator plan required.");
    try{
      // If you want to force-connect first: start OAuth if no token; otherwise export
      // Here we just export a simple page using LAST_OUTPUT
      const blocks = [];
      if (LAST_OUTPUT.linkedin) blocks.push({ type:"heading", text:"LinkedIn" },{ type:"paragraph", text: LAST_OUTPUT.linkedin });
      if (LAST_OUTPUT.x)        blocks.push({ type:"heading", text:"X (Twitter)" },{ type:"paragraph", text: LAST_OUTPUT.x });
      if (!blocks.length) return toast("Generate something first");
      const r = await fetch(`${WORKER_BASE}/api/integrations/notion/export`,{
        method:"POST", headers: await H(),
        body: JSON.stringify({ title:"Social Drafts", blocks })
      });
      const j = await r.json();
      if (!r.ok) throw new Error(j?.error?.message || "Notion export failed");
      toast("Sent to Notion ✅");
      j.url && window.open(j.url,"_blank");
    }catch(e){ toast(e.message||"Notion error"); }
  });

  btnTrello?.addEventListener("click", ()=>{
    if (!planAtLeast("creator")) return toast("Creator plan required.");
    trelloDialog?.showModal();
  });

  trelloConfirm?.addEventListener("click", async ()=>{
    const listId  = $("#trelloListId")?.value?.trim();
    const boardId = $("#trelloBoardId")?.value?.trim();
    if (!listId) return toast("Enter Trello List ID");
    const title = "Social Draft";
    const description = [
      "LinkedIn:\n"+(LAST_OUTPUT?.linkedin||""),
      "\nX:\n"+(LAST_OUTPUT?.x||"")
    ].join("\n");
    try{
      const r = await fetch(`${WORKER_BASE}/api/integrations/trello/export`,{
        method:"POST", headers: await H(),
        body: JSON.stringify({ board_id: boardId||undefined, list_id: listId, title, description })
      });
      const j = await r.json();
      if (!r.ok) throw new Error(j?.error?.message || "Trello export failed");
      toast("Sent to Trello ✅");
      trelloDialog?.close();
      j.url && window.open(j.url,"_blank");
    }catch(e){ toast(e.message||"Trello error"); }
  });
})();

/* =========================================================
   6) BEST PICKS: suggest exact plan + wire CTA to checkout
   ========================================================= */
(function wireBestPicks(){
  const txt = $("#bestPickText");
  const cta = $("#bestPickCta");
  const recalc = $("#bestPickRecalc");

  function set(plan){
    CURRENT_PLAN = CURRENT_PLAN || "free";
    if (!txt || !cta) return;
    if (plan==="starter"){
      txt.innerHTML = `Posting 2–4×/week? <span class="font-semibold">Starter</span> fits: 200 gens/mo + Scheduler + Analytics basics.`;
      cta.textContent = "Get Starter";
      cta.setAttribute("href", "#pricing");
      cta.setAttribute("data-price", "price_1S7y58JYjIKHzKcjzL7cIKiB");
      cta.classList.add("js-checkout");
    } else if (plan==="creator"){
      txt.innerHTML = `Multi-channel + templates + Notion/Trello? Choose <span class="font-semibold">Creator</span> for 500 gens/mo, unlimited presets & Analytics Pro.`;
      cta.textContent = "Get Creator";
      cta.setAttribute("href", "#pricing");
      cta.setAttribute("data-price", "price_1S7y77JYjIKHzKcjKQYjiqZH");
      cta.classList.add("js-checkout");
    } else {
      txt.innerHTML = `Team of 2–5? <span class="font-semibold">Business</span> adds seats, org analytics and white-label export.`;
      cta.textContent = "Get Business";
      cta.setAttribute("href", "#pricing");
      cta.setAttribute("data-price", "price_1S7y8OJYjIKHzKcjqA9uJdyh");
      cta.classList.add("js-checkout");
    }
    wireCheckoutButtons(); // re-wire in case we changed CTA dynamically
  }

  // naive heuristic based on LAST_OUTPUT presence (you can upgrade later with server stats)
  window.bestPicksRecalcFromUsage = function(){
    if (LAST_OUTPUT.instagram || LAST_OUTPUT.tiktok || LAST_OUTPUT.reddit) return set("creator");
    if (LAST_OUTPUT.linkedin && LAST_OUTPUT.x && LAST_OUTPUT.email) return set("starter");
    return set("starter");
  };
  recalc?.addEventListener("click", ()=> window.bestPicksRecalcFromUsage());
  window.bestPicksRecalcFromUsage();
})();

/* =========================================================
   7) CHECKOUT / BILLING wiring for any .js-checkout buttons
   ========================================================= */
function wireCheckoutButtons(){
  const btns = $$(".js-checkout");
  btns.forEach(btn=>{
    if (btn.__wired) return;
    btn.__wired = true;
    btn.addEventListener("click", async ()=>{
      try{
        const price = btn.getAttribute("data-price") || "";
        if (!price) return location.href = "#pricing";
        const old = btn.textContent; btn.disabled = true; btn.textContent = "Opening…";
        const h = { "Content-Type":"application/json" };
        try{
          const { data } = await window.supabase?.auth?.getSession() || {};
          const t = data?.session?.access_token; const u = data?.session?.user?.id;
          if (t) h.Authorization = `Bearer ${t}`; if (u) h["X-User-Id"]=u;
        }catch{}
        const r = await fetch(`${WORKER_BASE}/api/billing/checkout`,{
          method:"POST", headers:h,
          body: JSON.stringify({
            price,
            success_url: `${SITE_ORIGIN}/?billing=success`,
            cancel_url:  `${SITE_ORIGIN}/?billing=cancel`
          })
        });
        const j = await r.json();
        if (!r.ok) throw new Error(j?.error?.message || "Checkout error");
        location.href = j.url;
      }catch(e){
        toast(e.message||"Checkout error");
      }finally{
        btn.disabled=false; btn.textContent = btn.textContent||"Choose";
      }
    });
  });
}
wireCheckoutButtons();
</script>
<!-- ===== CRP FINISHER (Part 6) — Auth paint + Plan gates + Billing portal + Live stats + Nav/A11y ===== -->
<script type="module">
if (!window.__CRP_PART6_WIRED__) {
  window.__CRP_PART6_WIRED__ = true;

  /* ---------- Short helpers ---------- */
  const $  = (s, r=document)=>r.querySelector(s);
  const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));
  const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));
  const cap = (s)=> (s||"").slice(0,1).toUpperCase() + (s||"").slice(1);

  const WORKER_BASE = window.WORKER_BASE || "https://contentflow-worker.frank-couchman.workers.dev";
  const SITE_ORIGIN = window.SITE_ORIGIN || location.origin;

  /* ---------- Toast (shared) ---------- */
  function toast(msg){
    try {
      const t = $("#toast"); const m = $("#toastMsg");
      if (!t || !m) { alert(msg); return; }
      m.textContent = msg; t.classList.remove("hidden");
      setTimeout(()=>t.classList.add("hidden"), 1600);
    } catch { alert(msg); }
  }

  /* ---------- Auth + Headers ---------- */
  async function getAuthHeaders(){
    const h = { "Content-Type":"application/json" };
    try{
      const { data } = await window.supabase?.auth?.getSession() || {};
      const tok = data?.session?.access_token;
      const uid = data?.session?.user?.id;
      if (tok) h.Authorization = `Bearer ${tok}`;
      if (uid) h["X-User-Id"] = uid;
      window.__uid = uid || null;
    }catch{}
    return h;
  }

  /* ---------- Plan gates ---------- */
  const PLAN_RANK = { free:0, starter:1, creator:2, business:3 };
  function applyPlanGates(plan){
    const r = PLAN_RANK[plan] ?? 0;
    // Hide all plan blocks first
    $$(".plan-starter-plus").forEach(el => el.classList.add("hidden"));
    $$(".plan-creator-plus").forEach(el => el.classList.add("hidden"));
    $$(".plan-business-only").forEach(el => el.classList.add("hidden"));
    if (r >= 1) $$(".plan-starter-plus").forEach(el => el.classList.remove("hidden"));
    if (r >= 2) $$(".plan-creator-plus").forEach(el => el.classList.remove("hidden"));
    if (r >= 3) $$(".plan-business-only").forEach(el => el.classList.remove("hidden"));
  }
  function showGuest(isGuest){
    $$(".only-guest").forEach(el=> el.classList.toggle("hidden", !isGuest));
    $$(".only-authed").forEach(el=> el.classList.toggle("hidden", isGuest));
  }
  function paintBadges(plan, authed){
    const label = `Plan: ${cap(plan)}`;
    $("#planbadge")   && ($("#planbadge").textContent = label);
    $("#planbadge_m") && ($("#planbadge_m").textContent = label);
    $("#heroPlanName")&& ($("#heroPlanName").textContent = cap(plan));
    ["manageBilling","manageBilling_m","manageBilling2"].forEach(id=>{
      const el = $("#"+id); if (el) el.classList.toggle("hidden", !authed);
    });
    document.body.setAttribute("data-auth", authed ? "authed" : "guest");
    document.body.setAttribute("data-plan", plan);
  }

  /* ---------- Status + Quotas ---------- */
  async function fetchStatusAndPaint(){
    try{
      const r = await fetch(`${WORKER_BASE}/api/billing/status`, { headers: await getAuthHeaders() });
      const j = await r.json();
      const authed = j.scope==="user";
      const plan = (j.plan||"free").toLowerCase();
      window.CURRENT_PLAN = plan;
      window.AUTHTED = authed;

      showGuest(!authed);
      paintBadges(plan, authed);
      applyPlanGates(plan);

      // Quotas (optional labels if present)
      const demoEl = $("#demoQuota");
      const memEl  = $("#memberQuota");
      if (!authed){
        const cap = j.platform?.monthly?.cap ?? 5;
        const used= j.platform?.monthly?.used ?? 0;
        demoEl && (demoEl.textContent = Math.max(0, cap - used));
      } else {
        const cap = j.platform?.daily?.cap; // null ⇒ ∞
        const used= j.platform?.daily?.used ?? 0;
        memEl && (memEl.textContent = (cap==null ? "∞" : Math.max(0, cap - used)));
      }
    }catch{
      showGuest(true); paintBadges("free", false); applyPlanGates("free");
    }
  }

  /* ---------- Auth dialog open/close ---------- */
  function wireAuthDialog(){
    const dlg = $("#auth");
    if (!dlg) return;
    const send = $("#authSend");
    const gBtn = $("#authGoogle");
    const emailEl = $("#authEmail");

    // openers
    $$(".js-open-auth").forEach(b=> b.addEventListener("click", ()=> dlg.showModal()));
    ["loginBtn","loginBtn_m","heroSignIn"].forEach(id=>{
      const el = $("#"+id); el && el.addEventListener("click", ()=> dlg.showModal());
    });
    // logout
    ["logoutBtn","logoutBtn_m"].forEach(id=>{
      const el = $("#"+id); el && el.addEventListener("click", async ()=>{
        try{ await window.supabase?.auth?.signOut(); toast("Signed out"); }catch{}
      });
    });

    // magic link
    send?.addEventListener("click", async ()=>{
      const email = emailEl?.value?.trim();
      if (!email) return toast("Enter your email");
      try{
        await window.supabase?.auth?.signInWithOtp({ email, options:{ emailRedirectTo: SITE_ORIGIN } });
        toast("Check your email for the magic link.");
      }catch(e){ toast(e?.message||"Sign-in error"); }
    });
    // google
    gBtn?.addEventListener("click", async ()=>{
      try{
        await window.supabase?.auth?.signInWithOAuth({ provider:"google", options:{ redirectTo: SITE_ORIGIN }});
      }catch(e){ toast(e?.message||"Google sign-in failed"); }
    });
    // enter key
    emailEl?.addEventListener("keydown", (e)=>{ if (e.key==="Enter"){ e.preventDefault(); send?.click(); }});
  }

  /* ---------- Billing: checkout + portal ---------- */
  function wireBilling(){
    // Checkout buttons are re-wired by Part 5's helper; here we only wire portal
    ["manageBilling","manageBilling_m","manageBilling2"].forEach(id=>{
      const b = $("#"+id); if (!b) return;
      b.addEventListener("click", async ()=>{
        const old=b.textContent; b.disabled=true; b.textContent="Opening…";
        try{
          const r = await fetch(`${WORKER_BASE}/api/billing/portal`,{
            method:"POST", headers: await getAuthHeaders(),
            body: JSON.stringify({ return_url: location.href })
          });
          const j = await r.json();
          if (!r.ok) throw new Error(j?.error?.message || "Portal error");
          location.href = j.url;
        }catch(e){ toast(e.message||"Portal error"); b.disabled=false; b.textContent=old; }
      });
    });
  }

  /* ---------- Live stats / ticker ---------- */
  async function paintLive(){
    try{
      const r = await fetch(`${WORKER_BASE}/api/stats/today`);
      const j = await r.json();
      const count = (typeof j.today_count==="number") ? j.today_count : "—";
      // Support both hero + section counters
      $$('[data-live-count], #liveCount').forEach(el=> el.textContent = String(count));
      // (Optional) If you later stream examples, render them to [data-live-feed] / #liveFeed
    }catch{}
  }

  /* ---------- Nav + anchors + promo code ---------- */
  function wireNav(){
    const toggle = $("#navToggle");
    const sheet  = $("#mobileNav");
    const close  = $("#navClose");
    toggle && toggle.addEventListener("click", ()=> document.body.classList.add("nav-open"));
    close  && close.addEventListener("click", ()=> document.body.classList.remove("nav-open"));
    $$('a[href^="#"]').forEach(a=>{
      a.addEventListener("click", (e)=>{
        const id = a.getAttribute("href"); if (!id || id==="#") return;
        const el = $(id);
        if (el){ e.preventDefault(); try{ el.scrollIntoView({behavior:"smooth", block:"start"});}catch{el.scrollIntoView();} document.body.classList.remove("nav-open"); history.replaceState(null,"",id); }
      });
    });
    // promo copy buttons
    ["copyPromoBtn","copyPromoBtn2","copyPromoBtn_pr"].forEach(id=>{
      const el = $("#"+id);
      el && el.addEventListener("click", async ()=>{ try{ await navigator.clipboard.writeText("CONTENTOFF90"); toast("Code copied ✅"); }catch{ toast("Copy failed"); }});
    });
    // year
    const y = $("#year"); y && (y.textContent = new Date().getFullYear());
  }

  /* ---------- URL params (billing) ---------- */
  function handleBillingParams(){
    try{
      const u = new URL(location.href);
      const b = u.searchParams.get("billing");
      if (b==="success") toast("Billing updated — thank you!");
      if (b==="cancel")  toast("Billing cancelled");
      if (b){ u.searchParams.delete("billing"); history.replaceState({}, "", u.toString()); }
    }catch{}
  }

  /* ---------- Boot order ---------- */
  document.addEventListener("DOMContentLoaded", async ()=>{
    // supabase may already be initialized in <head>; just finish OAuth if needed
    try{
      const url = new URL(location.href);
      if (url.searchParams.get("code")) {
        const { error } = await window.supabase?.auth?.exchangeCodeForSession({ code: url.searchParams.get("code") });
        if (!error){
          ["code","state","scope","provider_id","redirected_from"].forEach(p=> url.searchParams.delete(p));
          history.replaceState({}, "", url.toString());
        }
      }
      if (location.hash.includes("access_token")){
        await window.supabase?.auth?.getSession();
        history.replaceState({}, "", location.pathname + location.search);
      }
    }catch{}

    wireAuthDialog();
    wireBilling();
    wireNav();

    await fetchStatusAndPaint();
    await paintLive();
    setInterval(paintLive, 30000);

    // React to auth changes → repaint plan gates & badges
    try{
      window.supabase?.auth?.onAuthStateChange((_event, session)=>{
        const authed = !!session;
        const plan = window.CURRENT_PLAN || "free";
        showGuest(!authed);
        paintBadges(plan, authed);
        applyPlanGates(plan);
        // Close auth dialog if open
        try{ $$('dialog[open]#auth').forEach(d=> d.close()); }catch{}
        // refresh status to recalc quotas
        fetchStatusAndPaint().catch(()=>{});
      });
    }catch{}

    handleBillingParams();

    // A11y finisher: mark app ready & live region on toast
    try{
      document.body.classList.add("__ready");
      const t = $("#toast");
      if (t){ t.setAttribute("role","status"); t.setAttribute("aria-live","polite"); }
    }catch{}
  });
}
</script>
<!-- ===== /CRP FINISHER (Part 6) ===== -->

</body>
</html>
