<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ContentRepurpose.pro — AI Content Repurposing Tool & Generator</title>
  <meta name="description" content="Repurpose content with AI. LinkedIn, X, Email, Instagram, Reddit, Facebook, Quora, TikTok — plus LinkedIn Article & Article Optimizer. Export to Notion & Trello. BYOK supported." />
  <link rel="canonical" href="https://contentrepurpose.pro/">
  <meta name="theme-color" content="#0a0d18"><meta name="color-scheme" content="dark light">
  <meta name="robots" content="index,follow,max-video-preview:-1,max-image-preview:large,max-snippet:-1">
  <meta property="og:type" content="website"><meta property="og:title" content="ContentRepurpose.pro — AI Content Repurposing Tool">
  <meta property="og:description" content="Turn one idea into everywhere content. Multi-channel drafts + Article Optimizer. Export to Notion & Trello. BYOK supported.">
  <meta property="og:url" content="https://contentrepurpose.pro/"><meta property="og:image" content="/og-cover.png">
  <meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="ContentRepurpose.pro — AI Content Generator">
  <meta name="twitter:description" content="Repurpose content with AI across LinkedIn, X, Email, Instagram, Reddit, Facebook, Quora, TikTok. Export to Notion & Trello."><meta name="twitter:image" content="/og-cover.png">

  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase UMD (stable on mobile; no dynamic import needed) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>

  <style>
    :root{ --brandA:#7AA2FF; --brandB:#FF2D2D; --ink:#0a0d18 }
    html,body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .txt-grad{background:linear-gradient(135deg,var(--brandA),var(--brandB));-webkit-background-clip:text;background-clip:text;color:transparent}
    .bg-grad{background:linear-gradient(135deg,var(--brandA),var(--brandB))}
    .card{border-radius:1.25rem;border:1px solid rgba(15,23,42,.10);background:rgba(255,255,255,.80);box-shadow:0 12px 40px rgba(2,6,23,.08)}
    .badge{display:inline-flex;align-items:center;gap:.5rem;padding:.35rem .6rem;border-radius:9999px;border:1px solid rgba(255,255,255,.15);font-size:.75rem;background:rgba(255,255,255,.65)}
    .chip{font-size:.7rem;padding:.2rem .5rem;border-radius:9999px;border:1px solid rgba(148,163,184,.35)}
    .btn{padding:.6rem .9rem;border-radius:.9rem;border:1px solid rgba(148,163,184,.35)}
    .btn-primary{background:black;color:white}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .halo{position:absolute;filter:blur(60px);opacity:.55;pointer-events:none;transform:translateZ(0);
      background:radial-gradient(50% 50% at 50% 50%, rgba(122,162,255,.8), rgba(255,45,45,.65) 60%, transparent 70%);
      width:42rem;height:42rem;border-radius:50%;animation:float 16s ease-in-out infinite;}
    .halo.h2{width:34rem;height:34rem;right:-12rem;top:-6rem;animation-duration:18s;opacity:.5}
    .halo.h3{width:28rem;height:28rem;left:-10rem;top:26rem;animation-duration:22s;opacity:.45}
    @keyframes float{ 0%,100%{ transform: translate3d(0,0,0) } 50%{ transform: translate3d(0,-20px,0) } }
    .orbit{position:absolute;inset:-32px;border-radius:24px;pointer-events:none;
      background: conic-gradient(from 0deg, rgba(122,162,255,.25), rgba(255,45,45,.18), rgba(122,162,255,.25));
      -webkit-mask: radial-gradient(closest-side, transparent 88%, black 89%); mask: radial-gradient(closest-side, transparent 88%, black 89%);
      animation: spin 18s linear infinite;}
    @keyframes spin{ to{ transform: rotate(360deg) } }
    .mock{border-radius:1rem;border:1px solid rgba(255,255,255,.12); background:linear-gradient(180deg,rgba(255,255,255,.75),rgba(255,255,255,.6));}
    @media (prefers-color-scheme:dark){
      body{background:var(--ink);color:#e9eef6}
      .card{background:rgba(14,16,22,.6);border-color:rgba(255,255,255,.08);box-shadow:0 24px 96px rgba(122,162,255,.08),0 14px 60px rgba(255,45,45,.06)}
      .badge{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.12)}
      .mock{ background:linear-gradient(180deg,rgba(17,20,31,.88),rgba(17,20,31,.72)); }
    }
    .marquee{ display:grid; grid-auto-flow:column; gap:2rem; align-items:center; animation: scrollx 26s linear infinite }
    .marquee:hover{ animation-play-state: paused }
    @keyframes scrollx{ from{ transform: translateX(0) } to{ transform: translateX(-50%) } }
    .nav-sheet{position:fixed; inset:0 0 auto 0; background:rgba(0,0,0,.6); backdrop-filter:blur(8px); display:none}
    .nav-panel{position:absolute; top:0; right:0; width:82vw; max-width:380px; height:100%; background:rgba(14,16,22,.96); border-left:1px solid rgba(255,255,255,.08); padding:1rem}
    .nav-open .nav-sheet{display:block}
    .only-guest{display:revert}.only-authed{display:none}
    .plan-starter-plus{display:none}.plan-creator-plus{display:none}.plan-business-only{display:none}
    body[data-auth="authed"] .only-guest{display:none} body[data-auth="authed"] .only-authed{display:revert}
    body[data-plan="starter"] .plan-starter-plus,
    body[data-plan="creator"] .plan-starter-plus,
    body[data-plan="business"] .plan-starter-plus{display:revert}
    body[data-plan="creator"] .plan-creator-plus,
    body[data-plan="business"] .plan-creator-plus{display:revert}
    body[data-plan="business"] .plan-business-only{display:revert}
    :focus-visible{ outline:2px solid var(--brandA); outline-offset:2px }

    /* Mobile-safe auth overlay */
    .auth-overlay{position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.5); z-index:1000}
    .auth-overlay[aria-hidden="false"]{display:grid}
    .auth-panel{width:min(92vw,480px); background:rgba(14,16,22,.98); color:white; border-radius:14px; border:1px solid rgba(255,255,255,.12); padding:16px}
    .auth-panel input{background:rgba(255,255,255,.1)}
  </style>

  <!-- Worker base & Stripe price IDs -->
  <script>
    window.WORKER_BASE = "https://contentflow-worker.frank-couchman.workers.dev";
    window.SITE_ORIGIN = location.origin;
    window.PRICE_IDS = {
      starter:  "price_1S7y58JYjIKHzKcjzL7cIKiB",
      creator:  "price_1S7y77JYjIKHzKcjKQYjiqZH",
      business: "price_1S7y8OJYjIKHzKcjqA9uJdyh"
    };
  </script>
</head>
<body class="min-h-full" data-auth="guest" data-plan="free">
  <div class="halo" style="left:-14rem; top:-10rem;"></div><div class="halo h2"></div><div class="halo h3"></div>

  <header class="sticky top-0 z-40 backdrop-blur bg-white/55 dark:bg-black/20 border-b border-white/30">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-4 flex items-center justify-between">
      <a href="/" class="flex items-center gap-3" aria-label="ContentRepurpose home">
        <svg width="36" height="36" viewBox="0 0 48 48" class="rounded-xl" aria-hidden="true">
          <defs><linearGradient id="g" x1="0" y="0" x2="1" y="1"><stop offset="0%" stop-color="#7AA2FF"/><stop offset="100%" stop-color="#FF2D2D"/></linearGradient></defs>
          <rect x="0" y="0" width="48" height="48" rx="12" fill="url(#g)"/><path d="M14 16h10a6 6 0 0 1 0 12H20v4h-6V16zm6 6v4h4a2 2 0 1 0 0-4h-4z" fill="white"/><path d="M28 16h6v16h-6z" fill="white" opacity=".9"/>
        </svg>
        <span class="font-semibold tracking-tight">Content<span class="txt-grad">Repurpose</span></span>
      </a>

      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="#demo" class="hover:opacity-80">Generator</a>
        <a href="#optimizer" class="hover:opacity-80">Article Optimizer</a>
        <a href="#integrations" class="hover:opacity-80">Integrations</a>
        <a href="#calendar" class="hover:opacity-80">Calendar</a>
        <a href="#pricing" class="hover:opacity-80">Pricing</a>

        <span id="planbadge" class="px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/50">Plan: Free</span>
        <button id="manageBilling" class="px-3 py-1 rounded-lg border hidden" type="button">Manage billing</button>
        <div class="flex items-center gap-2">
          <button id="loginBtn" class="px-3 py-1 rounded-lg border only-guest" type="button">Sign in</button>
          <button id="logoutBtn" class="px-3 py-1 rounded-lg border only-authed hidden" type="button">Sign out</button>
        </div>
      </nav>

      <button id="navToggle" class="md:hidden touch-target px-3 py-2 rounded-lg border" aria-expanded="false" aria-controls="mobileNav" aria-label="Open menu" type="button">☰</button>
    </div>

    <div class="border-t border-white/40 bg-white/70 dark:bg-white/10">
      <div class="max-w-7xl mx-auto px-4 md:px-5 py-2 flex flex-wrap items-center justify-between gap-3 text-sm">
        <div class="flex items-center gap-2"><span class="px-2 py-0.5 rounded-full text-[11px] bg-black/80 text-white">LIMITED</span>
          <span>Use <strong class="mono">CONTENTOFF90</strong> for <strong>90% off</strong> the Creator plan.</span></div>
        <div class="flex items-center gap-2"><button id="copyPromoBtn" class="px-3 py-1 rounded-lg border" type="button">Copy code</button>
          <a href="#pricing" class="px-3 py-1 rounded-lg bg-black text-white">See pricing</a></div>
      </div>
    </div>

    <!-- Mobile sheet -->
    <div id="mobileNav" class="nav-sheet" aria-hidden="true">
      <div class="nav-panel text-sm text-white">
        <div class="flex items-center justify-between"><span class="font-semibold">Menu</span>
          <button id="navClose" class="touch-target px-3 py-2 rounded-lg border border-white/20" aria-label="Close menu" type="button">✕</button></div>
        <nav class="mt-4 grid gap-2">
          <a href="#demo" class="px-3 py-2 rounded-lg hover:bg-white/10">Generator</a>
          <a href="#optimizer" class="px-3 py-2 rounded-lg hover:bg-white/10">Article Optimizer</a>
          <a href="#integrations" class="px-3 py-2 rounded-lg hover:bg-white/10">Integrations</a>
          <a href="#calendar" class="px-3 py-2 rounded-lg hover:bg-white/10">Calendar</a>
          <a href="#pricing" class="px-3 py-2 rounded-lg hover:bg-white/10">Pricing</a>
        </nav>
        <div class="mt-6 grid gap-2">
          <span id="planbadge_m" class="px-3 py-1 rounded-full text-xs bg-white/10 border border-white/20 w-fit">Plan: Free</span>
          <button id="manageBilling_m" class="px-3 py-2 rounded-lg border border-white/20 hidden" type="button">Manage billing</button>
          <button id="loginBtn_m" class="px-3 py-2 rounded-lg border border-white/20 only-guest" type="button">Sign in</button>
          <button id="logoutBtn_m" class="px-3 py-2 rounded-lg border border-white/20 only-authed hidden" type="button">Sign out</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="relative" id="hero">
    <div class="max-w-7xl mx-auto px-4 md:px-5 pt-10 md:pt-16 grid lg:grid-cols-2 gap-8 md:gap-10 items-center">
      <div>
        <div id="heroBadgeWrap" class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/40">
          <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
          <span class="only-guest">Preview the demo — <strong>5 runs/month</strong> (no login)</span>
          <span class="only-authed hidden">Signed in — <strong id="heroPlanName">Free</strong> plan active</span>
        </div>
        <h1 class="mt-4 text-3xl md:text-5xl font-black leading-tight tracking-tight">
          AI <span class="txt-grad">Content Repurposing</span> — turn one idea into everywhere content.
        </h1>
        <p class="mt-4 text-slate-600 dark:text-slate-300 max-w-xl">
          Generate for <strong>LinkedIn</strong>, <strong>X</strong>, <strong>Email</strong>, <strong>Instagram</strong>, <strong>Reddit</strong>, <strong>Facebook</strong>, <strong>Quora</strong>, <strong>TikTok</strong> + optional <strong>LinkedIn Article</strong>.
          Export to <strong>Notion</strong> & <strong>Trello</strong>. <strong>BYOK</strong> supported.
        </p>
        <ul class="mt-3 text-sm text-slate-600 dark:text-slate-300">
          <li>• <strong>Guest (no login):</strong> Generator <strong>5/month</strong> (IP-based).</li>
          <li>• <strong>Free (signed-in):</strong> Generator <strong>5/day</strong>, Optimizer <strong>1/day</strong>.</li>
        </ul>
        <div class="mt-6 flex flex-wrap gap-3">
          <a href="#demo" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90">Open Generator</a>
          <a href="#optimizer" class="px-4 py-3 rounded-xl font-semibold border border-slate-300/60">Open Article Optimizer</a>
          <button id="heroSignIn" class="px-4 py-3 rounded-xl font-semibold border border-slate-300/60 only-guest" type="button">Sign in</button>
        </div>
        <div class="mt-6 flex items-center gap-3 text-xs text-slate-500 dark:text-slate-400">
          <span class="badge">Multi-channel</span><span class="badge">Article Optimizer</span><span class="badge">Scheduler & Calendar</span><span class="badge">BYOK</span>
        </div>
      </div>

      <div class="relative">
        <div class="orbit" aria-hidden="true"></div>
        <div class="grid gap-4">
          <div class="mock p-4 card">
            <div class="text-xs text-slate-400">Command</div>
            <div class="mt-3 rounded-lg border p-3 bg-white/60 dark:bg-white/5">
              <svg width="100%" height="64" viewBox="0 0 600 64" role="img" aria-label="Generation progress">
                <defs><linearGradient id="lg" x1="0" y="0" x2="1" y="0"><stop offset="0%" stop-color="#7AA2FF"/><stop offset="100%" stop-color="#FF2D2D"/></linearGradient></defs>
                <rect x="12" y="20" width="160" height="24" rx="12" fill="url(#lg)"></rect>
                <rect x="184" y="20" width="120" height="24" rx="12" fill="url(#lg)" opacity=".85"></rect>
                <rect x="316" y="20" width="150" height="24" rx="12" fill="url(#lg)" opacity=".7"></rect>
                <rect x="478" y="20" width="110" height="24" rx="12" fill="url(#lg)" opacity=".55"></rect>
              </svg>
              <pre class="mono text-xs mt-2">repurpose generate --channels linkedin,x,email,instagram,reddit,facebook,quora,tiktok
outline ✓ • platform-native variants ✓ • SEO hints ✓</pre>
            </div>
          </div>

          <div class="grid md:grid-cols-2 gap-4">
            <div class="mock p-4 card"><div class="text-xs text-slate-400">LinkedIn</div>
              <div class="mt-2 h-24 text-sm text-slate-200/90 leading-relaxed">• Hook that earns the scroll<br>• 6–10 crisp lines, one CTA<br>• Optional LinkedIn Article</div></div>
            <div class="mock p-4 card"><div class="text-xs text-slate-400">X (Twitter)</div>
              <div class="mt-2 h-24 text-sm text-slate-200/90 leading-relaxed">Two fast variants or sequence<br>≤ 280 chars<br>Ready to post ✓</div></div>
          </div>
          <div class="grid md:grid-cols-2 gap-4">
            <div class="mock p-4 card"><div class="text-xs text-slate-400">Reddit</div>
              <div class="mt-2 h-20 text-sm text-slate-200/90 leading-relaxed">Best subs + rules & flair tips<br>3 starter comments</div></div>
            <div class="mock p-4 card"><div class="text-xs text-slate-400">TikTok</div>
              <div class="mt-2 h-20 text-sm text-slate-200/90 leading-relaxed">3 hooks + script + on-screen plan</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Live strip -->
    <div class="mt-8 md:mt-10">
      <div class="max-w-7xl mx-auto px-4 md:px-5">
        <div class="card p-4 md:p-5">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
              <strong class="tracking-tight">Generations today</strong><span class="chip" data-live-count>–</span></div>
            <div class="text-xs text-slate-500">Real results update every 30s</div>
          </div>
          <div class="mt-3 overflow-hidden">
            <div class="flex gap-3 whitespace-nowrap text-[13px] will-change-transform" style="animation: scrollx 28s linear infinite" data-live-feed></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- AUTH OVERLAY (email magic link + Google) -->
  <div id="authSheet" class="auth-overlay" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="auth-panel">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">Sign in</h3>
        <button class="btn" id="authClose" type="button" aria-label="Close">Close</button>
      </div>
      <p class="mt-2 text-sm text-slate-300">Enter your email to receive a magic link or continue with Google.</p>
      <input id="authEmail" type="email" inputmode="email" autocomplete="email" placeholder="you@domain.com" class="mt-3 border rounded-lg px-3 py-2 bg-white/10 placeholder-slate-400 w-full">
      <div class="grid grid-cols-2 gap-2 mt-3">
        <button id="authSend" class="btn btn-primary" type="button">Send magic link</button>
        <button id="authGoogle" class="btn" type="button">Continue with Google</button>
      </div>
      <p id="authNote" class="text-xs text-slate-400 mt-2">We’ll never share your email.</p>
    </div>
  </div>

  <!-- ===== GENERATOR ===== -->
  <section id="demo" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="flex items-end justify-between gap-4 mb-6">
        <div>
          <h2 class="text-2xl md:text-3xl font-black tracking-tight">Generator</h2>
          <p class="mt-1 text-slate-500 dark:text-slate-300 text-sm only-guest">
            Guest preview — <span class="font-semibold">5 runs/month</span> (IP-based; no login).
          </p>
          <p class="mt-1 text-slate-500 dark:text-slate-300 text-sm only-authed hidden">
            Signed in — your plan applies: <span class="chip">Free: 5/day</span> •
            <span class="chip">Starter: 10/day</span> • <span class="chip">Creator: 30/day</span> •
            <span class="chip">Business: 80/day</span>.
          </p>
        </div>
        <div class="flex items-center gap-3">
          <a href="#pricing" class="btn">See pricing</a>
          <button class="btn btn-primary js-open-auth only-guest" type="button">Sign in</button>
        </div>
      </div>

      <div class="card p-4 md:p-5 mb-6">
        <div class="flex items-center justify-between flex-wrap gap-3">
          <div class="flex items-center gap-2 text-sm">
            <span class="badge">Heads up</span>
            <span id="planNotice">Guests: 5/month on the generator. Sign in for 5/day + access the Article Optimizer.</span>
          </div>
          <div class="flex items-center gap-2">
            <button id="copyPromoBtn2" class="btn" type="button">Copy 90% OFF code</button>
            <a class="btn btn-primary" href="#pricing">Upgrade</a>
          </div>
        </div>
      </div>

      <div class="card p-5 md:p-6">
        <form id="demoForm" class="grid gap-6" autocomplete="off" novalidate onsubmit="return false;">
          <fieldset>
            <legend class="text-sm font-semibold">Source</legend>
            <div class="mt-2 grid md:grid-cols-3 gap-3">
              <label class="tab flex items-center justify-between">
                <span class="flex items-center gap-2">
                  <input type="radio" name="sourceType" value="paragraph" checked> Paragraph / Notes
                </span>
                <span class="chip">fastest</span>
              </label>
              <label class="tab flex items-center">
                <input type="radio" name="sourceType" value="blog" class="mr-2"> Full Blog (long form)
              </label>
              <label class="tab flex items-center">
                <input type="radio" name="sourceType" value="url" class="mr-2"> URL
              </label>
            </div>
            <div class="mt-3">
              <textarea id="sourceText" class="w-full rounded-xl border p-4 min-h-[140px]" placeholder="Paste your paragraph, full article, or a URL."></textarea>
            </div>
          </fieldset>

          <fieldset>
            <legend class="text-sm font-semibold">Channels to generate</legend>
            <div class="mt-2 grid sm:grid-cols-2 lg:grid-cols-4 gap-2">
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_linkedin" checked> LinkedIn</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_x" checked> X (Twitter)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_email" checked> Email</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_instagram"> Instagram</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_reddit" checked> Reddit</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_facebook"> Facebook</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_quora"> Quora</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_tiktok"> TikTok</label>
            </div>
          </fieldset>

          <div class="grid md:grid-cols-2 gap-6">
            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">LinkedIn</legend>
              <label class="flex items-center gap-2 mt-2">
                <input type="checkbox" name="li_article"> Also generate a LinkedIn Article
              </label>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">X (Twitter)</legend>
              <div class="mt-2 flex items-center gap-3">
                <label class="flex items-center gap-2"><input type="checkbox" name="x_sequence" checked> Output as sequence</label>
                <label class="flex items-center gap-2">Max posts:
                  <select name="x_posts" class="border rounded-lg px-2 py-1">
                    <option>2</option><option selected>4</option><option>6</option>
                  </select>
                </label>
              </div>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">Reddit</legend>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="rdt_communities" checked> Suggest best communities (rules & flair)</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="rdt_comments" checked> Include 3 starter comment angles</label>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">TikTok</legend>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="tt_hooks" checked> Provide 3 hook variants</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="tt_onscreen" checked> Include on-screen text plan</label>
            </fieldset>
          </div>

          <details>
            <summary class="text-sm font-semibold cursor-pointer">Article Optimizer (optional)</summary>
            <div class="mt-3 grid sm:grid-cols-2 lg:grid-cols-3 gap-2">
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_humanize" checked> Humanize content</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_lengthen" value="30"> Lengthen ~30%</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_faqs"> Add FAQs (+ JSON-LD)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_headings" checked> Auto-headings (H2/H3)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_meta" checked> Improve title & meta (CTR)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_ab" checked> A/B test 5 titles</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_seo" checked> SEO check (alt/links/length)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_svg"> Add platform-fit SVG ideas</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_reddit"> Reddit-ready (title + TL;DR)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_li_article"> LinkedIn Article HTML</label>
            </div>
            <div class="mt-3 grid md:grid-cols-3 gap-3">
              <label class="grid gap-1"><span class="text-xs text-slate-500">Focus keyword</span>
                <input name="seo_keyword" class="border rounded-lg px-3 py-2" placeholder="e.g. content repurposing for SEO" /></label>
              <label class="grid gap-1"><span class="text-xs text-slate-500">Secondary keywords (comma-sep)</span>
                <input name="seo_secondaries" class="border rounded-lg px-3 py-2" placeholder="repurposing workflow, repurpose project" /></label>
              <label class="grid gap-1"><span class="text-xs text-slate-500">Target SERP intent</span>
                <select name="seo_intent" class="border rounded-lg px-3 py-2">
                  <option value="informational" selected>Informational</option>
                  <option value="commercial">Commercial</option>
                  <option value="transactional">Transactional</option>
                  <option value="navigational">Navigational</option>
                </select></label>
            </div>
          </details>

          <div class="grid lg:grid-cols-3 gap-6">
            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">Presets</legend>
              <div class="mt-2 grid gap-2">
                <select id="presetSelect" class="border rounded-lg px-3 py-2">
                  <option value="">— Select preset —</option>
                </select>
                <input id="presetName" class="border rounded-lg px-3 py-2" placeholder="Name new preset" />
                <div class="flex gap-2 flex-wrap">
                  <button type="button" id="presetSave" class="btn">Save</button>
                  <button type="button" id="presetLoad" class="btn">Load</button>
                  <button type="button" id="presetLoadAndRun" class="btn">Apply & Generate</button>
                  <button type="button" id="presetDelete" class="btn">Delete</button>
                </div>
                <p class="text-xs text-slate-500">
                  Free: 1 preset • Starter/Creator/Business: unlimited.
                </p>
              </div>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">Batch inputs</legend>
              <div class="mt-2 grid gap-2">
                <label class="flex items-center gap-2">
                  <input id="batchEnable" type="checkbox"> Enable
                </label>
                <textarea id="batchList" class="w-full rounded-xl border p-3 min-h-[110px]" placeholder="One idea per line…"></textarea>
                <p class="text-xs text-slate-500">
                  Free: — • Starter: up to 10/run • Creator: 30/run • Business: 60/run.
                </p>
              </div>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">Use my OpenRouter key (BYOK)</legend>
              <p class="text-xs text-slate-500">
                Use your own model key (ChatGPT, Claude, Gemini, etc via OpenRouter). Saves cost & unlocks private generations.
              </p>
              <div class="mt-2 grid gap-2">
                <label class="grid gap-1">
                  <span class="text-xs text-slate-500">API key</span>
                  <input id="byokKey" class="border rounded-lg px-3 py-2" placeholder="sk-or-v1-..." />
                </label>
                <label class="grid gap-1">
                  <span class="text-xs text-slate-500">Preferred model (optional)</span>
                  <input id="byokModel" class="border rounded-lg px-3 py-2" placeholder="e.g. openai/gpt-4o, anthropic/claude-3.5-sonnet" />
                </label>
                <div class="flex items-center gap-2">
                  <button id="byokSave" type="button" class="btn">Save BYOK</button>
                  <button id="byokClear" type="button" class="btn">Clear</button>
                </div>
                <p id="byokStatus" class="text-xs text-slate-500">Status: not set</p>
              </div>
            </fieldset>
          </div>

          <div class="flex flex-wrap items-center gap-3">
            <button id="generateBtn" type="submit" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90 only-guest">Generate (demo)</button>
            <button id="generateBtn_member" type="submit" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90 only-authed hidden">Generate</button>
            <button type="button" id="clearBtn" class="px-4 py-3 rounded-xl font-semibold border">Clear</button>
            <div class="text-sm text-slate-500 only-guest">You have <span id="demoQuota">—</span> runs left this month.</div>
            <div class="text-sm text-slate-500 only-authed hidden">You have <span id="memberQuota">—</span> runs left today.</div>
            <a href="#pricing" class="text-sm underline hover:opacity-80 ml-auto">Need more? See plans</a>
          </div>
        </form>
      </div>

      <div id="demoOutput" class="mt-8 grid gap-6" aria-live="polite" aria-busy="false"></div>

      <div class="mt-10 card p-5">
        <div class="flex items-center justify-between flex-wrap gap-3">
          <strong class="tracking-tight">Publish / Export</strong>
          <div class="text-xs text-slate-500">Uses outputs from your last generation.</div>
        </div>
        <div class="mt-4 grid sm:grid-cols-2 lg:grid-cols-4 gap-3">
          <button id="qp-x" class="btn" type="button">Post to X</button>
          <button id="qp-reddit" class="btn" type="button">Open Reddit submit</button>
          <button id="qp-linkedin" class="btn" type="button">Copy for LinkedIn & open</button>
          <button id="qp-email" class="btn" type="button">Send email draft</button>
        </div>
        <div class="mt-4 grid sm:grid-cols-2 gap-3">
          <button id="li-notion" class="btn plan-creator-plus" type="button">Export to Notion</button>
          <button id="li-trello" class="btn plan-creator-plus" type="button">Send to Trello</button>
        </div>
        <p class="mt-2 text-xs text-slate-500">Free: 1 publish/day • Starter: 5/day • Creator/Business: unlimited.</p>
      </div>
    </div>
  </section>
  <!-- ===== ARTICLE OPTIMIZER ===== -->
  <section id="optimizer" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="flex items-end justify-between gap-4 mb-6">
        <div>
          <h2 class="text-2xl md:text-3xl font-black tracking-tight">Article Optimizer</h2>
          <p class="mt-1 text-slate-500 dark:text-slate-300 text-sm">
            Paste <strong>HTML or Markdown</strong>. We’ll return an improved article + SEO assets.
          </p>
          <p class="mt-1 text-amber-600 dark:text-amber-400 text-sm only-guest">
            You must <strong>sign in</strong> to use the Article Optimizer (Free: 1/day).
          </p>
          <p class="mt-1 text-slate-500 dark:text-slate-300 text-xs only-authed hidden">
            Free: 1/day • Starter: 5/day • Creator: 15/day • Business: 30/day.
          </p>
        </div>
        <div class="flex items-center gap-3">
          <a href="#pricing" class="btn">See pricing</a>
          <button class="btn btn-primary js-open-auth only-guest" type="button">Sign in</button>
        </div>
      </div>

      <div class="card p-5 md:p-6">
        <form id="optForm" class="grid gap-6" autocomplete="off" novalidate onsubmit="return false;">
          <label class="grid gap-1">
            <span class="text-sm font-semibold">Paste HTML or Markdown</span>
            <textarea id="optSource" class="w-full rounded-xl border p-4 min-h-[180px]" placeholder="Paste HTML or Markdown here..."></textarea>
          </label>

          <div class="grid md:grid-cols-3 gap-4">
            <fieldset class="grid gap-2">
              <legend class="text-sm font-semibold">Transform</legend>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_humanize" checked> Humanize content</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_lengthen" value="30"> Lengthen ~30%</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_headings" checked> Auto-headings (H2/H3)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_svg"> Add platform-fit SVG ideas</label>
            </fieldset>
            <fieldset class="grid gap-2">
              <legend class="text-sm font-semibold">SEO</legend>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_meta" checked> Improve title & meta (CTR)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_ab" checked> A/B test 5 titles</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_seo" checked> SEO check (alt/links/length)</label>
              <label class="grid gap-1 mt-1">
                <span class="text-xs text-slate-500">Focus keyword</span>
                <input name="seo_keyword" class="border rounded-lg px-3 py-2" placeholder="e.g. content repurposing for SEO" />
              </label>
              <label class="grid gap-1">
                <span class="text-xs text-slate-500">Secondary keywords (comma-sep)</span>
                <input name="seo_secondaries" class="border rounded-lg px-3 py-2" placeholder="repurpose workflow, content refresh" />
              </label>
              <label class="grid gap-1">
                <span class="text-xs text-slate-500">Target SERP intent</span>
                <select name="seo_intent" class="border rounded-lg px-3 py-2">
                  <option value="informational" selected>Informational</option>
                  <option value="commercial">Commercial</option>
                  <option value="transactional">Transactional</option>
                  <option value="navigational">Navigational</option>
                </select>
              </label>
            </fieldset>
            <fieldset class="grid gap-2">
              <legend class="text-sm font-semibold">Extras</legend>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_faqs" checked> Add FAQs (+ JSON-LD)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_reddit" checked> Reddit-ready (title + TL;DR)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_li_article"> LinkedIn Article HTML</label>
            </fieldset>
          </div>

          <div class="flex items-center gap-3">
            <button id="optRun" class="btn btn-primary" type="submit">Optimize</button>
            <button id="optClear" class="btn" type="button">Clear</button>
            <div class="text-sm text-slate-500 only-authed hidden">Optimizer uses your plan’s daily cap.</div>
          </div>
        </form>
      </div>

      <div id="optOutput" class="mt-8 grid gap-6" aria-live="polite" aria-busy="false"></div>
    </div>
  </section>

  <!-- ===== INTEGRATIONS ===== -->
  <section id="integrations" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <h2 class="text-2xl md:text-3xl font-black tracking-tight">Integrations</h2>
      <p class="mt-1 text-slate-500 dark:text-slate-300 text-sm">Connect once, then export/publish drafts instantly.</p>

      <div class="grid md:grid-cols-2 gap-6 mt-6">
        <div class="card p-5">
          <div class="flex items-center justify-between">
            <strong>Notion</strong>
            <div class="flex gap-2">
              <span id="notionStatus" class="chip">status: —</span>
              <button id="connectNotion" class="btn" type="button">Connect</button>
              <button id="disconnectNotion" class="btn" type="button">Disconnect</button>
            </div>
          </div>
          <p class="mt-2 text-sm text-slate-500">Export LinkedIn Articles and posts directly to your Notion workspace.</p>
        </div>

        <div class="card p-5">
          <div class="flex items-center justify-between">
            <strong>Trello</strong>
            <div class="flex gap-2">
              <span id="trelloStatus" class="chip">status: —</span>
              <button id="connectTrello" class="btn" type="button">Connect</button>
              <button id="disconnectTrello" class="btn" type="button">Disconnect</button>
            </div>
          </div>
          <p class="mt-2 text-sm text-slate-500">Send drafts to a Trello list. We’ll create a default board/list if needed.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== CALENDAR ===== -->
  <section id="calendar" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <h2 class="text-2xl md:text-3xl font-black tracking-tight">Calendar & Scheduler</h2>
      <p class="mt-1 text-slate-500 dark:text-slate-300 text-sm">
        Free: read-only preview • Starter/Creator: personal calendar • Business: shared team calendar & seats (3).
      </p>

      <div class="card p-5 md:p-6 mt-4">
        <div class="flex items-center justify-between flex-wrap gap-3">
          <div class="flex items-center gap-2">
            <span class="chip">View</span>
            <select id="calView" class="border rounded-lg px-2 py-1">
              <option value="week">Week</option>
              <option value="month" selected>Month</option>
              <option value="agenda">Agenda</option>
            </select>
          </div>
          <div class="flex items-center gap-2">
            <button id="calPrev" class="btn" type="button">‹</button>
            <button id="calToday" class="btn" type="button">Today</button>
            <button id="calNext" class="btn" type="button">›</button>
          </div>
          <div class="flex items-center gap-2">
            <button id="calNew" class="btn plan-starter-plus" type="button">New scheduled post</button>
          </div>
        </div>
        <div id="calGrid" class="mt-4 min-h-[360px] rounded-xl border p-3 grid gap-2 text-slate-300">
          (Calendar view loads here)
        </div>
      </div>
    </div>
  </section>

  <!-- Schedule modal -->
  <dialog id="scheduleDlg" class="rounded-xl p-0 w-[92vw] max-w-md" aria-labelledby="scheduleTitle" aria-modal="true">
    <form id="scheduleForm" method="dialog" class="p-5 grid gap-4" novalidate onsubmit="return false;">
      <div class="flex items-center justify-between">
        <h3 id="scheduleTitle" class="text-lg font-semibold">Schedule post</h3>
        <button class="btn" value="cancel" type="button" id="schClose" aria-label="Close">Close</button>
      </div>

      <label class="grid gap-1">
        <span class="text-sm text-slate-500">Channel</span>
        <select id="schChannel" class="border rounded-lg px-3 py-2">
          <option value="linkedin">LinkedIn</option>
          <option value="x">X (Twitter)</option>
          <option value="email">Email</option>
          <option value="instagram">Instagram</option>
          <option value="reddit">Reddit</option>
          <option value="facebook">Facebook</option>
          <option value="quora">Quora</option>
          <option value="tiktok">TikTok</option>
        </select>
      </label>

      <label class="grid gap-1">
        <span class="text-sm text-slate-500">When</span>
        <input id="schWhen" type="datetime-local" class="border rounded-lg px-3 py-2" required />
      </label>

      <label class="grid gap-1">
        <span class="text-sm text-slate-500">Content</span>
        <textarea id="schText" class="border rounded-lg px-3 py-2 min-h-[120px]" placeholder="Your post…" required></textarea>
      </label>

      <div class="flex items-center justify-between gap-2">
        <div class="text-xs text-slate-500">You’ll get a popup reminder at the scheduled time.</div>
        <div class="flex items-center gap-2">
          <button class="btn" type="button" id="schCancel">Cancel</button>
          <button class="btn btn-primary" id="schSubmit" type="submit">Schedule</button>
        </div>
      </div>
    </form>
  </dialog>

  <!-- ===== SEO: FAQs for Guest View ===== -->
  <section id="faqs" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="card p-6 md:p-8">
        <h2 class="text-2xl md:text-3xl font-black tracking-tight">Content Repurposing FAQs</h2>
        <p class="mt-2 text-slate-500 dark:text-slate-300">Answers for people searching for “content repurpose”, “repurposing content”, “social media generator”, and “AI content creation tool”.</p>

        <div class="mt-6 grid md:grid-cols-2 gap-6">
          <div>
            <h3 class="font-semibold">What is content repurposing?</h3>
            <p class="text-sm text-slate-500 dark:text-slate-300 mt-1">It’s the process of turning one asset (like a blog post or notes) into multiple platform-native pieces: LinkedIn, X, Email, Instagram, Reddit, Facebook, Quora, and TikTok. Our AI generator keeps voice and intent while optimizing length, hooks, hashtags, and CTAs.</p>
          </div>
          <div>
            <h3 class="font-semibold">How is this different from a generic AI generator?</h3>
            <p class="text-sm text-slate-500 dark:text-slate-300 mt-1">We are a focused <em>content repurpose tool</em>—not a chat box. You paste once, choose channels, and get platform-ready drafts + an optional LinkedIn Article. Presets, batch mode, scheduler, calendar, Notion/Trello export, and BYOK make it production-ready.</p>
          </div>
          <div>
            <h3 class="font-semibold">Will this help SEO?</h3>
            <p class="text-sm text-slate-500 dark:text-slate-300 mt-1">Yes. The Article Optimizer adds headings, title/meta, FAQs (JSON-LD), alt text hints, and A/B titles to improve click-through and on-page structure for your target keywords.</p>
          </div>
          <div>
            <h3 class="font-semibold">Do I need to sign in?</h3>
            <p class="text-sm text-slate-500 dark:text-slate-300 mt-1">Guest preview is <strong>5 runs/month</strong> (IP-based). Sign in to unlock <strong>5/day</strong>, the Article Optimizer, saved presets, and higher caps on paid plans.</p>
          </div>
        </div>

        <div class="mt-8">
          <h3 class="font-semibold">Recommended reads</h3>
          <ul class="list-disc pl-6 text-sm mt-2 space-y-1">
            <li><a class="underline" href="https://contentrepurpose.pro/blog/ai-social-media-post-generator/">AI Social Media Post Generator</a></li>
            <li><a class="underline" href="https://contentrepurpose.pro/blog/content-repurposing-for-seo/">Content Repurposing for SEO</a></li>
            <li><a class="underline" href="https://contentrepurpose.pro/blog/linkedin-post-templates/">LinkedIn Post Templates</a></li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== PRICING ===== -->
  <section id="pricing" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <h2 class="text-2xl md:text-3xl font-black tracking-tight">Pricing</h2>
      <p class="mt-1 text-slate-500 dark:text-slate-300 text-sm">Start free. Upgrade for batch, scheduler & calendar, unlimited presets, and higher daily caps.</p>

      <div class="grid lg:grid-cols-4 gap-6 mt-6">
        <!-- Free -->
        <div class="card p-5 flex flex-col">
          <div class="flex items-center justify-between">
            <strong class="text-lg">Free</strong>
            <span class="chip">No credit card</span>
          </div>
          <div class="mt-2 text-3xl font-black">$0 <span class="text-sm font-semibold text-slate-500">/ forever</span></div>
          <ul class="mt-4 text-sm space-y-2">
            <li>• Generator: <strong>5 runs / day</strong> (signed-in)</li>
            <li>• Guest preview: <strong>5 / month</strong> (no login)</li>
            <li>• Article Optimizer: <strong>1 / day</strong> (signed-in)</li>
            <li>• Presets: <strong>1 saved preset</strong></li>
            <li>• Notion/Trello publish: <strong>1 / day</strong></li>
            <li>• Scheduler: <strong>visible (upgrade to use)</strong></li>
            <li>• Calendar: <strong>read-only</strong></li>
            <li>• BYOK supported (5/day)</li>
          </ul>
          <button class="btn btn-primary mt-5 js-open-auth only-guest" type="button">Start free</button>
          <a href="#demo" class="btn mt-2 only-authed hidden">Use Generator</a>
        </div>

        <!-- Starter -->
        <div class="card p-5 flex flex-col border-2 border-emerald-300/40">
          <div class="flex items-center justify-between">
            <strong class="text-lg">Starter</strong>
            <span class="badge">Most popular</span>
          </div>
          <div class="mt-2 text-3xl font-black">$9 <span class="text-sm font-semibold text-slate-500">/ month</span></div>
          <ul class="mt-4 text-sm space-y-2">
            <li>• Generator: <strong>10 runs / day</strong></li>
            <li>• Article Optimizer: <strong>5 / day</strong></li>
            <li>• Presets: <strong>unlimited</strong></li>
            <li>• Batch: <strong>up to 10 items / run</strong></li>
            <li>• Notion/Trello publish: <strong>5 / day</strong></li>
            <li>• Scheduler: <strong>enabled</strong></li>
            <li>• Calendar: <strong>personal calendar</strong></li>
          </ul>
          <button class="btn btn-primary mt-5 js-checkout" data-plan="starter" type="button">Choose Starter</button>
        </div>

        <!-- Creator -->
        <div class="card p-5 flex flex-col">
          <div class="flex items-center justify-between">
            <strong class="text-lg">Creator</strong>
            <span class="chip">Power users</span>
          </div>
          <div class="mt-2 text-3xl font-black">$19 <span class="text-sm font-semibold text-slate-500">/ month</span></div>
          <ul class="mt-4 text-sm space-y-2">
            <li>• Generator: <strong>30 runs / day</strong></li>
            <li>• Article Optimizer: <strong>15 / day</strong></li>
            <li>• Presets: <strong>unlimited</strong></li>
            <li>• Batch: <strong>up to 30 items / run</strong></li>
            <li>• Notion/Trello publish: <strong>unlimited</strong></li>
            <li>• Scheduler: <strong>enabled</strong></li>
            <li>• Calendar: <strong>personal calendar</strong></li>
            <li>• Priority platform pool</li>
          </ul>
          <button class="btn btn-primary mt-5 js-checkout" data-plan="creator" type="button">Choose Creator</button>
        </div>

        <!-- Business -->
        <div class="card p-5 flex flex-col">
          <div class="flex items-center justify-between">
            <strong class="text-lg">Business</strong>
            <span class="chip">Team</span>
          </div>
          <div class="mt-2 text-3xl font-black">$49 <span class="text-sm font-semibold text-slate-500">/ month</span></div>
          <ul class="mt-4 text-sm space-y-2">
            <li>• Generator: <strong>80 runs / day</strong></li>
            <li>• Article Optimizer: <strong>30 / day</strong></li>
            <li>• Presets & Batch: <strong>unlimited</strong> (batch up to 60/run)</li>
            <li>• Notion/Trello publish: <strong>unlimited</strong></li>
            <li>• Shared Scheduler & Calendar for team</li>
            <li>• Invite up to <strong>3 seats</strong></li>
            <li>• Priority support & higher pool</li>
            <li>• BYOK caps increased</li>
          </ul>
          <button class="btn btn-primary mt-5 js-checkout" data-plan="business" type="button">Choose Business</button>
        </div>
      </div>
    </div>
  </section>

  <footer class="mt-20 border-t">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-10 text-sm flex flex-wrap items-center justify-between gap-3">
      <div class="opacity-80">© <span id="year">2025</span> ContentRepurpose.pro</div>
      <nav class="flex flex-wrap items-center gap-4 opacity-80">
        <a href="#pricing" class="hover:opacity-100">Pricing</a>
        <a href="#integrations" class="hover:opacity-100">Integrations</a>
        <a href="https://contentrepurpose.pro/blog/" class="hover:opacity-100">Blog</a>
        <a href="https://contentrepurpose.pro/terms" class="hover:opacity-100">Terms</a>
        <a href="https://contentrepurpose.pro/privacy" class="hover:opacity-100">Privacy</a>
        <a href="mailto:hello@contentrepurpose.pro" class="hover:opacity-100">Contact</a>
      </nav>
    </div>
  </footer>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 hidden">
    <div class="px-4 py-2 rounded-lg bg-black text-white text-sm shadow">
      <span id="toastMsg">…</span>
    </div>
  </div>
  <!-- ===== APP BOOT (auth overlay fixed + non-refresh submits) ===== -->
  <script>
  (function(){
  const byId = (id)=> document.getElementById(id);
   const $  = (s, el)=> (el && typeof el.querySelector==="function" ? el.querySelector(s) : document.querySelector(s));
   const $$ = (s, el)=> (el && typeof el.querySelectorAll==="function" ? Array.from(el.querySelectorAll(s)) : Array.from(document.querySelectorAll(s)));

    const toast=(msg)=>{const t=byId("toast"),m=byId("toastMsg"); if(!t||!m){alert(msg);return;} m.textContent=msg; t.classList.remove("hidden"); setTimeout(()=>t.classList.add("hidden"),2000);};
    const cap=(s)=> (s||"").slice(0,1).toUpperCase()+(s||"").slice(1);

    const WORKER_BASE = window.WORKER_BASE || "https://contentflow-worker.frank-couchman.workers.dev";
    const SITE_ORIGIN = window.SITE_ORIGIN || location.origin;

    // Supabase client (UMD already loaded in <head>)
    const SUPABASE_URL  = "https://ynkoavaeadlzlwylmfmu.supabase.co";
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlua29hdmFlYWRsemx3eWxtZm11Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5OTAxNDgsImV4cCI6MjA3MzU2NjE0OH0.1yM5yDo0MI9Upzt4GkLyf1mqvDXfb3DXvC0ouOLtRoU";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON, { auth:{ persistSession:true, autoRefreshToken:true, detectSessionInUrl:true }});

    let AUTHTED=false, CURRENT_PLAN="free";

    /* ---------- auth overlay (never uses <dialog>, mobile safe) ---------- */
    const authSheet = byId("authSheet");
    const openAuth = ()=>{ if(authSheet){ authSheet.setAttribute("aria-hidden","false"); byId("authEmail")?.focus(); } };
    const closeAuth= ()=>{ if(authSheet){ authSheet.setAttribute("aria-hidden","true"); } };

    ["loginBtn","loginBtn_m","heroSignIn"].forEach(id=> byId(id)?.addEventListener("click", openAuth));
    $$(".js-open-auth").forEach(b=> b.addEventListener("click", openAuth));
    byId("authClose")?.addEventListener("click", closeAuth);
    authSheet?.addEventListener("click",(e)=>{ if(e.target===authSheet) closeAuth(); });

    // Auth actions
    byId("authGoogle")?.addEventListener("click", async ()=>{
      try{ await supabase.auth.signInWithOAuth({ provider:"google", options:{ redirectTo: SITE_ORIGIN }}); }
      catch(e){ toast(e?.message||"Google sign-in failed"); }
    });
    byId("authSend")?.addEventListener("click", async ()=>{
      const email=(byId("authEmail")?.value||"").trim(); if(!email) return toast("Enter your email");
      try{
        const { error } = await supabase.auth.signInWithOtp({ email, options:{ emailRedirectTo: SITE_ORIGIN } });
        if(error) throw error; toast("Check your email for the magic link.");
      }catch(e){ toast(e?.message||"Sign-in error"); }
    });
    ["logoutBtn","logoutBtn_m"].forEach(id=> byId(id)?.addEventListener("click", async ()=>{
      try{ await supabase.auth.signOut(); toast("Signed out"); setAuthFlag(false); setPlan("free"); }catch{}
    }));

    // Finish OAuth params & clean URL
    (async function finalizeOAuth(){
      try{
        const u=new URL(location.href);
        if(u.searchParams.get("code")){
          await supabase.auth.exchangeCodeForSession({ code: u.searchParams.get("code") });
          ["code","state","scope","provider_id","redirected_from"].forEach(k=>u.searchParams.delete(k));
          history.replaceState({}, "", u.toString());
        }
        if(location.hash && (/#access_token=|#token=/.test(location.hash))){
          await supabase.auth.getSession();
          history.replaceState({}, "", location.pathname + location.search);
        }
      }catch(e){ console.warn("OAuth finalize failed", e); }
    })();

    // Mobile nav
    (function wireNav(){
      const toggle=byId("navToggle"), sheet=byId("mobileNav"), close=byId("navClose");
      toggle?.addEventListener("click", ()=>{ document.body.classList.add("nav-open"); toggle.setAttribute("aria-expanded","true"); sheet?.setAttribute("aria-hidden","false"); });
      close?.addEventListener("click", ()=>{ document.body.classList.remove("nav-open"); toggle.setAttribute("aria-expanded","false"); sheet?.setAttribute("aria-hidden","true"); });
      sheet?.addEventListener("click",(e)=>{ if(e.target===sheet){ document.body.classList.remove("nav-open"); toggle?.setAttribute("aria-expanded","false"); sheet.setAttribute("aria-hidden","true"); } });
      $$('a[href^="#"]').forEach(a=> a.addEventListener("click",(e)=>{ const id=a.getAttribute("href"); const el=$(id); if(el){ e.preventDefault(); el.scrollIntoView({behavior:"smooth", block:"start"}); history.replaceState(null,"",id); document.body.classList.remove("nav-open"); sheet?.setAttribute("aria-hidden","true"); } }));
    })();

    // UI state helpers
    function setAuthFlag(on){
      AUTHTED=!!on;
      document.body.setAttribute("data-auth", on? "authed":"guest");
      $$(".only-guest").forEach(el=> el.classList.toggle("hidden", !!on));
      $$(".only-authed").forEach(el=> el.classList.toggle("hidden", !on));
    }
    function setPlan(plan){
      const p=(plan||"free").toLowerCase();
      CURRENT_PLAN=p; document.body.setAttribute("data-plan", p);
      const label=`Plan: ${cap(p)}`;
      byId("planbadge")&&(byId("planbadge").textContent=label);
      byId("planbadge_m")&&(byId("planbadge_m").textContent=label);
      byId("heroPlanName")&&(byId("heroPlanName").textContent=cap(p));
      const rank={free:0, starter:1, creator:2, business:3}[p]??0;
      $$(".plan-starter-plus").forEach(el=> el.classList.toggle("hidden", rank<1));
      $$(".plan-creator-plus").forEach(el=> el.classList.toggle("hidden", rank<2));
      $$(".plan-business-only").forEach(el=> el.classList.toggle("hidden", rank<3));
    }

    async function getAuthHeaders(extra={}){
      const h={ "Content-Type":"application/json", ...extra };
      try{
        const { data } = await supabase.auth.getSession();
        const tok = data?.session?.access_token;
        const uid = data?.session?.user?.id;
        if(tok) h["Authorization"]=`Bearer ${tok}`;
        if(uid) h["X-User-Id"] = uid;
      }catch{}
      return h;
    }

    // Status & quotas
    async function fetchStatus(){
      try{
        const r=await fetch(`${WORKER_BASE}/api/billing/status`, { headers: await getAuthHeaders() });
        const j=await r.json();
        const authed=j.scope==="user";
        setAuthFlag(authed);
        setPlan((j.plan||"free").toLowerCase());

        // quotas
        const memEl=byId("memberQuota"), demoEl=byId("demoQuota");
        if(authed){
          const cap=j.platform?.daily?.cap, used=j.platform?.daily?.used||0;
          if(memEl) memEl.textContent = (cap==null? "∞" : Math.max(0,(cap-used)));
        }else{
          if(demoEl && j.platform?.monthly){
            const cap=j.platform.monthly.cap ?? 5;
            const used=j.platform.monthly.used || 0;
            demoEl.textContent = String(Math.max(0, cap-used));
          }
        }

        // integration badges
        byId("notionStatus")&&(byId("notionStatus").textContent = `status: ${j.integrations?.notion? "connected":"—"}`);
        byId("trelloStatus")&&(byId("trelloStatus").textContent = `status: ${j.integrations?.trello? "connected":"—"}`);
      }catch(e){ console.warn("status fail", e); setAuthFlag(false); setPlan("free"); }
    }

    // Promo buttons
    ["copyPromoBtn","copyPromoBtn2"].forEach(id=> byId(id)?.addEventListener("click", async ()=>{
      try{ await navigator.clipboard.writeText("CONTENTOFF90"); toast("Code copied ✅"); }catch{ toast("Copy failed"); }
    }));

    // Billing buttons
    $$(".js-checkout").forEach(btn=>{
      btn.addEventListener("click", async ()=>{
        const plan=btn.getAttribute("data-plan")||"starter";
        const MAP={ starter:window.PRICE_IDS?.starter, creator:window.PRICE_IDS?.creator, business:window.PRICE_IDS?.business };
        const priceId=MAP[plan]; if(!priceId) return toast("Missing price id");
        const old=btn.textContent; btn.disabled=true; btn.textContent="Redirecting…";
        try{
          const r=await fetch(`${WORKER_BASE}/api/billing/checkout`,{
            method:"POST",
            headers: await getAuthHeaders(),
            body: JSON.stringify({
              price_id: priceId,
              mode: "subscription",
              success_url: location.origin + location.pathname + "?billing=success",
              cancel_url: location.origin + location.pathname + "?billing=cancel"
            })
          });
          const j=await r.json();
          if(!r.ok || !j?.url) throw new Error(j?.error?.message||"Checkout failed");
          location.href=j.url;
        }catch(e){ toast(e.message||"Checkout error"); btn.disabled=false; btn.textContent=old; }
      });
    });
    ["manageBilling","manageBilling_m"].forEach(id=>{
      const b=byId(id); if(!b) return;
      b.addEventListener("click", async ()=>{
        const old=b.textContent; b.disabled=true; b.textContent="Opening…";
        try{
          const r=await fetch(`${WORKER_BASE}/api/billing/portal`,{ method:"POST", headers: await getAuthHeaders(), body: JSON.stringify({ return_url: location.href }) });
          const j=await r.json(); if(!r.ok || !j?.url) throw new Error(j?.error?.message||"Portal error");
          location.href=j.url;
        }catch(e){ toast(e.message||"Portal error"); b.disabled=false; b.textContent=old; }
      });
    });

    // Live ticker
    async function paintLive(){
      try{
        const r=await fetch(`${WORKER_BASE}/api/stats/today`);
        const j=await r.json();
        if(typeof j.today_count==="number"){ $$('[data-live-count]').forEach(el=> el.textContent=String(j.today_count)); }
      }catch{}
    }

    // Generator wiring
    function readToggles(form){
      const g=(n)=> form.elements[n];
      return {
        ch:{ linkedin:g("ch_linkedin")?.checked, x:g("ch_x")?.checked, email:g("ch_email")?.checked, instagram:g("ch_instagram")?.checked, reddit:g("ch_reddit")?.checked, facebook:g("ch_facebook")?.checked, quora:g("ch_quora")?.checked, tiktok:g("ch_tiktok")?.checked },
        extras:{ li_article:g("li_article")?.checked, x_sequence:g("x_sequence")?.checked, x_posts:g("x_posts")?.value||"4", rdt_communities:g("rdt_communities")?.checked, rdt_comments:g("rdt_comments")?.checked, tt_hooks:g("tt_hooks")?.checked, tt_onscreen:g("tt_onscreen")?.checked },
        opt:{ humanize:g("opt_humanize")?.checked, lengthen:g("opt_lengthen")?.checked, faqs:g("opt_faqs")?.checked, headings:g("opt_headings")?.checked, svg:g("opt_svg")?.checked, seo:g("opt_seo")?.checked, meta:g("opt_meta")?.checked, ab:g("opt_ab")?.checked, reddit:g("opt_reddit")?.checked, li_article:g("opt_li_article")?.checked }
      };
    }
    const parseJsonLoose=(txt)=>{ if(!txt) return null; let s=String(txt).trim(); s=s.replace(/^```(?:json)?/i,"").replace(/```$/,"").trim(); const a=s.indexOf("{"), b=s.lastIndexOf("}"); if(a>=0&&b>a) s=s.slice(a,b+1); try{ return JSON.parse(s);}catch{} s=s.replace(/,\s*([}\]])/g,"$1"); try{ return JSON.parse(s);}catch{} return null; };
    function systemPrompt(t){ return { role:"system", content:
`You are a senior social copywriter.
Return ONLY JSON:
{ "outline":string,
  "linkedin":string|null,
  "x":string[]|null,
  "email":{ "subject":string, "body":string }|null,
  "instagram":{ "caption":string, "hashtags":string[] }|null,
  "reddit":{ "title":string, "body":string, "communities":string[], "starter_comments":string[] }|null,
  "facebook":{ "primary":string, "meta":{ "headline":string, "description":string } }|null,
  "quora":{ "answer":string, "followups":string[] }|null,
  "tiktok":{ "hooks":string[], "script":string, "onscreen":string[] }|null,
  "linkedin_article_html":string|null }
X posts ≤ 280 chars; if multiple, prefix "Post N:".
No text outside JSON.` }; }
    function userPrompt(raw, form, t){
      const srcType=form.elements["sourceType"]?.value||"paragraph";
      const head = srcType==="url"?"URL":(srcType==="blog"?"Full Blog":"Paragraph/Notes");
      const channels = Object.entries(t.ch).filter(([,v])=>v).map(([k])=>k).join(", ");
      return { role:"user", content:
`${head}:
${raw}

Task:
1) One-line outline.
2) Generate ONLY for: ${channels||"linkedin,x,email"}.
3) Respect toggles exactly.`};
    }

    // FIXED: proper template literal interpolation (no backslashes)
    function addCard(wrap, title, bodyText){
      const id=`c_${Math.random().toString(36).slice(2,8)}`;
      wrap.insertAdjacentHTML("beforeend", `
        <div class="card p-5" id="${id}">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight">${title}</strong>
            <div class="flex gap-2">
              <button class="btn copy" type="button">Copy</button>
            </div>
          </div>
          <pre class="whitespace-pre-wrap text-sm mt-3 content">${bodyText}</pre>
        </div>`);
      const card=byId(id), copyBtn=$(".btn.copy", card), pre=$("pre.content", card);
      copyBtn?.addEventListener("click", async ()=>{ try{ await navigator.clipboard.writeText(pre?.innerText||""); toast("Copied ✅"); }catch{ toast("Copy failed"); } });
    }

    function paintOutput(j){
      const wrap=byId("demoOutput"); wrap.innerHTML="";
      if(j.linkedin) addCard(wrap,"LinkedIn",j.linkedin);
      if(Array.isArray(j.x)&&j.x.length){ addCard(wrap,"X (Twitter)", j.x.map((t,i)=>`Post ${i+1}: ${t}`).join("\n\n")); }
      if(j.email){ addCard(wrap,"Email",`Subject: ${j.email.subject||""}\n\n${j.email.body||""}`); }
      if(j.instagram){ addCard(wrap,"Instagram",`${j.instagram.caption||""}\n\n${(j.instagram.hashtags||[]).map(h=>h.startsWith("#")?h:"#"+h).join(" ")}`); }
      if(j.reddit){
        const subs=(j.reddit.communities||[]).map(s=>`r/${s}`).join(", ");
        const starters=(j.reddit.starter_comments||[]).map(c=>`• ${c}`).join("\n");
        addCard(wrap,"Reddit",`${j.reddit.title||""}\n\n${j.reddit.body||""}\n\nSubs: ${subs||"—"}\n\nStarters:\n${starters||"—"}`);
      }
      if(j.facebook){ addCard(wrap,"Facebook",`Primary:\n${j.facebook.primary||""}\n\nLink preview:\n${j.facebook?.meta?.headline||""}\n${j.facebook?.meta?.description||""}`); }
      if(j.quora){ addCard(wrap,"Quora",`Answer:\n${j.quora.answer||""}\n\nFollow-ups:\n${(j.quora.followups||[]).map(f=>"• "+f).join("\n")}`); }
      if(j.tiktok){ addCard(wrap,"TikTok",`Script:\n${j.tiktok.script||""}\n\nHooks:\n${(j.tiktok.hooks||[]).map(h=>"• "+h).join("\n")}\n\nOn-screen:\n${(j.tiktok.onscreen||[]).map(o=>"• "+o).join("\n")}`); }
      if(j.linkedin_article_html){ addCard(wrap,"LinkedIn Article (HTML)",j.linkedin_article_html); }
    }
    function ctaAfterGuestTries(used, cap){
      if(AUTHTED) return;
      const wrap=byId("demoOutput");
      if(!wrap) return;
      const left=Math.max(0, cap-used);
      if(used>=2){
        wrap.insertAdjacentHTML("afterbegin", `
          <div class="card p-5">
            <div class="flex items-center justify-between gap-3 flex-wrap">
              <div><strong>Getting value?</strong> Sign in for <strong>5 runs/day</strong> plus the Article Optimizer.</div>
              <button class="btn btn-primary js-open-auth" type="button">Sign in</button>
            </div>
            <p class="text-xs text-slate-500 mt-2">Guest preview left this month: ${left}</p>
          </div>
        `);
        $$(".js-open-auth", wrap).forEach(b=> b.addEventListener("click", openAuth));
      }
    }
    function wireGenerator(){
      const form=byId("demoForm"), src=byId("sourceText"), out=byId("demoOutput");
      const guestBtn=byId("generateBtn"), memBtn=byId("generateBtn_member"), clearBtn=byId("clearBtn");
      if(!form || !src) return;

      clearBtn?.addEventListener("click", ()=>{ src.value=""; out.innerHTML=""; });

      form.addEventListener("submit", async (e)=>{
        e.preventDefault();
        const raw=(src.value||"").trim(); if(!raw) return toast("Paste some content first");
        const btn = AUTHTED ? memBtn : guestBtn; const old=btn?.textContent;
        try{
          btn&&(btn.disabled=true, btn.textContent="Generating…");
          out.innerHTML=`<div class="card p-5 text-sm text-slate-500">Working…</div>`;
          const t=readToggles(form);
          const messages=[ systemPrompt(t), userPrompt(raw, form, t) ];
          const lane = (!AUTHTED || CURRENT_PLAN==="free") ? "free" : "pro";
          const headers = await getAuthHeaders();
          const r=await fetch(`${WORKER_BASE}/api/generate`, { method:"POST", headers, body: JSON.stringify({ plan: lane, temperature:0.5, messages }) });
          const j=await r.json();
          if(!r.ok) throw new Error(j?.error?.message||"Generation failed");
          const content=j?.choices?.[0]?.message?.content||"";
          const data=parseJsonLoose(content); if(!data) throw new Error("Model did not return JSON");
          paintOutput(data); toast("Done ✅");
          try{
            const s=await fetch(`${WORKER_BASE}/api/billing/status`, { headers: await getAuthHeaders() }).then(r=>r.json());
            if(s?.scope==="ip" && s.platform?.monthly){ ctaAfterGuestTries(s.platform.monthly.used, s.platform.monthly.cap ?? 5); }
          }catch{}
          fetchStatus().catch(()=>{});
        }catch(err){ out.innerHTML=`<div class="card p-5 text-sm text-red-500">Error: ${err.message||err}</div>`; }
        finally{ btn&&(btn.disabled=false, btn.textContent=old|| (AUTHTED?"Generate":"Generate (demo)")); }
      });
    }

    // Optimizer
    function optSystem(){ return { role:"system", content:
`You are an expert editor & SEO. Return ONLY JSON:
{ "html":string, "title":string, "meta_description":string,
  "faqs_jsonld":object|null,
  "reddit":{ "title":string, "tldr":string }|null,
  "ab_titles":string[]|null,
  "alt_keywords":string[]|null,
  "rank_likelihood":string|null,
  "linkedin_article_html":string|null }`}; }
    function optUser(src){ return { role:"user", content:`Improve this HTML/Markdown:\n\n${src}\n\nAdd headings, meta, optional FAQs & Reddit TL;DR. Return JSON only.`}; }

    // FIXED card builder also uses real interpolation
    function paintOpt(j){
      const wrap=byId("optOutput"); wrap.innerHTML="";
      const card=(title, txt)=>{
        const id=`o_${Math.random().toString(36).slice(2,8)}`;
        wrap.insertAdjacentHTML("beforeend", `
          <div class="card p-5" id="${id}">
            <div class="flex justify-between items-center gap-2 flex-wrap">
              <strong>${title}</strong>
              <button class="btn copy" type="button">Copy</button>
            </div>
            <pre class="whitespace-pre-wrap text-sm mt-3 content">${txt}</pre>
          </div>
        `);
        const c=byId(id);
        $(".btn.copy",c)?.addEventListener("click", async()=>{ try{ await navigator.clipboard.writeText($(".content",c)?.innerText||""); toast("Copied ✅"); }catch{ toast("Copy failed"); } });
      };
      if(j.title||j.meta_description) card("Title & Meta", `Title: ${j.title||""}\n\n${j.meta_description||""}`);
      if(j.ab_titles?.length) card("A/B Titles", j.ab_titles.map((t,i)=>`${i+1}. ${t}`).join("\n"));
      if(j.html) card("Improved Article (HTML)", j.html);
      if(j.faqs_jsonld) card("FAQ JSON-LD", JSON.stringify(j.faqs_jsonld,null,2));
      if(j.reddit) card("Reddit-ready", `Title:\n${j.reddit.title||""}\n\nTL;DR:\n${j.reddit.tldr||""}`);
      if(j.alt_keywords?.length || j.rank_likelihood) card("SEO Insights", `Alt keyword ideas:\n${(j.alt_keywords||[]).map(k=>"• "+k).join("\n")}\n\nEstimated ranking likelihood: ${j.rank_likelihood||"—"}`);
      if(j.linkedin_article_html) card("LinkedIn Article (HTML)", j.linkedin_article_html);
    }

    function wireOptimizer(){
      const form=byId("optForm"), src=byId("optSource"), out=byId("optOutput"), btn=byId("optRun"), clr=byId("optClear");
      if(!form || !src) return;
      clr?.addEventListener("click", ()=>{ src.value=""; out.innerHTML=""; });
      form.addEventListener("submit", async (e)=>{
        e.preventDefault();
        if(!AUTHTED) return openAuth();
        const raw=(src.value||"").trim(); if(!raw) return toast("Paste HTML or Markdown first");
        const old=btn.textContent; btn.disabled=true; btn.textContent="Optimizing…";
        out.innerHTML=`<div class="card p-5 text-sm text-slate-500">Working…</div>`;
        try{
          const messages=[ optSystem(), optUser(raw) ];
          const lane = (CURRENT_PLAN==="free") ? "free" : "pro";
          const headers = await getAuthHeaders();
          const r=await fetch(`${WORKER_BASE}/api/optimize`, { method:"POST", headers, body: JSON.stringify({ plan: lane, temperature:0.4, messages }) });
          const j=await r.json();
          if(!r.ok) throw new Error(j?.error?.message||"Optimize failed");
          const content=j?.choices?.[0]?.message?.content||"";
          const data=parseJsonLoose(content); if(!data) throw new Error("Model did not return JSON");
          paintOpt(data); toast("Optimized ✅"); fetchStatus().catch(()=>{});
        }catch(err){ out.innerHTML=`<div class="card p-5 text-sm text-red-500">Error: ${err.message||err}</div>`; }
        finally{ btn.disabled=false; btn.textContent=old; }
      });
    }

    // Calendar preview + schedule
    function showModalSafe(dlg){ try{ if(typeof HTMLDialogElement!=="undefined" && "showModal" in HTMLDialogElement.prototype){ if(!dlg.open) dlg.showModal(); } else { dlg.setAttribute("open",""); dlg.style.display="block"; } }catch{ dlg.setAttribute("open",""); dlg.style.display="none"; } }
    function closeModalSafe(dlg){ try{ if(typeof HTMLDialogElement!=="undefined" && "close" in HTMLDialogElement.prototype){ if(dlg.open) dlg.close(); } else { dlg.removeAttribute("open"); dlg.style.display="none"; } }catch{ dlg.removeAttribute("open"); dlg.style.display="none"; } }
    function wireCalendar(){
      const grid=byId("calGrid");
      if(grid){ grid.textContent="Read-only preview — sign in & upgrade to schedule posts."; }
      byId("calNew")?.addEventListener("click", ()=>{ showModalSafe(byId("scheduleDlg")); });
      byId("schClose")?.addEventListener("click", ()=> closeModalSafe(byId("scheduleDlg")));
      byId("schCancel")?.addEventListener("click", ()=> closeModalSafe(byId("scheduleDlg")));
      byId("scheduleDlg")?.addEventListener("click",(e)=>{ const form=byId("scheduleForm"); const rect=form?.getBoundingClientRect(); if(!rect) return; const inBox = e.clientX>=rect.left&&e.clientX<=rect.right&&e.clientY>=rect.top&&e.clientY<=rect.bottom; if(!inBox) closeModalSafe(byId("scheduleDlg")); });
      byId("scheduleForm")?.addEventListener("submit", async (e)=>{
        e.preventDefault();
        const when=byId("schWhen")?.value, text=(byId("schText")?.value||"").trim();
        if(!when||!text) return toast("Pick a date/time and content");
        try{
          const r=await fetch(`${WORKER_BASE}/api/schedule/create`, { method:"POST", headers: await getAuthHeaders(), body: JSON.stringify({ text, when }) });
          const j=await r.json(); if(!r.ok) throw new Error(j?.error?.message||"Schedule failed");
          toast("Scheduled ✅"); closeModalSafe(byId("scheduleDlg"));
        }catch(err){ toast(err.message||"Schedule failed"); }
      });
    }

    // Export quick actions
    byId("qp-x")?.addEventListener("click", ()=> window.open("https://x.com/compose/post","_blank"));
    byId("qp-reddit")?.addEventListener("click", ()=> window.open("https://www.reddit.com/submit","_blank"));
    byId("qp-linkedin")?.addEventListener("click", ()=> window.open("https://www.linkedin.com/feed/","_blank"));
    byId("qp-email")?.addEventListener("click", ()=> window.open("mailto:","_blank"));

    // BYOK save/clear
    byId("byokSave")?.addEventListener("click", async ()=>{
      const key=(byId("byokKey")?.value||"").trim(); if(!key) return toast("Enter your OpenRouter key");
      try{
        const r=await fetch(`${WORKER_BASE}/api/account/byok/save`,{ method:"POST", headers: await getAuthHeaders(), body: JSON.stringify({ key })});
        const j=await r.json(); if(!r.ok) throw new Error(j?.error?.message||"Save failed");
        byId("byokStatus").textContent=`Status: saved (${j.mask||"****"})`; toast("BYOK saved ✅");
      }catch(e){ toast(e.message||"Save failed"); }
    });
    byId("byokClear")?.addEventListener("click", async ()=>{
      try{
        const r=await fetch(`${WORKER_BASE}/api/account/byok/clear`,{ method:"POST", headers: await getAuthHeaders()});
        const j=await r.json(); if(!r.ok) throw new Error(j?.error?.message||"Clear failed");
        byId("byokStatus").textContent="Status: not set"; toast("BYOK cleared");
      }catch(e){ toast(e.message||"Clear failed"); }
    });

    // Year + billing result
    byId("year")&&(byId("year").textContent=new Date().getFullYear());
    try{
      const u=new URL(location.href);
      if(u.searchParams.get("billing")==="success") toast("Billing updated — thank you!");
      if(u.searchParams.get("billing")==="cancel")  toast("Billing cancelled");
      u.searchParams.delete("billing");
      history.replaceState({}, "", u.toString());
    }catch{}

    // Auth change → update UI & close auth
    supabase.auth.onAuthStateChange((_evt, session)=>{
      setAuthFlag(!!session); setPlan("free"); // base until status returns
      fetchStatus();
      closeAuth();
    });

    // Boot
    (async function boot(){
      try{
        wireGenerator();
        wireOptimizer();
        wireCalendar();
        await fetchStatus();
        await paintLive(); setInterval(paintLive, 30000);
      }catch(e){
        console.error(e); toast("App failed to initialize");
      }
    })();

  })();
  </script>
</body>
</html>
