<!doctype html>
<html lang="en" class="h-full">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17511593434"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'AW-17511593434');
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>ContentRepurpose.pro — AI Content Repurposing Tool & Generator</title>
  <meta name="description" content="Repurpose blogs, emails, and posts into LinkedIn, X, Instagram and more. AI-powered content repurposing tool & generator. Export to Notion & Trello. BYOK supported." />
  <link rel="canonical" href="https://contentrepurpose.pro/">
  <meta name="theme-color" content="#0a0d18">
  <meta name="color-scheme" content="dark light">
  <meta name="robots" content="index,follow,max-video-preview:-1,max-image-preview:large,max-snippet:-1">

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="ContentRepurpose.pro — AI Content Repurposing Tool">
  <meta property="og:description" content="Turn one idea into posts for LinkedIn, X, Instagram, and Email. Export with one click. BYOK supported.">
  <meta property="og:url" content="https://contentrepurpose.pro/">
  <meta property="og:image" content="/og-cover.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ContentRepurpose.pro — AI Content Generator">
  <meta name="twitter:description" content="Repurpose your content into multi-channel drafts. Export to Notion & Trello. BYOK supported.">
  <meta name="twitter:image" content="/og-cover.png">

  <!-- Preconnects for perf -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{ --brandA:#7AA2FF; --brandB:#FF2D2D; --ink:#0a0d18; --ink-2:#101425 }
    html,body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    html,body{overflow-x:hidden; width:100%; max-width:100%}
    body{min-width:320px}
    .txt-grad{background:linear-gradient(135deg,var(--brandA),var(--brandB));-webkit-background-clip:text;background-clip:text;color:transparent}
    .bg-grad{background:linear-gradient(135deg,var(--brandA),var(--brandB))}
    .card{border-radius:1.25rem;border:1px solid rgba(15,23,42,.10);background:rgba(255,255,255,.80);box-shadow:0 12px 40px rgba(2,6,23,.08)}
    .badge{display:inline-flex;align-items:center;gap:.5rem;padding:.35rem .6rem;border-radius:9999px;border:1px solid rgba(255,255,255,.15);font-size:.75rem;background:rgba(255,255,255,.65)}
    .chip{font-size:.7rem;padding:.2rem .5rem;border-radius:9999px;border:1px solid rgba(148,163,184,.35)}
    .btn{padding:.6rem .9rem;border-radius:.9rem;border:1px solid rgba(148,163,184,.35)}
    .btn-primary{background:black;color:white}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    #click-guard{position:fixed;inset:0;pointer-events:none}

    /* --- CLICKABILITY SAFEGUARDS --- */
    /* Put the real app above decorative layers */
    #app, header, main, footer, section, dialog { position: relative; z-index: 20 }
    /* Common decorative/fullscreen things should not block clicks */
    .overlay, .backdrop, .noise, .gridlines, .gradient, .bg-layer, .halo, .orbit,
    [aria-hidden="true"], [role="presentation"] { pointer-events: none !important }
    /* Only make fixed/absolute full-bleed non-interactive when hidden */
    .fixed.inset-0[aria-hidden="true"], .absolute.inset-0[aria-hidden="true"] { pointer-events: none !important }

    /* Glass & dark */
    .glass{backdrop-filter: blur(12px); background:rgba(255,255,255,.62)}
    @media (prefers-color-scheme:dark){
      body{background:var(--ink);color:#e9eef6}
      .card{background:rgba(14,16,22,.6);border-color:rgba(255,255,255,.08);box-shadow:0 24px 96px rgba(122,162,255,.08),0 14px 60px rgba(255,45,45,.06)}
      .badge{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.12)}
    }

    /* Decorative visuals */
    .halo{
      position:absolute; filter: blur(60px); opacity:.55; pointer-events:none; transform:translateZ(0);
      background:radial-gradient(50% 50% at 50% 50%, rgba(122,162,255,.8), rgba(255,45,45,.65) 60%, transparent 70%);
      width:42rem; height:42rem; border-radius:50%;
      animation: float 16s ease-in-out infinite;
    }
    .halo.h2{ width:34rem; height:34rem; left:auto; right:-12rem; top:-6rem; animation-duration:18s; opacity:.5 }
    .halo.h3{ width:28rem; height:28rem; left:-10rem; top:26rem; animation-duration:22s; opacity:.45 }
    @keyframes float{ 0%,100%{ transform: translate3d(0,0,0) } 50%{ transform: translate3d(0,-20px,0) } }
    .orbit{
      position:absolute; inset:-32px; border-radius:24px; pointer-events:none;
      background: conic-gradient(from 0deg, rgba(122,162,255,.25), rgba(255,45,45,.18), rgba(122,162,255,.25));
      -webkit-mask: radial-gradient(closest-side, transparent 88%, black 89%);
              mask: radial-gradient(closest-side, transparent 88%, black 89%);
      animation: spin 18s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg) } }

    .mock{border-radius:1rem;border:1px solid rgba(255,255,255,.12); background:linear-gradient(180deg,rgba(255,255,255,.75),rgba(255,255,255,.6));}
    @media (prefers-color-scheme:dark){ .mock{ background:linear-gradient(180deg,rgba(17,20,31,.88),rgba(17,20,31,.72)); } }

    .marquee{ display:grid; grid-auto-flow:column; gap:2rem; align-items:center; animation: scrollx 26s linear infinite }
    .marquee:hover{ animation-play-state: paused }
    @keyframes scrollx{ from{ transform: translateX(0) } to{ transform: translateX(-50%) } }

    /* Mobile helpers */
    .nav-sheet{position:fixed; inset:0 0 auto 0; background:rgba(0,0,0,.6); backdrop-filter:blur(8px); display:none; z-index:60}
    .nav-panel{position:absolute; top:0; right:0; width:82vw; max-width:380px; height:100%; background:rgba(14,16,22,.96); border-left:1px solid rgba(255,255,255,.08); padding:1rem}
    .nav-open .nav-sheet{display:block}
    .touch-target{min-height:44px; min-width:44px}

    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    /* --- MOBILE LAYOUT POLISH --- */
    /* Prevent “split screen” look: force single column below md, clamp widths */
    section, header, footer { width:100%; max-width:100vw }
    .max-w-7xl { max-width: 90rem } /* keep */
    .container, .card, .mock { width:100%; max-width:100% }
    /* Ensure action bars are on top of any bg */
    .action-bar, .sticky-actions, .btn, button, a.button { position: relative; z-index: 40 }
  </style>

  <!-- JSON-LD: Organization -->
  <script type="application/ld+json">{
    "@context":"https://schema.org",
    "@type":"Organization",
    "name":"ContentRepurpose.pro",
    "url":"https://contentrepurpose.pro/",
    "logo":"https://contentrepurpose.pro/logo.svg",
    "sameAs":[
      "https://x.com/contentflow",
      "https://www.linkedin.com/company/contentflowai"
    ]
  }</script>

  <!-- JSON-LD: WebSite + Sitelinks search -->
  <script type="application/ld+json">{
    "@context":"https://schema.org",
    "@type":"WebSite",
    "url":"https://contentrepurpose.pro/",
    "name":"ContentRepurpose.pro",
    "potentialAction":{
      "@type":"SearchAction",
      "target":"https://contentrepurpose.pro/search?q={q}",
      "query-input":"required name=q"
    }
  }</script>

  <!-- JSON-LD: SoftwareApplication -->
  <script type="application/ld+json">{
    "@context":"https://schema.org",
    "@type":"SoftwareApplication",
    "name":"ContentRepurpose.pro",
    "applicationCategory":"ContentCreationApplication",
    "operatingSystem":"Web",
    "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}
  }</script>
</head>

<body class="min-h-full w-full max-w-[100vw]" data-auth="guest">
  <div id="click-guard" aria-hidden="true"></div>

  <!-- Decorative halos (explicitly pointer-events: none) -->
  <div class="halo pointer-events-none" style="left:-14rem; top:-10rem;"></div>
  <div class="halo h2 pointer-events-none"></div>
  <div class="halo h3 pointer-events-none"></div>

  <!-- TOP PROMO BANNER -->
  <div id="promoBar" class="w-full bg-black text-white">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-2 flex items-center justify-between text-xs">
      <span class="truncate">First Users: <strong>90% off Creator</strong> — use code <span class="underline">CONTENTOFF90</span></span>
      <div class="flex items-center gap-2">
        <a href="#pricing" class="px-3 py-1 rounded-lg border border-white/20 hover:bg-white/10 touch-target">Get deal</a>
        <button type="button" class="px-3 py-1 rounded-lg border border-white/20 hover:bg-white/10 touch-target" data-dismiss-banner>✕</button>
      </div>
    </div>
  </div>

  <!-- NAV -->
  <header class="sticky top-0 z-50 backdrop-blur bg-white/55 dark:bg-black/20 border-b border-white/30">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-4 flex items-center justify-between">
      <a href="/" class="flex items-center gap-3" aria-label="ContentRepurpose home">
        <svg width="36" height="36" viewBox="0 0 48 48" class="rounded-xl" aria-hidden="true">
          <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7AA2FF"/><stop offset="100%" stop-color="#FF2D2D"/></linearGradient></defs>
          <rect x="0" y="0" width="48" height="48" rx="12" fill="url(#g)"/>
          <path d="M14 16h10a6 6 0 0 1 0 12H20v4h-6V16zm6 6v4h4a2 2 0 1 0 0-4h-4z" fill="white"/>
          <path d="M28 16h6v16h-6z" fill="white" opacity=".9"/>
        </svg>
        <span class="font-semibold tracking-tight">Content<span class="txt-grad">Repurpose</span></span>
      </a>

      <!-- Desktop nav -->
      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="#demo" class="hover:opacity-80">Live Demo</a>
        <a href="#templates" class="hover:opacity-80">Templates</a>
        <a href="#use-cases" class="hover:opacity-80">Use cases</a>
        <a href="#best-picks" class="hover:opacity-80">Best picks</a>
        <a href="#pricing" class="hover:opacity-80">Pricing</a>
        <a href="/blog" class="hover:opacity-80">Blog</a>
        <span id="planbadge" class="px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/50">Plan: Free</span>
        <button id="manageBilling" class="px-3 py-1 rounded-lg border hidden touch-target">Manage billing</button>
        <div class="flex items-center gap-2">
          <button id="loginBtn" class="px-3 py-1 rounded-lg border touch-target">Sign in</button>
          <button id="logoutBtn" class="px-3 py-1 rounded-lg border hidden touch-target">Sign out</button>
        </div>
      </nav>

      <!-- Mobile burger -->
      <button id="navToggle" class="md:hidden touch-target px-3 py-2 rounded-lg border" aria-expanded="false" aria-controls="mobileNav" aria-label="Open menu">☰</button>
    </div>

    <!-- Mobile sheet -->
    <div id="mobileNav" class="nav-sheet" aria-hidden="true">
      <div class="nav-panel text-sm text-white">
        <div class="flex items-center justify-between">
          <span class="font-semibold">Menu</span>
          <button id="navClose" class="touch-target px-3 py-2 rounded-lg border border-white/20" aria-label="Close menu">✕</button>
        </div>
        <nav class="mt-4 grid gap-2">
          <a href="#demo" class="px-3 py-2 rounded-lg hover:bg-white/10">Live Demo</a>
          <a href="#templates" class="px-3 py-2 rounded-lg hover:bg-white/10">Templates</a>
          <a href="#use-cases" class="px-3 py-2 rounded-lg hover:bg-white/10">Use cases</a>
          <a href="#best-picks" class="px-3 py-2 rounded-lg hover:bg-white/10">Best picks</a>
          <a href="#pricing" class="px-3 py-2 rounded-lg hover:bg-white/10">Pricing</a>
          <a href="/blog" class="px-3 py-2 rounded-lg hover:bg-white/10">Blog</a>
        </nav>
        <div class="mt-6 grid gap-2">
          <span id="planbadge_m" class="px-3 py-1 rounded-full text-xs bg-white/10 border border-white/20 w-fit">Plan: Free</span>
          <button id="manageBilling_m" class="px-3 py-2 rounded-lg border border-white/20 hidden touch-target">Manage billing</button>
          <button id="loginBtn_m" class="px-3 py-2 rounded-lg border border-white/20 touch-target">Sign in</button>
          <button id="logoutBtn_m" class="px-3 py-2 rounded-lg border border-white/20 hidden touch-target">Sign out</button>
        </div>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="relative" id="hero">
    <div class="max-w-7xl mx-auto px-4 md:px-5 pt-10 md:pt-16 grid lg:grid-cols-2 gap-8 md:gap-10 items-center">
      <div>
        <div id="heroBadgeWrap" class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/40">
          <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
          <span id="heroBadge">Demo — <strong class="mx-1">5 runs / month</strong> (no login)</span>
        </div>
        <h1 class="mt-4 text-3xl md:text-5xl font-black leading-tight tracking-tight">
          AI <span class="txt-grad">Content Repurposing Tool</span> — turn one idea into everywhere content.
        </h1>
        <p class="mt-4 text-slate-600 dark:text-slate-300 max-w-xl">
          Paste content → get <strong>LinkedIn</strong>, <strong>X</strong>, <strong>Email</strong> &amp; <strong>Instagram</strong> drafts.
          Export to <strong>Notion</strong> or <strong>Trello</strong> with one click. BYOK supported.
        </p>
        <div class="mt-6 flex flex-wrap gap-3">
          <a href="#demo" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90 touch-target">Try the Live Demo</a>
          <a href="#pricing" class="px-4 py-3 rounded-xl font-semibold border border-slate-300/60 hover:bg-white/50 touch-target">See pricing</a>
          <button id="heroSignIn" class="px-4 py-3 rounded-xl font-semibold border border-slate-300/60 touch-target">Sign in</button>
        </div>
        <div class="mt-6 flex items-center gap-3 text-xs text-slate-500 dark:text-slate-400">
          <span class="badge">AI Content Generator</span>
          <span class="badge">Repurposing Tool</span>
          <span class="badge">SEO-ready</span>
          <span class="badge">BYOK</span>
        </div>

        <div id="chips" class="mt-6 flex flex-wrap gap-2 text-[12px]">
          <span class="chip">AI content repurposing</span>
          <span class="chip">Content repurpose</span>
          <span class="chip">Repurpose blog to LinkedIn</span>
          <span class="chip">Repurpose blog to X</span>
          <span class="chip">Repurpose email to social</span>
          <span class="chip">Notion export</span>
          <span class="chip">Trello export</span>
          <span class="chip">Content repurposing tool</span>
          <span class="chip">Content repurposing ideas</span>
          <span class="chip">Repurpose project</span>
          <span class="chip">Repurpose content AI</span>
          <span class="chip">SEO repurposing</span>
        </div>

        <div class="mt-8 overflow-hidden">
          <div class="flex items-center gap-4 text-[11px] uppercase tracking-widest text-slate-500">
            <span class="chip">Creators</span>
            <span class="chip">Marketers</span>
            <span class="chip">Newsletters</span>
            <span class="chip">Teams</span>
          </div>
          <div class="relative mt-4">
            <div class="marquee opacity-70">
              <div class="chip">LinkedIn-first</div><div class="chip">Editorial-friendly</div><div class="chip">Email copy</div><div class="chip">Instagram captions</div><div class="chip">Notion export</div><div class="chip">Trello sync</div><div class="chip">Keyword-aware</div><div class="chip">Tone controls</div>
              <div class="chip">LinkedIn-first</div><div class="chip">Editorial-friendly</div><div class="chip">Email copy</div><div class="chip">Instagram captions</div><div class="chip">Notion export</div><div class="chip">Trello sync</div><div class="chip">Keyword-aware</div><div class="chip">Tone controls</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Visual mockups -->
      <div class="relative">
        <div class="orbit pointer-events-none" aria-hidden="true"></div>
        <div class="grid gap-4">
          <div class="mock p-4 card">
            <div class="text-xs text-slate-400">Command</div>
            <pre class="mono text-xs bg-black/85 text-emerald-200 rounded-xl p-4 h-40 overflow-auto" aria-label="CLI Preview">repurpose generate --channels linkedin,x,email,instagram
✓ outline created
✓ 3 social variants
✓ email subject + body ready
✓ instagram caption + hashtags</pre>
          </div>
          <div class="grid md:grid-cols-2 gap-4">
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">LinkedIn</div>
              <div class="mt-2 h-24 text-sm text-slate-200/90 leading-relaxed">
                • Hook that earns the scroll<br>• 6–10 crisp lines, one CTA<br>• On-brand tone &amp; keywords
              </div>
            </div>
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">X (Twitter)</div>
              <div class="mt-2 h-24 text-sm text-slate-200/90 leading-relaxed">
                Two fast variants<br>Always &le; 280 chars<br>Ready to post ✨
              </div>
            </div>
          </div>
          <div class="grid md:grid-cols-2 gap-4">
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">Email</div>
              <div class="mt-2 h-20 text-sm text-slate-200/90 leading-relaxed">
                Subject &amp; body prepped<br>Preview &amp; send from your client
              </div>
            </div>
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">Instagram</div>
              <div class="mt-2 h-20 text-sm text-slate-200/90 leading-relaxed">
                Caption + 3–5 hashtags<br>Short, skimmable, on-brand
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Live activity strip -->
    <div class="mt-8 md:mt-10">
      <div class="max-w-7xl mx-auto px-4 md:px-5">
        <div class="card p-4 md:p-5">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
              <strong class="tracking-tight">Generations today</strong>
              <span id="liveCount" class="chip">–</span>
            </div>
            <div class="text-xs text-slate-500">Real results update every 30s</div>
          </div>
          <div class="mt-3 overflow-hidden">
            <div id="liveFeed" class="flex gap-3 whitespace-nowrap text-[13px] will-change-transform" style="animation: scrollx 28s linear infinite"></div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- ===== GUEST VIEW (LOGGED OUT) ===== -->
  <section id="guestView">
    <!-- DEMO -->
    <main id="demo" class="max-w-7xl mx-auto px-4 md:px-5 pb-12 grid lg:grid-cols-2 gap-8">
      <section class="card p-6">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-bold tracking-tight">Live Demo — Repurpose</h2>
          <span id="quota" class="px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/50">Checking quota…</span>
        </div>

        <label for="source" class="sr-only">Source text</label>
        <textarea id="source" class="mt-4 w-full h-48 p-3 rounded-xl border border-slate-200/70 focus:outline-none focus:ring-2 focus:ring-slate-300 dark:bg-black/30" placeholder="Paste a paragraph or blog snippet…"></textarea>

        <details id="settings" class="mt-4">
          <summary class="cursor-pointer text-sm text-slate-500">Advanced settings</summary>
          <div class="grid md:grid-cols-3 gap-3 mt-3">
            <input id="model" class="p-2 rounded-xl border border-slate-200/70 dark:bg-black/30" placeholder="Preferred model (optional)" />
            <select id="byok_provider" class="p-2 rounded-xl border border-slate-200/70 dark:bg-black/30">
              <option value="">Provider (auto)</option>
              <option value="openrouter">OpenRouter</option>
              <option value="openai">OpenAI</option>
              <option value="anthropic">Anthropic</option>
              <option value="together">Together</option>
              <option value="groq">Groq</option>
              <option value="custom">Custom (OpenAI-compatible)</option>
            </select>
            <input id="byok_key" class="p-2 rounded-xl border border-slate-200/70 dark:bg-black/30" placeholder="Your API key (BYOK)" />
            <input id="byok_base" class="p-2 rounded-xl border border-slate-200/70 dark:bg-black/30 md:col-span-2" placeholder="Custom base URL (if custom provider)" />
            <button id="save" class="px-4 py-2 rounded-xl font-semibold border border-slate-300/60 hover:bg-white/50 touch-target" type="button">Save</button>
          </div>
          <p class="text-xs text-slate-500 mt-2">BYOK is used only when you click “Generate with your BYOK”.</p>
        </details>

        <div class="mt-4 flex flex-wrap items-center gap-3">
          <button id="run" class="px-4 py-2 rounded-xl font-semibold text-white bg-black hover:opacity-90 touch-target" type="button">Generate</button>
          <button id="run-byok" class="px-4 py-2 rounded-xl font-semibold text-white bg-emerald-600 hover:opacity-90 touch-target" type="button">Generate with your BYOK</button>
          <button id="clear" class="px-4 py-2 rounded-xl font-semibold border border-slate-300/60 hover:bg-white/50 touch-target" type="button">Clear</button>
          <button id="dl-md" class="px-4 py-2 rounded-xl font-semibold border border-slate-300/60 hover:bg-white/50 touch-target" type="button" disabled>Download Markdown</button>
          <button id="dl-csv" class="px-4 py-2 rounded-xl font-semibold border border-slate-300/60 hover:bg-white/50 touch-target" type="button" disabled>Export CSV</button>
          <span id="status" class="text-sm text-slate-500" role="status" aria-live="polite"></span>
        </div>
      </section>

      <section class="grid gap-5">
        <div class="card p-5">
          <div class="flex justify-between items-center">
            <strong class="tracking-tight inline-flex items-center gap-2">LinkedIn</strong>
            <div class="text-xs text-slate-400"><span id="li-lines">0</span> lines</div>
            <button id="copy-li" class="px-3 py-1 rounded-full text-xs border border-slate-300/60 hover:bg-white/50 touch-target" type="button">Copy</button>
          </div>
          <pre id="out-li" class="whitespace-pre-wrap text-sm mt-3"></pre>
        </div>

        <div class="card p-5">
          <div class="flex justify-between items-center">
            <strong class="tracking-tight inline-flex items-center gap-2">X (Twitter)</strong>
            <div class="text-xs text-slate-400">Chars: <span id="x-len">0</span> <span id="x-flag" class="ml-1"></span></div>
            <button id="copy-x" class="px-3 py-1 rounded-full text-xs border border-slate-300/60 hover:bg-white/50 touch-target" type="button">Copy</button>
          </div>
          <pre id="out-x" class="whitespace-pre-wrap text-sm mt-3"></pre>
        </div>

        <div class="card p-5">
          <div class="flex justify-between items-center">
            <strong class="tracking-tight inline-flex items-center gap-2">Email</strong>
            <button id="copy-em" class="px-3 py-1 rounded-full text-xs border border-slate-300/60 hover:bg-white/50 touch-target" type="button">Copy</button>
          </div>
          <div class="text-xs text-slate-400">Subject:</div>
          <pre id="out-em-subj" class="whitespace-pre-wrap text-sm mt-1"></pre>
          <div class="text-xs text-slate-400 mt-3">Body:</div>
          <pre id="out-em-body" class="whitespace-pre-wrap text-sm mt-1"></pre>
        </div>

        <div class="card p-5">
          <div class="flex justify-between items-center">
            <strong class="tracking-tight inline-flex items-center gap-2">Instagram</strong>
            <div class="text-xs text-slate-400">Hashtags: <span id="ig-tags">0</span></div>
            <button id="copy-ig" class="px-3 py-1 rounded-full text-xs border border-slate-300/60 hover:bg-white/50 touch-target" type="button">Copy</button>
          </div>
          <pre id="out-ig" class="whitespace-pre-wrap text-sm mt-3"></pre>
        </div>
      </section>
    </main>
  </section>

  <!-- ===== MEMBER VIEW (SIGNED IN) ===== -->
  <section id="memberView" class="hidden">
    <div class="max-w-7xl mx-auto px-4 md:px-5 pb-12">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mt-8 mb-6">
        <div>
          <h2 class="text-2xl md:text-3xl font-extrabold tracking-tight">Dashboard</h2>
          <p class="text-slate-500 dark:text-slate-300">Welcome back, <span id="userEmail" class="font-medium"></span></p>
        </div>
        <div class="flex items-center gap-3">
          <span id="memberPlanBadge" class="px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/50">Plan: Free</span>
          <button id="manageBilling2" class="px-3 py-1 rounded-lg border hidden touch-target" type="button">Manage billing</button>
          <button id="logoutBtn2" class="px-3 py-1 rounded-lg border touch-target" type="button">Sign out</button>
        </div>
      </div>

      <div id="quotaCards" class="grid sm:grid-cols-2 lg:grid-cols-4 gap-5 mb-6"></div>

      <div class="card p-6">
        <div class="flex items-center justify-between">
          <h3 class="text-xl font-bold tracking-tight">Create new content</h3>
          <div class="flex items-center gap-3 flex-wrap">
            <label class="text-xs flex items-center gap-2">
              <input id="whitelabel" type="checkbox" class="hidden">
              <span id="wlLabel" class="chip hidden">White-label export</span>
            </label>
            <button id="exportPack" class="btn hidden touch-target" type="button">Export Project Pack (.zip)</button>
            <span id="quotaMember" class="px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/50">Today: 0/5</span>
          </div>
        </div>
        <textarea id="source_m" class="mt-4 w-full h-40 p-3 rounded-xl border border-slate-200/70 focus:outline-none focus:ring-2 focus:ring-slate-300 dark:bg-black/30" placeholder="Paste a paragraph or idea…"></textarea>

        <details class="mt-4">
          <summary class="cursor-pointer text-sm text-slate-500">BYOK settings (optional)</summary>
          <div class="grid md:grid-cols-3 gap-3 mt-3">
            <input id="model_m" class="p-2 rounded-xl border border-slate-200/70 dark:bg-black/30" placeholder="Preferred model (optional)" />
            <select id="byok_provider_m" class="p-2 rounded-xl border border-slate-200/70 dark:bg-black/30">
              <option value="">Provider (auto)</option>
              <option value="openrouter">OpenRouter</option>
              <option value="openai">OpenAI</option>
              <option value="anthropic">Anthropic</option>
              <option value="together">Together</option>
              <option value="groq">Groq</option>
              <option value="custom">Custom (OpenAI-compatible)</option>
            </select>
            <input id="byok_key_m" class="p-2 rounded-xl border border-slate-200/70 dark:bg-black/30" placeholder="Your API key (BYOK)" />
            <input id="byok_base_m" class="p-2 rounded-xl border border-slate-200/70 dark:bg-black/30 md:col-span-2" placeholder="Custom base URL (if custom provider)" />
            <button id="save_m" class="px-4 py-2 rounded-xl font-semibold border border-slate-300/60 hover:bg-white/50 touch-target" type="button">Save to my account</button>
          </div>
          <p class="text-xs text-slate-500 mt-2">Your BYOK is only used when you click “Generate with your BYOK”.</p>
        </details>

        <div class="mt-4 flex flex-wrap items-center gap-3">
          <button id="run_m" class="px-4 py-2 rounded-xl font-semibold text-white bg-black hover:opacity-90 touch-target" type="button">Generate</button>
          <button id="run-byok_m" class="px-4 py-2 rounded-xl font-semibold text-white bg-emerald-600 hover:opacity-90 touch-target" type="button">Generate with your BYOK</button>
          <button id="clear_m" class="px-4 py-2 rounded-xl font-semibold border border-slate-300/60 hover:bg:white/50 touch-target" type="button">Clear</button>
          <span id="status_m" class="text-sm text-slate-500" role="status" aria-live="polite"></span>
        </div>
      </div>

      <div class="grid lg:grid-cols-2 gap-5 mt-6">
        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight inline-flex items-center gap-2">LinkedIn</strong>
            <div class="flex items-center gap-2">
              <button id="copy-li_m" class="px-3 py-1 rounded-full text-xs border touch-target" type="button">Copy</button>
              <button id="publish-li_m" class="px-3 py-1 rounded-full text-xs border touch-target" type="button">Publish</button>
              <button id="li-notion" class="px-3 py-1 rounded-full text-xs border hidden touch-target" type="button">Export to Notion</button>
              <button id="li-trello" class="px-3 py-1 rounded-full text-xs border hidden touch-target" type="button">Send to Trello</button>
              <button id="li-buffer" class="px-3 py-1 rounded-full text-xs border hidden touch-target" type="button">Queue in Buffer</button>
            </div>
          </div>
          <pre id="out-li_m" class="whitespace-pre-wrap text-sm mt-3"></pre>
        </div>

        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight inline-flex items-center gap-2">X (Twitter)</strong>
            <div class="flex items-center gap-2">
              <button id="copy-x_m" class="px-3 py-1 rounded-full text-xs border touch-target" type="button">Copy</button>
              <button id="publish-x_m" class="px-3 py-1 rounded-full text-xs border touch-target" type="button">Publish</button>
              <button id="x-notion" class="px-3 py-1 rounded-full text-xs border hidden touch-target" type="button">Export to Notion</button>
              <button id="x-trello" class="px-3 py-1 rounded-full text-xs border hidden touch-target" type="button">Send to Trello</button>
              <button id="x-buffer" class="px-3 py-1 rounded-full text-xs border hidden touch-target" type="button">Queue in Buffer</button>
            </div>
          </div>
          <pre id="out-x_m" class="whitespace-pre-wrap text-sm mt-3"></pre>
        </div>

        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight inline-flex items-center gap-2">Email</strong>
            <div class="flex items-center gap-2">
              <button id="copy-em_m" class="px-3 py-1 rounded-full text-xs border touch-target" type="button">Copy</button>
              <button id="publish-em_m" class="px-3 py-1 rounded-full text-xs border touch-target" type="button">Preview &amp; Send</button>
              <button id="em-notion" class="px-3 py-1 rounded-full text-xs border hidden touch-target" type="button">Export to Notion</button>
              <button id="em-trello" class="px-3 py-1 rounded-full text-xs border hidden touch-target" type="button">Send to Trello</button>
              <button id="em-buffer" class="px-3 py-1 rounded-full text-xs border hidden touch-target" type="button">Queue in Buffer</button>
            </div>
          </div>
          <div class="text-xs text-slate-400">Subject:</div>
          <pre id="out-em-subj_m" class="whitespace-pre-wrap text-sm mt-1"></pre>
          <div class="text-xs text-slate-400 mt-3">Body:</div>
          <pre id="out-em-body_m" class="whitespace-pre-wrap text-sm mt-1"></pre>
        </div>

        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight inline-flex items-center gap-2">Instagram</strong>
            <div class="flex items-center gap-2">
              <button id="copy-ig_m" class="px-3 py-1 rounded-full text-xs border touch-target" type="button">Copy</button>
              <button id="publish-ig_m" class="px-3 py-1 rounded-full text-xs border touch-target" type="button">Open Creator Studio</button>
              <button id="ig-notion" class="px-3 py-1 rounded-full text-xs border hidden touch-target" type="button">Export to Notion</button>
              <button id="ig-trello" class="px-3 py-1 rounded-full text-xs border hidden touch-target" type="button">Send to Trello</button>
              <button id="ig-buffer" class="px-3 py-1 rounded-full text-xs border hidden touch-target" type="button">Queue in Buffer</button>
            </div>
          </div>
          <pre id="out-ig_m" class="whitespace-pre-wrap text-sm mt-3"></pre>
        </div>
      </div>
    </div>
  </section>

  <!-- PRICING -->
  <section id="pricing" class="max-w-7xl mx-auto px-4 md:px-5 pb-16">
    <div class="text-center mb-8">
      <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight">Simple, honest pricing</h2>
      <p class="text-slate-600 dark:text-slate-300 mt-2">Start free. Add power when you need it.</p>
    </div>
    <div class="grid lg:grid-cols-4 gap-6">
      <div class="card p-6">
        <div class="text-sm px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 border w-fit">Free</div>
        <h3 class="mt-3 text-xl font-bold">Demo</h3>
        <div class="mt-2 text-3xl font-extrabold">$0<span class="text-sm text-slate-500">/forever</span></div>
        <ul class="mt-4 text-sm space-y-2">
          <li>• 5 runs / month (no login)</li>
          <li>• Signed-in free: 5 / day</li>
          <li>• BYOK: 5 / day</li>
          <li>• 1 saved preset</li>
          <li>• CSV/Markdown export</li>
        </ul>
        <a href="#demo" class="mt-6 block text-center px-4 py-2 rounded-xl font-semibold border hover:bg:white/50 touch-target">Try free</a>
      </div>

      <div class="card p-6">
        <div class="text-sm px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 border w-fit">Starter</div>
        <h3 class="mt-3 text-xl font-bold">Solo Creator</h3>
        <div class="mt-2 text-3xl font-extrabold">$9<span class="text-sm text-slate-500">/mo</span></div>
        <ul class="mt-4 text-sm space-y-2">
          <li>• 200 generations / month</li>
          <li>• Batch inputs</li>
          <li>• 10 saved presets</li>
          <li>• Priority models</li>
          <li>• BYOK: 50 / month <span class="text-slate-400">(plus +5 daily headroom)</span></li>
        </ul>
        <button data-price="price_1S7y58JYjIKHzKcjzL7cIKiB" class="subBtn mt-6 w-full text-center px-4 py-2 rounded-xl font-semibold bg-black text-white hover:opacity-90 touch-target" type="button">Get Solo Creator</button>
      </div>

      <div class="card p-6">
        <div class="text-sm px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 border w-fit">Best value</div>
        <h3 class="mt-3 text-xl font-bold">Creator</h3>
        <div class="mt-2 text-3xl font-extrabold">$19<span class="text-sm text-slate-500">/mo</span></div>
        <ul class="mt-4 text-sm space-y-2">
          <li>• 500 generations / month</li>
          <li>• Unlimited presets</li>
          <li>• Project pack export</li>
          <li>• <strong>Notion export + Trello boards</strong></li>
          <li>• <strong>Push drafts to Buffer</strong></li>
          <li>• New workflows early</li>
          <li>• BYOK: 150 / month <span class="text-slate-400">(includes +10 daily)</span></li>
        </ul>
        <button data-price="price_1S7y77JYjIKHzKcjKQYjiqZH" class="subBtn mt-6 w-full text-center px-4 py-2 rounded-xl font-semibold bg-black text-white hover:opacity-90 touch-target" type="button">Get Creator</button>
      </div>

      <div class="card p-6">
        <div class="text-sm px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 border w-fit">Team</div>
        <h3 class="mt-3 text-xl font-bold">Business</h3>
        <div class="mt-2 text-3xl font-extrabold">$49<span class="text-sm text-slate-500">/mo</span></div>
        <ul class="mt-4 text-sm space-y-2">
          <li>• Unlimited (fair use)</li>
          <li>• 3 seats</li>
          <li>• White-label export</li>
          <li>• Priority support</li>
          <li>• All Creator integrations</li>
          <li>• Team presets &amp; shared calendar</li>
          <li>• BYOK: 300 / month <span class="text-slate-400">(+30 daily)</span></li>
        </ul>
        <button data-price="price_1S7y8OJYjIKHzKcjqA9uJdyh" class="subBtn mt-6 w-full text-center px-4 py-2 rounded-xl font-semibold border hover:bg:white/50 touch-target" type="button">Get Business</button>
      </div>
    </div>
  </section>

  <!-- SEO FAQ (deduped / single block) -->
  <section id="seo-faq" class="max-w-7xl mx-auto px-4 md:px-5 pb-12">
    <h2 class="text-2xl md:text-3xl font-extrabold tracking-tight">Content Repurposing Tool — FAQs</h2>
    <div class="mt-5 grid md:grid-cols-2 gap-5">
      <article class="card p-5">
        <h3 class="font-semibold">What is AI content repurposing?</h3>
        <p class="text-sm text-slate-500 mt-2">
          AI content repurposing turns one source—like a blog, email, or social post—into
          ready-to-edit drafts for <strong>LinkedIn</strong>, <strong>X</strong>, <strong>Instagram</strong>, and
          <strong>Email</strong>. Export to <strong>Notion</strong> or <strong>Trello</strong> with one click.
        </p>
      </article>
      <article class="card p-5">
        <h3 class="font-semibold">From email to Trello or Notion (in one click)</h3>
        <p class="text-sm text-slate-500 mt-2">
          Turn a rough email into a cross-channel draft, then file it to a board or doc instantly. When you need scale, batch inputs help.
        </p>
      </article>
    </div>
  </section>

  <!-- Promo: external ad link -->
  <section class="max-w-7xl mx-auto px-4 md:px-5 pb-8">
    <div class="card p-5 md:p-6 flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
      <div>
        <h3 class="text-lg font-semibold">Want more AI creation ideas?</h3>
        <p class="text-sm text-slate-500 mt-1">Check out our friends at <strong>aigenerationtool.com</strong> for inspiration and tools.</p>
      </div>
      <a href="https://aigenerationtool.com" target="_blank" rel="noopener nofollow" class="px-4 py-2 rounded-xl font-semibold bg-black text-white hover:opacity-90 touch-target">Visit aigenerationtool.com</a>
    </div>
  </section>

  <footer class="py-10 text-center text-xs text-slate-500">
    © <span id="year"></span> ContentRepurpose
    • <a class="underline hover:opacity-80" href="https://contentrepurpose.pro/privacy">Privacy</a>
    • <a class="underline hover:opacity-80" href="https://contentrepurpose.pro/terms">Terms</a>
  </footer>

  <!-- Auth Modal -->
  <dialog id="auth" class="rounded-2xl p-0 w-[520px] max-w-[92vw] bg-neutral-900 text-white border border-white/10">
    <form method="dialog">
      <div class="p-6 space-y-3">
        <h3 class="text-xl text-white font-bold">Sign in</h3>
        <p class="text-white/70 text-sm">Use Google or request a magic link.</p>
        <button id="googleBtn" class="w-full px-4 py-2 rounded-xl bg-white text-black font-semibold touch-target" type="button">Continue with Google</button>
        <div class="flex items-center gap-3 text-xs text-white/50"><span class="flex-1 h-px bg-white/10"></span>or<span class="flex-1 h-px bg-white/10"></span></div>
        <div class="grid gap-2">
          <input id="emailInput" type="email" placeholder="you@company.com" class="p-2 rounded-xl border border-white/15 bg-white/5">
          <button id="magicBtn" class="px-4 py-2 rounded-xl bg-white/10 touch-target" type="button">Send magic link</button>
        </div>
        <div class="text-xs text-white/50">We never store your BYOK.</div>
      </div>
    </form>
  </dialog>

  <!-- Email Preview Modal -->
  <dialog id="emailPreview" class="rounded-2xl p-0 w-[720px] max-w-[96vw] bg-neutral-900 text-white border border-white/10">
    <form method="dialog" class="p-6 space-y-3">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-bold">Preview email</h3>
        <button value="cancel" class="px-3 py-1 rounded-lg border border-white/20 touch-target">Close</button>
      </div>
      <label class="text-sm">Subject</label>
      <input id="emailSubjEdit" class="w-full p-2 rounded-xl border border-white/15 bg-white/5" />
      <label class="text-sm">Body</label>
      <textarea id="emailBodyEdit" class="w-full h-52 p-2 rounded-xl border border-white/15 bg-white/5"></textarea>
      <div class="flex justify-end gap-2">
        <button id="emailSendBtn" class="px-4 py-2 rounded-xl bg-white text-black font-semibold touch-target" type="button">Open in email client</button>
      </div>
    </form>
  </dialog>

  <!-- Simple Toast -->
  <div id="toast" class="fixed left-1/2 -translate-x-1/2 bottom-6 z-[90] hidden">
    <div id="toastMsg" class="px-3 py-2 rounded-lg bg-black text-white text-sm shadow-lg"></div>
  </div>

  <!-- APP SCRIPT (wiring Sign-in, Generate, billing, mobile nav, clickability guards) -->
  <script type="module">
    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
    const WORKER_BASE = "https://contentflow-worker.frank-couchman.workers.dev";

    /* --- Prevent overlays from eating clicks --- */
    $$(".halo, .orbit, [aria-hidden='true']").forEach(el => el.style.pointerEvents = "none");
    // Make sure nothing sits above UI unexpectedly
    $$(".card, button, a, input, textarea, dialog").forEach(el => { el.style.position ||= "relative"; el.style.zIndex ||= 20; });

    /* --- Year --- */
    const yearEl = $("#year"); if (yearEl) yearEl.textContent = new Date().getFullYear();

    /* --- Promo banner dismiss --- */
    (function promoPersist(){
      const bar = $("#promoBar");
      const closeBtn = bar?.querySelector("[data-dismiss-banner]");
      const key = "promoBarDismissed_v1";
      if (!bar) return;
      try { if (localStorage.getItem(key)==="1") bar.style.display="none"; } catch {}
      closeBtn?.addEventListener("click", ()=>{ bar.style.display="none"; try{localStorage.setItem(key,"1");}catch{} });
    })();

    /* --- Mobile nav --- */
    (function mobileNav(){
      const sheet = $("#mobileNav");
      const open = $("#navToggle");
      const close = $("#navClose");
      const links = $$("#mobileNav a");
      const setOpen = (v)=>{ document.documentElement.classList.toggle("nav-open", v); sheet?.setAttribute("aria-hidden", String(!v)); open?.setAttribute("aria-expanded", String(v)); };
      open?.addEventListener("click", ()=> setOpen(true));
      close?.addEventListener("click", ()=> setOpen(false));
      links.forEach(a=> a.addEventListener("click", ()=> setOpen(false)));
    })();

    /* --- Toast helper --- */
    function toast(msg){ const box=$("#toast"), t=$("#toastMsg"); if(!box||!t) return; t.textContent=msg; box.classList.remove("hidden"); setTimeout(()=>box.classList.add("hidden"), 2400); }

    /* --- Sign-in modal (stub; opens dialog so button is clickable now) --- */
    const authDlg = $("#auth");
    const signButtons = ["#loginBtn","#loginBtn_m","#heroSignIn"].map(sel=>$(sel)).filter(Boolean);
    signButtons.forEach(b=> b.addEventListener("click", ()=> authDlg?.showModal()));
    $("#logoutBtn")?.addEventListener("click", ()=> toast("Signed out"));
    $("#logoutBtn_m")?.addEventListener("click", ()=> toast("Signed out"));
    $("#logoutBtn2")?.addEventListener("click", ()=> toast("Signed out"));
    $("#googleBtn")?.addEventListener("click", ()=> toast("Google sign-in coming online"));
    $("#magicBtn")?.addEventListener("click", ()=> toast("Magic link sent (demo)"));

    /* --- Billing buttons --- */
    async function openCheckout(price){
      try{
        const res = await fetch(`${WORKER_BASE}/api/billing/checkout`,{
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ price, success_url: location.href, cancel_url: location.href })
        });
        const j = await res.json();
        if (j?.url) location.href = j.url;
        else toast(j?.error?.message || "Checkout failed");
      }catch(e){ toast("Could not start checkout"); }
    }
    $$(".subBtn").forEach(btn=>{
      btn.addEventListener("click", ()=> openCheckout(btn.getAttribute("data-price")));
    });

    /* --- Quota pill + live counter --- */
    async function refreshStatus(){
      try{
        const r = await fetch(`${WORKER_BASE}/api/billing/status`);
        const j = await r.json();
        $("#quota").textContent = j?.scope==="ip"
          ? `Demo left: ${Math.max(0,(j.byok?.monthly?.cap||5)-(j.byok?.monthly?.used||0))}/5`
          : `Today: ${j?.platform?.daily?.used||0}/${j?.platform?.daily?.cap ?? "∞"}`;
      }catch{ $("#quota").textContent = "Ready"; }
    }
    refreshStatus();

    async function refreshLive(){
      try{
        const r = await fetch(`${WORKER_BASE}/api/stats/today`);
        const j = await r.json();
        $("#liveCount").textContent = j?.today_count ?? "–";
      }catch{}
    }
    refreshLive(); setInterval(refreshLive, 30000);

    /* --- DEMO Generate (guest) --- */
    const source = $("#source");
    const runBtn = $("#run");
    const runByokBtn = $("#run-byok");
    const clearBtn = $("#clear");
    const statusEl = $("#status");

    function setBusy(b){
      [runBtn, runByokBtn, clearBtn].forEach(x=> x && (x.disabled=b));
      if (b){ statusEl.textContent = "Working…"; } else { statusEl.textContent = ""; }
    }

    function parseOutputs(text){
      // Extremely tolerant splitter from a single assistant text block
      const out = { li:"", x:"", em_subj:"", em_body:"", ig:"" };
      const t = text || "";
      // Try headings
      const parts = t.split(/(?:^|\n)###?\s*(LinkedIn|X|Email|Instagram)[: ]?/gi);
      if (parts.length>1){
        for(let i=1;i<parts.length;i+=2){
          const k = (parts[i]||"").toLowerCase();
          const v = (parts[i+1]||"").trim();
          if (k.startsWith("linked")) out.li = v;
          else if (k==="x") out.x = v;
          else if (k.startsWith("email")){
            const m = v.split(/\n+/);
            out.em_subj = (m.shift()||"").replace(/^subject:\s*/i,"").trim();
            out.em_body = m.join("\n").trim();
          } else if (k.startsWith("insta")) out.ig = v;
        }
      }else{
        // Fallback: heuristics
        const lines = t.split("\n");
        out.li = lines.slice(0,8).join("\n");
        out.x = lines.slice(8,12).join("\n");
        out.em_subj = "Draft subject";
        out.em_body = lines.slice(12,).join("\n");
        out.ig = "#content #repurpose";
      }
      return out;
    }

    async function doGenerate({ byok=false }={}){
      const text = (source.value||"").trim();
      if (!text){ toast("Paste some text first"); source.focus(); return; }
      setBusy(true);
      try{
        const body = {
          messages:[
            { role:"system", content:"You turn input into: LinkedIn, two X variants, Email subject+body, Instagram caption+hashtags. Use concise, skimmable copy."},
            { role:"user", content: text }
          ],
          temperature: 0.7,
          max_tokens: 800,
          plan: byok ? "byok" : "free",
          use_byok: byok
        };
        const headers = { "Content-Type":"application/json" };
        if (byok){
          const k = $("#byok_key")?.value.trim();
          if (!k){ toast("Enter your BYOK key first"); setBusy(false); return; }
          headers["X-User-OpenRouter-Key"] = k;
        }
        const res = await fetch(`${WORKER_BASE}/api/generate`, { method:"POST", headers, body: JSON.stringify(body) });
        const json = await res.json();
        if (!res.ok){ throw new Error(json?.error?.message || res.statusText); }
        const textOut = json?.choices?.[0]?.message?.content || "";
        const out = parseOutputs(textOut);

        $("#out-li").textContent = out.li;
        $("#out-x").textContent = out.x;
        $("#out-em-subj").textContent = out.em_subj;
        $("#out-em-body").textContent = out.em_body;
        $("#out-ig").textContent = out.ig;

        $("#li-lines").textContent = (out.li.match(/\n/g)||[]).length + 1;
        $("#x-len").textContent = out.x.replace(/\n/g," ").length;
        $("#ig-tags").textContent = (out.ig.match(/#\w+/g)||[]).length;

        $("#dl-md").disabled = false;
        $("#dl-csv").disabled = false;
        toast("Generated ✨");
        refreshStatus();
      }catch(e){
        const msg = String(e.message||e);
        statusEl.textContent = msg.includes("quota") ? "Quota reached. Sign in or use BYOK." : msg;
        toast(statusEl.textContent);
      }finally{ setBusy(false); }
    }

    runBtn?.addEventListener("click", ()=> doGenerate({ byok:false }));
    runByokBtn?.addEventListener("click", ()=> doGenerate({ byok:true }));
    clearBtn?.addEventListener("click", ()=>{
      source.value = "";
      ["#out-li","#out-x","#out-em-subj","#out-em-body","#out-ig"].forEach(sel=>{ const el=$(sel); if (el) el.textContent=""; });
      $("#dl-md").disabled = true; $("#dl-csv").disabled = true;
    });

    /* --- Copy helpers --- */
    function copySel(id){ const t=$(id)?.textContent||""; if(!t) return toast("Nothing to copy"); navigator.clipboard.writeText(t).then(()=>toast("Copied")); }
    $("#copy-li")?.addEventListener("click", ()=>copySel("#out-li"));
    $("#copy-x")?.addEventListener("click", ()=>copySel("#out-x"));
    $("#copy-em")?.addEventListener("click", ()=>navigator.clipboard.writeText(`${$("#out-em-subj").textContent}\n\n${$("#out-em-body").textContent}`).then(()=>toast("Copied")));
    $("#copy-ig")?.addEventListener("click", ()=>copySel("#out-ig"));

    /* --- Downloads --- */
    $("#dl-md")?.addEventListener("click", ()=>{
      const md = `# Repurposed\n\n## LinkedIn\n${$("#out-li").textContent}\n\n## X\n${$("#out-x").textContent}\n\n## Email\n**Subject:** ${$("#out-em-subj").textContent}\n\n${$("#out-em-body").textContent}\n\n## Instagram\n${$("#out-ig").textContent}\n`;
      const blob = new Blob([md], {type:"text/markdown"}); const a=document.createElement("a");
      a.href = URL.createObjectURL(blob); a.download="repurposed.md"; a.click(); URL.revokeObjectURL(a.href);
    });
    $("#dl-csv")?.addEventListener("click", ()=>{
      const rows = [
        ["LinkedIn","X","Email Subject","Email Body","Instagram"],
        [$("#out-li").textContent.replace(/\n/g," "), $("#out-x").textContent.replace(/\n/g," "),
         $("#out-em-subj").textContent.replace(/\n/g," "), $("#out-em-body").textContent.replace(/\n/g," "), $("#out-ig").textContent.replace(/\n/g," ")]
      ];
      const csv = rows.map(r => r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(",")).join("\n");
      const blob = new Blob([csv], {type:"text/csv"}); const a=document.createElement("a");
      a.href = URL.createObjectURL(blob); a.download="repurposed.csv"; a.click(); URL.revokeObjectURL(a.href);
    });

    /* --- Guard against any accidental full-screen blocker --- */
    (function antiBlocker(){
      // If any full-viewport element overlaps buttons, disable its pointer-events
      const targets = [runBtn, runByokBtn, $("#loginBtn"), $("#heroSignIn")].filter(Boolean);
      const check = ()=>{
        targets.forEach(t=>{
          const r1 = t.getBoundingClientRect();
          document.elementsFromPoint(r1.left+5, r1.top+5).forEach(el=>{
            if (el!==t && el!==document.body && el!==document.documentElement){
              const style = getComputedStyle(el);
              const isFull = style.position==="fixed" && style.inset==="0px";
              const z = parseInt(style.zIndex||"0",10);
              if (z>50 || isFull){
                el.style.pointerEvents = "none";
              }
            }
          });
        });
      };
      check();
      window.addEventListener("resize", check, { passive:true });
      window.addEventListener("scroll", check, { passive:true });
      setTimeout(check, 100);
    })();
  </script>
</body>
</html>
