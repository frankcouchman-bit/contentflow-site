<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>ContentRepurpose.pro — AI Content Repurposing Tool & Generator</title>
  <meta name="description" content="Content repurposing AI that turns one idea into LinkedIn, X, Email & Instagram drafts. Export to Notion & Trello. BYOK supported." />
  <link rel="canonical" href="https://contentrepurpose.pro/">
  <meta name="theme-color" content="#0a0d18">
  <meta name="color-scheme" content="dark light">
  <meta name="robots" content="index,follow,max-video-preview:-1,max-image-preview:large,max-snippet:-1">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="ContentRepurpose.pro — AI Content Repurposing Tool">
  <meta property="og:description" content="Repurpose content with AI. Paste once → get LinkedIn, X, Email & Instagram drafts. Export to Notion & Trello. BYOK supported.">
  <meta property="og:url" content="https://contentrepurpose.pro/">
  <meta property="og:image" content="/og-cover.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ContentRepurpose.pro — AI Content Generator">
  <meta name="twitter:description" content="Content repurposing AI for multi-channel drafts. Export to Notion & Trello. BYOK supported.">
  <meta name="twitter:image" content="/og-cover.png">

  <!-- Fonts + Tailwind -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Global CSS (kept compact; dark-friendly) -->
  <style>
    :root{ --brandA:#7AA2FF; --brandB:#FF2D2D; --ink:#0a0d18 }
    html,body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .txt-grad{background:linear-gradient(135deg,var(--brandA),var(--brandB));-webkit-background-clip:text;background-clip:text;color:transparent}
    .bg-grad{background:linear-gradient(135deg,var(--brandA),var(--brandB))}
    .card{border-radius:1.25rem;border:1px solid rgba(15,23,42,.10);background:rgba(255,255,255,.80);box-shadow:0 12px 40px rgba(2,6,23,.08)}
    .badge{display:inline-flex;align-items:center;gap:.5rem;padding:.35rem .6rem;border-radius:9999px;border:1px solid rgba(255,255,255,.15);font-size:.75rem;background:rgba(255,255,255,.65)}
    .chip{font-size:.7rem;padding:.2rem .5rem;border-radius:9999px;border:1px solid rgba(148,163,184,.35)}
    .btn{padding:.6rem .9rem;border-radius:.9rem;border:1px solid rgba(148,163,184,.35)}
    .btn-primary{background:black;color:white}
    .glass{backdrop-filter: blur(12px); background:rgba(255,255,255,.62)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .halo{position:absolute;filter:blur(60px);opacity:.55;pointer-events:none;transform:translateZ(0);
      background:radial-gradient(50% 50% at 50% 50%, rgba(122,162,255,.8), rgba(255,45,45,.65) 60%, transparent 70%);
      width:42rem;height:42rem;border-radius:50%;animation:float 16s ease-in-out infinite;}
    .halo.h2{width:34rem;height:34rem;right:-12rem;top:-6rem;animation-duration:18s;opacity:.5}
    .halo.h3{width:28rem;height:28rem;left:-10rem;top:26rem;animation-duration:22s;opacity:.45}
    @keyframes float{ 0%,100%{ transform: translate3d(0,0,0) } 50%{ transform: translate3d(0,-20px,0) } }
    .orbit{position:absolute;inset:-32px;border-radius:24px;pointer-events:none;
      background: conic-gradient(from 0deg, rgba(122,162,255,.25), rgba(255,45,45,.18), rgba(122,162,255,.25));
      -webkit-mask: radial-gradient(closest-side, transparent 88%, black 89%); mask: radial-gradient(closest-side, transparent 88%, black 89%);
      animation: spin 18s linear infinite;}
    @keyframes spin{ to{ transform: rotate(360deg) } }
    .mock{border-radius:1rem;border:1px solid rgba(255,255,255,.12); background:linear-gradient(180deg,rgba(255,255,255,.75),rgba(255,255,255,.6));}
    @media (prefers-color-scheme:dark){ body{background:var(--ink);color:#e9eef6} .card{background:rgba(14,16,22,.6);border-color:rgba(255,255,255,.08);box-shadow:0 24px 96px rgba(122,162,255,.08),0 14px 60px rgba(255,45,45,.06)} .badge{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.12)} .mock{ background:linear-gradient(180deg,rgba(17,20,31,.88),rgba(17,20,31,.72)); } }
    .marquee{ display:grid; grid-auto-flow:column; gap:2rem; align-items:center; animation: scrollx 26s linear infinite }
    .marquee:hover{ animation-play-state: paused } @keyframes scrollx{ from{ transform: translateX(0) } to{ transform: translateX(-50%) } }
    .nav-sheet{position:fixed; inset:0 0 auto 0; background:rgba(0,0,0,.6); backdrop-filter:blur(8px); display:none}
    .nav-panel{position:absolute; top:0; right:0; width:82vw; max-width:380px; height:100%; background:rgba(14,16,22,.96); border-left:1px solid rgba(255,255,255,.08); padding:1rem}
    .nav-open .nav-sheet{display:block}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .icon { width: 1rem; height: 1rem; display: inline-block; vertical-align: -0.15em; }
  </style>

  <!-- JSON-LD (Organization + WebSite + App) -->
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","name":"ContentRepurpose.pro","url":"https://contentrepurpose.pro/","logo":"https://contentrepurpose.pro/logo.svg","sameAs":["https://x.com/contentrepurpose","https://www.linkedin.com/company/contentrepurpose"]}</script>
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","url":"https://contentrepurpose.pro/","name":"ContentRepurpose.pro","potentialAction":{"@type":"SearchAction","target":"https://contentrepurpose.pro/search?q={q}","query-input":"required name=q"}}</script>
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"SoftwareApplication","name":"ContentRepurpose.pro","applicationCategory":"ContentCreationApplication","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}}</script>

  <!-- IMPORTANT: Worker base (your Cloudflare Worker) -->
  <script>
    // Point all fetches at your Worker
    window.WORKER_BASE = "https://contentflow-worker.frank-couchman.workers.dev";
    // Optional identity flags used by the bootstrap code later
    window.SITE_ORIGIN = "https://contentrepurpose.pro";
  </script>

  <!-- ✅ Supabase v2 (added; non-destructive) -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

    // Supabase project config (as requested)
    const SUPABASE_URL  = "https://ynkoavaeadlzlwylmfmu.supabase.co";
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlua29hdmFlYWRsemx3eWxtZm11Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5OTAxNDgsImV4cCI6MjA3MzU2NjE0OH0.1yM5yDo0MI9Upzt4GkLyf1mqvDXfb3DXvC0ouOLtRoU";

    // Create client (exposed globally)
    window.supabase = createClient(SUPABASE_URL, SUPABASE_ANON);

    // Global helpers used by other scripts (non-destructive: only added if absent)
    window.getAuth = window.getAuth || (async () => {
      try {
        const { data } = await window.supabase.auth.getSession();
        const s = data?.session;
        return {
          token:  s?.access_token || "",
          userId: s?.user?.id || null,
          email:  s?.user?.email || null
        };
      } catch {
        return { token:"", userId:null, email:null };
      }
    });

    window.getAuthHeaders = window.getAuthHeaders || (async () => {
      const { token, userId } = await window.getAuth();
      const h = { "Content-Type": "application/json" };
      if (token)  h["Authorization"] = `Bearer ${token}`;
      if (userId) h["X-User-Id"]    = userId;
      return h;
    });

    // Minimal UI wiring for Sign in / Sign out buttons (additive only)
    function paintAuthUI(authed) {
      const show = (id) => document.getElementById(id)?.classList.remove("hidden");
      const hide = (id) => document.getElementById(id)?.classList.add("hidden");
      const has = (id) => !!document.getElementById(id);

      if (has("loginBtn"))     (authed ? hide("loginBtn")     : show("loginBtn"));
      if (has("loginBtn_m"))   (authed ? hide("loginBtn_m")   : show("loginBtn_m"));
      if (has("logoutBtn"))    (authed ? show("logoutBtn")    : hide("logoutBtn"));
      if (has("logoutBtn_m"))  (authed ? show("logoutBtn_m")  : hide("logoutBtn_m"));
      if (has("manageBilling"))   authed ? show("manageBilling")   : hide("manageBilling");
      if (has("manageBilling_m")) authed ? show("manageBilling_m") : hide("manageBilling_m");
      if (has("planbadge"))    document.getElementById("planbadge").textContent = authed ? "Plan: Member" : "Plan: Free";
      if (has("planbadge_m"))  document.getElementById("planbadge_m").textContent = authed ? "Plan: Member" : "Plan: Free";
    }

    // Email magic link sign-in (prompt-based; you can swap to OAuth later without changing existing HTML)
    function wireAuthButtons() {
      const loginEls  = ["loginBtn","loginBtn_m","heroSignIn"].map(id => document.getElementById(id)).filter(Boolean);
      const logoutEls = ["logoutBtn","logoutBtn_m"].map(id => document.getElementById(id)).filter(Boolean);

      loginEls.forEach(btn => btn.addEventListener("click", async () => {
        const email = prompt("Enter your email to sign in via magic link:");
        if (!email) return;
        const { error } = await window.supabase.auth.signInWithOtp({ email });
        alert(error ? `Sign-in error: ${error.message}` : "Check your email for the magic link.");
      }));

      logoutEls.forEach(btn => btn.addEventListener("click", async () => {
        await window.supabase.auth.signOut();
      }));
    }

    // Keep UI in sync with auth state (does not modify your existing DOM beyond hiding/showing)
    window.supabase.auth.onAuthStateChange((_event, session) => {
      paintAuthUI(!!session);
    });

    // Initial paint + wiring after DOM is ready
    document.addEventListener("DOMContentLoaded", async () => {
      wireAuthButtons();
      const { data } = await window.supabase.auth.getSession();
      paintAuthUI(!!data?.session);
    });
  </script>
</head>
<body class="min-h-full" data-auth="guest">
  <!-- Decorative halos -->
  <div class="halo" style="left:-14rem; top:-10rem;"></div>
  <div class="halo h2"></div>
  <div class="halo h3"></div>

  <!-- Top nav (desktop + mobile trigger) -->
  <header class="sticky top-0 z-40 backdrop-blur bg-white/55 dark:bg-black/20 border-b border-white/30">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-4 flex items-center justify-between">
      <a href="/" class="flex items-center gap-3" aria-label="ContentRepurpose home">
        <svg width="36" height="36" viewBox="0 0 48 48" class="rounded-xl" aria-hidden="true">
          <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7AA2FF"/><stop offset="100%" stop-color="#FF2D2D"/></linearGradient></defs>
          <rect x="0" y="0" width="48" height="48" rx="12" fill="url(#g)"/>
          <path d="M14 16h10a6 6 0 0 1 0 12H20v4h-6V16zm6 6v4h4a2 2 0 1 0 0-4h-4z" fill="white"/>
          <path d="M28 16h6v16h-6z" fill="white" opacity=".9"/>
        </svg>
        <span class="font-semibold tracking-tight">Content<span class="txt-grad">Repurpose</span></span>
      </a>

      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="#demo" class="hover:opacity-80" data-nav="demo">Live Demo</a>
        <a href="#templates" class="hover:opacity-80">Templates</a>
        <a href="#use-cases" class="hover:opacity-80">Use cases</a>
        <a href="#best-picks" class="hover:opacity-80">Best picks</a>
        <a href="#pricing" class="hover:opacity-80" data-nav="pricing">Pricing</a>
        <a href="/blog" class="hover:opacity-80">Blog</a>
        <span id="planbadge" class="px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/50">Plan: Free</span>
        <button id="manageBilling" class="px-3 py-1 rounded-lg border hidden">Manage billing</button>
        <div class="flex items-center gap-2">
          <button id="loginBtn" class="px-3 py-1 rounded-lg border">Sign in</button>
          <button id="logoutBtn" class="px-3 py-1 rounded-lg border hidden">Sign out</button>
        </div>
      </nav>

      <button id="navToggle" class="md:hidden touch-target px-3 py-2 rounded-lg border" aria-expanded="false" aria-controls="mobileNav" aria-label="Open menu">☰</button>
    </div>

    <!-- Promo strip -->
    <div class="border-t border-white/40 bg-white/70 dark:bg-white/10">
      <div class="max-w-7xl mx-auto px-4 md:px-5 py-2 flex flex-wrap items-center justify-between gap-3 text-sm">
        <div class="flex items-center gap-2">
          <span class="px-2 py-0.5 rounded-full text-[11px] bg-black/80 text-white">LIMITED</span>
          <span>Use <strong class="mono">CONTENTOFF90</strong> for <strong>90% off</strong> the Creator plan.</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="copyPromoBtn" class="px-3 py-1 rounded-lg border">Copy code</button>
          <a href="#pricing" class="px-3 py-1 rounded-lg bg-black text-white" data-nav="pricing">See pricing</a>
        </div>
      </div>
    </div>

    <!-- Mobile sheet -->
    <div id="mobileNav" class="nav-sheet" aria-hidden="true">
      <div class="nav-panel text-sm text-white">
        <div class="flex items-center justify-between">
          <span class="font-semibold">Menu</span>
          <button id="navClose" class="touch-target px-3 py-2 rounded-lg border border-white/20" aria-label="Close menu">✕</button>
        </div>
        <nav class="mt-4 grid gap-2">
          <a href="#demo" class="px-3 py-2 rounded-lg hover:bg-white/10" data-nav="demo_m">Live Demo</a>
          <a href="#templates" class="px-3 py-2 rounded-lg hover:bg-white/10">Templates</a>
          <a href="#use-cases" class="px-3 py-2 rounded-lg hover:bg-white/10">Use cases</a>
          <a href="#best-picks" class="px-3 py-2 rounded-lg hover:bg-white/10">Best picks</a>
          <a href="#pricing" class="px-3 py-2 rounded-lg hover:bg-white/10" data-nav="pricing_m">Pricing</a>
          <a href="/blog" class="px-3 py-2 rounded-lg hover:bg-white/10">Blog</a>
        </nav>
        <div class="mt-6 grid gap-2">
          <span id="planbadge_m" class="px-3 py-1 rounded-full text-xs bg-white/10 border border-white/20 w-fit">Plan: Free</span>
          <button id="manageBilling_m" class="px-3 py-2 rounded-lg border border-white/20 hidden">Manage billing</button>
          <button id="loginBtn_m" class="px-3 py-2 rounded-lg border border-white/20">Sign in</button>
          <button id="logoutBtn_m" class="px-3 py-2 rounded-lg border border-white/20 hidden">Sign out</button>
        </div>
      </div>
    </div>
  </header>

  <!-- ===== HERO + CTA rail ===== -->
  <section class="relative">
    <div class="max-w-7xl mx-auto px-4 md:px-5 pt-10 md:pt-16 grid lg:grid-cols-2 gap-8 md:gap-10 items-center">
      <!-- Left: copy + CTAs -->
      <div>
        <div id="heroBadgeWrap" class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/40">
          <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
          <span id="heroBadge">Demo — <strong class="mx-1">5 runs / month</strong> (no login)</span>
        </div>

        <h1 class="mt-4 text-3xl md:text-5xl font-black leading-tight tracking-tight">
          AI <span class="txt-grad">Content Repurposing Tool</span> — turn one idea into everywhere content.
        </h1>

        <p class="mt-4 text-slate-600 dark:text-slate-300 max-w-xl">
          Paste content → get <strong>LinkedIn</strong>, <strong>X</strong>, <strong>Email</strong> &amp; <strong>Instagram</strong> drafts.
          Export to <strong>Notion</strong> or <strong>Trello</strong>. BYOK supported.
        </p>

        <!-- CTA rail -->
        <div class="mt-6 flex flex-wrap gap-3">
          <a href="#demo" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90" data-action="scroll-demo" id="ctaTryDemo">
            Try the Live Demo
          </a>
          <a href="#pricing" class="px-4 py-3 rounded-xl font-semibold border border-slate-300/60 hover:bg-white/50" data-nav="pricing">
            See pricing
          </a>
          <button id="heroSignIn" class="px-4 py-3 rounded-xl font-semibold border border-slate-300/60" data-action="open-auth">
            Sign in
          </button>
        </div>

        <div class="mt-6 flex items-center gap-3 text-xs text-slate-500 dark:text-slate-400">
          <span class="badge">AI Content Generator</span>
          <span class="badge">Repurposing Tool</span>
          <span class="badge">SEO-ready</span>
          <span class="badge">BYOK</span>
        </div>

        <!-- Trust strip -->
        <div class="mt-8 overflow-hidden">
          <div class="flex items-center gap-4 text-[11px] uppercase tracking-widest text-slate-500">
            <span class="chip">Creators</span>
            <span class="chip">Marketers</span>
            <span class="chip">Newsletters</span>
            <span class="chip">Teams</span>
          </div>
          <div class="relative mt-4">
            <div class="marquee opacity-70">
              <div class="chip">LinkedIn-first</div>
              <div class="chip">Editorial-friendly</div>
              <div class="chip">Email copy</div>
              <div class="chip">Instagram captions</div>
              <div class="chip">Notion export</div>
              <div class="chip">Trello sync</div>
              <div class="chip">Keyword-aware</div>
              <div class="chip">Tone controls</div>
              <!-- duplicate for seamless scroll -->
              <div class="chip">LinkedIn-first</div>
              <div class="chip">Editorial-friendly</div>
              <div class="chip">Email copy</div>
              <div class="chip">Instagram captions</div>
              <div class="chip">Notion export</div>
              <div class="chip">Trello sync</div>
              <div class="chip">Keyword-aware</div>
              <div class="chip">Tone controls</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right: visual mocks -->
      <div class="relative">
        <div class="orbit" aria-hidden="true"></div>
        <div class="grid gap-4">
          <div class="mock p-4 card">
            <div class="text-xs text-slate-400">Command</div>
            <pre class="mono text-xs bg-black/85 text-emerald-200 rounded-xl p-4 h-40 overflow-auto" aria-label="CLI Preview">repurpose generate --channels linkedin,x,email,instagram
? outline created
? 3 social variants
? email subject + body ready
? instagram caption + hashtags</pre>
          </div>
          <div class="grid md:grid-cols-2 gap-4">
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">LinkedIn</div>
              <div class="mt-2 h-24 text-sm text-slate-200/90 leading-relaxed">
                • Hook that earns the scroll<br>
                • 6–10 crisp lines, one CTA<br>
                • On-brand tone &amp; keywords
              </div>
            </div>
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">X (Twitter)</div>
              <div class="mt-2 h-24 text-sm text-slate-200/90 leading-relaxed">
                Two fast variants<br>
                Always ≤ 280 chars<br>
                Ready to post ✓
              </div>
            </div>
          </div>
          <div class="grid md:grid-cols-2 gap-4">
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">Email</div>
              <div class="mt-2 h-20 text-sm text-slate-200/90 leading-relaxed">
                Subject &amp; body prepped<br>
                Preview &amp; send from your client
              </div>
            </div>
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">Instagram</div>
              <div class="mt-2 h-20 text-sm text-slate-200/90 leading-relaxed">
                Caption + 3–5 hashtags<br>
                Short, skimmable, on-brand
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Live activity strip -->
    <div class="mt-8 md:mt-10">
      <div class="max-w-7xl mx-auto px-4 md:px-5">
        <div class="card p-4 md:p-5">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
              <strong class="tracking-tight">Generations today</strong>
              <span id="liveCount" class="chip">–</span>
            </div>
            <div class="text-xs text-slate-500">Real results update every 30s</div>
          </div>
          <div class="mt-3 overflow-hidden">
            <div id="liveFeed" class="flex gap-3 whitespace-nowrap text-[13px] will-change-transform" style="animation: scrollx 28s linear infinite"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== LIVE DEMO ===== -->
  <section id="demo" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="flex items-end justify-between gap-4 mb-6">
        <div>
          <h2 class="text-2xl md:text-3xl font-black tracking-tight">Live Demo</h2>
          <p class="mt-1 text-slate-500 dark:text-slate-300 text-sm">
            No login needed — <span class="font-semibold">5 runs/month</span> on the public pool.
          </p>
        </div>
        <div class="flex items-center gap-3">
          <a href="#pricing" class="btn">See pricing</a>
          <button id="heroSignIn" class="btn btn-primary">Sign in</button>
        </div>
      </div>

      <!-- Demo CTA rail (upsell + sign-in) -->
      <div class="card p-4 md:p-5 mb-6">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div class="flex items-center gap-2 text-sm">
            <span class="badge">LIMITED</span>
            <span>Use <strong class="mono">CONTENTOFF90</strong> for <strong>90% off</strong> the Creator plan.</span>
          </div>
          <div class="flex items-center gap-2">
            <button id="copyPromoBtn2" class="btn">Copy code</button>
            <a class="btn btn-primary" href="#pricing">Upgrade</a>
          </div>
        </div>
      </div>

      <!-- Demo Form -->
      <div class="card p-5 md:p-6">
        <form id="demoForm" class="grid gap-6" autocomplete="off">
          <!-- Source selector -->
          <fieldset>
            <legend class="text-sm font-semibold">Source</legend>
            <div class="mt-2 grid md:grid-cols-3 gap-3">
              <label class="tab flex items-center justify-between">
                <span class="flex items-center gap-2">
                  <input type="radio" name="sourceType" value="paragraph" checked>
                  Paragraph / Notes
                </span>
                <span class="chip">fastest</span>
              </label>
              <label class="tab flex items-center">
                <input type="radio" name="sourceType" value="blog" class="mr-2">
                Full Blog
              </label>
              <label class="tab flex items-center">
                <input type="radio" name="sourceType" value="url" class="mr-2">
                URL
              </label>
            </div>
            <div class="mt-3">
              <textarea id="sourceText" class="w-full rounded-xl border p-4 min-h-[140px]"
                placeholder="Paste your paragraph or blog. If you selected URL, paste it here."></textarea>
            </div>
          </fieldset>

          <!-- Optimizer options -->
          <fieldset>
            <legend class="text-sm font-semibold">Article Optimizer (optional)</legend>
            <div class="mt-2 grid sm:grid-cols-2 lg:grid-cols-3 gap-2">
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_humanize" checked> Humanize content</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_lengthen"> Lengthen content</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_faqs"> Add FAQs (+ JSON-LD)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_headings" checked> Auto-headings (H2/H3)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_svg"> Add platform-fit SVG image ideas</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_seo"> Check SEO basics (title/meta/alt-text)</label>
            </div>
          </fieldset>

          <!-- Channels -->
          <fieldset>
            <legend class="text-sm font-semibold">Channels to generate</legend>
            <div class="mt-2 grid sm:grid-cols-2 lg:grid-cols-4 gap-2">
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_linkedin" checked> LinkedIn</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_x" checked> X (Twitter)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_email" checked> Email</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_instagram"> Instagram</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_reddit" checked> Reddit</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_facebook"> Facebook</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_quora"> Quora</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_tiktok"> TikTok</label>
            </div>
          </fieldset>

          <!-- Channel-specific extras -->
          <div class="grid md:grid-cols-2 gap-6">
            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">LinkedIn</legend>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="li_article"> Also generate a LinkedIn Article</label>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">X (Twitter)</legend>
              <div class="mt-2 flex items-center gap-3">
                <label class="flex items-center gap-2"><input type="checkbox" name="x_sequence" checked> Output as sequence</label>
                <label class="flex items-center gap-2">
                  Max posts:
                  <select name="x_posts" class="border rounded-lg px-2 py-1">
                    <option>2</option><option selected>4</option><option>6</option>
                  </select>
                </label>
              </div>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">Reddit</legend>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="rdt_communities" checked> Suggest best communities (with rules & flair tips)</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="rdt_comments" checked> Include 3 starter comment angles</label>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">TikTok</legend>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="tt_hooks" checked> Provide 3 hook variants</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="tt_onscreen" checked> Include on-screen text plan</label>
            </fieldset>
          </div>

          <!-- Actions -->
          <div class="flex flex-wrap items-center gap-3">
            <button id="generateBtn" type="submit" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90">
              Generate
            </button>
            <button type="button" id="clearBtn" class="px-4 py-3 rounded-xl font-semibold border">Clear</button>
            <div class="text-sm text-slate-500">You have <span id="demoQuota">—</span> demo runs left.</div>
            <a href="#pricing" class="text-sm underline hover:opacity-80 ml-auto">Need more? See plans</a>
          </div>
        </form>
      </div>

      <!-- OUTPUT -->
      <div id="demoOutput" class="mt-8 grid gap-6" aria-live="polite" aria-busy="false">
        <!-- Channel cards will be injected here -->
      </div>

      <!-- Live strip -->
      <div class="mt-8 md:mt-10">
        <div class="card p-4 md:p-5">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
              <strong class="tracking-tight">Generations today</strong>
              <span id="liveCount" class="chip">–</span>
            </div>
            <div class="text-xs text-slate-500">Real results update every 30s</div>
          </div>
          <div class="mt-3 overflow-hidden">
            <div id="liveFeed" class="flex gap-3 whitespace-nowrap text-[13px] will-change-transform" style="animation: scrollx 28s linear infinite"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== PRICING ===== -->
  <section id="pricing" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="text-center mb-10">
        <h2 class="text-3xl md:text-4xl font-black tracking-tight">Simple, honest pricing</h2>
        <p class="mt-2 text-slate-600 dark:text-slate-300">Start free. Add power when you need it.</p>
      </div>

      <!-- Conversion rail -->
      <div class="card p-4 md:p-5 mb-6 flex flex-wrap items-center justify-between gap-3">
        <div class="flex items-center gap-2 text-sm">
          <span class="badge">LIMITED</span>
          <span>Use <strong class="mono">CONTENTOFF90</strong> for <strong>90% off</strong> your first month of <strong>Creator</strong>.</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="copyPromoBtn_pr" class="btn">Copy code</button>
          <a href="#demo" class="btn">Try Demo</a>
          <button id="heroSignIn_pr" class="btn">Sign in</button>
          <a href="#pricing" class="btn btn-primary">See plans</a>
        </div>
      </div>

      <div class="grid lg:grid-cols-4 gap-6">
        <!-- FREE -->
        <div class="card p-6 flex flex-col">
          <div class="text-sm px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 border w-fit">Free</div>
          <h3 class="mt-3 text-xl font-bold">Demo + Account</h3>
          <div class="mt-2 text-3xl font-extrabold">$0<span class="text-sm text-slate-500">/forever</span></div>
          <ul class="mt-4 text-sm space-y-2">
            <li>• Demo (no login): <strong>5 runs / month</strong></li>
            <li>• Free account: <strong>5 runs / day</strong></li>
            <li>• 1× <strong>Article Optimizer</strong> (once after verification)</li>
            <li>• BYOK: <strong>5 / day</strong></li>
            <li>• CSV/Markdown export</li>
          </ul>
          <a href="#demo" class="mt-6 block text-center btn">Start free</a>
        </div>

        <!-- STARTER -->
        <div class="card p-6 flex flex-col">
          <div class="text-sm px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 border w-fit">Starter</div>
          <h3 class="mt-3 text-xl font-bold">Solo Creator</h3>
          <div class="mt-2 text-3xl font-extrabold">$9<span class="text-sm text-slate-500">/mo</span></div>
          <ul class="mt-4 text-sm space-y-2">
            <li>• <strong>200 generations / month</strong></li>
            <li>• Batch inputs (up to 5 lines/run)</li>
            <li>• 10 saved presets</li>
            <li>• Priority models</li>
            <li>• BYOK: 50 / month (+5 daily headroom)</li>
            <li>• <strong>Scheduler</strong> (queue & calendar)</li>
            <li>• <strong>Analytics</strong> (basics)</li>
            <li>• <strong>Article Optimizer</strong>: up to 5 / day</li>
          </ul>
          <button
            data-price="price_1S7y58JYjIKHzKcjzL7cIKiB"
            class="subBtn mt-6 w-full btn btn-primary"
            type="button">Get Starter</button>
        </div>

        <!-- CREATOR (featured) -->
        <div class="card p-6 flex flex-col ring-1 ring-black/5 relative">
          <span class="absolute -top-3 left-1/2 -translate-x-1/2 text-xs px-3 py-1 rounded-full bg-grad text-white shadow">Best value</span>
          <h3 class="mt-1 text-xl font-bold">Creator</h3>
          <div class="mt-2 text-3xl font-extrabold">$19<span class="text-sm text-slate-500">/mo</span></div>
          <ul class="mt-4 text-sm space-y-2">
            <li>• <strong>500 generations / month</strong></li>
            <li>• Unlimited presets</li>
            <li>• Project pack export</li>
            <li>• Notion export & Trello boards</li>
            <li>• Push drafts to Buffer</li>
            <li>• New workflows early</li>
            <li>• BYOK: 150 / month (+10 daily)</li>
            <li>• <strong>Scheduler</strong> (multi-profile)</li>
            <li>• <strong>Analytics Pro</strong> (per-channel)</li>
            <li>• <strong>Article Optimizer</strong>: up to 15 / day</li>
          </ul>
          <button
            data-price="price_1S7y77JYjIKHzKcjKQYjiqZH"
            class="subBtn mt-6 w-full btn btn-primary"
            type="button">Get Creator</button>
        </div>

        <!-- BUSINESS -->
        <div class="card p-6 flex flex-col">
          <div class="text-sm px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 border w-fit">Team</div>
          <h3 class="mt-3 text-xl font-bold">Business</h3>
          <div class="mt-2 text-3xl font-extrabold">$49<span class="text-sm text-slate-500">/mo</span></div>
          <ul class="mt-4 text-sm space-y-2">
            <li>• <strong>Unlimited</strong> (fair use)</li>
            <li>• 3 seats included</li>
            <li>• White-label export</li>
            <li>• Priority support</li>
            <li>• All Creator integrations</li>
            <li>• Team presets & shared calendar</li>
            <li>• BYOK: 300 / month (+30 daily)</li>
            <li>• <strong>Team Analytics</strong> (org-wide)</li>
            <li>• <strong>Article Optimizer</strong>: up to 30 / day</li>
          </ul>
          <button
            data-price="price_1S7y8OJYjIKHzKcjqA9uJdyh"
            class="subBtn mt-6 w-full btn"
            type="button">Get Business</button>
        </div>
      </div>

      <!-- Why upgrade -->
      <div class="grid md:grid-cols-3 gap-6 mt-10">
        <div class="stat">
          <div class="k">Faster queues</div>
          <p class="text-sm text-slate-500 dark:text-slate-400">Paid lanes hit priority models with fewer rate limits.</p>
        </div>
        <div class="stat">
          <div class="k">Scheduler</div>
          <p class="text-sm text-slate-500 dark:text-slate-400">Queue multi-channel posts and see your week at a glance.</p>
        </div>
        <div class="stat">
          <div class="k">Integrations</div>
          <p class="text-sm text-slate-500 dark:text-slate-400">Push to Notion, Trello, and Buffer in one click.</p>
        </div>
      </div>

      <!-- ===== FAQ ===== -->
      <div id="faq" class="mt-14">
        <h3 class="text-2xl md:text-3xl font-black tracking-tight">Frequently asked questions</h3>
        <div class="mt-6 grid md:grid-cols-2 gap-4">
          <details class="card p-4">
            <summary class="font-semibold cursor-pointer">What counts as a “generation”?</summary>
            <p class="mt-2 text-sm text-slate-500 dark:text-slate-300">
              Any click on <em>Generate</em> that returns content (demo or signed-in). Batch mode counts per line.
            </p>
          </details>

          <details class="card p-4">
            <summary class="font-semibold cursor-pointer">Is the Article Optimizer included?</summary>
            <p class="mt-2 text-sm text-slate-500 dark:text-slate-300">
              Yes for all paid plans (daily caps by tier). Free users get one verified run.
            </p>
          </details>

          <details class="card p-4">
            <summary class="font-semibold cursor-pointer">What is BYOK?</summary>
            <p class="mt-2 text-sm text-slate-500 dark:text-slate-300">
              “Bring Your Own Key.” Use your own model API key for extra capacity. We never store your key in plaintext.
            </p>
          </details>

          <details class="card p-4">
            <summary class="font-semibold cursor-pointer">Can I cancel anytime?</summary>
            <p class="mt-2 text-sm text-slate-500 dark:text-slate-300">
              Absolutely. Manage billing from your dashboard; your plan remains active until the end of the cycle.
            </p>
          </details>

          <details class="card p-4">
            <summary class="font-semibold cursor-pointer">Do you support teams?</summary>
            <p class="mt-2 text-sm text-slate-500 dark:text-slate-300">
              Yes — the Business plan includes 3 seats, shared calendar, org analytics, and white-label exports.
            </p>
          </details>

          <details class="card p-4">
            <summary class="font-semibold cursor-pointer">Which platforms can you export to?</summary>
            <p class="mt-2 text-sm text-slate-500 dark:text-slate-300">
              Notion and Trello on Creator+, plus Buffer queueing for LinkedIn, X, Facebook, and Instagram.
            </p>
          </details>
        </div>
      </div>
    </div>

    <!-- FAQ JSON-LD (kept near the section for clarity) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "What counts as a “generation”?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Any click on Generate that returns content (demo or signed-in). Batch mode counts per line."
          }
        },
        {
          "@type": "Question",
          "name": "Is the Article Optimizer included?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes for all paid plans (daily caps by tier). Free users get one verified run."
          }
        },
        {
          "@type": "Question",
          "name": "What is BYOK?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Bring Your Own Key — use your own model API key for extra capacity. We never store your key in plaintext."
          }
        },
        {
          "@type": "Question",
          "name": "Can I cancel anytime?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. Manage billing from your dashboard; your plan remains active until the end of the cycle."
          }
        },
        {
          "@type": "Question",
          "name": "Do you support teams?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes — the Business plan includes 3 seats, shared calendar, org analytics, and white-label exports."
          }
        },
        {
          "@type": "Question",
          "name": "Which platforms can you export to?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Notion and Trello on Creator+, plus Buffer queueing for LinkedIn, X, Facebook, and Instagram."
          }
        }
      ]
    }
    </script>
  </section>
<script>
/* ========= ContentRepurpose.pro — App wiring (Part 6/8) ========= */

/* NOTE: Auth helpers come from Part 1 (Supabase). We only reference them here to avoid duplicates. */

// --- CONFIG ---
const WORKER_BASE = "https://contentflow-worker.frank-couchman.workers.dev";

// --- tiny utils ---
const $ = (q, r=document) => r.querySelector(q);
const $$ = (q, r=document) => [...r.querySelectorAll(q)];
const byId = (id) => document.getElementById(id);
const sleep = (ms)=> new Promise(r=>setTimeout(r,ms));

function showToast(msg){
  const t = byId("toast"), m = byId("toastMsg");
  if (!t || !m) return alert(msg);
  m.textContent = msg;
  t.classList.remove("hidden");
  setTimeout(()=> t.classList.add("hidden"), 1800);
}

// Use global auth headers from Part 1; fallback to anonymous
async function getAuthHeaders(){
  if (typeof window.getAuthHeaders === "function") return await window.getAuthHeaders();
  return { "Content-Type":"application/json" };
}
function extractJSON(txt){
  try { return JSON.parse(txt); } catch {}
  const m = String(txt||"").match(/\{[\s\S]*\}$/);
  if (!m) return null;
  try { return JSON.parse(m[0]); } catch { return null; }
}

// --- NAV: burger + smooth anchor ---
(function navWire(){
  const toggle = byId("navToggle");
  const sheet  = byId("mobileNav");
  const close  = byId("navClose");
  if (toggle && sheet){
    toggle.addEventListener("click", ()=> document.body.classList.add("nav-open"));
  }
  if (close){
    close.addEventListener("click", ()=> document.body.classList.remove("nav-open"));
  }
  // smooth scroll for internal anchors
  $$('a[href^="#"]').forEach(a=>{
    a.addEventListener("click", (e)=>{
      const id = a.getAttribute("href");
      if (!id || id==="#" ) return;
      const el = $(id);
      if (el){
        e.preventDefault();
        el.scrollIntoView({ behavior:"smooth", block:"start" });
        document.body.classList.remove("nav-open");
        history.replaceState(null,"",id);
      }
    });
  });
})();

// --- Promo copy buttons (header + pricing rail) ---
["copyPromoBtn", "copyPromoBtn_pr"].forEach(id=>{
  const btn = byId(id);
  if (!btn) return;
  btn.addEventListener("click", async ()=>{
    try { await navigator.clipboard.writeText("CONTENTOFF90"); showToast("Code copied ✅"); }
    catch { showToast("Copy failed"); }
  });
});

// --- Sign-in modal triggers (hero + pricing rail + header) ---
["heroSignIn", "heroSignIn_pr", "loginBtn", "loginBtn_m"].forEach(id=>{
  const b = byId(id);
  if(!b) return;
  b.addEventListener("click", ()=>{
    // Part 1 wires magic-link prompt; if you have a <dialog id="auth"> it will still work
    const dlg = byId("auth");
    if (dlg && typeof dlg.showModal==="function") dlg.showModal();
  });
});

// --- Manage Billing (Stripe portal) ---
["manageBilling","manageBilling2","manageBilling_m"].forEach(id=>{
  const b = byId(id);
  if(!b) return;
  b.classList.remove("hidden");
  b.addEventListener("click", async ()=>{
    try{
      const r = await fetch(`${WORKER_BASE}/api/billing/portal`,{
        method:"POST", headers: await getAuthHeaders(),
        body: JSON.stringify({ return_url: location.origin })
      });
      const j = await r.json();
      if (!r.ok) throw new Error(j?.error?.message || "Portal error");
      location.href = j.url;
    }catch(e){ showToast(e.message || "Billing error"); }
  });
});

// --- Checkout buttons (plans) ---
$$(".subBtn").forEach(btn=>{
  btn.addEventListener("click", async ()=>{
    const price = btn.getAttribute("data-price");
    if(!price) return;
    try{
      const r = await fetch(`${WORKER_BASE}/api/billing/checkout`,{
        method:"POST",
        headers: await getAuthHeaders(),
        body: JSON.stringify({ price, success_url: `${location.origin}/?billing=success`, cancel_url: `${location.origin}/?billing=cancel` })
      });
      const j = await r.json();
      if (!r.ok) throw new Error(j?.error?.message || "Checkout error");
      location.href = j.url;
    }catch(e){ showToast(e.message || "Checkout error"); }
  });
});

// --- Live stats ticker (light) ---
(async function liveStats(){
  const countEl = byId("liveCount");
  if (!countEl) return;
  async function tick(){
    try{
      const r = await fetch(`${WORKER_BASE}/api/stats/today`);
      const j = await r.json();
      if (r.ok && typeof j.today_count === "number"){
        countEl.textContent = j.today_count.toString();
      }
    }catch{}
  }
  tick();
  setInterval(tick, 30000);
})();

// --- DEMO: form -> generate ---
(function demoWire(){
  const form = byId("demoForm");
  const src  = byId("sourceText");
  const outWrap = byId("demoOutput");
  const quotaEl = byId("demoQuota");
  const generateBtn = byId("generateBtn");
  const clearBtn = byId("clearBtn");

  if (!form || !src || !outWrap) return;

  clearBtn?.addEventListener("click", ()=>{
    src.value = "";
    outWrap.innerHTML = "";
  });

  // basic “remaining” paint from status endpoint (guest or authed)
  (async function paintQuota(){
    try{
      const r = await fetch(`${WORKER_BASE}/api/billing/status`, { headers: await getAuthHeaders() });
      const j = await r.json();
      if (r.ok){
        if (j.scope==="ip"){
          const cap = j.platform?.monthly?.cap ?? 5;
          const used = j.platform?.monthly?.used ?? 0;
          const left = Math.max(0, cap - used);
          if (quotaEl) quotaEl.textContent = left;
        } else {
          const capD = j.platform?.daily?.cap ?? 5;
          const usedD = j.platform?.daily?.used ?? 0;
          const left = (capD==null) ? "∞" : Math.max(0, capD - usedD);
          if (quotaEl) quotaEl.textContent = left;
        }
      }
    }catch{}
  })();

  function readToggles(){
    const g = (n)=> form.elements[n];
    return {
      // optimizers
      opt: {
        humanize:  g("opt_humanize")?.checked,
        lengthen:  g("opt_lengthen")?.checked,
        faqs:      g("opt_faqs")?.checked,
        headings:  g("opt_headings")?.checked,
        svg:       g("opt_svg")?.checked,
        seo:       g("opt_seo")?.checked
      },
      // channels
      ch: {
        linkedin:  g("ch_linkedin")?.checked,
        x:         g("ch_x")?.checked,
        email:     g("ch_email")?.checked,
        instagram: g("ch_instagram")?.checked,
        reddit:    g("ch_reddit")?.checked,
        facebook:  g("ch_facebook")?.checked,
        quora:     g("ch_quora")?.checked,
        tiktok:    g("ch_tiktok")?.checked,
      },
      // channel extras
      extras: {
        li_article: g("li_article")?.checked,
        x_sequence: g("x_sequence")?.checked,
        x_posts:    g("x_posts")?.value || "4",
        rdt_communities: g("rdt_communities")?.checked,
        rdt_comments:    g("rdt_comments")?.checked,
        tt_hooks:   g("tt_hooks")?.checked,
        tt_onscreen:g("tt_onscreen")?.checked
      }
    };
  }

  function systemPrompt(tog){
    // Strict JSON envelope for robust parsing
    return {
      role:"system",
      content:
`You are a senior social copywriter.
Return ONLY valid JSON with this shape:
{
  "outline": string,
  "linkedin": string|null,
  "x": string[]|null,
  "email": { "subject": string, "body": string }|null,
  "instagram": { "caption": string, "hashtags": string[] }|null,
  "reddit": { "title": string, "body": string, "communities": string[], "starter_comments": string[] }|null,
  "facebook": { "primary": string, "meta": { "headline": string, "description": string } }|null,
  "quora": { "answer": string, "followups": string[] }|null,
  "tiktok": { "hooks": string[], "script": string, "onscreen": string[] }|null,
  "linkedin_article_html": string|null
}
Respect these toggles: 
- Humanize: ${tog.opt.humanize ? "on" : "off"}
- Lengthen: ${tog.opt.lengthen ? "on" : "off"}
- Add FAQs: ${tog.opt.faqs ? "on" : "off"}
- Auto-headings: ${tog.opt.headings ? "on" : "off"}
- SVG ideas: ${tog.opt.svg ? "on" : "off"}
- SEO basics: ${tog.opt.seo ? "on" : "off"}
- X posts max: ${tog.extras.x_posts}
- X sequence format: ${tog.extras.x_sequence ? "on (Post 1…N)" : "off"}
- LinkedIn Article: ${tog.extras.li_article ? "on" : "off"}
- Reddit communities: ${tog.extras.rdt_communities ? "include" : "skip"}
- Reddit starter comments: ${tog.extras.rdt_comments ? "include" : "skip"}
- TikTok hooks: ${tog.extras.tt_hooks ? "3 variants" : "1 variant"}
- TikTok on-screen text: ${tog.extras.tt_onscreen ? "include" : "skip"}

Rules:
- Keep posts concise, skimmable and platform-native.
- X posts ≤ 280 chars when possible; if a thread is required, prefix "Post N:" per item.
- Provide meaningful hashtags (3–5) for Instagram.
- If a field/channel wasn't requested, set it to null; do NOT invent.
- NO prose outside the JSON.`
    };
  }

  function userPrompt(raw, tog){
    const srcType = form.elements["sourceType"]?.value || "paragraph";
    const head = srcType==="url" ? "URL" : (srcType==="blog" ? "Full Blog" : "Paragraph/Notes");
    const channels = Object.entries(tog.ch).filter(([,v])=>v).map(([k])=>k).join(", ");
    return {
      role:"user",
      content:
`${head}:
${raw}

Task:
1) Create a one-line outline.
2) Generate content ONLY for these channels: ${channels || "linkedin,x,email"}.
3) Apply the toggles and extras exactly.`
    };
  }

  function paintOutput(j){
    outWrap.innerHTML = ""; // clear first
    // LinkedIn
    if (j.linkedin){
      outWrap.insertAdjacentHTML("beforeend", `
        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight inline-flex items-center gap-2"><svg class="icon"><use href="#i-li"/></svg>LinkedIn</strong>
            <button class="btn copy">Copy</button>
          </div>
          <pre class="whitespace-pre-wrap text-sm mt-3 content">${j.linkedin}</pre>
        </div>`);
    }
    // X
    if (Array.isArray(j.x) && j.x.length){
      const seq = j.x.map((t,i)=>`Post ${i+1}: ${t}`).join("\n\n");
      outWrap.insertAdjacentHTML("beforeend", `
        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight inline-flex items-center gap-2"><svg class="icon"><use href="#i-x"/></svg>X (Twitter)</strong>
            <button class="btn copy">Copy</button>
          </div>
          <pre class="whitespace-pre-wrap text-sm mt-3 content">${seq}</pre>
          <div class="text-xs text-slate-500 mt-2">Sequence format: “Post 1 … Post N”.</div>
        </div>`);
    }
    // Email
    if (j.email && (j.email.subject || j.email.body)){
      outWrap.insertAdjacentHTML("beforeend", `
        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight inline-flex items-center gap-2"><svg class="icon"><use href="#i-mail"/></svg>Email</strong>
            <button class="btn copy">Copy</button>
          </div>
          <div class="text-xs text-slate-400">Subject:</div>
          <pre class="whitespace-pre-wrap text-sm mt-1 content">${j.email.subject||""}</pre>
          <div class="text-xs text-slate-400 mt-3">Body:</div>
          <pre class="whitespace-pre-wrap text-sm mt-1 content">${j.email.body||""}</pre>
        </div>`);
    }
    // Instagram
    if (j.instagram){
      const cap = j.instagram.caption||"";
      const tags = (j.instagram.hashtags||[]).map(h=> (h.startsWith("#")?h:"#"+h)).join(" ");
      outWrap.insertAdjacentHTML("beforeend", `
        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight inline-flex items-center gap-2"><svg class="icon"><use href="#i-ig"/></svg>Instagram</strong>
            <button class="btn copy">Copy</button>
          </div>
          <pre class="whitespace-pre-wrap text-sm mt-3 content">${cap}\n\n${tags}</pre>
        </div>`);
    }
    // Reddit
    if (j.reddit){
      const subs = (j.reddit.communities||[]).map(s=>`r/${s}`).join(", ");
      const starters = (j.reddit.starter_comments||[]).map((c,i)=>`• ${c}`).join("\n");
      outWrap.insertAdjacentHTML("beforeend", `
        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight inline-flex items-center gap-2"><svg class="icon"><use href="#i-reddit"/></svg>Reddit</strong>
            <button class="btn copy">Copy</button>
          </div>
          <div class="text-xs text-slate-400">Main post:</div>
          <pre class="whitespace-pre-wrap text-sm mt-1 content"><strong>${j.reddit.title||""}</strong>\n\n${j.reddit.body||""}</pre>
          <div class="text-xs text-slate-400 mt-3">Suggested communities:</div>
          <pre class="whitespace-pre-wrap text-sm mt-1 content">${subs || "—"}</pre>
          <div class="text-xs text-slate-400 mt-3">Starter comments:</div>
          <pre class="whitespace-pre-wrap text-sm mt-1 content">${starters || "—"}</pre>
        </div>`);
    }
    // Facebook
    if (j.facebook){
      outWrap.insertAdjacentHTML("beforeend", `
        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight inline-flex items-center gap-2"><svg class="icon"><use href="#i-fb"/></svg>Facebook</strong>
            <button class="btn copy">Copy</button>
          </div>
          <div class="text-xs text-slate-400">Primary text:</div>
          <pre class="whitespace-pre-wrap text-sm mt-1 content">${j.facebook.primary||""}</pre>
          <div class="text-xs text-slate-400 mt-3">Link preview headline/description:</div>
          <pre class="whitespace-pre-wrap text-sm mt-1 content">${(j.facebook.meta?.headline||"")}\n${(j.facebook.meta?.description||"")}</pre>
        </div>`);
    }
    // Quora
    if (j.quora){
      const follow = (j.quora.followups||[]).map(f=>`• ${f}`).join("\n");
      outWrap.insertAdjacentHTML("beforeend", `
        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight inline-flex items-center gap-2"><svg class="icon"><use href="#i-quora"/></svg>Quora</strong>
            <button class="btn copy">Copy</button>
          </div>
          <div class="text-xs text-slate-400">Answer:</div>
          <pre class="whitespace-pre-wrap text-sm mt-1 content">${j.quora.answer||""}</pre>
          <div class="text-xs text-slate-400 mt-3">Follow-up prompts:</div>
          <pre class="whitespace-pre-wrap text-sm mt-1 content">${follow || "—"}</pre>
        </div>`);
    }
    // TikTok
    if (j.tiktok){
      const hooks = (j.tiktok.hooks||[]).map(h=>`• ${h}`).join("\n");
      const ons = (j.tiktok.onscreen||[]).map(o=>`• ${o}`).join("\n");
      outWrap.insertAdjacentHTML("beforeend", `
        <div class="card p-5">
          <div class="flex justify-between items-center gap-2 flex-wrap">
            <strong class="tracking-tight inline-flex items-center gap-2"><svg class="icon"><use href="#i-tt"/></svg>TikTok</strong>
            <button class="btn copy">Copy</button>
          </div>
          <div class="text-xs text-slate-400">Script:</div>
          <pre class="whitespace-pre-wrap text-sm mt-1 content">${j.tiktok.script||""}</pre>
          <div class="text-xs text-slate-400 mt-3">Hooks:</div>
          <pre class="whitespace-pre-wrap text-sm mt-1 content">${hooks || "—"}</pre>
          <div class="text-xs text-slate-400 mt-3">On-screen plan:</div>
          <pre class="whitespace-pre-wrap text-sm mt-1 content">${ons || "—"}</pre>
        </div>`);
    }

    // copy buttons inside outputs
    $$(".card .btn.copy", outWrap).forEach(b=>{
      b.addEventListener("click", async ()=>{
        const pre = b.closest(".card")?.querySelector("pre.content");
        if (!pre) return;
        try{ await navigator.clipboard.writeText(pre.innerText); showToast("Copied ✅"); }
        catch{ showToast("Copy failed"); }
      });
    });
  }

  form.addEventListener("submit", async (e)=>{
    e.preventDefault();
    const raw = (src.value||"").trim();
    if (!raw){ showToast("Paste some content first"); return; }

    try{
      generateBtn.disabled = true; generateBtn.textContent = "Generating…";
      outWrap.innerHTML = `<div class="card p-5 text-sm text-slate-500">Working…</div>`;

      const tog = readToggles();
      const messages = [ systemPrompt(tog), userPrompt(raw, tog) ];
      const r = await fetch(`${WORKER_BASE}/api/generate`,{
        method:"POST",
        headers: await getAuthHeaders(),
        body: JSON.stringify({ plan: "free", temperature: 0.5, messages })
      });
      const data = await r.json();
      if (!r.ok) throw new Error(data?.error?.message || "Generation failed");

      const content = data?.choices?.[0]?.message?.content || "";
      const j = extractJSON(content);
      if (!j) throw new Error("Model did not return JSON");

      paintOutput(j);
      showToast("Done ✅");
    }catch(e){
      outWrap.innerHTML = `<div class="card p-5 text-sm text-red-500">Error: ${e.message || e}</div>`;
    }finally{
      generateBtn.disabled = false; generateBtn.textContent = "Generate";
    }
  });
})();

// --- Footer year ---
(function(){ const y = byId("year"); if (y) y.textContent = new Date().getFullYear(); })();
</script>

<script>
/* ========= ContentRepurpose.pro — Member wiring (Part 7/8) ========= */

(function memberBoot(){
  const elMember = byId("memberView");
  if (!elMember) return; // safety if member section not present

  // Use global auth headers from Part 1 if present
  async function getAuthHeadersLocal(){
    if (typeof window.getAuthHeaders === "function") return await window.getAuthHeaders();
    return { "Content-Type":"application/json" };
  }

  // ---- PLAN + QUOTA PAINT ----
  async function paintStatus(){
    try{
      const r = await fetch(`${WORKER_BASE}/api/billing/status`, { headers: await getAuthHeadersLocal() });
      const j = await r.json();
      if (!r.ok) throw new Error(j?.error?.message || "Status error");

      // Header badges
      const plan = (j.plan || "free").toLowerCase();
      if (byId("memberPlanBadge")) byId("memberPlanBadge").textContent = `Plan: ${plan.charAt(0).toUpperCase()+plan.slice(1)}`;

      // Header manage billing visibility for paid
      if (plan !== "free"){
        ["manageBilling2","manageBilling","manageBilling_m"].forEach(id => byId(id)?.classList.remove("hidden"));
      }

      // Top quota chips
      const qc = byId("quotaCards");
      if (qc){
        const pd = j.platform?.daily || {used:0, cap:null};
        const pm = j.platform?.monthly || {used:0, cap:null};
        const bd = j.byok?.daily || {used:0, cap:0};
        const bm = j.byok?.monthly || {used:0, cap:0};
        qc.innerHTML = `
          <div class="stat"><div class="text-xs text-slate-500">Platform • Today</div><div class="k">${pd.used}/${pd.cap ?? "∞"}</div></div>
          <div class="stat"><div class="text-xs text-slate-500">Platform • This month</div><div class="k">${pm.used}/${pm.cap ?? "∞"}</div></div>
          <div class="stat"><div class="text-xs text-slate-500">BYOK • Today</div><div class="k">${bd.used}/${bd.cap ?? "—"}</div></div>
          <div class="stat"><div class="text-xs text-slate-500">BYOK • This month</div><div class="k">${bm.used}/${bm.cap ?? "—"}</div></div>
        `;
      }

      // “Today: x/y” chip near Create
      const q = byId("quotaMember");
      if (q){
        const used = j.platform?.daily?.used ?? 0;
        const cap  = j.platform?.daily?.cap ?? 5;
        q.textContent = `Today: ${used}/${cap ?? "∞"}`;
      }

      // Feature list
      const fl = byId("featureList");
      if (fl){
        let feats = [];
        if (plan==="free"){
          feats = [
            "5 runs/day • signed-in",
            "Article Optimizer • one-time trial",
            "Export CSV/Markdown",
            "BYOK: 5/day"
          ];
        } else if (plan==="starter"){
          feats = [
            "200 generations/month",
            "Batch (up to 5 lines/run)",
            "10 saved presets",
            "Scheduler (queue & calendar)",
            "Analytics (basics)",
            "BYOK: 50/month (+5 daily headroom)"
          ];
        } else if (plan==="creator"){
          feats = [
            "500 generations/month",
            "Unlimited presets",
            "Project pack export",
            "Notion & Trello export",
            "Buffer queue",
            "Analytics Pro (per-channel)",
            "BYOK: 150/month (+10 daily)"
          ];
        } else {
          feats = [
            "Unlimited (fair use)",
            "3 seats included",
            "White-label export",
            "Team presets & shared calendar",
            "Priority support",
            "Team Analytics (org-wide)",
            "BYOK: 300/month (+30 daily)"
          ];
        }
        fl.innerHTML = feats.map(f=>`<li>• ${f}</li>`).join("");
      }

      // Integrations badges (if already connected)
      const iNotion = j.integrations?.notion?.connected;
      const iTrello = j.integrations?.trello?.connected;
      if (byId("notionState")) byId("notionState").textContent = iNotion ? "Connected" : "Disconnected";
      if (byId("trelloState")) byId("trelloState").textContent = iTrello ? "Connected" : "Disconnected";
      if (iNotion){ byId("connectNotion")?.classList.add("hidden"); byId("disconnectNotion")?.classList.remove("hidden"); }
      if (iTrello){ byId("connectTrello")?.classList.add("hidden"); byId("disconnectTrello")?.classList?.remove("hidden"); } // (disconnectTrello not in DOM in this rev)

      // Team section visibility (Business)
      const teamCard = byId("teamCard");
      if (teamCard){
        teamCard.style.display = (plan==="business") ? "" : "none";
        if (plan==="business") refreshOrgMembers();
      }

      // White-label toggle
      const wl = byId("whitelabel");
      const wlLabel = byId("wlLabel");
      if (wl && wlLabel){
        const enabled = !!(j.org && j.org.white_label);
        wl.checked = enabled;
        wlLabel.classList.remove("hidden");
      }
    }catch(e){ /* non-fatal */ }
  }
  paintStatus();

  // ---- BYOK SAVE/GET ----
  byId("save_m")?.addEventListener("click", async ()=>{
    const provider = byId("byok_provider_m")?.value || "";
    const key      = byId("byok_key_m")?.value?.trim() || "";
    const base     = byId("byok_base_m")?.value?.trim() || "";
    const model    = byId("model_m")?.value?.trim() || "";
    if (!key){ showToast("Add your API key first"); return; }
    try{
      const r = await fetch(`${WORKER_BASE}/api/byok/save`,{
        method:"POST", headers: await getAuthHeadersLocal(),
        body: JSON.stringify({ provider, key, base, model })
      });
      const j = await r.json();
      if (!r.ok) throw new Error(j?.error?.message || "Could not save");
      showToast("BYOK saved ✅");
    }catch(e){ showToast(e.message || "Save failed"); }
  });

  (async function hydrateBYOK(){
    try{
      const r = await fetch(`${WORKER_BASE}/api/byok/get`, { headers: await getAuthHeadersLocal() });
      const j = await r.json();
      if (!r.ok) return;
      if (byId("byok_provider_m")) byId("byok_provider_m").value = j.provider || "";
      if (byId("byok_key_m"))      byId("byok_key_m").value      = j.key || "";
      if (byId("byok_base_m"))     byId("byok_base_m").value     = j.base || "";
      if (byId("model_m"))         byId("model_m").value         = j.model || "";
    }catch{}
  })();

  // ---- MEMBER GENERATE (platform & BYOK) ----
  const gsrc   = byId("source_m");
  const gst    = byId("status_m");
  const outIds = {
    li: "out-li_m", liArticle: "out-li-article_m",
    x: "out-x_m",
    emSubj: "out-em-subj_m", emBody:"out-em-body_m",
    ig: "out-ig_m",
    reddit: "out-reddit_m", redditSubs:"out-reddit-subs_m", redditCom:"out-reddit-comments_m",
    fb: "out-fb_m", fbMeta:"out-fb-meta_m",
    quora: "out-quora_m", quoraP:"out-quora-prompts_m",
    tt: "out-tt_m", ttOn: "out-tt-onscreen_m"
  };
  function clearMemberOutputs(){
    Object.values(outIds).forEach(id => {
      const el = byId(id);
      if (!el) return;
      if (el.tagName==="UL") el.innerHTML = "";
      else el.textContent = "";
    });
  }
  function readMemberToggles(){
    return {
      opt: {
        humanize:  byId("opt_humanize_m")?.checked,
        lengthen:  byId("opt_lengthen_m")?.checked,
        faqs:      byId("opt_faqs_m")?.checked,
        headings:  byId("opt_headings_m")?.checked,
        svg:       byId("opt_svg_m")?.checked,
        seo:       byId("opt_seo_m")?.checked
      }
    };
  }

  function sysMember(){
    return {
      role:"system",
      content:
`You are a social + editorial repurposer. Return ONLY valid JSON with keys:
{
  "linkedin": string|null,
  "x": string[]|null,
  "email": { "subject": string, "body": string }|null,
  "instagram": { "caption": string, "hashtags": string[] }|null,
  "reddit": { "title": string, "body": string, "communities": string[], "starter_comments": string[] }|null,
  "facebook": { "primary": string, "meta": { "headline": string, "description": string } }|null,
  "quora": { "answer": string, "followups": string[] }|null,
  "tiktok": { "hooks": string[], "script": string, "onscreen": string[] }|null,
  "linkedin_article_html": string|null
}
Guidelines: skimmable, native tone; X posts ≤ 280 chars when possible; IG hashtags 3–5; NO prose outside JSON.`
    };
  }
  function usrMember(src){
    return { role:"user", content:`Source:\n${src}\n\nGenerate for LinkedIn, X, Email, Instagram, Reddit, Facebook, Quora, TikTok. If missing context, be conservative.` };
  }
  function paintMember(j){
    // LI
    if (j.linkedin && byId(outIds.li)) byId(outIds.li).textContent = j.linkedin;
    if (j.linkedin_article_html && byId(outIds.liArticle)) byId(outIds.liArticle).innerHTML = j.linkedin_article_html;

    // X
    if (Array.isArray(j.x) && j.x.length && byId(outIds.x)){
      byId(outIds.x).textContent = j.x.map((t,i)=>`Post ${i+1}: ${t}`).join("\n\n");
    }

    // Email
    if (j.email){
      if (byId(outIds.emSubj)) byId(outIds.emSubj).textContent = j.email.subject || "";
      if (byId(outIds.emBody)) byId(outIds.emBody).textContent = j.email.body || "";
    }

    // IG
    if (j.instagram){
      const tags = (j.instagram.hashtags||[]).map(h=> h.startsWith("#")?h:"#"+h).join(" ");
      if (byId(outIds.ig)) byId(outIds.ig).textContent = `${j.instagram.caption||""}\n\n${tags}`;
    }

    // Reddit
    if (j.reddit){
      if (byId(outIds.reddit)) byId(outIds.reddit).textContent = `**${j.reddit.title||""}**\n\n${j.reddit.body||""}`;
      if (byId(outIds.redditSubs)) byId(outIds.redditSubs).innerHTML = (j.reddit.communities||[]).slice(0,8).map(s=>`<li>r/${s}</li>`).join("");
      if (byId(outIds.redditCom)) byId(outIds.redditCom).textContent = (j.reddit.starter_comments||[]).map(c=>`• ${c}`).join("\n");
    }

    // FB
    if (j.facebook){
      if (byId(outIds.fb)) byId(outIds.fb).textContent = j.facebook.primary || "";
      if (byId(outIds.fbMeta)) byId(outIds.fbMeta).textContent = `${j.facebook.meta?.headline||""}\n${j.facebook.meta?.description||""}`;
    }

    // Quora
    if (j.quora){
      if (byId(outIds.quora)) byId(outIds.quora).textContent = j.quora.answer || "";
      if (byId(outIds.quoraP)) byId(outIds.quoraP).textContent = (j.quora.followups||[]).map(x=>`• ${x}`).join("\n");
    }

    // TikTok
    if (j.tiktok){
      if (byId(outIds.tt)) byId(outIds.tt).textContent = j.tiktok.script || "";
      if (byId(outIds.ttOn)) byId(outIds.ttOn).textContent = (j.tiktok.onscreen||[]).map(x=>`• ${x}`).join("\n");
    }
  }

  async function runMember({ lane="platform" }={}){
    const raw = (gsrc?.value||"").trim();
    if (!raw){ showToast("Paste an idea, excerpt, or URL first"); return; }
    const btn = (lane==="byok") ? byId("run-byok_m") : byId("run_m");
    try{
      btn && (btn.disabled=true, btn.textContent="Generating…");
      gst && (gst.textContent="Working…");
      clearMemberOutputs();

      const messages = [ sysMember(readMemberToggles()), usrMember(raw) ];
      const body = { messages, temperature: 0.4 };
      if (lane==="byok"){ body.plan = "byok"; body.use_byok = true; }
      else { body.plan = "member"; }

      const r = await fetch(`${WORKER_BASE}/api/generate`,{
        method:"POST", headers: await getAuthHeadersLocal(),
        body: JSON.stringify(body)
      });
      const data = await r.json();
      if (!r.ok) throw new Error(data?.error?.message || "Generation failed");

      const content = data?.choices?.[0]?.message?.content || "";
      const j = (function(){ try { return JSON.parse(content); } catch { return null; } })() || (function(){
        const m = String(content||"").match(/\{[\s\S]*\}$/); if (!m) return null;
        try { return JSON.parse(m[0]); } catch { return null; }
      })();
      if (!j) throw new Error("Model did not return JSON");

      paintMember(j); 
      gst && (gst.textContent="Done ✅");
      bumpAnalytics("generation"); // local analytics
    }catch(e){
      gst && (gst.textContent = `Error: ${e.message || e}`);
    }finally{
      btn && (btn.disabled=false, btn.textContent = (lane==="byok") ? "Generate with your BYOK" : "Generate");
      paintStatus();
    }
  }

  byId("run_m")?.addEventListener("click", ()=> runMember({ lane:"platform" }));
  byId("run-byok_m")?.addEventListener("click", ()=> runMember({ lane:"byok" }));
  byId("clear_m")?.addEventListener("click", ()=>{
    gsrc && (gsrc.value = "");
    clearMemberOutputs();
    gst && (gst.textContent="";
    );
  });

  // ---- EXPORTS (Notion, Trello) ----
  // Notion: simple page composed from LinkedIn + X
  byId("li-notion")?.classList.remove("hidden");
  byId("li-notion")?.addEventListener("click", async ()=>{
    const title = "LinkedIn draft";
    const blocks = [];
    const li = byId(outIds.li)?.textContent || "";
    const x  = byId(outIds.x)?.textContent || "";
    if (li) blocks.push({ type:"heading", text:"LinkedIn" }, { type:"paragraph", text: li });
    if (x)  blocks.push({ type:"heading", text:"X (Twitter)" }, { type:"paragraph", text: x });
    try{
      const r = await fetch(`${WORKER_BASE}/api/integrations/notion/export`,{
        method:"POST", headers: await getAuthHeadersLocal(),
        body: JSON.stringify({ title, blocks })
      });
      const j = await r.json();
      if (!r.ok) throw new Error(j?.error?.message || "Notion export failed");
      showToast("Sent to Notion ✅");
      window.open(j.url, "_blank");
    }catch(e){ showToast(e.message || "Notion export failed"); }
  });

  // Trello: open modal and send
  const trelloBtn = byId("li-trello");
  const trelloDialog = byId("trelloModal");
  if (trelloBtn && trelloDialog){
    trelloBtn.classList.remove("hidden");
    trelloBtn.addEventListener("click", ()=> trelloDialog.showModal());
    byId("trelloConfirm")?.addEventListener("click", async ()=>{
      const board_id = byId("trelloBoardId")?.value?.trim();
      const list_id  = byId("trelloListId")?.value?.trim();
      if (!list_id){ showToast("Enter List ID"); return; }
      const title = "Social Draft";
      const description = [
        "LinkedIn:\n"+(byId(outIds.li)?.textContent||""),
        "\nX:\n"+(byId(outIds.x)?.textContent||"")
      ].join("\n");
      try{
        const r = await fetch(`${WORKER_BASE}/api/integrations/trello/export`,{
          method:"POST", headers: await getAuthHeadersLocal(),
          body: JSON.stringify({ board_id, list_id, title, description })
        });
        const j = await r.json();
        if (!r.ok) throw new Error(j?.error?.message || "Trello export failed");
        showToast("Sent to Trello ✅");
        trelloDialog.close();
        if (j.url) window.open(j.url, "_blank");
      }catch(e){ showToast(e.message || "Trello export failed"); }
    });
  }

  // Connect Trello / Notion
  byId("connectTrello")?.addEventListener("click", async ()=>{
    try{
      const r = await fetch(`${WORKER_BASE}/api/integrations/trello/oauth/start`, { headers: await getAuthHeadersLocal() });
      const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message || "Start Trello OAuth failed");
      location.href = j.url;
    }catch(e){ showToast(e.message || "Trello connect failed"); }
  });
  byId("connectNotion")?.addEventListener("click", async ()=>{
    try{
      const r = await fetch(`${WORKER_BASE}/api/integrations/notion/oauth/start`, { headers: await getAuthHeadersLocal() });
      const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message || "Start Notion OAuth failed");
      location.href = j.url;
    }catch(e){ showToast(e.message || "Notion connect failed"); }
  });
  byId("disconnectNotion")?.addEventListener("click", async ()=>{
    try{
      const r = await fetch(`${WORKER_BASE}/api/integrations/notion/disconnect`,{ method:"POST", headers: await getAuthHeadersLocal() });
      if (!r.ok){ const j = await r.json(); throw new Error(j?.error?.message || "Disconnect failed"); }
      showToast("Notion disconnected");
      paintStatus();
    }catch(e){ showToast(e.message || "Notion disconnect failed"); }
  });

  // ---- EMAIL PREVIEW ----
  const emailDlg = byId("emailPreview");
  byId("publish-em_m")?.addEventListener("click", ()=>{
    if (!emailDlg) return;
    byId("emailSubjEdit").value = byId(outIds.emSubj)?.textContent || "";
    byId("emailBodyEdit").value = byId(outIds.emBody)?.textContent || "";
    emailDlg.showModal();
  });
  byId("emailSendBtn")?.addEventListener("click", ()=>{
    const subj = encodeURIComponent(byId("emailSubjEdit").value || "");
    const body = encodeURIComponent(byId("emailBodyEdit").value || "");
    location.href = `mailto:?subject=${subj}&body=${body}`;
  });

  // ---- COPY buttons (member) ----
  function simpleCopy(id, btnId){
    const b = byId(btnId);
    if (!b) return;
    b.addEventListener("click", async ()=>{
      try{ await navigator.clipboard.writeText(byId(id)?.textContent || ""); showToast("Copied ✅"); }
      catch{ showToast("Copy failed"); }
    });
  }
  simpleCopy(outIds.li, "copy-li_m");
  simpleCopy(outIds.x,  "copy-x_m");
  simpleCopy(outIds.emSubj, "copy-em_m"); // copies subject only; body is in preview modal
  simpleCopy(outIds.ig, "copy-ig_m");
  simpleCopy(outIds.reddit, "copy-reddit_m");
  simpleCopy(outIds.fb, "copy-fb_m");
  simpleCopy(outIds.quora, "copy-quora_m");
  simpleCopy(outIds.tt, "copy-tt_m");

  // ---- Scheduler (local-only queue UI) ----
  const schedKey = "crp_scheduler_queue_v1";
  const schedList = byId("schedList");
  function loadSched(){ try{ return JSON.parse(localStorage.getItem(schedKey)||"[]"); }catch{return [];} }
  function saveSched(arr){ localStorage.setItem(schedKey, JSON.stringify(arr)); }
  function paintSched(){
    const items = loadSched().sort((a,b)=> new Date(a.when) - new Date(b.when));
    if (!schedList) return;
    schedList.innerHTML = items.map((it,i)=> `<li class="p-2 rounded-lg border flex items-center justify-between"><span class="text-xs">${new Date(it.when).toLocaleString()} • ${it.channel}</span><button data-i="${i}" class="btn text-xs">Remove</button></li>`).join("");
    $$("button[data-i]", schedList).forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const i = Number(btn.getAttribute("data-i"));
        const arr = loadSched(); arr.splice(i,1); saveSched(arr); paintSched();
      });
    });
  }
  byId("schedSave")?.addEventListener("click", ()=>{
    const ch = byId("schedChannel")?.value || "linkedin";
    const when = byId("schedWhen")?.value;
    const content = byId("schedContent")?.value?.trim() || "";
    if (!when || !content){ showToast("Pick date/time and paste content"); return; }
    const arr = loadSched(); arr.push({ channel: ch, when, content }); saveSched(arr); paintSched(); showToast("Added to queue ✅");
  });
  byId("schedClear")?.addEventListener("click", ()=>{
    byId("schedContent").value = ""; showToast("Cleared");
  });
  paintSched();

  // ---- Analytics (local only; augments with live count) ----
  const anCount = byId("anCount");
  const anTop   = byId("anTop");
  const anRecent = byId("anRecent");
  const anChart = byId("anChart"); // placeholder box
  const analyticsKey = "crp_local_analytics_v1";
  function getAn(){ try{ return JSON.parse(localStorage.getItem(analyticsKey)||"{}"); }catch{return{}}; }
  function setAn(obj){ localStorage.setItem(analyticsKey, JSON.stringify(obj)); }
  function bumpAnalytics(kind){
    const an = getAn();
    an.events = an.events || [];
    an.events.push({ t: Date.now(), kind });
    setAn(an);
    paintAnalytics();
  }
  function paintAnalytics(){
    const an = getAn();
    const events = (an.events||[]).filter(e => Date.now() - e.t < 1000*60*60*24*90); // last 90d
    const byDay = {};
    events.forEach(e=>{
      const d = new Date(e.t).toISOString().slice(0,10);
      byDay[d] = (byDay[d]||0)+1;
    });
    const total = events.length;
    if (anCount) anCount.textContent = String(total);
    if (anTop) anTop.textContent = "LinkedIn"; // placeholder until real per-channel telemetry
    if (anRecent) anRecent.innerHTML = events.slice(-5).reverse().map(e=>`<li class="p-2 rounded-lg border text-xs">Generated • ${new Date(e.t).toLocaleString()}</li>`).join("");
    if (anChart){ anChart.textContent = "Volume (local): " + Object.values(byDay).slice(-7).join(", ");
    }
  }
  paintAnalytics();
  window.bumpAnalytics = bumpAnalytics; // used by generator painting

  // ---- Presets (save/load/delete) ----
  const presetList = byId("presetList"); // optional: if you add a list
  async function loadPresets(){
    if (!presetList) return;
    try{
      const r = await fetch(`${WORKER_BASE}/api/presets/list`, { headers: await getAuthHeadersLocal() });
      const j = await r.json();
      if (!r.ok) throw new Error(j?.error?.message || "Load presets failed");
      const arr = j.presets || [];
      presetList.innerHTML = arr.length ? arr.map(p=>`<li class="p-2 rounded-lg border flex items-center justify-between">
        <span class="text-xs">${p.title}</span>
        <div class="flex gap-2">
          <button data-id="${p.id}" class="btn text-xs loadPreset">Load</button>
          <button data-id="${p.id}" class="btn text-xs delPreset">Delete</button>
        </div>
      </li>`).join("") : `<li class="text-xs text-slate-500">No presets yet</li>`;
      $$(".loadPreset", presetList).forEach(b=> b.addEventListener("click", ()=> showToast("Preset load stub (map to UI fields)")));
      $$(".delPreset", presetList).forEach(b=> b.addEventListener("click", async ()=>{
        const id = b.getAttribute("data-id");
        const r = await fetch(`${WORKER_BASE}/api/presets/delete`, { method:"POST", headers: await getAuthHeadersLocal(), body: JSON.stringify({ id }) });
        if (!r.ok){ const jj = await r.json(); showToast(jj?.error?.message || "Delete failed"); return; }
        showToast("Preset deleted"); loadPresets();
      }));
    }catch(e){ /* non-fatal */ }
  }
  loadPresets();

  // ---- Teams (Business)
  async function refreshOrgMembers(){
    try{
      const r = await fetch(`${WORKER_BASE}/api/org/members`, { headers: await getAuthHeadersLocal() });
      const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message || "Org members error");
      const list = byId("seatList");
      if (list){
        list.innerHTML = (j.members||[]).map(m=> `<li class="p-2 rounded-lg border text-xs flex items-center justify-between">
          <span>${m.email || m.user_id}</span>
          ${j.owner_id===m.user_id ? `<span class="chip">Owner</span>` : `<button data-id="${m.user_id}" class="btn text-xs removeSeat">Remove</button>`}
        </li>`).join("") + (j.invites && j.invites.length ? `<li class="p-2 rounded-lg border text-xs">Invites: ${j.invites.map(i=>i.email).join(", ")}</li>` : "");
        $$(".removeSeat", list).forEach(b=>{
          b.addEventListener("click", async ()=>{
            const uid = b.getAttribute("data-id");
            const r2 = await fetch(`${WORKER_BASE}/api/org/remove`, {
              method:"POST", headers: await getAuthHeadersLocal(), body: JSON.stringify({ user_id: uid })
            });
            if (!r2.ok){ const jj = await r2.json(); showToast(jj?.error?.message || "Remove failed"); return; }
            showToast("Removed"); refreshOrgMembers();
          });
        });
      }
    }catch(e){ /* non-fatal */ }
  }
  byId("inviteBtn")?.addEventListener("click", async ()=>{
    try{
      // ensure org exists
      await fetch(`${WORKER_BASE}/api/org/ensure`, { method:"POST", headers: await getAuthHeadersLocal(), body: JSON.stringify({ name:"Your Team" }) });
      const email = byId("inviteEmail")?.value?.trim();
      if (!email){ showToast("Enter an email"); return; }
      const r = await fetch(`${WORKER_BASE}/api/org/invite`, { method:"POST", headers: await getAuthHeadersLocal(), body: JSON.stringify({ email }) });
      const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message || "Invite failed");
      showToast("Invite sent ✅");
      byId("inviteEmail").value = "";
      refreshOrgMembers();
    }catch(e){ showToast(e.message || "Invite failed"); }
  });

})();
</script>

<script>
/* ========= ContentRepurpose.pro — Final polish (Part 8/8) ========= */

(function finalPolish(){
  // --- Shortcuts to shared helpers from earlier parts ---
  const $  = (sel, el=document) => el.querySelector(sel);
  const $$ = (sel, el=document) => [...el.querySelectorAll(sel)];
  const byId = id => document.getElementById(id);
  const noop = ()=>{};
  const sleep = (ms)=> new Promise(r=>setTimeout(r,ms));

  // --- Safe toast (reuses Part 6’s showToast if present) ---
  function toast(msg){
    if (typeof window.showToast === "function") return window.showToast(msg);
    console.log("[toast]", msg);
  }

  // --- Smooth scroll to anchors/sections ---
  function smoothScrollTo(el){
    try{ el?.scrollIntoView({ behavior:"smooth", block:"start" }); }catch{ el?.scrollIntoView(); }
  }

  // --- Tiny router: #demo, #pricing, #signin, #member ---
  async function routeFromHash(){
    const h = (location.hash||"").replace(/^#/, "").toLowerCase();
    if (!h) return;

    if (h==="demo"){
      const v = byId("demoView") || byId("hero") || byId("demo");
      smoothScrollTo(v);
      byId("source")?.focus();
      return;
    }
    if (h==="pricing"){
      const v = byId("pricing") || byId("plans");
      smoothScrollTo(v);
      return;
    }
    if (h==="signin" || h==="login"){
      if (typeof window.doSignIn === "function") return window.doSignIn().catch(noop);
      toast("Sign-in is available from the top-right button.");
      return;
    }
    if (h==="member" || h==="dashboard"){
      const v = byId("memberView") || byId("hero");
      smoothScrollTo(v);
      return;
    }
  }
  window.addEventListener("hashchange", routeFromHash);
  routeFromHash();

  // --- “Try Demo” / hero buttons ---
  const tryDemoBtns = $$('[data-action="try-demo"]');
  tryDemoBtns.forEach(btn=>{
    btn.addEventListener("click", ()=>{
      location.hash = "demo";
      const pre = btn.getAttribute("data-prefill");
      if (pre && byId("source")) byId("source").value = pre;
    });
  });

  // --- “Sign in” buttons (header + hero) ---
  const signInBtns = $$('[data-action="sign-in"]');
  signInBtns.forEach(b=>{
    b.addEventListener("click", async ()=>{
      if (typeof window.doSignIn === "function"){
        try{ await window.doSignIn(); }catch(e){ toast(e.message||"Sign-in failed"); }
      }else{
        location.hash = "signin";
      }
    });
  });

  // --- “Copy code” (coupon, snippets) ---
  $$('[data-copy]').forEach(btn=>{
    btn.addEventListener("click", async ()=>{
      const val = btn.getAttribute("data-copy") || btn.textContent.trim();
      try{ await navigator.clipboard.writeText(val); toast("Copied ✓"); }
      catch{ toast("Copy failed"); }
    });
  });

  // --- FAQ accordion (keyboard + a11y) ---
  $$('.faq-item').forEach(item=>{
    const header = $('.faq-q', item);
    const panel  = $('.faq-a', item);
    if (!header || !panel) return;
    const id = header.id || ('faq_' + Math.random().toString(36).slice(2));
    header.id = id;
    header.setAttribute('role','button');
    header.setAttribute('tabindex','0');
    header.setAttribute('aria-expanded','false');
    panel.setAttribute('role','region');
    panel.setAttribute('aria-labelledby', id);
    panel.hidden = true;

    function toggle(){
      const open = header.getAttribute('aria-expanded') === 'true';
      header.setAttribute('aria-expanded', String(!open));
      panel.hidden = open;
    }
    header.addEventListener('click', toggle);
    header.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggle(); }
      if (e.key === 'ArrowDown'){ e.preventDefault(); header.parentElement?.nextElementSibling?.querySelector?.('.faq-q')?.focus(); }
      if (e.key === 'ArrowUp'){ e.preventDefault(); header.parentElement?.previousElementSibling?.querySelector?.('.faq-q')?.focus(); }
    });
  });

  // --- Pricing CTAs → checkout
  async function getAuthHeaders(){
    if (typeof window.getAuthHeaders === "function") return await window.getAuthHeaders();
    return { "Content-Type":"application/json" };
  }
  const WORKER_BASE = window.WORKER_BASE || "https://contentflow-worker.frank-couchman.workers.dev";

  $$('[data-checkout="stripe"]').forEach(btn=>{
    btn.addEventListener("click", async ()=>{
      const price = btn.getAttribute("data-price") || "";
      if (!price){ toast("Missing price id on button"); return; }
      btn.disabled = true; const old = btn.textContent; btn.textContent = "Opening…";
      try{
        const body = {
          price,
          success_url: location.origin + "/?billing=success",
          cancel_url:  location.origin + "/?billing=cancel"
        };
        const r = await fetch(`${WORKER_BASE}/api/billing/checkout`, {
          method:"POST",
          headers: await getAuthHeaders(),
          body: JSON.stringify(body)
        });
        const j = await r.json();
        if (!r.ok) throw new Error(j?.error?.message || "Checkout error");
        if (j.url) location.href = j.url;
        else throw new Error("No checkout URL returned");
      }catch(e){
        toast(e.message || "Unable to open checkout");
        btn.disabled = false; btn.textContent = old;
      }
    });
  });

  // --- Manage billing (Customer Portal) ---
  $$('[data-portal="stripe"]').forEach(btn=>{
    btn.addEventListener("click", async ()=>{
      btn.disabled = true; const old = btn.textContent; btn.textContent = "Opening…";
      try{
        const r = await fetch(`${WORKER_BASE}/api/billing/portal`, {
          method:"POST",
          headers: await getAuthHeaders(),
          body: JSON.stringify({ return_url: location.href })
        });
        const j = await r.json();
        if (!r.ok) throw new Error(j?.error?.message || "Portal error");
        if (j.url) location.href = j.url;
        else throw new Error("No portal URL returned");
      }catch(e){
        toast(e.message || "Unable to open billing portal");
        btn.disabled = false; btn.textContent = old;
      }
    });
  });

  // --- Auto-apply referral codes from ?ref=...
  (async function applyReferral(){
    try{
      const u = new URL(location.href);
      const ref = u.searchParams.get("ref");
      if (!ref) return;
      fetch(`${WORKER_BASE}/api/ref/apply?ref=${encodeURIComponent(ref)}`).catch(()=>{});
    }catch{}
  })();

  // --- Intersection polish: fade-in sections on scroll (CSS classes must exist) ---
  const io = new IntersectionObserver((entries)=>{
    entries.forEach(e=>{
      if (e.isIntersecting){ e.target.classList.add("reveal-in"); io.unobserve(e.target); }
    });
  }, { rootMargin: "0px 0px -10% 0px", threshold: 0.15 });
  $$('.reveal').forEach(el=> io.observe(el));

  // --- Handle billing query params (success/cancel) ---
  (function billingBanner(){
    const u = new URL(location.href);
    const ok   = u.searchParams.get("billing")==="success";
    const fail = u.searchParams.get("billing")==="cancel";
    if (ok)   toast("Billing updated — thank you!");
    if (fail) toast("Billing cancelled");
    if (ok || fail){
      u.searchParams.delete("billing");
      history.replaceState({}, "", u.toString());
    }
  })();

  // --- Guard: prevent full page jump for in-page primary nav ---
  $$('a[href^="#"]').forEach(a=>{
    a.addEventListener("click", (e)=>{
      const id = a.getAttribute("href")?.slice(1);
      if (!id) return;
      const el = byId(id);
      if (!el) return;
      e.preventDefault();
      smoothScrollTo(el);
      history.pushState({}, "", `#${id}`);
    });
  });

  if (location.hash === "#demo") {
    setTimeout(()=> routeFromHash(), 0);
  }

  // Normalize external links
  $$('a[target="_blank"]').forEach(a=> a.setAttribute("rel","noopener"));

  // Keyboard: close any <dialog> with Escape
  window.addEventListener("keydown", (e)=>{
    if (e.key==="Escape"){
      $$('dialog[open]').forEach(d=> d.close());
    }
  });

  // UTM persistence (7 days)
  (function persistUTM(){
    const u = new URL(location.href);
    const keys = ["utm_source","utm_medium","utm_campaign","utm_term","utm_content"];
    let touched = false;
    const store = JSON.parse(localStorage.getItem("crp_utm")||"{}");
    keys.forEach(k=>{
      if (u.searchParams.has(k)){ store[k] = u.searchParams.get(k); touched = true; }
    });
    if (touched){
      store._ts = Date.now();
      localStorage.setItem("crp_utm", JSON.stringify(store));
    }
  })();

})();
</script>
  <!-- ===== GLOBAL SVG SPRITE (icons used in cards) ===== -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="i-li" viewBox="0 0 24 24"><path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1 4.98 2.12 4.98 3.5zM0 8h5v16H0zM8 8h4.8v2.2h.1c.7-1.3 2.4-2.7 4.9-2.7 5.2 0 6.2 3.4 6.2 7.8V24h-5v-7.1c0-1.7 0-3.9-2.4-3.9s-2.8 1.9-2.8 3.8V24H8z"/></symbol>
    <symbol id="i-x" viewBox="0 0 24 24"><path d="M18.9 2H22l-7.7 8.8L23.3 22H16l-5.4-6.6L4.5 22H1.4l8.4-9.6L.9 2H8l4.9 5.9L18.9 2zM17 20h1.9L7.1 4H5.1L17 20z"/></symbol>
    <symbol id="i-mail" viewBox="0 0 24 24"><path d="M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"/></symbol>
    <symbol id="i-ig" viewBox="0 0 24 24"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7zm5 3a5 5 0 1 1 0 10 5 5 0 0 1 0-10zm0 2.2a2.8 2.8 0 1 0 0 5.6 2.8 2.8 0 0 0 0-5.6zM18 6.5a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/></symbol>
    <symbol id="i-reddit" viewBox="0 0 24 24"><path d="M22 12.5c0-1.1-.9-2-2-2-.6 0-1.1.2-1.5.6-1.2-.8-2.8-1.3-4.6-1.4l.8-3.8 2.7.6c0 1 .8 1.8 1.8 1.8a1.8 1.8 0 1 0 0-3.6c-.7 0-1.2.3-1.6.8l-3.5-.8c-.3-.1-.6.1-.7.4l-1 4.6c-1.8.1-3.4.6-4.6 1.4-.4-.4-1-.6-1.6-.6-1.1 0-2 .9-2 2 0 .8.5 1.5 1.2 1.8-.1.4-.2.8-.2 1.2 0 2.8 3.1 5.1 7 5.4h1.7c3.9-.3 7-2.6 7-5.4 0-.4-.1-.8-.2-1.2.7-.3 1.2-1 1.2-1.8zM8.5 14a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm7 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zM12 20c-2 0-3.9-.6-5.2-1.6-.3-.2-.3-.6 0-.8.2-.3.6-.3.8 0 1 .8 2.7 1.3 4.4 1.3s3.4-.5 4.4-1.3c.2-.2.6-.2.8 0 .3.2.3.6 0 .8C15.9 19.4 14 20 12 20z"/></symbol>
    <symbol id="i-fb" viewBox="0 0 24 24"><path d="M22 12a10 10 0 1 0-11.6 9.9v-7h-2.3v-2.9h2.3V9.2c0-2.3 1.4-3.5 3.4-3.5.98 0 2 .17 2 .17v2.2h-1.1c-1.1 0-1.4.68-1.4 1.4v1.7h2.6l-.4 2.9h-2.2v7A10 10 0 0 0 22 12z"/></symbol>
    <symbol id="i-quora" viewBox="0 0 24 24"><path d="M12 2C6.7 2 3 6 3 12s3.7 10 9 10c1.7 0 3.3-.4 4.6-1.2l1.7 2.2h2.9l-3-3.9c1.7-1.8 2.8-4.4 2.8-7.1 0-6-3.7-10-9-10zm0 2c4.3 0 7 3.2 7 8s-2.7 8-7 8-7-3.2-7-8 2.7-8 7-8zm2.4 12.7c-.7.5-1.7.8-2.7.8-2.7 0-4.5-2-4.5-5.5s1.8-5.5 4.5-5.5S16.2 8.5 16.2 12c0 1.5-.3 2.8-.8 3.7l1.6 2.1h-1.9l-1.1-1.4z"/></symbol>
    <symbol id="i-tt" viewBox="0 0 24 24"><path d="M15.5 3c.3 2.2 1.7 3.7 3.8 4v3.1c-1.4.1-2.6-.4-3.8-1.2v5.7c0 3.9-3.1 7-7 7S1.5 18.5 1.5 14.6c0-3.8 2.9-6.8 6.6-7v3.4c-1.8.1-3.2 1.6-3.2 3.6 0 2 .1 3.6 3 3.6 1.7 0 3.1-1.5 3.1-3.2V3h4.5z"/></symbol>
  </svg>

  <!-- ===== TOAST ===== -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 z-[9999] hidden">
    <div class="px-4 py-2 rounded-xl bg-black text-white shadow"> <span id="toastMsg">Done</span> </div>
  </div>

  <!-- ===== AUTH DIALOG (email magic link) ===== -->
  <dialog id="auth" class="rounded-xl p-0 w-[92vw] max-w-md">
    <form method="dialog" class="p-5 grid gap-4">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">Sign in</h3>
        <button class="btn" value="cancel">Close</button>
      </div>
      <p class="text-sm text-slate-500">Enter your email to receive a magic link.</p>
      <input id="authEmail" type="email" required placeholder="you@domain.com" class="border rounded-lg px-3 py-2">
      <button id="authSend" class="btn btn-primary" type="button">Send magic link</button>
      <p id="authNote" class="text-xs text-slate-500">We’ll never share your email.</p>
    </form>
  </dialog>

  <!-- ===== EMAIL PREVIEW DIALOG ===== -->
  <dialog id="emailPreview" class="rounded-xl p-0 w-[92vw] max-w-2xl">
    <form method="dialog" class="p-5 grid gap-3">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">Email preview</h3>
        <button class="btn" value="cancel">Close</button>
      </div>
      <label class="text-xs text-slate-500">Subject</label>
      <input id="emailSubjEdit" class="border rounded-lg px-3 py-2" />
      <label class="text-xs text-slate-500 mt-2">Body</label>
      <textarea id="emailBodyEdit" class="border rounded-lg px-3 py-2 min-h-[180px]"></textarea>
      <div class="mt-3 flex items-center justify-end gap-2">
        <button class="btn" value="cancel">Cancel</button>
        <button id="emailSendBtn" class="btn btn-primary" type="button">Open in mail app</button>
      </div>
    </form>
  </dialog>

  <!-- ===== TRELLO EXPORT DIALOG ===== -->
  <dialog id="trelloModal" class="rounded-xl p-0 w-[92vw] max-w-md">
    <form method="dialog" class="p-5 grid gap-3">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">Send to Trello</h3>
        <button class="btn" value="cancel">Close</button>
      </div>
      <label class="text-xs text-slate-500">Board ID (optional)</label>
      <input id="trelloBoardId" class="border rounded-lg px-3 py-2" placeholder="e.g. 5ab123..." />
      <label class="text-xs text-slate-500">List ID <span class="text-red-500">*</span></label>
      <input id="trelloListId" class="border rounded-lg px-3 py-2" placeholder="e.g. 5ac456..." />
      <div class="mt-3 flex items-center justify-end gap-2">
        <button class="btn" value="cancel">Cancel</button>
        <button id="trelloConfirm" class="btn btn-primary" type="button">Send to Trello</button>
      </div>
    </form>
  </dialog>

  <!-- ===== FOOTER ===== -->
  <footer class="mt-20 border-t border-white/30">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-10 text-sm flex flex-wrap items-center justify-between gap-3">
      <div class="opacity-80">© <span id="year">2025</span> ContentRepurpose.pro</div>
      <nav class="flex items-center gap-4 opacity-80">
        <a href="#pricing" class="hover:opacity-100">Pricing</a>
        <a href="/blog" class="hover:opacity-100">Blog</a>
        <a href="mailto:hello@contentrepurpose.pro" class="hover:opacity-100">Contact</a>
      </nav>
    </div>
  </footer>

</body>
</html>
