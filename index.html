<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ContentRepurpose.pro — AI Content Repurposing Tool & Generator</title>
  <meta name="description" content="Content repurposing AI that turns one idea into LinkedIn, X, Email & Instagram drafts. Export to Notion & Trello. BYOK supported." />
  <link rel="canonical" href="https://contentrepurpose.pro/">
  <meta name="theme-color" content="#0a0d18"><meta name="color-scheme" content="dark light">
  <meta name="robots" content="index,follow,max-video-preview:-1,max-image-preview:large,max-snippet:-1">
  <meta property="og:type" content="website"><meta property="og:title" content="ContentRepurpose.pro — AI Content Repurposing Tool">
  <meta property="og:description" content="Repurpose content with AI. Paste once → get LinkedIn, X, Email & Instagram drafts. Export to Notion & Trello. BYOK supported.">
  <meta property="og:url" content="https://contentrepurpose.pro/"><meta property="og:image" content="/og-cover.png">
  <meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="ContentRepurpose.pro — AI Content Generator">
  <meta name="twitter:description" content="Content repurposing AI for multi-channel drafts. Export to Notion & Trello. BYOK supported."><meta name="twitter:image" content="/og-cover.png">

  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{ --brandA:#7AA2FF; --brandB:#FF2D2D; --ink:#0a0d18 }
    html,body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .txt-grad{background:linear-gradient(135deg,var(--brandA),var(--brandB));-webkit-background-clip:text;background-clip:text;color:transparent}
    .bg-grad{background:linear-gradient(135deg,var(--brandA),var(--brandB))}
    .card{border-radius:1.25rem;border:1px solid rgba(15,23,42,.10);background:rgba(255,255,255,.80);box-shadow:0 12px 40px rgba(2,6,23,.08)}
    .badge{display:inline-flex;align-items:center;gap:.5rem;padding:.35rem .6rem;border-radius:9999px;border:1px solid rgba(255,255,255,.15);font-size:.75rem;background:rgba(255,255,255,.65)}
    .chip{font-size:.7rem;padding:.2rem .5rem;border-radius:9999px;border:1px solid rgba(148,163,184,.35)}
    .btn{padding:.6rem .9rem;border-radius:.9rem;border:1px solid rgba(148,163,184,.35)}
    .btn-primary{background:black;color:white}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .halo{position:absolute;filter:blur(60px);opacity:.55;pointer-events:none;transform:translateZ(0);
      background:radial-gradient(50% 50% at 50% 50%, rgba(122,162,255,.8), rgba(255,45,45,.65) 60%, transparent 70%);
      width:42rem;height:42rem;border-radius:50%;animation:float 16s ease-in-out infinite;}
    .halo.h2{width:34rem;height:34rem;right:-12rem;top:-6rem;animation-duration:18s;opacity:.5}
    .halo.h3{width:28rem;height:28rem;left:-10rem;top:26rem;animation-duration:22s;opacity:.45}
    @keyframes float{ 0%,100%{ transform: translate3d(0,0,0) } 50%{ transform: translate3d(0,-20px,0) } }
    .orbit{position:absolute;inset:-32px;border-radius:24px;pointer-events:none;
      background: conic-gradient(from 0deg, rgba(122,162,255,.25), rgba(255,45,45,.18), rgba(122,162,255,.25));
      -webkit-mask: radial-gradient(closest-side, transparent 88%, black 89%); mask: radial-gradient(closest-side, transparent 88%, black 89%);
      animation: spin 18s linear infinite;}
    @keyframes spin{ to{ transform: rotate(360deg) } }
    .mock{border-radius:1rem;border:1px solid rgba(255,255,255,.12); background:linear-gradient(180deg,rgba(255,255,255,.75),rgba(255,255,255,.6));}
    @media (prefers-color-scheme:dark){ body{background:var(--ink);color:#e9eef6} .card{background:rgba(14,16,22,.6);border-color:rgba(255,255,255,.08);box-shadow:0 24px 96px rgba(122,162,255,.08),0 14px 60px rgba(255,45,45,.06)} .badge{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.12)} .mock{ background:linear-gradient(180deg,rgba(17,20,31,.88),rgba(17,20,31,.72)); } }
    .marquee{ display:grid; grid-auto-flow:column; gap:2rem; align-items:center; animation: scrollx 26s linear infinite }
    .marquee:hover{ animation-play-state: paused } @keyframes scrollx{ from{ transform: translateX(0) } to{ transform: translateX(-50%) } }
    .nav-sheet{position:fixed; inset:0 0 auto 0; background:rgba(0,0,0,.6); backdrop-filter:blur(8px); display:none}
    .nav-panel{position:absolute; top:0; right:0; width:82vw; max-width:380px; height:100%; background:rgba(14,16,22,.96); border-left:1px solid rgba(255,255,255,.08); padding:1rem}
    .nav-open .nav-sheet{display:block}
    .only-guest{display:revert}.only-authed{display:none}
    .plan-starter-plus{display:none}.plan-creator-plus{display:none}.plan-business-only{display:none}
    body[data-auth="authed"] .only-guest{display:none} body[data-auth="authed"] .only-authed{display:revert}
    body[data-plan="starter"] .plan-starter-plus, body[data-plan="creator"] .plan-starter-plus, body[data-plan="business"] .plan-starter-plus{display:revert}
    body[data-plan="creator"] .plan-creator-plus, body[data-plan="business"] .plan-creator-plus{display:revert}
    body[data-plan="business"] .plan-business-only{display:revert}
    :focus-visible{ outline:2px solid var(--brandA); outline-offset:2px }
  </style>

  <!-- JSON-LD -->
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","name":"ContentRepurpose.pro","url":"https://contentrepurpose.pro/","logo":"https://contentrepurpose.pro/logo.svg","sameAs":["https://x.com/contentrepurpose","https://www.linkedin.com/company/contentrepurpose"]}</script>
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","url":"https://contentrepurpose.pro/","name":"ContentRepurpose.pro","potentialAction":{"@type":"SearchAction","target":"https://contentrepurpose.pro/search?q={q}","query-input":"required name=q"}}</script>
  <script type="application/ld+json">{"@context":"https://schema.org","@type":"SoftwareApplication","name":"ContentRepurpose.pro","applicationCategory":"ContentCreationApplication","operatingSystem":"Web","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}}</script>

  <!-- Worker base -->
  <script>
    window.WORKER_BASE = "https://contentflow-worker.frank-couchman.workers.dev";
    window.SITE_ORIGIN = "https://contentrepurpose.pro";
  </script>
</head>
<body class="min-h-full" data-auth="guest" data-plan="free">
  <!-- Decorative halos -->
  <div class="halo" style="left:-14rem; top:-10rem;"></div>
  <div class="halo h2"></div>
  <div class="halo h3"></div>

  <!-- Top nav -->
  <header class="sticky top-0 z-40 backdrop-blur bg-white/55 dark:bg-black/20 border-b border-white/30">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-4 flex items-center justify-between">
      <a href="/" class="flex items-center gap-3" aria-label="ContentRepurpose home">
        <svg width="36" height="36" viewBox="0 0 48 48" class="rounded-xl" aria-hidden="true">
          <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7AA2FF"/><stop offset="100%" stop-color="#FF2D2D"/></linearGradient></defs>
          <rect x="0" y="0" width="48" height="48" rx="12" fill="url(#g)"/>
          <path d="M14 16h10a6 6 0 0 1 0 12H20v4h-6V16zm6 6v4h4a2 2 0 1 0 0-4h-4z" fill="white"/>
          <path d="M28 16h6v16h-6z" fill="white" opacity=".9"/>
        </svg>
        <span class="font-semibold tracking-tight">Content<span class="txt-grad">Repurpose</span></span>
      </a>

      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="#demo" class="hover:opacity-80">Generator</a>
        <a href="#optimizer" class="hover:opacity-80">Article Optimizer</a>
        <a href="#use-cases" class="hover:opacity-80">Use cases</a>
        <a href="#best-picks" class="hover:opacity-80">Best picks</a>
        <a href="#pricing" class="hover:opacity-80">Pricing</a>
        <a href="/blog" class="hover:opacity-80">Blog</a>
        <span id="planbadge" class="px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/50">Plan: Free</span>
        <button id="manageBilling" class="px-3 py-1 rounded-lg border hidden">Manage billing</button>
        <div class="flex items-center gap-2">
          <button id="loginBtn" class="px-3 py-1 rounded-lg border only-guest">Sign in</button>
          <button id="logoutBtn" class="px-3 py-1 rounded-lg border only-authed hidden">Sign out</button>
        </div>
      </nav>

      <button id="navToggle" class="md:hidden touch-target px-3 py-2 rounded-lg border" aria-expanded="false" aria-controls="mobileNav" aria-label="Open menu">☰</button>
    </div>

    <!-- Promo strip -->
    <div class="border-t border-white/40 bg-white/70 dark:bg-white/10">
      <div class="max-w-7xl mx-auto px-4 md:px-5 py-2 flex flex-wrap items-center justify-between gap-3 text-sm">
        <div class="flex items-center gap-2">
          <span class="px-2 py-0.5 rounded-full text-[11px] bg-black/80 text-white">LIMITED</span>
          <span>Use <strong class="mono">CONTENTOFF90</strong> for <strong>90% off</strong> the Creator plan.</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="copyPromoBtn" class="px-3 py-1 rounded-lg border">Copy code</button>
          <a href="#pricing" class="px-3 py-1 rounded-lg bg-black text-white">See pricing</a>
        </div>
      </div>
    </div>

    <!-- Mobile sheet -->
    <div id="mobileNav" class="nav-sheet" aria-hidden="true">
      <div class="nav-panel text-sm text-white">
        <div class="flex items-center justify-between">
          <span class="font-semibold">Menu</span>
          <button id="navClose" class="touch-target px-3 py-2 rounded-lg border border-white/20" aria-label="Close menu">✕</button>
        </div>
        <nav class="mt-4 grid gap-2">
          <a href="#demo" class="px-3 py-2 rounded-lg hover:bg-white/10">Generator</a>
          <a href="#optimizer" class="px-3 py-2 rounded-lg hover:bg-white/10">Article Optimizer</a>
          <a href="#use-cases" class="px-3 py-2 rounded-lg hover:bg-white/10">Use cases</a>
          <a href="#best-picks" class="px-3 py-2 rounded-lg hover:bg-white/10">Best picks</a>
          <a href="#pricing" class="px-3 py-2 rounded-lg hover:bg-white/10">Pricing</a>
          <a href="/blog" class="px-3 py-2 rounded-lg hover:bg-white/10">Blog</a>
        </nav>
        <div class="mt-6 grid gap-2">
          <span id="planbadge_m" class="px-3 py-1 rounded-full text-xs bg-white/10 border border-white/20 w-fit">Plan: Free</span>
          <button id="manageBilling_m" class="px-3 py-2 rounded-lg border border-white/20 hidden">Manage billing</button>
          <button id="loginBtn_m" class="px-3 py-2 rounded-lg border border-white/20 only-guest">Sign in</button>
          <button id="logoutBtn_m" class="px-3 py-2 rounded-lg border border-white/20 only-authed hidden">Sign out</button>
        </div>
      </div>
    </div>
  </header>

  <!-- ===== HERO ===== -->
  <section class="relative" id="hero">
    <div class="max-w-7xl mx-auto px-4 md:px-5 pt-10 md:pt-16 grid lg:grid-cols-2 gap-8 md:gap-10 items-center">
      <!-- Left: copy + CTAs -->
      <div>
        <div id="heroBadgeWrap" class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs bg-white/70 dark:bg-white/10 border border-white/40">
          <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
          <span class="only-guest">Demo — <strong class="mx-1">5 runs / month</strong> (no login)</span>
          <span class="only-authed hidden">Signed in — <strong id="heroPlanName">Free</strong> plan active</span>
        </div>

        <h1 class="mt-4 text-3xl md:text-5xl font-black leading-tight tracking-tight">
          AI <span class="txt-grad">Content Repurposing Tool</span> — turn one idea into everywhere content.
        </h1>

        <p class="mt-4 text-slate-600 dark:text-slate-300 max-w-xl">
          Paste once → get <strong>LinkedIn</strong>, <strong>X</strong>, <strong>Email</strong>, <strong>Instagram</strong> &amp; more.
          Export to <strong>Notion</strong> or <strong>Trello</strong>. BYOK supported.
        </p>

        <!-- CTA rail -->
        <div class="mt-6 flex flex-wrap gap-3">
          <a href="#demo" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90 only-guest">Try the Live Demo</a>
          <a href="#demo" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90 only-authed hidden">Open Generator</a>
          <a href="#optimizer" class="px-4 py-3 rounded-xl font-semibold border border-slate-300/60">Open Article Optimizer</a>
          <button id="heroSignIn" class="px-4 py-3 rounded-xl font-semibold border border-slate-300/60 only-guest">Sign in</button>
        </div>

        <div class="mt-6 flex items-center gap-3 text-xs text-slate-500 dark:text-slate-400">
          <span class="badge">AI Content Generator</span>
          <span class="badge">Repurposing Tool</span>
          <span class="badge">Scheduler</span>
          <span class="badge">BYOK</span>
        </div>

        <!-- Trust strip -->
        <div class="mt-8 overflow-hidden">
          <div class="flex items-center gap-4 text-[11px] uppercase tracking-widest text-slate-500">
            <span class="chip">Creators</span>
            <span class="chip">Marketers</span>
            <span class="chip">Newsletters</span>
            <span class="chip">Teams</span>
          </div>
          <div class="relative mt-4">
            <div class="marquee opacity-70">
              <div class="chip">LinkedIn-first</div>
              <div class="chip">Editorial-friendly</div>
              <div class="chip">Email copy</div>
              <div class="chip">Instagram captions</div>
              <div class="chip">Notion export</div>
              <div class="chip">Trello sync</div>
              <div class="chip">Keyword-aware</div>
              <div class="chip">Tone controls</div>
              <!-- duplicate for seamless scroll -->
              <div class="chip">LinkedIn-first</div>
              <div class="chip">Editorial-friendly</div>
              <div class="chip">Email copy</div>
              <div class="chip">Instagram captions</div>
              <div class="chip">Notion export</div>
              <div class="chip">Trello sync</div>
              <div class="chip">Keyword-aware</div>
              <div class="chip">Tone controls</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right: visual mocks -->
      <div class="relative">
        <div class="orbit" aria-hidden="true"></div>
        <div class="grid gap-4">
          <div class="mock p-4 card">
            <div class="text-xs text-slate-400">Command</div>
            <pre class="mono text-xs bg-black/85 text-emerald-200 rounded-xl p-4 h-40 overflow-auto" aria-label="CLI Preview">repurpose generate --channels linkedin,x,email,instagram
? outline created
? 3 social variants
? email subject + body ready
? instagram caption + hashtags</pre>
          </div>
          <div class="grid md:grid-cols-2 gap-4">
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">LinkedIn</div>
              <div class="mt-2 h-24 text-sm text-slate-200/90 leading-relaxed">
                • Hook that earns the scroll<br>
                • 6–10 crisp lines, one CTA<br>
                • On-brand tone &amp; keywords
              </div>
            </div>
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">X (Twitter)</div>
              <div class="mt-2 h-24 text-sm text-slate-200/90 leading-relaxed">
                Two fast variants<br>
                Always ≤ 280 chars<br>
                Ready to post ✓
              </div>
            </div>
          </div>
          <div class="grid md:grid-cols-2 gap-4">
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">Email</div>
              <div class="mt-2 h-20 text-sm text-slate-200/90 leading-relaxed">
                Subject &amp; body prepped<br>
                Preview &amp; send from your client
              </div>
            </div>
            <div class="mock p-4 card">
              <div class="text-xs text-slate-400">Instagram</div>
              <div class="mt-2 h-20 text-sm text-slate-200/90 leading-relaxed">
                Caption + 3–5 hashtags<br>
                Short, skimmable, on-brand
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Live activity strip (hero) -->
    <div class="mt-8 md:mt-10">
      <div class="max-w-7xl mx-auto px-4 md:px-5">
        <div class="card p-4 md:p-5">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
              <strong class="tracking-tight">Generations today</strong>
              <span class="chip" data-live-count>–</span>
            </div>
            <div class="text-xs text-slate-500">Real results update every 30s</div>
          </div>
          <div class="mt-3 overflow-hidden">
            <div class="flex gap-3 whitespace-nowrap text-[13px] will-change-transform" style="animation: scrollx 28s linear infinite" data-live-feed></div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- Auth dialog -->
  <dialog id="auth" class="rounded-xl p-0 w-[92vw] max-w-md">
    <form method="dialog" class="p-5 grid gap-4">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">Sign in</h3>
        <button class="btn" value="cancel">Close</button>
      </div>
      <p class="text-sm text-slate-500">Enter your email to receive a magic link or continue with Google.</p>
      <input id="authEmail" type="email" required placeholder="you@domain.com" class="border rounded-lg px-3 py-2">
      <div class="grid grid-cols-2 gap-2">
        <button id="authSend" class="btn btn-primary" type="button">Send magic link</button>
        <button id="authGoogle" class="btn" type="button">Continue with Google</button>
      </div>
      <p id="authNote" class="text-xs text-slate-500">We’ll never share your email.</p>
    </form>
  </dialog>

  <!-- ===== GENERATOR ===== -->
  <section id="demo" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="flex items-end justify-between gap-4 mb-6">
        <div>
          <h2 class="text-2xl md:text-3xl font-black tracking-tight">Generator</h2>
          <p class="mt-1 text-slate-500 dark:text-slate-300 text-sm only-guest">
            No login needed — <span class="font-semibold">5 runs/month</span> on the public pool.
          </p>
          <p class="mt-1 text-slate-500 dark:text-slate-300 text-sm only-authed hidden">
            Signed in — your plan limits apply per day/month by tier.
          </p>
        </div>
        <div class="flex items-center gap-3">
          <a href="#pricing" class="btn">See pricing</a>
          <button class="btn btn-primary js-open-auth only-guest" type="button">Sign in</button>
        </div>
      </div>

      <!-- Conversion rail -->
      <div class="card p-4 md:p-5 mb-6">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div class="flex items-center gap-2 text-sm">
            <span class="badge">LIMITED</span>
            <span>Use <strong class="mono">CONTENTOFF90</strong> for <strong>90% off</strong> the Creator plan.</span>
          </div>
          <div class="flex items-center gap-2">
            <button id="copyPromoBtn2" class="btn" type="button">Copy code</button>
            <a class="btn btn-primary" href="#pricing">Upgrade</a>
          </div>
        </div>
      </div>

      <!-- Presets + Batch toolbar -->
      <div class="card p-4 md:p-5 mb-6">
        <div class="flex flex-wrap items-center gap-3">
          <!-- Presets -->
          <div class="flex items-center gap-2">
            <span class="text-sm text-slate-600 dark:text-slate-300">Presets:</span>
            <select id="preSelect" class="border rounded-lg px-2 py-1 min-w-[200px]">
              <option value="">— choose preset —</option>
            </select>
            <button id="preApply" class="btn" type="button">Load</button>
            <button id="preSave" class="btn" type="button">Save current</button>
            <button id="preDelete" class="btn" type="button">Delete</button>
          </div>

          <!-- Batch -->
          <div class="ml-auto flex items-center gap-2">
            <span class="text-sm text-slate-600 dark:text-slate-300">Batch:</span>
            <span class="text-xs text-slate-500">Paste multiple lines (one per job) into the source field.</span>
          </div>
        </div>
      </div>

      <!-- Generator Form (no Article Optimizer toggles here) -->
      <div class="card p-5 md:p-6">
        <form id="demoForm" class="grid gap-6" autocomplete="off">
          <!-- Source selector -->
          <fieldset>
            <legend class="text-sm font-semibold">Source</legend>
            <div class="mt-2 grid md:grid-cols-3 gap-3">
              <label class="tab flex items-center justify-between">
                <span class="flex items-center gap-2">
                  <input type="radio" name="sourceType" value="paragraph" checked>
                  Paragraph / Notes
                </span>
                <span class="chip">fastest</span>
              </label>
              <label class="tab flex items-center">
                <input type="radio" name="sourceType" value="blog" class="mr-2">
                Full Blog
              </label>
              <label class="tab flex items-center">
                <input type="radio" name="sourceType" value="url" class="mr-2">
                URL
              </label>
            </div>
            <div class="mt-3">
              <textarea id="sourceText" class="w-full rounded-xl border p-4 min-h-[140px]"
                placeholder="Paste paragraph(s), full article, or a URL. For batch: paste multiple lines — one per job."></textarea>
            </div>
          </fieldset>

          <!-- Channels -->
          <fieldset>
            <legend class="text-sm font-semibold">Channels to generate</legend>
            <div class="mt-2 grid sm:grid-cols-2 lg:grid-cols-4 gap-2">
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_linkedin" checked> LinkedIn</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_x" checked> X (Twitter)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_email" checked> Email</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_instagram"> Instagram</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_reddit" checked> Reddit</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_facebook"> Facebook</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_quora"> Quora</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="ch_tiktok"> TikTok</label>
            </div>
          </fieldset>

          <!-- Channel-specific extras -->
          <div class="grid md:grid-cols-2 gap-6">
            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">LinkedIn</legend>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="li_article"> Also generate a LinkedIn Article</label>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">X (Twitter)</legend>
              <div class="mt-2 flex items-center gap-3">
                <label class="flex items-center gap-2"><input type="checkbox" name="x_sequence" checked> Output as sequence</label>
                <label class="flex items-center gap-2">
                  Max posts:
                  <select name="x_posts" class="border rounded-lg px-2 py-1">
                    <option>2</option><option selected>4</option><option>6</option>
                  </select>
                </label>
              </div>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">Reddit</legend>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="rdt_communities" checked> Suggest best communities (with rules & flair tips)</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="rdt_comments" checked> Include 3 starter comment angles</label>
            </fieldset>

            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">TikTok</legend>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="tt_hooks" checked> Provide 3 hook variants</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="tt_onscreen" checked> Include on-screen text plan</label>
            </fieldset>
          </div>

          <!-- Actions -->
          <div class="flex flex-wrap items-center gap-3">
            <button id="generateBtn" type="submit" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90 only-guest">
              Generate (demo)
            </button>
            <button id="generateBtn_member" type="submit" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90 only-authed hidden">
              Generate
            </button>
            <button type="button" id="clearBtn" class="px-4 py-3 rounded-xl font-semibold border">Clear</button>

            <!-- Quota copy varies -->
            <div class="text-sm text-slate-500 only-guest">
              You have <span id="demoQuota">—</span> demo runs left this month.
            </div>
            <div class="text-sm text-slate-500 only-authed hidden">
              You have <span id="memberQuota">—</span> runs left today.
            </div>

            <a href="#pricing" class="text-sm underline hover:opacity-80 ml-auto">Need more? See plans</a>
          </div>
        </form>
      </div>

      <!-- OUTPUT + per-card copy/publish/export controls -->
      <div id="demoOutput" class="mt-8 grid gap-6" aria-live="polite" aria-busy="false">
        <!-- Channel cards injected by JS:
          - Each card has “Copy” button
          - If authed: “Publish” rail (X, Reddit, LinkedIn, Email)
          - If Creator+: “Export to Notion / Trello” mini-buttons
        -->
      </div>

      <!-- Quick Publish panel (uses LAST_OUTPUT) -->
      <div class="mt-10 card p-5 only-authed hidden">
        <div class="flex items-center justify-between flex-wrap gap-3">
          <strong class="tracking-tight">Quick publish</strong>
          <div class="text-xs text-slate-500">Works with your last generation’s outputs.</div>
        </div>
        <div class="mt-4 grid sm:grid-cols-2 lg:grid-cols-4 gap-3">
          <button id="qp-x" class="btn">Post to X</button>
          <button id="qp-reddit" class="btn">Open Reddit submit</button>
          <button id="qp-linkedin" class="btn">Copy for LinkedIn & open</button>
          <button id="qp-email" class="btn">Send email draft</button>
        </div>

        <!-- Creator+ integrations -->
        <div class="mt-4 grid sm:grid-cols-2 gap-3 plan-creator-plus">
          <button id="li-notion" class="btn">Export to Notion</button>
          <button id="li-trello" class="btn">Send to Trello</button>
        </div>
        <div class="mt-2 text-xs text-slate-500 plan-creator-plus">
          Notion/Trello require connecting once from this device. Find them in Settings → Integrations.
        </div>
      </div>

      <!-- Scheduler (Starter+) -->
      <div class="mt-10 card p-5 plan-starter-plus">
        <div class="flex items-center justify-between flex-wrap gap-3">
          <strong class="tracking-tight">Scheduler</strong>
          <div class="text-xs text-slate-500">Queue & calendar. Starter gets single-profile; Creator+ supports multi-profile.</div>
        </div>

        <!-- Composer -->
        <div class="mt-4 grid md:grid-cols-4 gap-3">
          <label class="grid gap-1">
            <span class="text-xs text-slate-500">Channel</span>
            <select id="schedChannel" class="border rounded-lg px-3 py-2">
              <option value="linkedin">LinkedIn</option>
              <option value="x">X (Twitter)</option>
              <option value="instagram">Instagram</option>
              <option value="facebook">Facebook</option>
              <option value="reddit">Reddit</option>
              <option value="email">Email</option>
            </select>
          </label>
          <label class="grid gap-1">
            <span class="text-xs text-slate-500">When</span>
            <input id="schedWhen" type="datetime-local" class="border rounded-lg px-3 py-2" />
          </label>
          <div class="md:col-span-2 grid grid-cols-2 gap-2 items-end">
            <button id="schedAdd" class="btn btn-primary" type="button">Add to queue</button>
            <button id="schedUseLast" class="btn" type="button">Add from last output</button>
          </div>
        </div>

        <label class="grid gap-1 mt-3">
          <span class="text-xs text-slate-500">Text</span>
          <textarea id="schedText" class="border rounded-lg px-3 py-2 min-h-[120px]" placeholder="Paste content (or generate first and use 'Add from last output')"></textarea>
        </label>

        <!-- Queue -->
        <div class="mt-5">
          <div class="flex items-center justify-between">
            <strong class="text-sm">Queue</strong>
            <div class="flex items-center gap-2">
              <button id="schedPublish" class="btn" type="button">Publish selected</button>
              <button id="schedClear" class="btn" type="button">Clear all</button>
            </div>
          </div>
          <div id="schedEmpty" class="text-sm text-slate-500 mt-3">Nothing scheduled yet.</div>
          <div id="schedList" class="mt-3 grid gap-3"></div>
        </div>
      </div>

      <!-- Live strip (section-local) -->
      <div class="mt-10">
        <div class="card p-4 md:p-5">
          <div class="flex items-center justify-between flex-wrap gap-3">
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
              <strong class="tracking-tight">Generations today</strong>
              <span id="liveCount" class="chip">–</span>
            </div>
            <div class="text-xs text-slate-500">Real results update every 30s</div>
          </div>
          <div class="mt-3 overflow-hidden">
            <div id="liveFeed" class="flex gap-3 whitespace-nowrap text-[13px] will-change-transform" style="animation: scrollx 28s linear infinite"></div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- ===== ARTICLE OPTIMIZER (separate tool) ===== -->
  <section id="optimizer" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="flex items-end justify-between gap-4 mb-6">
        <div>
          <h2 class="text-2xl md:text-3xl font-black tracking-tight">Article Optimizer</h2>
          <p class="mt-1 text-slate-500 dark:text-slate-300 text-sm">
            Paste HTML or Markdown. We’ll return an improved article + SEO assets.
          </p>
          <p class="mt-1 text-slate-500 dark:text-slate-300 text-xs only-guest">
            Demo: <strong>1 optimization / month</strong> to preview the tool. Sign in for daily caps by plan.
          </p>
          <p class="mt-1 text-slate-500 dark:text-slate-300 text-xs only-authed hidden">
            Starter: <strong>5/day</strong> • Creator: <strong>15/day</strong> • Business: <strong>30/day</strong>
          </p>
        </div>
        <div class="flex items-center gap-3">
          <a href="#pricing" class="btn">See pricing</a>
          <button class="btn btn-primary js-open-auth only-guest" type="button">Sign in</button>
        </div>
      </div>

      <div class="card p-5 md:p-6">
        <form id="optimizerForm" class="grid gap-6" autocomplete="off">
          <label class="grid gap-1">
            <span class="text-sm font-semibold">Paste HTML or Markdown</span>
            <textarea id="optimizerText" class="w-full rounded-xl border p-4 min-h-[220px]"
              placeholder="Paste your article here…"></textarea>
          </label>

          <!-- Controls -->
          <div class="grid lg:grid-cols-3 gap-6">
            <!-- Transform -->
            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">Transform</legend>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="opt_humanize" checked> Humanize content</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="opt_lengthen" value="30"> Lengthen ~30%</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="opt_headings" checked> Auto-headings (H2/H3)</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="opt_svg"> Add platform-fit SVG ideas</label>
            </fieldset>

            <!-- SEO -->
            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">SEO</legend>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="opt_meta" checked> Improve title &amp; meta (CTR)</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="opt_ab" checked> A/B test 5 titles</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="opt_seo" checked> SEO check (alt/links/length)</label>

              <div class="mt-3 grid gap-2">
                <label class="grid gap-1">
                  <span class="text-xs text-slate-500">Focus keyword</span>
                  <input name="seo_keyword" class="border rounded-lg px-3 py-2" placeholder="e.g. content repurposing for SEO" />
                </label>
                <label class="grid gap-1">
                  <span class="text-xs text-slate-500">Secondary keywords (comma-sep)</span>
                  <input name="seo_secondaries" class="border rounded-lg px-3 py-2" placeholder="content repurpose workflow, repurpose project" />
                </label>
                <label class="grid gap-1">
                  <span class="text-xs text-slate-500">Target SERP intent</span>
                  <select name="seo_intent" class="border rounded-lg px-3 py-2">
                    <option value="informational" selected>Informational</option>
                    <option value="commercial">Commercial</option>
                    <option value="transactional">Transactional</option>
                    <option value="navigational">Navigational</option>
                  </select>
                </label>
              </div>
            </fieldset>

            <!-- Extras -->
            <fieldset class="card p-4">
              <legend class="text-sm font-semibold">Extras</legend>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="opt_faqs"> Add FAQs (+ JSON-LD)</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="opt_reddit" checked> Reddit-ready (title + TL;DR)</label>
              <label class="flex items-center gap-2 mt-2"><input type="checkbox" name="opt_li_article"> LinkedIn Article HTML</label>
              <p class="mt-3 text-[12px] text-slate-500">
                Optimizer outputs: <em>improved HTML article</em>, <em>CTR-optimized title &amp; meta</em>,
                <em>FAQ JSON-LD</em>, <em>Reddit-ready title + TL;DR</em>, and optional <em>LinkedIn Article HTML</em>.
              </p>
            </fieldset>
          </div>

          <!-- Actions -->
          <div class="flex flex-wrap items-center gap-3">
            <button id="optRun" type="submit" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90">
              Optimize
            </button>
            <button type="button" id="optClear" class="px-4 py-3 rounded-xl font-semibold border">Clear</button>

            <div class="text-sm text-slate-500 only-guest">
              You have <span id="optDemoQuota">1</span> optimizer demo left this month.
            </div>
            <div class="text-sm text-slate-500 only-authed hidden">
              Uses your plan’s daily cap.
            </div>

            <a href="#pricing" class="text-sm underline hover:opacity-80 ml-auto">Need more? See plans</a>
          </div>
        </form>
      </div>

      <!-- OPTIMIZER OUTPUT (pretty, sectioned) -->
      <div id="optOutput" class="mt-8 grid gap-6" aria-live="polite" aria-busy="false">
        <!-- JS paints:
          1) Improved Article (HTML preview + Copy)
          2) SEO Panel: Title, Meta, 5× A/B titles, SEO checklist
          3) FAQ JSON-LD (code block + Copy)
          4) Reddit Pack: Title + TL;DR + Suggested subs (if requested)
          5) LinkedIn Article HTML (if requested)
          6) Export rail (Notion/Trello) for Creator+
          Each card includes Copy and, where relevant, Publish buttons.
        -->
      </div>
    </div>
  </section>
  <!-- ===== PRESETS TOOLBAR (Generator) ===== -->
  <section id="presets" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-10">
      <div class="card p-5 md:p-6">
        <div class="flex items-center justify-between gap-3 flex-wrap">
          <div>
            <h3 class="text-lg font-semibold">Presets</h3>
            <p class="text-xs text-slate-500">Save your channel/toggle settings and reuse them anytime.</p>
          </div>
          <div class="flex items-center gap-2">
            <input id="presetTitle" class="border rounded-lg px-3 py-2 text-sm" placeholder="Preset name (e.g. LinkedIn + Email)" />
            <button id="presetSave" class="btn btn-primary" type="button">Save preset</button>
            <div class="relative">
              <button id="presetOpen" class="btn" type="button" aria-haspopup="true" aria-expanded="false">Load / delete</button>
              <div id="presetMenu" class="absolute right-0 mt-2 w-72 card p-2 hidden z-20">
                <div id="presetList" class="grid gap-1 text-sm">
                  <div class="text-slate-500 text-xs px-2">No presets yet.</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <p class="mt-3 text-xs text-slate-500">Starter: up to 10 saved presets • Creator/Business: unlimited</p>
      </div>
    </div>
  </section>

  <!-- ===== BATCH INPUT (Generator) ===== -->
  <section id="batch" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 pb-10">
      <div class="card p-5 md:p-6">
        <div class="flex items-center justify-between gap-3">
          <div>
            <h3 class="text-lg font-semibold">Batch inputs</h3>
            <p class="text-xs text-slate-500">
              Enter one idea per line. We’ll run each line through the same preset.
              <span class="chip">Starter: up to 5 lines/run</span>
            </p>
          </div>
          <div class="flex items-center gap-2">
            <label class="flex items-center gap-2 text-sm">
              <input id="batchToggle" type="checkbox" />
              Enable batch mode
            </label>
            <button id="batchUseSource" class="btn" type="button">Use current Generator source</button>
          </div>
        </div>
        <textarea id="batchText" class="w-full rounded-xl border p-4 min-h-[120px] mt-3" placeholder="Line 1&#10;Line 2&#10;Line 3" disabled></textarea>
        <div class="mt-3 text-xs text-slate-500">
          Tip: save a preset first, then enable batch to generate consistent multi-channel drafts for all lines.
        </div>
      </div>
    </div>
  </section>

  <!-- ===== SETTINGS / INTEGRATIONS / BYOK ===== -->
  <section id="settings" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="text-center mb-10">
        <h2 class="text-3xl md:text-4xl font-black tracking-tight">Settings & Integrations</h2>
        <p class="mt-2 text-slate-600 dark:text-slate-300">Connect once, then export in one click.</p>
      </div>

      <div class="grid md:grid-cols-3 gap-6">
        <!-- Notion -->
        <div class="card p-5">
          <div class="flex items-center justify-between">
            <strong>Notion</strong>
            <span class="chip plan-creator-plus">Creator+</span>
          </div>
          <p class="text-sm text-slate-500 mt-2">Export optimizer outputs or generator drafts to a Notion page.</p>
          <div class="mt-3 flex items-center gap-2">
            <button id="notionConnect" class="btn plan-creator-plus" type="button">Connect Notion</button>
            <button id="notionDisconnect" class="btn plan-creator-plus" type="button">Disconnect</button>
          </div>
          <div id="notionState" class="text-xs text-slate-500 mt-2">Status: Not connected</div>
        </div>

        <!-- Trello -->
        <div class="card p-5">
          <div class="flex items-center justify-between">
            <strong>Trello</strong>
            <span class="chip plan-creator-plus">Creator+</span>
          </div>
          <p class="text-sm text-slate-500 mt-2">Send drafts to your Trello board as cards.</p>
          <div class="mt-3 flex items-center gap-2">
            <button id="trelloConnect" class="btn plan-creator-plus" type="button">Connect Trello</button>
          </div>
          <div id="trelloState" class="text-xs text-slate-500 mt-2">Status: Not connected</div>
        </div>

        <!-- BYOK -->
        <div class="card p-5">
          <div class="flex items-center justify-between">
            <strong>BYOK</strong>
            <span class="chip">All plans</span>
          </div>
          <p class="text-sm text-slate-500 mt-2">Bring your own OpenRouter API key for extra capacity.</p>
          <div class="mt-3 grid gap-2">
            <input id="byokKey" class="border rounded-lg px-3 py-2 text-sm" placeholder="OpenRouter API key (sk-or-…)" />
            <input id="byokModel" class="border rounded-lg px-3 py-2 text-sm" placeholder="Preferred model (optional)" />
            <button id="byokSave" class="btn btn-primary" type="button">Save key</button>
            <button id="byokDelete" class="btn" type="button">Remove key</button>
          </div>
          <div id="byokState" class="text-xs text-slate-500 mt-2">Status: Not set</div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== EXPORT DRAWER (reusable for Generator & Optimizer) ===== -->
  <div id="exportDrawer" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50">
    <div class="absolute right-0 top-0 h-full w-[92vw] max-w-md bg-white/95 dark:bg-slate-900 border-l border-white/30 p-4 overflow-auto">
      <div class="flex items-center justify-between">
        <strong>Export</strong>
        <button id="exportClose" class="btn" type="button">Close</button>
      </div>
      <div class="mt-4 grid gap-3">
        <button id="exToNotion" class="btn plan-creator-plus" type="button">Send to Notion</button>
        <button id="exToTrello" class="btn plan-creator-plus" type="button">Send to Trello</button>
        <a id="exDownloadMd" class="btn" download="contentrepurpose.md">Download as Markdown</a>
        <a id="exDownloadCsv" class="btn" download="contentrepurpose.csv">Download as CSV</a>
        <p class="text-xs text-slate-500">Exports use your latest outputs (Generator or Optimizer).</p>
      </div>
    </div>
  </div>

  <!-- ===== TOAST (global) ===== -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg bg-black text-white text-sm shadow-lg hidden z-50">
    <span id="toastMsg">Done</span>
  </div>
  <!-- ===== PRESETS TOOLBAR (Generator) ===== -->
  <section id="presets" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-10">
      <div class="card p-5 md:p-6">
        <div class="flex items-center justify-between gap-3 flex-wrap">
          <div>
            <h3 class="text-lg font-semibold">Presets</h3>
            <p class="text-xs text-slate-500">Save your channel/toggle settings and reuse them anytime.</p>
          </div>
          <div class="flex items-center gap-2">
            <input id="presetTitle" class="border rounded-lg px-3 py-2 text-sm" placeholder="Preset name (e.g. LinkedIn + Email)" />
            <button id="presetSave" class="btn btn-primary" type="button">Save preset</button>
            <div class="relative">
              <button id="presetOpen" class="btn" type="button" aria-haspopup="true" aria-expanded="false">Load / delete</button>
              <div id="presetMenu" class="absolute right-0 mt-2 w-72 card p-2 hidden z-20">
                <div id="presetList" class="grid gap-1 text-sm">
                  <div class="text-slate-500 text-xs px-2">No presets yet.</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <p class="mt-3 text-xs text-slate-500">Starter: up to 10 saved presets • Creator/Business: unlimited</p>
      </div>
    </div>
  </section>

  <!-- ===== BATCH INPUT (Generator) ===== -->
  <section id="batch" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 pb-10">
      <div class="card p-5 md:p-6">
        <div class="flex items-center justify-between gap-3">
          <div>
            <h3 class="text-lg font-semibold">Batch inputs</h3>
            <p class="text-xs text-slate-500">
              Enter one idea per line. We’ll run each line through the same preset.
              <span class="chip">Starter: up to 5 lines/run</span>
            </p>
          </div>
          <div class="flex items-center gap-2">
            <label class="flex items-center gap-2 text-sm">
              <input id="batchToggle" type="checkbox" />
              Enable batch mode
            </label>
            <button id="batchUseSource" class="btn" type="button">Use current Generator source</button>
          </div>
        </div>
        <textarea id="batchText" class="w-full rounded-xl border p-4 min-h-[120px] mt-3" placeholder="Line 1&#10;Line 2&#10;Line 3" disabled></textarea>
        <div class="mt-3 text-xs text-slate-500">
          Tip: save a preset first, then enable batch to generate consistent multi-channel drafts for all lines.
        </div>
      </div>
    </div>
  </section>

  <!-- ===== SETTINGS / INTEGRATIONS / BYOK ===== -->
  <section id="settings" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="text-center mb-10">
        <h2 class="text-3xl md:text-4xl font-black tracking-tight">Settings & Integrations</h2>
        <p class="mt-2 text-slate-600 dark:text-slate-300">Connect once, then export in one click.</p>
      </div>

      <div class="grid md:grid-cols-3 gap-6">
        <!-- Notion -->
        <div class="card p-5">
          <div class="flex items-center justify-between">
            <strong>Notion</strong>
            <span class="chip plan-creator-plus">Creator+</span>
          </div>
          <p class="text-sm text-slate-500 mt-2">Export optimizer outputs or generator drafts to a Notion page.</p>
          <div class="mt-3 flex items-center gap-2">
            <button id="notionConnect" class="btn plan-creator-plus" type="button">Connect Notion</button>
            <button id="notionDisconnect" class="btn plan-creator-plus" type="button">Disconnect</button>
          </div>
          <div id="notionState" class="text-xs text-slate-500 mt-2">Status: Not connected</div>
        </div>

        <!-- Trello -->
        <div class="card p-5">
          <div class="flex items-center justify-between">
            <strong>Trello</strong>
            <span class="chip plan-creator-plus">Creator+</span>
          </div>
          <p class="text-sm text-slate-500 mt-2">Send drafts to your Trello board as cards.</p>
          <div class="mt-3 flex items-center gap-2">
            <button id="trelloConnect" class="btn plan-creator-plus" type="button">Connect Trello</button>
          </div>
          <div id="trelloState" class="text-xs text-slate-500 mt-2">Status: Not connected</div>
        </div>

        <!-- BYOK -->
        <div class="card p-5">
          <div class="flex items-center justify-between">
            <strong>BYOK</strong>
            <span class="chip">All plans</span>
          </div>
          <p class="text-sm text-slate-500 mt-2">Bring your own OpenRouter API key for extra capacity.</p>
          <div class="mt-3 grid gap-2">
            <input id="byokKey" class="border rounded-lg px-3 py-2 text-sm" placeholder="OpenRouter API key (sk-or-…)" />
            <input id="byokModel" class="border rounded-lg px-3 py-2 text-sm" placeholder="Preferred model (optional)" />
            <button id="byokSave" class="btn btn-primary" type="button">Save key</button>
            <button id="byokDelete" class="btn" type="button">Remove key</button>
          </div>
          <div id="byokState" class="text-xs text-slate-500 mt-2">Status: Not set</div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== EXPORT DRAWER (reusable for Generator & Optimizer) ===== -->
  <div id="exportDrawer" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden z-50">
    <div class="absolute right-0 top-0 h-full w-[92vw] max-w-md bg-white/95 dark:bg-slate-900 border-l border-white/30 p-4 overflow-auto">
      <div class="flex items-center justify-between">
        <strong>Export</strong>
        <button id="exportClose" class="btn" type="button">Close</button>
      </div>
      <div class="mt-4 grid gap-3">
        <button id="exToNotion" class="btn plan-creator-plus" type="button">Send to Notion</button>
        <button id="exToTrello" class="btn plan-creator-plus" type="button">Send to Trello</button>
        <a id="exDownloadMd" class="btn" download="contentrepurpose.md">Download as Markdown</a>
        <a id="exDownloadCsv" class="btn" download="contentrepurpose.csv">Download as CSV</a>
        <p class="text-xs text-slate-500">Exports use your latest outputs (Generator or Optimizer).</p>
      </div>
    </div>
  </div>

  <!-- ===== TOAST (global) ===== -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg bg-black text-white text-sm shadow-lg hidden z-50">
    <span id="toastMsg">Done</span>
  </div>
  <!-- ===== ARTICLE OPTIMIZER (separate tool) ===== -->
  <section id="optimizer" class="relative scroll-mt-24">
    <div class="max-w-7xl mx-auto px-4 md:px-5 py-14 md:py-20">
      <div class="text-center mb-8">
        <h2 class="text-3xl md:text-4xl font-black tracking-tight">Article Optimizer</h2>
        <p class="mt-2 text-slate-600 dark:text-slate-300">
          Paste HTML or Markdown. We’ll return an improved article + SEO assets.
        </p>
        <p class="mt-1 text-xs text-slate-500">
          <span class="chip">Starter: 5/day</span>
          <span class="chip">Creator: 15/day</span>
          <span class="chip">Business: 30/day</span>
          <span class="chip">Free: 1 demo/month</span>
        </p>
      </div>

      <div class="card p-5 md:p-6">
        <form id="optForm" class="grid gap-6" autocomplete="off">
          <label class="grid gap-1">
            <span class="text-sm text-slate-500">Paste HTML or Markdown</span>
            <textarea id="optSource" class="w-full rounded-xl border p-4 min-h-[220px]"
              placeholder="&lt;h1&gt;Your article title&lt;/h1&gt; ... or Markdown"></textarea>
          </label>

          <!-- Transform toggles -->
          <fieldset class="relative">
            <legend class="text-sm font-semibold">Transform</legend>
            <div class="mt-2 grid sm:grid-cols-2 lg:grid-cols-4 gap-2">
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_humanize" checked> Humanize content</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_lengthen" value="30"> Lengthen ~30%</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_headings" checked> Auto-headings (H2/H3)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_svg"> Add platform-fit SVG ideas</label>
            </div>
          </fieldset>

          <!-- SEO toggles -->
          <fieldset class="relative">
            <legend class="text-sm font-semibold">SEO</legend>
            <div class="mt-2 grid sm:grid-cols-2 lg:grid-cols-4 gap-2">
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_meta" checked> Improve title & meta (CTR)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_ab" checked> A/B test 5 titles</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_seo" checked> SEO check (alt/links/length)</label>
            </div>

            <div class="mt-3 grid md:grid-cols-3 gap-3">
              <label class="grid gap-1">
                <span class="text-xs text-slate-500">Focus keyword</span>
                <input name="seo_keyword" class="border rounded-lg px-3 py-2" placeholder="e.g. content repurposing for SEO" />
              </label>
              <label class="grid gap-1">
                <span class="text-xs text-slate-500">Secondary keywords (comma-sep)</span>
                <input name="seo_secondaries" class="border rounded-lg px-3 py-2" placeholder="content repurposing strategy, social media repurposing" />
              </label>
              <label class="grid gap-1">
                <span class="text-xs text-slate-500">Target SERP intent</span>
                <select name="seo_intent" class="border rounded-lg px-3 py-2">
                  <option value="informational" selected>Informational</option>
                  <option value="commercial">Commercial</option>
                  <option value="transactional">Transactional</option>
                  <option value="navigational">Navigational</option>
                </select>
              </label>
            </div>
          </fieldset>

          <!-- Extras -->
          <fieldset class="relative">
            <legend class="text-sm font-semibold">Extras</legend>
            <div class="mt-2 grid sm:grid-cols-2 lg:grid-cols-3 gap-2">
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_faqs"> Add FAQs (+ JSON-LD)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="opt_reddit"> Reddit-ready (title + TL;DR)</label>
              <label class="flex items-center gap-2"><input type="checkbox" name="li_article"> LinkedIn Article HTML</label>
            </div>
          </fieldset>

          <div class="flex items-center gap-3">
            <button id="optRun" class="px-4 py-3 rounded-xl font-semibold text-white bg-black hover:opacity-90" type="submit">Optimize</button>
            <button id="optClear" class="px-4 py-3 rounded-xl font-semibold border" type="button">Clear</button>
            <button id="optExport" class="px-4 py-3 rounded-xl font-semibold border" type="button">Export</button>
            <span class="text-sm text-slate-500">Optimizer uses your plan’s daily cap.</span>
          </div>
        </form>
      </div>

      <div id="optOutput" class="mt-8 grid gap-6" aria-live="polite" aria-busy="false"></div>
    </div>
  </section>

  <!-- ===== WIRING: Presets, Batch, Integrations, BYOK, Export, Optimizer ===== -->
  <script type="module">
    // Reuse helpers from the main boot script defined earlier:
    // $, $$, byId, toast, WORKER_BASE, getAuthHeaders, setPlan, setAuthFlag, paintAuthedUi/paintGuestUi, etc.
    // Also reuse LAST_OUTPUT; we'll track LAST_OPTIM_OUTPUT here.
    let LAST_OPTIM_OUTPUT = null;

    /* -------------------- PRESETS -------------------- */
    function collectGeneratorState(){
      const form = byId("demoForm"); if(!form) return {};
      const get = (n)=> form.elements[n];
      const data = {
        sourceType: get("sourceType")?.value || "paragraph",
        channels: {
          linkedin:  get("ch_linkedin")?.checked || false,
          x:         get("ch_x")?.checked || false,
          email:     get("ch_email")?.checked || false,
          instagram: get("ch_instagram")?.checked || false,
          reddit:    get("ch_reddit")?.checked || false,
          facebook:  get("ch_facebook")?.checked || false,
          quora:     get("ch_quora")?.checked || false,
          tiktok:    get("ch_tiktok")?.checked || false,
        },
        extras: {
          li_article: get("li_article")?.checked || false,
          x_sequence: get("x_sequence")?.checked || false,
          x_posts:    get("x_posts")?.value || "4",
          rdt_communities: get("rdt_communities")?.checked || false,
          rdt_comments:    get("rdt_comments")?.checked || false,
          tt_hooks:   get("tt_hooks")?.checked || false,
          tt_onscreen:get("tt_onscreen")?.checked || false
        }
      };
      return data;
    }
    function applyGeneratorState(data){
      const form = byId("demoForm"); if(!form || !data) return;
      const set = (n,v)=>{ if(form.elements[n]===undefined) return; const el=form.elements[n]; if(el.type==="checkbox") el.checked=!!v; else el.value=v; };
      if (data.sourceType) {
        const el = form.elements["sourceType"];
        if (el) { [...el].forEach(r=>{ r.checked = (r.value===data.sourceType); }); }
      }
      if (data.channels) {
        Object.entries(data.channels).forEach(([k,v])=> set(`ch_${k}`, !!v));
      }
      if (data.extras) {
        Object.entries(data.extras).forEach(([k,v])=> set(k, v));
      }
      toast("Preset loaded");
    }
    async function listPresets(){
      try{
        const r = await fetch(`${WORKER_BASE}/api/presets/list`, { headers: await getAuthHeaders() });
        const j = await r.json();
        if (!r.ok) throw new Error(j?.error?.message||"Failed to load");
        const list = byId("presetList");
        list.innerHTML = "";
        (j.presets||[]).forEach(p=>{
          const row = document.createElement("div");
          row.className = "flex items-center justify-between px-2 py-1 rounded-lg hover:bg-white/10";
          row.innerHTML = `
            <span class="truncate">${p.title}</span>
            <div class="flex items-center gap-2">
              <button class="btn text-xs load">Load</button>
              <button class="btn text-xs del">Delete</button>
            </div>`;
          row.querySelector(".load").addEventListener("click", ()=> applyGeneratorState(p.data));
          row.querySelector(".del").addEventListener("click", async ()=>{
            try{
              const rr = await fetch(`${WORKER_BASE}/api/presets/delete`,{
                method:"POST", headers: await getAuthHeaders(), body: JSON.stringify({ id: p.id })
              });
              const jj = await rr.json(); if(!rr.ok) throw new Error(jj?.error?.message||"Delete failed");
              listPresets(); toast("Preset deleted");
            }catch(e){ toast(e.message||"Error");}
          });
          list.appendChild(row);
        });
        if (!list.childElementCount){
          list.innerHTML = `<div class="text-slate-500 text-xs px-2">No presets yet.</div>`;
        }
      }catch(e){ toast(e.message||"Error"); }
    }
    function wirePresets(){
      const menuBtn = byId("presetOpen");
      const menu = byId("presetMenu");
      menuBtn?.addEventListener("click", async ()=>{
        menu.classList.toggle("hidden");
        if (!menu.classList.contains("hidden")) listPresets();
      });
      document.addEventListener("click",(e)=>{
        if (!menu || e.target===menuBtn) return;
        if (!menu.contains(e.target)) menu.classList.add("hidden");
      });
      byId("presetSave")?.addEventListener("click", async ()=>{
        const title = byId("presetTitle")?.value?.trim() || "Preset";
        try{
          const data = collectGeneratorState();
          const r = await fetch(`${WORKER_BASE}/api/presets/save`,{
            method:"POST", headers: await getAuthHeaders(),
            body: JSON.stringify({ title, data })
          });
          const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message||"Save failed");
          toast("Preset saved");
          byId("presetTitle").value="";
        }catch(e){ toast(e.message||"Error"); }
      });
    }

    /* -------------------- BATCH -------------------- */
    function wireBatch(){
      const tgl = byId("batchToggle"), ta = byId("batchText"), useSrc = byId("batchUseSource");
      if (!tgl || !ta) return;
      tgl.addEventListener("change", ()=>{ ta.disabled = !tgl.checked; });
      useSrc?.addEventListener("click", ()=>{
        const src = byId("sourceText")?.value || "";
        if (!src) return toast("Nothing in Generator source");
        const lines = src.split(/\n+/).map(s=>s.trim()).filter(Boolean);
        ta.value = lines.join("\n");
        toast("Copied into batch");
      });

      // Hook into existing Generator submit to expand batch
      const form = byId("demoForm");
      if (!form) return;
      const origHandler = form.onsubmit; // we already attached in main boot with addEventListener; we’ll intercept inside listener below.
      form.addEventListener("submit", async (evt)=>{
        if (!tgl.checked) return; // normal path already handled by main boot
        evt.preventDefault(); // batch overrides single-call path
        const lines = (ta.value||"").split(/\n/).map(s=>s.trim()).filter(Boolean);
        if (!lines.length) return toast("Add 1–5 lines");
        if (lines.length>5) { toast("Starter cap: 5 lines/run"); return; }

        const out = byId("demoOutput"); out.innerHTML="";
        // run sequentially to stay within free-pool RPM
        for (let i=0;i<lines.length;i++){
          byId("sourceText").value = lines[i];
          // Trigger the single-run logic by dispatching a synthetic submit without batch flag
          const fake = new Event("submit", { cancelable:true });
          tgl.checked = false; ta.disabled = true;
          form.dispatchEvent(fake);
          await new Promise(r=> setTimeout(r, 800)); // tiny spacing
          tgl.checked = true; ta.disabled = false;
        }
      }, { capture:true });
    }

    /* -------------------- INTEGRATIONS + BYOK -------------------- */
    async function refreshBYOK(){
      try{
        const r = await fetch(`${WORKER_BASE}/api/byok/status`, { headers: await getAuthHeaders() });
        const j = await r.json();
        byId("byokState").textContent = j?.has_byok ? "Status: Saved" : "Status: Not set";
      }catch{}
    }
    function wireBYOK(){
      byId("byokSave")?.addEventListener("click", async ()=>{
        const key = byId("byokKey")?.value?.trim();
        const model = byId("byokModel")?.value?.trim();
        if (!key) return toast("Enter your OpenRouter key");
        try{
          const r = await fetch(`${WORKER_BASE}/api/byok/save`,{
            method:"POST", headers: await getAuthHeaders(),
            body: JSON.stringify({ key, model })
          });
          const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message||"Save failed");
          toast("BYOK saved"); refreshBYOK();
        }catch(e){ toast(e.message||"Error"); }
      });
      byId("byokDelete")?.addEventListener("click", async ()=>{
        try{
          const r = await fetch(`${WORKER_BASE}/api/byok/delete`,{ method:"POST", headers: await getAuthHeaders() });
          const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message||"Delete failed");
          toast("BYOK removed"); refreshBYOK();
        }catch(e){ toast(e.message||"Error"); }
      });
      refreshBYOK();
    }
    function wireIntegrations(){
      // Notion
      byId("notionConnect")?.addEventListener("click", async ()=>{
        try{
          const r = await fetch(`${WORKER_BASE}/api/integrations/notion/oauth/start`, { headers: await getAuthHeaders() });
          const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message||"Connect failed");
          location.href = j.url;
        }catch(e){ toast(e.message||"Error"); }
      });
      byId("notionDisconnect")?.addEventListener("click", async ()=>{
        try{
          const r = await fetch(`${WORKER_BASE}/api/integrations/notion/disconnect`,{ method:"POST", headers: await getAuthHeaders() });
          const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message||"Disconnect failed");
          toast("Notion disconnected"); byId("notionState").textContent = "Status: Not connected";
        }catch(e){ toast(e.message||"Error"); }
      });

      // Trello
      byId("trelloConnect")?.addEventListener("click", async ()=>{
        try{
          const r = await fetch(`${WORKER_BASE}/api/integrations/trello/oauth/start`, { headers: await getAuthHeaders() });
          const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message||"Connect failed");
          location.href = j.url;
        }catch(e){ toast(e.message||"Error"); }
      });

      // Paint simple “connected” hints via billing status
      (async ()=>{
        try{
          const r = await fetch(`${WORKER_BASE}/api/billing/status`, { headers: await getAuthHeaders() });
          const j = await r.json();
          const integ = j?.integrations || {};
          byId("notionState").textContent = integ?.notion?.connected ? "Status: Connected" : "Status: Not connected";
          byId("trelloState").textContent = integ?.trello?.token ? "Status: Connected" : "Status: Not connected";
        }catch{}
      })();
    }

    /* -------------------- EXPORT DRAWER -------------------- */
    const Export = {
      open(){ byId("exportDrawer")?.classList.remove("hidden"); },
      close(){ byId("exportDrawer")?.classList.add("hidden"); },
      latestMarkdown(){
        const blocks = [];
        if (window.LAST_OUTPUT){
          Object.entries(window.LAST_OUTPUT).forEach(([k,v])=>{
            if (!v) return;
            blocks.push(`## ${k}\n\n${v.trim()}\n`);
          });
        }
        if (LAST_OPTIM_OUTPUT?.html){
          blocks.push(`## Optimized Article (HTML)\n\n${LAST_OPTIM_OUTPUT.html}`);
        }
        if (LAST_OPTIM_OUTPUT?.faq_jsonld){
          blocks.push(`## FAQ JSON-LD\n\n\`\`\`json\n${JSON.stringify(LAST_OPTIM_OUTPUT.faq_jsonld,null,2)}\n\`\`\``);
        }
        if (LAST_OPTIM_OUTPUT?.reddit){
          blocks.push(`## Reddit TL;DR\n\n**${LAST_OPTIM_OUTPUT.reddit.title||""}**\n\n${LAST_OPTIM_OUTPUT.reddit.tldr||""}`);
        }
        return blocks.join("\n\n");
      },
      latestCsv(){
        // very lightweight CSV from generator channels
        const rows = [["channel","content"]];
        if (window.LAST_OUTPUT){
          Object.entries(window.LAST_OUTPUT).forEach(([k,v])=>{
            if (!v) return;
            rows.push([k, v.replace(/\n/g," \\n ")]);
          });
        }
        return rows.map(r=> r.map(x=> `"${String(x).replace(/"/g,'""')}"`).join(",")).join("\n");
      }
    };
    function wireExport(){
      const drawer = byId("exportDrawer");
      byId("exportClose")?.addEventListener("click", Export.close);
      byId("optExport")?.addEventListener("click", Export.open);

      // Update download links on open
      drawer?.addEventListener("transitionend", ()=>{ /* noop */ });
      drawer?.addEventListener("click",(e)=>{ if (e.target===drawer) Export.close(); });

      const updateLinks = ()=>{
        const md = Export.latestMarkdown();
        const csv = Export.latestCsv();
        const mdBlob = new Blob([md], { type:"text/markdown" });
        const csvBlob= new Blob([csv],{ type:"text/csv" });
        byId("exDownloadMd").href = URL.createObjectURL(mdBlob);
        byId("exDownloadCsv").href= URL.createObjectURL(csvBlob);
      };
      byId("exportDrawer")?.addEventListener("mouseenter", updateLinks);

      // Notion
      byId("exToNotion")?.addEventListener("click", async ()=>{
        try{
          const blocks = [];
          if (window.LAST_OUTPUT){
            Object.entries(window.LAST_OUTPUT).forEach(([k,v])=>{
              if (v) { blocks.push({ type:"heading", text:k }); blocks.push({ type:"paragraph", text:v }); }
            });
          }
          if (LAST_OPTIM_OUTPUT?.html){
            blocks.push({ type:"heading", text:"Optimized Article (HTML)" });
            blocks.push({ type:"paragraph", text: LAST_OPTIM_OUTPUT.html });
          }
          const r = await fetch(`${WORKER_BASE}/api/integrations/notion/export`,{
            method:"POST", headers: await getAuthHeaders(),
            body: JSON.stringify({ title:"ContentRepurpose Export", blocks })
          });
          const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message||"Export failed");
          toast("Sent to Notion"); Export.close();
          window.open(j.url,"_blank");
        }catch(e){ toast(e.message||"Error"); }
      });

      // Trello
      byId("exToTrello")?.addEventListener("click", async ()=>{
        try{
          const desc = Export.latestMarkdown();
          // NOTE: You can extend UI to choose board/list; here we require user to set defaults later.
          const board_id = ""; const list_id = ""; // placeholder (Worker side can default or validate)
          const r = await fetch(`${WORKER_BASE}/api/integrations/trello/export`,{
            method:"POST", headers: await getAuthHeaders(),
            body: JSON.stringify({ board_id, list_id, title:"ContentRepurpose Drafts", description:desc })
          });
          const j = await r.json(); if (!r.ok) throw new Error(j?.error?.message||"Export failed");
          toast("Card created in Trello"); Export.close();
          window.open(j.url,"_blank");
        }catch(e){ toast(e.message||"Error"); }
      });
    }

    /* -------------------- ARTICLE OPTIMIZER -------------------- */
    const parseJsonLoose = (txt)=>{
      if (!txt) return null;
      let s = String(txt).trim();
      s = s.replace(/^```(?:json)?/i,"").replace(/```$/i,"").trim();
      const a=s.indexOf("{"), b=s.lastIndexOf("}");
      if (a>=0 && b>a) s=s.slice(a,b+1);
      try{ return JSON.parse(s);}catch{}
      s = s.replace(/,\s*([}\]])/g,"$1");
      try{ return JSON.parse(s);}catch{}
      return null;
    };
    function readOptToggles(form){
      const g = (n)=> form.elements[n];
      return {
        transform: {
          humanize:  g("opt_humanize")?.checked,
          lengthen:  g("opt_lengthen")?.checked,
          headings:  g("opt_headings")?.checked,
          svg:       g("opt_svg")?.checked,
        },
        seo: {
          meta:      g("opt_meta")?.checked,
          ab:        g("opt_ab")?.checked,
          checks:    g("opt_seo")?.checked,
          keyword:   g("seo_keyword")?.value || "",
          seconds:   g("seo_secondaries")?.value || "",
          intent:    g("seo_intent")?.value || "informational"
        },
        extras: {
          faqs:      g("opt_faqs")?.checked,
          reddit:    g("opt_reddit")?.checked,
          li_article:g("li_article")?.checked
        }
      };
    }
    function optimizerSystem(tog){
      return {
        role:"system",
        content:
`You are an expert SEO editor. Return ONLY JSON in this shape:
{
  "html": string,                    // improved article HTML
  "title": string,                   // CTR-optimized
  "meta_description": string,        // ~150 chars
  "faq_jsonld": object|null,         // schema.org FAQPage if toggled
  "reddit": { "title": string, "tldr": string }|null,
  "linkedin_article_html": string|null
}
Respect toggles exactly:
humanize:${tog.transform.humanize}, lengthen:${tog.transform.lengthen}, headings:${tog.transform.headings},
svg:${tog.transform.svg}, meta:${tog.seo.meta}, ab:${tog.seo.ab}, checks:${tog.seo.checks},
keyword:${tog.seo.keyword}, secondaries:${tog.seo.seconds}, intent:${tog.seo.intent},
faqs:${tog.extras.faqs}, reddit:${tog.extras.reddit}, li_article:${tog.extras.li_article}.
If 'ab' is true, embed 5 alternative <title> candidates as an HTML comment at the top.`
      };
    }
    function optimizerUser(raw, tog){
      return {
        role:"user",
        content:
`Source article:
${raw}

Tasks:
1) Improve structure, clarity, and SEO according to toggles.
2) Output JSON only in the specified shape.`
      };
    }
    function paintOptimizer(j){
      const wrap = byId("optOutput");
      wrap.innerHTML = "";
      LAST_OPTIM_OUTPUT = j;

      const add = (title, html, copySel=".content")=>{
        wrap.insertAdjacentHTML("beforeend", `
          <div class="card p-5">
            <div class="flex justify-between items-center gap-2 flex-wrap">
              <strong class="tracking-tight">${title}</strong>
              <div class="flex items-center gap-2">
                <button class="btn copy" type="button">Copy</button>
                <button class="btn export" type="button">Export</button>
              </div>
            </div>
            ${html}
          </div>`);
        const card = wrap.lastElementChild;
        const copyBtn = card.querySelector(".btn.copy");
        const exBtn   = card.querySelector(".btn.export");
        const pre = card.querySelector(copySel) || card.querySelector("pre");
        copyBtn?.addEventListener("click", async ()=>{
          try{ await navigator.clipboard.writeText(pre?.innerText || ""); toast("Copied ✅"); }catch{ toast("Copy failed"); }
        });
        exBtn?.addEventListener("click", ()=> Export.open());
      };

      if (j.html){
        add("Improved Article (HTML)", `<pre class="whitespace-pre-wrap text-sm mt-3 content">${j.html}</pre>`);
      }
      if (j.title || j.meta_description){
        add("Title & Meta", `
          <div class="text-xs text-slate-400">Title:</div>
          <pre class="whitespace-pre-wrap text-sm mt-1 content">${j.title||""}</pre>
          <div class="text-xs text-slate-400 mt-3">Meta Description:</div>
          <pre class="whitespace-pre-wrap text-sm mt-1">${j.meta_description||""}</pre>`);
      }
      if (j.faq_jsonld){
        add("FAQ JSON-LD", `<pre class="whitespace-pre-wrap text-sm mt-3 content">${JSON.stringify(j.faq_jsonld,null,2)}</pre>`);
      }
      if (j.reddit){
        add("Reddit-ready", `
          <div class="text-xs text-slate-400">Title:</div>
          <pre class="whitespace-pre-wrap text-sm mt-1 content">${j.reddit.title||""}</pre>
          <div class="text-xs text-slate-400 mt-3">TL;DR:</div>
          <pre class="whitespace-pre-wrap text-sm mt-1">${j.reddit.tldr||""}</pre>`);
      }
      if (j.linkedin_article_html){
        add("LinkedIn Article (HTML)", `<pre class="whitespace-pre-wrap text-sm mt-3 content">${j.linkedin_article_html}</pre>`);
      }
    }
    function wireOptimizer(){
      const form = byId("optForm");
      const src  = byId("optSource");
      const out  = byId("optOutput");
      const run  = byId("optRun");
      const clr  = byId("optClear");
      const ex   = byId("optExport");

      clr?.addEventListener("click", ()=>{ src.value=""; out.innerHTML=""; LAST_OPTIM_OUTPUT=null; });
      ex?.addEventListener("click", ()=> Export.open());

      form?.addEventListener("submit", async (e)=>{
        e.preventDefault();
        const raw = (src.value||"").trim();
        if (!raw) return toast("Paste your article first");

        const old = run.textContent; run.disabled=true; run.textContent="Optimizing…";
        out.innerHTML = `<div class="card p-5 text-sm text-slate-500">Working…</div>`;
        try{
          const tog = readOptToggles(form);
          const messages = [ optimizerSystem(tog), optimizerUser(raw, tog) ];
          // same lane logic as generator: free if guest/free, pro if paid; BYOK lane added automatically by Worker if present
          // Frontend simply posts to /api/optimizer/run; Worker enforces caps (including free demo 1/month).
          const r = await fetch(`${WORKER_BASE}/api/optimizer/run`,{
            method:"POST", headers: await getAuthHeaders(),
            body: JSON.stringify({ temperature: 0.4, messages, toggles: tog })
          });
          const data = await r.json();
          if (!r.ok) throw new Error(data?.error?.message || "Optimizer failed");
          const content = data?.choices?.[0]?.message?.content || "";
          const j = parseJsonLoose(content);
          if (!j) throw new Error("Model did not return JSON");
          paintOptimizer(j);
          toast("Done ✅");
        }catch(e){
          out.innerHTML = `<div class="card p-5 text-sm text-red-500">Error: ${e.message || e}</div>`;
        }finally{
          run.disabled=false; run.textContent=old||"Optimize";
        }
      });
    }

    /* -------------------- BOOT THIS MODULE -------------------- */
    document.addEventListener("DOMContentLoaded", ()=>{
      wirePresets();
      wireBatch();
      wireIntegrations();
      wireBYOK();
      wireExport();
      wireOptimizer();
    });
  </script>
