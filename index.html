<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1"
  />
  <title>ContentRepurpose — Repurpose any content into platform-ready posts</title>
  <meta
    name="description"
    content="Turn articles, notes, or URLs into LinkedIn posts, X threads, Reddit posts, emails, and more — with presets, batch inputs, scheduler, and Notion/Trello export."
  />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link
    rel="preconnect"
    href="https://fonts.gstatic.com"
    crossorigin
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
    rel="stylesheet"
  />
  <style>
    :root{
      --bg:#0b0e17;
      --panel:#0f1322;
      --muted:#98a4c2;
      --text:#e7ecf6;
      --brandA:#7c5cff;
      --brandB:#07d1c1;
      --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:linear-gradient(180deg,#0b0e17 0%, #0c1221 60%, #0a0f1a 100%);
      color:var(--text); font:16px/1.5 Inter,system-ui,Segoe UI,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    a{color:inherit;text-decoration:none}
    .container{max-width:1120px;margin:0 auto;padding:0 20px}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:.5rem;
      padding:.68rem 1rem;border-radius:12px;border:1px solid rgba(255,255,255,.08);
      background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
      color:#fff;cursor:pointer;user-select:none; transition:all .18s ease;
    }
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(124,92,255,.15)}
    .btn.primary{background:linear-gradient(180deg,var(--brandA),#5a3cff);border-color:transparent}
    .btn.green{background:linear-gradient(180deg,#16d0a3,#09b596);border-color:transparent}
    .btn.ghost{background:transparent;border-color:rgba(255,255,255,.12)}
    .btn.small{padding:.5rem .7rem;border-radius:10px;font-size:.92rem}
    .chip{
      display:inline-flex;align-items:center;gap:.5rem;
      padding:.35rem .6rem;border-radius:999px;background:rgba(124,92,255,.12);
      border:1px solid rgba(124,92,255,.35);color:#cfc9ff;font-weight:600;
      letter-spacing:.2px
    }
    .card{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); border-radius:18px}
    header.site{
      position:sticky;top:0;z-index:50;backdrop-filter:saturate(160%) blur(8px);
      background:rgba(11,14,23,.45); border-bottom:1px solid rgba(255,255,255,.06)
    }
    .nav{
      display:flex;align-items:center;justify-content:space-between;gap:16px;padding:14px 0
    }
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;font-size:1.05rem;letter-spacing:.2px}
    .brand .dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(180deg,var(--brandA),#5836ff)}
    .nav a.link{opacity:.86}
    .nav a.link:hover{opacity:1}
    .links{display:flex;align-items:center;gap:16px}
    .spacer{flex:1}
    .only-authed{display:none}
    .hidden{display:none !important}
    .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    /* Sections */
    section{padding:64px 0}
    .hero h1{font-size: clamp(28px, 4vw, 48px);line-height:1.1;margin:10px 0 8px}
    .hero p{color:var(--muted);max-width:720px}
    .hero .actions{display:flex;flex-wrap:wrap;gap:12px;margin-top:18px}
    .grid{display:grid;gap:16px}
    @media(min-width:960px){ .grid.cols-2{grid-template-columns:1fr 1fr} .grid.cols-3{grid-template-columns:repeat(3,1fr)} }
    /* Forms */
    input, textarea, select{
      width:100%;background:#0a0f1a;border:1px solid rgba(255,255,255,.08);color:#fff;
      border-radius:12px;padding:.75rem .9rem; outline: none;
    }
    textarea{min-height:140px;resize:vertical}
    label.small{font-size:.9rem;color:var(--muted)}
    /* Toast */
    #toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;z-index:60}
    #toast .box{background:#111629;border:1px solid rgba(255,255,255,.12);color:#e7ecf6;
      padding:.65rem .9rem;border-radius:12px;box-shadow:0 12px 30px rgba(0,0,0,.25)}
    #toast.hidden{display:none}
    /* Dialog base */
    dialog{
      background:#0f1322;color:#fff;border:1px solid rgba(255,255,255,.12);
      border-radius:16px;padding:0;max-width:520px;width:calc(100% - 24px)
    }
    dialog::backdrop{background:rgba(0,0,0,.55)}
    .dialog-head{padding:16px 18px;border-bottom:1px solid rgba(255,255,255,.08);display:flex;justify-content:space-between;align-items:center}
    .dialog-body{padding:18px}
    .x{cursor:pointer;opacity:.8}
    .x:hover{opacity:1}
    /* Anchor targets spacing */
    .anchor{
      position:relative;scroll-margin-top:84px;
    }
    /* Mobile sheet nav */
    #mobileNavSheet{position:fixed;inset:0;z-index:70;display:none}
    body.nav-open #mobileNavSheet{display:block}
    .sheet-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.55)}
    .sheet{position:absolute;right:0;top:0;bottom:0;width:min(90vw,420px);background:#0f1322;border-left:1px solid rgba(255,255,255,.1);padding:16px;display:flex;flex-direction:column;gap:12px}
    .sheet a{padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.06)}
    .sheet .top{display:flex;align-items:center;justify-content:space-between}
    .muted{color:var(--muted)}
    /* Pricing + badges visibility gated by data-plan on body (JS sets) */
    body[data-plan="free"] .plan-starter-plus,
    body[data-plan="free"] .plan-creator-plus,
    body[data-plan="free"] .plan-business-only{display:none}
    body[data-auth="authed"] .only-guest{display:none !important}
    body[data-auth="guest"] .only-authed{display:none !important}
    /* Prose preview for LinkedIn Article etc */
    .prose{max-width:720px}
    .prose h1,.prose h2,.prose h3{margin:.2em 0}
    .prose p{color:#d7def0}
  </style>
  <!-- Tailwind (optional, keeps utility classes working if you used them earlier) -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body data-plan="free" data-auth="guest">
  <!-- MOBILE NAV SHEET -->
  <div id="mobileNavSheet" aria-hidden="true">
    <div class="sheet-backdrop" id="navClose"></div>
    <nav class="sheet card">
      <div class="top">
        <div class="brand"><span class="dot"></span> ContentRepurpose</div>
        <button class="x btn small ghost" id="navCloseBtn">Close</button>
      </div>
      <a class="link" href="#generator">Generator</a>
      <a class="link" href="#optimizer">Article Optimizer</a>
      <a class="link" href="#scheduler">Scheduler</a>
      <a class="link" href="#integrations">Integrations</a>
      <a class="link" href="#pricing">Pricing</a>
      <div class="spacer"></div>
      <div class="grid">
        <button class="btn primary js-open-auth only-guest">Sign in</button>
        <button class="btn ghost only-authed" id="manageBilling_m">Manage billing</button>
        <button class="btn ghost only-authed" id="logoutBtn_m">Log out</button>
      </div>
      <div class="muted text-sm">Current <span id="planbadge_m" class="chip">Plan: Free</span></div>
    </nav>
  </div>

  <!-- HEADER -->
  <header class="site">
    <div class="container nav">
      <div class="brand">
        <span class="dot"></span>
        <a href="/">ContentRepurpose</a>
      </div>
      <nav class="links" aria-label="Primary">
        <a class="link" href="#generator">Generator</a>
        <a class="link" href="#optimizer">Optimizer</a>
        <a class="link" href="#scheduler">Scheduler</a>
        <a class="link" href="#integrations">Integrations</a>
        <a class="link" href="#pricing">Pricing</a>
      </nav>
      <div class="spacer"></div>
      <div class="links">
        <span class="chip" id="planbadge">Plan: Free</span>
        <button class="btn small ghost js-open-auth only-guest" id="loginBtn">Sign in</button>
        <button class="btn small ghost only-authed" id="manageBilling">Manage billing</button>
        <button class="btn small ghost only-authed" id="logoutBtn">Log out</button>
        <button class="btn small" id="navToggle" aria-label="Menu">☰</button>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="container">
      <div class="chip">New • Live analytics, presets & queue</div>
      <h1>Repurpose anything into platform-ready content</h1>
      <p>Paste notes, a URL, or a full article. Get LinkedIn posts, X threads, Reddit posts, emails, TikTok scripts, and more — with saved presets, batch inputs, and a built-in scheduler. Export to Notion & Trello in one click.</p>
      <div class="actions">
        <a href="#generator" class="btn primary" id="heroGenerate">Open Generator</a>
        <button class="btn js-open-auth only-guest" id="heroSignIn">Sign in to save presets</button>
        <span class="muted">Today’s runs: <span id="liveCount">—</span></span>
      </div>
    </div>
  </section>

  <!-- TOAST -->
  <div id="toast" class="hidden">
    <div class="box"><span id="toastMsg">Saved</span></div>
  </div>

  <!-- AUTH DIALOG (MAGIC LINK + GOOGLE) -->
  <dialog id="auth" aria-labelledby="authTitle">
    <div class="dialog-head">
      <strong id="authTitle">Sign in</strong>
      <button class="x btn small ghost" onclick="this.closest('dialog').close()">✕</button>
    </div>
    <div class="dialog-body">
      <p class="muted" style="margin-top:0">Use a magic link or sign in with Google to save presets and access your plan features.</p>
      <div class="grid cols-2" style="gap:12px">
        <div>
          <label class="small">Email</label>
          <input id="authEmail" type="email" placeholder="you@company.com" autocomplete="email" />
        </div>
        <div class="grid" style="align-content:end">
          <button class="btn primary" id="authSend" type="button">Send magic link</button>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:10px;margin:14px 0">
        <div style="height:1px;background:rgba(255,255,255,.1);flex:1"></div>
        <span class="muted">or</span>
        <div style="height:1px;background:rgba(255,255,255,.1);flex:1"></div>
      </div>
      <button class="btn green" id="authGoogle" type="button">Continue with Google</button>
      <p class="muted" style="margin:12px 0 0;font-size:.9rem">
        By continuing you agree to our Terms and acknowledge our Privacy Policy.
      </p>
    </div>
  </dialog>
  <!-- GENERATOR -->
  <section id="generator" class="anchor">
    <div class="container">
      <div class="grid cols-2">
        <!-- Left: Inputs -->
        <div class="card" style="padding:18px">
          <h2 style="margin:0 0 8px">Generator</h2>
          <p class="muted" style="margin:0 0 16px">
            Paste an article, notes, or a URL. Choose channels and style, then generate.
          </p>

          <div class="grid" style="gap:12px">
            <div>
              <label class="small">Source (text or URL)</label>
              <textarea id="genInput" placeholder="Paste text or URL…"></textarea>
              <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
                <label class="small" style="flex:1">Batch inputs (max 5 lines / run)</label>
                <button class="btn small ghost" id="batchHelpBtn" type="button">?</button>
              </div>
              <textarea id="batchInput" class="mono" placeholder="Optional: one topic or URL per line (up to 5)…"></textarea>
              <div class="muted" id="batchCounter" style="font-size:.88rem;margin-top:6px">0 / 5</div>
            </div>

            <div class="grid cols-2" style="gap:12px">
              <div>
                <label class="small">Tone</label>
                <select id="tone">
                  <option value="professional" selected>Professional</option>
                  <option value="conversational">Conversational</option>
                  <option value="authoritative">Authoritative</option>
                  <option value="playful">Playful</option>
                  <option value="concise">Concise</option>
                </select>
              </div>
              <div>
                <label class="small">Audience</label>
                <input id="audience" placeholder="e.g., SaaS founders, content marketers…" />
              </div>
            </div>

            <!-- Channels -->
            <div>
              <label class="small">Channels</label>
              <div class="grid" style="grid-template-columns:repeat(2,minmax(0,1fr));gap:8px;margin-top:6px">
                <label><input type="checkbox" class="ch" value="linkedin" checked /> LinkedIn Post</label>
                <label><input type="checkbox" class="ch" value="linkedin_article" id="chLinkedInArticle" /> LinkedIn Article</label>
                <label><input type="checkbox" class="ch" value="xthread" /> X Thread</label>
                <label><input type="checkbox" class="ch" value="reddit" /> Reddit Post</label>
                <label><input type="checkbox" class="ch" value="email" /> Email</label>
                <label><input type="checkbox" class="ch" value="tiktok" /> TikTok Script</label>
              </div>
              <p class="muted" style="margin:.25rem 0 0;font-size:.9rem">
                Reddit communities should be like <span class="mono">r/contentwriting</span> (not <span class="mono">r/r/contentwriting</span>).
              </p>
              <input id="redditSub" class="mono" placeholder="Optional: r/marketing, r/contentwriting…" style="margin-top:8px" />
            </div>

            <!-- Model lane -->
            <div class="grid cols-2" style="gap:12px">
              <div>
                <label class="small">Model lane</label>
                <select id="lane">
                  <option value="free" selected>Platform Free</option>
                  <option value="pro">Platform Pro (paid plans)</option>
                  <option value="byok">BYOK (your OpenRouter key)</option>
                </select>
              </div>
              <div>
                <label class="small">Preferred model (optional)</label>
                <input id="model" class="mono" placeholder="e.g., meta-llama/llama-3.3-70b-instruct:free" />
              </div>
            </div>

            <!-- Presets -->
            <div class="card" style="padding:12px">
              <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
                <strong>Presets</strong>
                <div class="muted small">
                  <span id="presetCapNote">Free: 0 saved • Starter: 10 • Creator/Business: unlimited</span>
                </div>
              </div>
              <div class="grid" style="gap:8px;margin-top:10px">
                <div style="display:flex;gap:8px">
                  <input id="presetTitle" placeholder="Preset name…" />
                  <button class="btn small" id="presetSave">Save</button>
                </div>
                <div id="presetList" class="grid" style="gap:8px"></div>
              </div>
            </div>

            <!-- Actions -->
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <button class="btn primary" id="generateBtn">Generate</button>
              <button class="btn ghost" id="clearBtn" type="button">Clear</button>
              <button class="btn ghost only-authed" id="queueFromLast" type="button">Add from last output</button>
            </div>
            <div class="muted" id="quotaNote" style="font-size:.9rem">Signed out demo: 5 runs/month. Sign in for daily caps and BYOK.</div>
          </div>
        </div>

        <!-- Right: Output + Exports -->
        <div class="card" style="padding:18px">
          <h2 style="margin:0 0 8px">Outputs</h2>
          <p class="muted" style="margin:0 0 12px">Each channel appears in its own tab. Click copy, edit inline, and export.</p>

          <!-- Tabs -->
          <div id="outTabs" style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px"></div>

          <!-- Editor / preview -->
          <div id="outPane" class="prose" style="min-height:220px;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px;overflow:auto">
            <div class="muted">Nothing yet. Generate to see results.</div>
          </div>

          <!-- Post-actions -->
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px">
            <button class="btn small ghost" id="copyBtn" type="button">Copy</button>
            <button class="btn small ghost only-authed" id="saveAsPresetFromOutput" type="button">Save as preset</button>
            <span class="spacer"></span>
            <button class="btn small ghost only-authed" id="exportNotion" type="button" data-enabled="false">Export to Notion</button>
            <button class="btn small ghost only-authed" id="exportTrello" type="button" data-enabled="false">Send to Trello</button>
          </div>

          <!-- Integration connection helpers -->
          <div class="muted" style="margin-top:8px;font-size:.9rem">
            <span id="notionState">Notion: <strong>not connected</strong></span> •
            <span id="trelloState">Trello: <strong>not connected</strong></span>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
            <button class="btn small" id="connectNotion" type="button">Connect Notion</button>
            <button class="btn small" id="connectTrello" type="button">Connect Trello</button>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- OPTIMIZER -->
  <section id="optimizer" class="anchor">
    <div class="container">
      <div class="grid cols-2">
        <!-- Left: Input + Controls -->
        <div class="card" style="padding:18px">
          <h2 style="margin:0 0 8px">Article Optimizer</h2>
          <p class="muted" style="margin:0 0 14px">
            Paste an article or a URL. We’ll improve clarity, structure, SEO, and produce a clean preview.
          </p>

          <div class="grid" style="gap:12px">
            <div>
              <label class="small">Article text or URL</label>
              <textarea id="optInput" placeholder="Paste full article or a URL to optimize…"></textarea>
            </div>

            <div class="grid cols-2" style="gap:12px">
              <div>
                <label class="small">Goal</label>
                <select id="optGoal">
                  <option value="clarity" selected>Clarity & Brevity</option>
                  <option value="seo">SEO & Discoverability</option>
                  <option value="conversion">Conversion (lead gen)</option>
                  <option value="thought_leadership">Thought Leadership</option>
                </select>
              </div>
              <div>
                <label class="small">Target keywords (comma-separated)</label>
                <input id="optKeywords" class="mono" placeholder="e.g., content repurposing, social scheduler…" />
              </div>
            </div>

            <div class="grid cols-2" style="gap:12px">
              <div>
                <label class="small">Tone</label>
                <select id="optTone">
                  <option value="professional" selected>Professional</option>
                  <option value="conversational">Conversational</option>
                  <option value="authoritative">Authoritative</option>
                  <option value="playful">Playful</option>
                  <option value="concise">Concise</option>
                </select>
              </div>
              <div>
                <label class="small">Audience</label>
                <input id="optAudience" placeholder="e.g., B2B marketers, indie founders…" />
              </div>
            </div>

            <div class="grid cols-2" style="gap:12px">
              <div>
                <label class="small">Model lane</label>
                <select id="optLane">
                  <option value="free" selected>Platform Free</option>
                  <option value="pro">Platform Pro (paid plans)</option>
                  <option value="byok">BYOK (your OpenRouter key)</option>
                </select>
              </div>
              <div>
                <label class="small">Preferred model (optional)</label>
                <input id="optModel" class="mono" placeholder="e.g., meta-llama/llama-3.3-70b-instruct:free" />
              </div>
            </div>

            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <button class="btn primary" id="optimizeBtn">Optimize</button>
              <button class="btn ghost" id="optClearBtn" type="button">Clear</button>
            </div>
            <div class="muted" style="font-size:.9rem">Signed out demo: 5 runs/month. Sign in for daily caps and BYOK.</div>
          </div>
        </div>

        <!-- Right: Results -->
        <div class="card" style="padding:18px">
          <h2 style="margin:0 0 8px">Preview & Suggestions</h2>
          <div class="grid" style="gap:12px">
            <!-- Quick metrics -->
            <div class="grid cols-3" style="gap:10px">
              <div class="stat">
                <div class="muted small">Readability</div>
                <div id="optReadability" class="mono" style="font-size:1.1rem">—</div>
              </div>
              <div class="stat">
                <div class="muted small">Word count</div>
                <div id="optWordcount" class="mono" style="font-size:1.1rem">—</div>
              </div>
              <div class="stat">
                <div class="muted small">Keyword fit</div>
                <div id="optKWScore" class="mono" style="font-size:1.1rem">—</div>
              </div>
            </div>

            <!-- Suggestions -->
            <div class="card subtle" style="padding:12px">
              <strong>Suggestions</strong>
              <ul id="optSuggestions" class="muted" style="margin:8px 0 0 16px;line-height:1.5">
                <li>Nothing yet — run Optimize.</li>
              </ul>
            </div>

            <!-- SEO fields -->
            <div class="grid cols-2" style="gap:12px">
              <div>
                <label class="small">SEO title</label>
                <input id="optSEOTitle" />
              </div>
              <div>
                <label class="small">Meta description</label>
                <input id="optSEOMeta" />
              </div>
            </div>

            <!-- CTA -->
            <div>
              <label class="small">Suggested CTA</label>
              <input id="optCTA" placeholder="e.g., Start free trial, Download the checklist…" />
            </div>

            <!-- Output tabs -->
            <div id="optTabs" style="display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 8px"></div>

            <!-- Live preview (editable) -->
            <div id="optPreview" class="prose" contenteditable="true" style="min-height:240px;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px;outline:none">
              <div class="muted">Your optimized article appears here. You can edit inline.</div>
            </div>

            <!-- Actions -->
            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
              <button class="btn small ghost" id="optCopyBtn" type="button">Copy</button>
              <span class="spacer"></span>
              <button class="btn small ghost only-authed" id="optExportNotion" type="button" data-enabled="false">Export to Notion</button>
              <button class="btn small ghost only-authed" id="optExportTrello" type="button" data-enabled="false">Send to Trello</button>
            </div>

            <!-- LinkedIn article toggle for generator parity -->
            <div class="muted" style="font-size:.9rem">
              Need a LinkedIn Article from this? Click <a href="#generator" data-nav="generator">Generator</a> and toggle
              <span class="mono">Also generate a LinkedIn Article</span>. It will now produce a proper long-form article.
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- PRICING -->
  <section id="pricing" class="anchor alt">
    <div class="container">
      <h2 style="margin:0 0 18px">Pricing</h2>
      <p class="muted" style="margin:0 0 22px">
        Upgrade to unlock bigger batches, unlimited presets, exports, and Analytics Pro.
      </p>

      <div class="grid cols-3">
        <!-- Starter -->
        <div class="card plan" data-plan="starter">
          <div class="plan-badge">Starter</div>
          <div class="price-row">
            <span class="price" id="priceStarter">$9</span><span class="period">/mo</span>
          </div>
          <ul class="features">
            <li>• Batch inputs up to <strong>5</strong> lines/run</li>
            <li>• <strong>10</strong> saved presets</li>
            <li>• Project pack export</li>
            <li>• Basic Analytics</li>
            <li class="muted">• Notion & Trello export</li>
          </ul>
          <button class="btn primary w-100 checkoutBtn" data-price="starter">Get Starter</button>
        </div>

        <!-- Creator -->
        <div class="card plan" data-plan="creator">
          <div class="plan-badge">Creator</div>
          <div class="price-row">
            <span class="price" id="priceCreator">$19</span><span class="period">/mo</span>
          </div>
          <ul class="features">
            <li>• Batch inputs up to <strong>30</strong> lines/run</li>
            <li>• <strong>Unlimited</strong> presets</li>
            <li>• Project pack export</li>
            <li>• <strong>Notion export & Trello boards</strong></li>
            <li>• Analytics Pro</li>
          </ul>
          <button class="btn primary w-100 checkoutBtn" data-price="creator">Get Creator</button>
        </div>

        <!-- Business -->
        <div class="card plan" data-plan="business">
          <div class="plan-badge">Business</div>
          <div class="price-row">
            <span class="price" id="priceBusiness">$49</span><span class="period">/mo</span>
          </div>
          <ul class="features">
            <li>• <strong>Unlimited</strong> batch inputs</li>
            <li>• <strong>Unlimited</strong> presets</li>
            <li>• Project pack export</li>
            <li>• Notion export & Trello boards</li>
            <li>• Analytics Pro + Team seats</li>
          </ul>
          <button class="btn primary w-100 checkoutBtn" data-price="business">Get Business</button>
        </div>
      </div>

      <div class="muted small" style="margin-top:10px">
        Prices shown are placeholders; actual Stripe prices are bound in JS via your environment IDs.
      </div>
    </div>
  </section>

  <!-- INTEGRATIONS -->
  <section id="integrations" class="anchor">
    <div class="container">
      <h2 style="margin:0 0 18px">Integrations</h2>
      <div class="grid cols-3">
        <!-- Notion -->
        <div class="card">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
            <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/notion.svg" alt="Notion" width="22" height="22" />
            <strong>Notion</strong>
            <span class="badge" id="notionStatus">Disconnected</span>
          </div>
          <p class="muted small" style="margin:0 0 10px">Export optimized content and generator outputs to your Notion workspace.</p>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn small" id="connectNotionBtn">Connect</button>
            <button class="btn small ghost" id="disconnectNotionBtn">Disconnect</button>
          </div>
          <div class="muted tiny" id="notionWorkspace" style="margin-top:8px">—</div>
        </div>

        <!-- Trello -->
        <div class="card">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
            <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/trello.svg" alt="Trello" width="22" height="22" />
            <strong>Trello</strong>
            <span class="badge" id="trelloStatus">Disconnected</span>
          </div>
          <p class="muted small" style="margin:0 0 10px">Send ideas and drafts straight to a Trello board list as cards.</p>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn small" id="connectTrelloBtn">Connect</button>
          </div>
          <div class="muted tiny" id="trelloConnectedAt" style="margin-top:8px">—</div>
        </div>

        <!-- BYOK -->
        <div class="card">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
            <span class="badge">Advanced</span>
            <strong>BYOK (OpenRouter)</strong>
          </div>
          <p class="muted small" style="margin:0 0 10px">
            Use your own OpenRouter API key for higher limits and model choice.
          </p>
          <div class="grid" style="gap:10px">
            <input id="byokKey" class="mono" placeholder="sk-or-v1-..." />
            <div class="grid cols-2" style="gap:10px">
              <input id="byokModel" class="mono" placeholder="Preferred model (optional)" />
              <input id="byokBase" class="mono" placeholder="Custom API base (optional)" />
            </div>
            <button class="btn small" id="saveByokBtn">Save BYOK</button>
            <button class="btn small ghost" id="removeByokBtn">Remove BYOK</button>
            <div class="muted tiny" id="byokStatus">—</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SCHEDULER -->
  <section id="scheduler" class="anchor alt">
    <div class="container">
      <h2 style="margin:0 0 18px">Scheduler</h2>
      <p class="muted" style="margin:0 0 16px">
        Queue posts for later. Connect channels (coming online as you post). For now, add items to a local queue.
      </p>

      <div class="grid cols-2">
        <div class="card">
          <div class="grid" style="gap:10px">
            <input id="schTitle" placeholder="Post title / handle" />
            <textarea id="schBody" placeholder="Paste content to schedule…"></textarea>
            <div class="grid cols-3" style="gap:10px">
              <select id="schChannel">
                <option value="twitter" selected>Twitter/X</option>
                <option value="linkedin">LinkedIn</option>
                <option value="facebook">Facebook</option>
                <option value="instagram">Instagram</option>
              </select>
              <input id="schWhen" type="datetime-local" />
              <button class="btn" id="schAddBtn" type="button">Add to queue</button>
            </div>
            <div class="muted tiny">Tip: Use the Generator’s last output → “Add from last output”.</div>
          </div>
        </div>

        <div class="card">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
            <strong>Queued</strong>
            <button class="btn small ghost" id="schAddFromLast" type="button">Add from last output</button>
            <span class="spacer"></span>
            <button class="btn small ghost" id="schClearBtn" type="button">Clear</button>
          </div>
          <div id="schList" class="list">No scheduled items yet.</div>
        </div>
      </div>
    </div>
  </section>

  <!-- ANALYTICS -->
  <section id="analytics" class="anchor">
    <div class="container">
      <h2 style="margin:0 0 18px">Analytics</h2>
      <div class="grid cols-3">
        <div class="card">
          <div class="muted small">Per-day posts</div>
          <div id="anPosts" class="mono" style="font-size:1.4rem">—</div>
        </div>
        <div class="card">
          <div class="muted small">Estimated reach</div>
          <div id="anReach" class="mono" style="font-size:1.4rem">—</div>
        </div>
        <div class="card">
          <div class="muted small">Connected accounts</div>
          <div id="anAccounts" class="mono" style="font-size:1.4rem">0</div>
        </div>
      </div>
      <div class="card" style="margin-top:12px">
        <div class="muted small" style="margin-bottom:6px">Per-day trend (7 days)</div>
        <div id="anChart" style="height:160px;background:rgba(255,255,255,.04);border-radius:10px;display:flex;align-items:flex-end;gap:6px;padding:8px"></div>
        <div class="muted tiny" style="margin-top:6px">
          Analytics Pro unlocks channel breakdown. Coming online as you post.
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ -->
  <section id="faq" class="anchor alt">
    <div class="container">
      <h2 style="margin:0 0 18px">FAQs</h2>
      <div class="faq">
        <details>
          <summary>Why can’t I click “Sign in”?</summary>
          <div>On this build, sign-in uses Supabase/Google magic link. Make sure your browser didn’t block popups and you’re not in an embedded WebView. We also bind the button via JS — if it looks disabled, reload and try again.</div>
        </details>
        <details>
          <summary>How do batch inputs and presets work?</summary>
          <div>Paste up to 5, 30, or unlimited lines (plan-based) and the Generator runs each line as a separate job. Save your favorite settings as presets and re-use them with one click.</div>
        </details>
        <details>
          <summary>What counts against my quota?</summary>
          <div>Each generation (including Optimizer runs) counts. BYOK requests count against your BYOK caps instead of platform caps.</div>
        </details>
        <details>
          <summary>Why is Reddit showing “r/r/contentwriting”?</summary>
          <div>We fixed the label logic; it will now render as <span class="mono">r/contentwriting</span> without the extra <span class="mono">r/</span>.</div>
        </details>
        <details>
          <summary>Can I export to Notion or Trello?</summary>
          <div>Yes — connect in Integrations. Then use “Export to Notion” or “Send to Trello” on Generator/Optimizer outputs.</div>
        </details>
      </div>
    </div>
  </section>
  <!-- TOAST -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- ======= APP SCRIPT (core wiring) ======= -->
  <script>
  (function(){
    /* ---------- tiny helpers ---------- */
    const qs  = (s, el=document) => el.querySelector(s);
    const qsa = (s, el=document) => Array.from(el.querySelectorAll(s));
    const on  = (el, ev, fn, opts) => el && el.addEventListener(ev, fn, opts);
    const $$  = (o) => JSON.stringify(o, null, 2);

    const toast = (msg, ms=2400) => {
      const t = qs('#toast');
      if (!t) return alert(msg);
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(()=> t.classList.remove('show'), ms);
    };

    const ORIGIN = location.origin; // same-origin worker proxying

    /* ---------- global-ish state ---------- */
    const state = {
      token: localStorage.getItem('crp_token') || '',
      user: null,
      plan: 'free',
      lastOutput: '',
      lastTitle: '',
      integrations: {},
      presets: [],
      scheduler: JSON.parse(localStorage.getItem('crp_schedule') || '[]'),
    };

    /* ---------- section router (fixes #hash not showing content) ---------- */
    const sections = ['home','generator','optimizer','pricing','integrations','scheduler','analytics','faq'];
    function showSection(id){
      sections.forEach(sec=>{
        const el = qs(`#${sec}`);
        if (!el) return;
        if (sec === id) { el.classList.add('active'); }
        else { el.classList.remove('active'); }
      });
      // focus first interactive thing in section
      const first = qs(`#${id} input, #${id} textarea, #${id} button`);
      if (first) first.focus({preventScroll:false});
    }
    function goHash(){
      let h = (location.hash || '#home').replace('#','').trim();
      if (!sections.includes(h)) h = 'home';
      showSection(h);
    }
    on(window, 'hashchange', goHash);
    // ensure top nav clicks do not just change URL — they also reveal section immediately
    qsa('a[href^="#"]').forEach(a=>{
      on(a, 'click', (e)=>{
        const id = a.getAttribute('href').replace('#','');
        if (sections.includes(id)) {
          e.preventDefault();
          history.pushState(null, '', '#'+id);
          showSection(id);
        }
      });
    });

    /* ---------- API helper ---------- */
    async function api(path, opts={}){
      const headers = {
        'Content-Type':'application/json',
        'X-Requested-With':'fetch',
        'X-Title':'ContentRepurpose',
        'HTTP-Referer': ORIGIN
      };
      if (state.token) headers['Authorization'] = `Bearer ${state.token}`;
      const r = await fetch(`${ORIGIN}${path}`, { method:'GET', headers, ...opts });
      const txt = await r.text();
      let j=null; try{ j = JSON.parse(txt); }catch{ j = { raw: txt }; }
      if (!r.ok || j?.error) throw new Error(j?.error?.message || r.statusText || 'Request failed');
      return j;
    }

    /* ---------- Auth (button binding only; uses existing client if present) ---------- */
    const loginBtn = qs('#loginBtn');
    const logoutBtn = qs('#logoutBtn');
    on(loginBtn, 'click', async ()=>{
      // If a global supabase client is present, call Google OAuth; otherwise emit event hook.
      if (window.supabase?.auth?.signInWithOAuth) {
        try{
          await window.supabase.auth.signInWithOAuth({ provider: 'google', options:{ redirectTo: location.origin }});
        }catch(e){ toast('Sign-in failed'); }
      } else {
        // Fallback: emit a custom event your existing script can catch
        window.dispatchEvent(new CustomEvent('crp:login'));
        toast('Opening sign-in…');
      }
    });
    on(logoutBtn, 'click', ()=>{
      state.token = '';
      localStorage.removeItem('crp_token');
      state.user = null; state.plan='free';
      refreshGuardUI();
      toast('Signed out');
    });

    // If your auth layer stores a session token, listen and cache it
    window.addEventListener('crp:token', (ev)=>{
      if (!ev.detail) return;
      state.token = ev.detail;
      localStorage.setItem('crp_token', state.token);
      bootstrap().catch(()=>{});
    });

    /* ---------- Status + header UI ---------- */
    async function loadStatus(){
      try{
        const s = await api('/api/billing/status');
        state.plan = (s.plan || 'free').toLowerCase();
        state.integrations = s.integrations || {};
        // header plan badge
        const hb = qs('#headerPlan');
        if (hb) hb.textContent = state.plan.charAt(0).toUpperCase()+state.plan.slice(1);
        // integration badges
        setIntegrationBadges();
        return s;
      }catch(e){
        // unauthenticated will still return ip status — OK
        return null;
      }
    }
    function refreshGuardUI(){
      // Gate: batch-size limits by plan
      const maxBatch = state.plan==='business' ? Infinity : state.plan==='creator' ? 30 : 5;
      const batchCapEl = qs('#batchCap');
      if (batchCapEl) batchCapEl.textContent = (maxBatch===Infinity ? '∞' : String(maxBatch));

      // toggle “pro-only” controls
      qsa('[data-requires!=""]').forEach(el=>{
        const need = (el.getAttribute('data-requires')||'').split(',').map(s=>s.trim().toLowerCase()).filter(Boolean);
        const ok = !need.length || need.includes(state.plan);
        el.toggleAttribute('disabled', !ok);
        el.classList.toggle('locked', !ok);
      });
    }

    /* ---------- Generator wiring ---------- */
    const genInput = qs('#genInput');
    const genModel = qs('#genModel');
    const genBtn   = qs('#genBtn');
    const genOut   = qs('#genOutput');
    const genTitle = qs('#genTitle');
    const optTabs  = qsa('.opt-tab');
    const optArea  = qs('#optArea');
    const optBtn   = qs('#optBtn');
    const optOut   = qs('#optOutput');

    function pushOutput(text, title='Generated'){
      state.lastOutput = text || '';
      state.lastTitle  = title || 'Generated';
      if (genOut) genOut.value = text;
    }

    on(genBtn,'click', async ()=>{
      const raw = (genInput?.value || '').trim();
      if (!raw) { toast('Enter something to generate'); return; }

      // Split into batch respecting plan
      const maxBatch = state.plan==='business' ? Infinity : state.plan==='creator' ? 30 : 5;
      const lines = raw.split('\n').map(s=>s.trim()).filter(Boolean).slice(0, maxBatch);
      const model = (genModel?.value || '').trim();

      genBtn.disabled = true; genBtn.textContent = 'Generating…';
      let outputs = [];
      try{
        for (let i=0;i<lines.length;i++){
          const prompt = lines[i];
          const body = {
            messages: [
              { role:'system', content:'You are ContentRepurpose — produce concise, on-brand social posts.' },
              { role:'user', content: prompt }
            ],
            temperature: 0.75,
            model
          };
          const j = await api('/api/generate', { method:'POST', body: JSON.stringify(body) });
          const text = (j?.choices?.[0]?.message?.content || '').trim();
          if (text) outputs.push(text);
        }
        const merged = outputs.join('\n\n— — —\n\n');
        pushOutput(merged, 'Generated Pack');
        toast('Generated ✓');
      }catch(e){
        toast(e.message || 'Failed to generate');
      }finally{
        genBtn.disabled = false; genBtn.textContent = 'Generate';
      }
    });

    /* ---------- Optimizer ---------- */
    let currentStrategy = 'concise';
    optTabs.forEach(tab=>{
      on(tab,'click', ()=>{
        optTabs.forEach(x=>x.classList.remove('active'));
        tab.classList.add('active');
        currentStrategy = tab.dataset.strategy || 'concise';
      });
    });

    on(optBtn,'click', async ()=>{
      const input = (optArea?.value || '').trim();
      if (!input){ toast('Paste an article or text to optimize'); return; }

      optBtn.disabled = true; optBtn.textContent = 'Optimizing…';
      try{
        const prompt = `Optimize the following for ${currentStrategy} style. Keep author voice. Return copy-ready:\n\n${input}`;
        const j = await api('/api/generate', {
          method:'POST',
          body: JSON.stringify({
            messages: [
              { role:'system', content:'You improve articles. Keep structure, fix clarity and headlines, return Markdown.' },
              { role:'user', content: prompt }
            ],
            temperature: 0.4
          })
        });
        const text = (j?.choices?.[0]?.message?.content || '').trim();
        if (optOut) optOut.value = text;
        state.lastOutput = text; state.lastTitle = 'Optimized Article';
        toast('Optimized ✓');
      }catch(e){
        toast(e.message || 'Failed to optimize');
      }finally{
        optBtn.disabled = false; optBtn.textContent = 'Optimize';
      }
    });

    /* ---------- Export buttons (delegated; works in Generator & Optimizer) ---------- */
    document.addEventListener('click', async (e)=>{
      const el = e.target.closest('[data-action]');
      if (!el) return;
      const act = el.getAttribute('data-action');
      if (act==='export-notion'){
        e.preventDefault();
        await exportToNotion();
      }
      if (act==='export-trello'){
        e.preventDefault();
        await exportToTrello();
      }
      if (act==='copy-output'){
        e.preventDefault();
        const text = (qs('#genOutput')?.value || qs('#optOutput')?.value || state.lastOutput || '').trim();
        if (!text) return toast('Nothing to copy yet');
        try{ await navigator.clipboard.writeText(text); toast('Copied'); } catch{ toast('Copy failed'); }
      }
    });

    async function exportToNotion(){
      const text = (qs('#genOutput')?.value || qs('#optOutput')?.value || state.lastOutput || '').trim();
      if (!text) return toast('Nothing to export');
      try{
        const blocks = text.split(/\n{2,}/).map(p=>({ type:'paragraph', text:p }));
        const j = await api('/api/integrations/notion/export', {
          method:'POST',
          body: JSON.stringify({ title: state.lastTitle || 'ContentRepurpose Export', blocks })
        });
        toast('Sent to Notion ✓');
        if (j.url) window.open(j.url, '_blank');
      }catch(e){
        if (/Connect Notion/.test(e.message)) {
          toast('Connect Notion first (Integrations)');
          location.hash = '#integrations'; showSection('integrations');
        } else {
          toast(e.message || 'Notion export failed');
        }
      }
    }
    async function exportToTrello(){
      const text  = (qs('#genOutput')?.value || qs('#optOutput')?.value || state.lastOutput || '').trim();
      if (!text) return toast('Nothing to send');
      const title = (state.lastTitle || 'ContentRepurpose Draft').slice(0, 180);
      // For simplicity, ask for board/list once using prompt() (you can replace with a nice picker)
      const list_id = localStorage.getItem('crp_trello_list') || prompt('Enter Trello List ID to create card in:');
      if (!list_id) return;
      localStorage.setItem('crp_trello_list', list_id);
      try{
        const j = await api('/api/integrations/trello/export', {
          method:'POST',
          body: JSON.stringify({ list_id, title, description: text })
        });
        toast('Card created ✓');
        if (j.url) window.open(j.url, '_blank');
      }catch(e){
        if (/Connect Trello/.test(e.message)) {
          toast('Connect Trello first (Integrations)');
          location.hash = '#integrations'; showSection('integrations');
        } else {
          toast(e.message || 'Trello export failed');
        }
      }
    }

    /* ---------- Integrations connect/disconnect ---------- */
    on(qs('#connectNotionBtn'), 'click', async ()=>{
      try{
        const j = await api('/api/integrations/notion/oauth/start');
        if (j.url) location.href = j.url;
      }catch(e){ toast(e.message || 'Notion connect failed'); }
    });
    on(qs('#disconnectNotionBtn'), 'click', async ()=>{
      try{ await api('/api/integrations/notion/disconnect', { method:'POST', body:'{}' }); toast('Disconnected Notion'); await loadStatus(); setIntegrationBadges(); }
      catch(e){ toast(e.message || 'Disconnect failed'); }
    });

    on(qs('#connectTrelloBtn'), 'click', async ()=>{
      try{
        const j = await api('/api/integrations/trello/oauth/start');
        if (j.url) location.href = j.url;
      }catch(e){ toast(e.message || 'Trello connect failed'); }
    });

    function setIntegrationBadges(){
      const nBadge = qs('#notionStatus');
      const tBadge = qs('#trelloStatus');
      const nWs    = qs('#notionWorkspace');
      const tAt    = qs('#trelloConnectedAt');
      const n = state.integrations?.notion;
      const t = state.integrations?.trello;
      if (nBadge) { nBadge.textContent = n?.connected ? 'Connected' : 'Disconnected'; nBadge.className = 'badge '+(n?.connected?'success':''); }
      if (tBadge) { tBadge.textContent = t?.connected ? 'Connected' : 'Disconnected'; tBadge.className = 'badge '+(t?.connected?'success':''); }
      if (nWs)    { nWs.textContent = n?.workspace_name ? `Workspace: ${n.workspace_name}` : '—'; }
      if (tAt)    { tAt.textContent = t?.at ? `Connected: ${new Date(t.at).toLocaleString()}` : '—'; }
    }

    /* ---------- BYOK ---------- */
    on(qs('#saveByokBtn'), 'click', async ()=>{
      const key = (qs('#byokKey')?.value || '').trim();
      if (!key) return toast('Enter an OpenRouter key');
      const model = (qs('#byokModel')?.value || '').trim();
      const base  = (qs('#byokBase')?.value || '').trim();
      try{
        await api('/api/byok/save', { method:'POST', body: JSON.stringify({ key, model, base, provider:'openrouter' }) });
        toast('BYOK saved ✓');
        qs('#byokStatus').textContent = 'Saved. Your requests will use BYOK when selected.';
      }catch(e){ toast(e.message || 'Save failed'); }
    });
    on(qs('#removeByokBtn'), 'click', async ()=>{
      try{ await api('/api/byok/delete', { method:'POST', body:'{}' }); toast('BYOK removed'); qs('#byokStatus').textContent = 'Removed.'; }
      catch(e){ toast(e.message || 'Remove failed'); }
    });

    /* ---------- Scheduler (local for now) ---------- */
    const schList = qs('#schList');
    function renderSchedule(){
      if (!schList) return;
      if (!state.scheduler.length){ schList.innerHTML = 'No scheduled items yet.'; return; }
      schList.innerHTML = '';
      state.scheduler
        .sort((a,b)=> new Date(a.when) - new Date(b.when))
        .forEach((it, idx)=>{
          const row = document.createElement('div');
          row.className = 'list-item';
          row.innerHTML = `
            <div>
              <div class="mono">${new Date(it.when).toLocaleString()} • ${it.channel}</div>
              <div><strong>${it.title||''}</strong></div>
              <div class="muted tiny">${(it.body||'').slice(0,140)}${(it.body||'').length>140?'…':''}</div>
            </div>
            <div style="display:flex;gap:6px">
              <button class="btn small ghost" data-idx="${idx}" data-op="copy">Copy</button>
              <button class="btn small" data-idx="${idx}" data-op="remove">Remove</button>
            </div>
          `;
          schList.appendChild(row);
        });
    }
    function persistSchedule(){
      localStorage.setItem('crp_schedule', JSON.stringify(state.scheduler));
      renderSchedule();
      updateAnalytics();
    }
    on(qs('#schAddBtn'), 'click', ()=>{
      const title = (qs('#schTitle')?.value || '').trim();
      const body  = (qs('#schBody')?.value || '').trim();
      const channel = (qs('#schChannel')?.value || 'twitter');
      const when = (qs('#schWhen')?.value || '').trim() || new Date(Date.now()+3600e3).toISOString().slice(0,16);
      if (!body) return toast('Paste some content first');
      state.scheduler.push({ title, body, channel, when: when.length<=16 ? when : when.slice(0,16) });
      persistSchedule();
      toast('Added to queue ✓');
    });
    on(qs('#schAddFromLast'), 'click', ()=>{
      if (!state.lastOutput) return toast('Generate or optimize something first');
      state.scheduler.push({
        title: state.lastTitle || 'Post',
        body: state.lastOutput,
        channel: (qs('#schChannel')?.value || 'twitter'),
        when: (qs('#schWhen')?.value || new Date(Date.now()+3600e3).toISOString().slice(0,16))
      });
      persistSchedule();
      toast('Queued last output ✓');
    });
    on(qs('#schClearBtn'), 'click', ()=>{
      state.scheduler = [];
      persistSchedule();
      toast('Cleared queue');
    });
    on(schList, 'click', (e)=>{
      const btn = e.target.closest('button[data-op]');
      if (!btn) return;
      const idx = Number(btn.getAttribute('data-idx'));
      const op  = btn.getAttribute('data-op');
      const it = state.scheduler[idx];
      if (!it) return;
      if (op==='copy'){
        navigator.clipboard.writeText(it.body||'').then(()=> toast('Copied'));
      } else if (op==='remove'){
        state.scheduler.splice(idx,1);
        persistSchedule();
        toast('Removed');
      }
    });

    /* ---------- Analytics (basic mock + reacts to queue) ---------- */
    function updateAnalytics(){
      const posts = state.scheduler.length;
      const reach = posts * 350 + Math.floor(Math.random()*200);
      const accs  = (state.integrations?.notion?.connected?1:0) + (state.integrations?.trello?.connected?1:0);
      const postsEl = qs('#anPosts'), reachEl = qs('#anReach'), accEl = qs('#anAccounts');
      if (postsEl) postsEl.textContent = String(posts);
      if (reachEl) reachEl.textContent = String(reach);
      if (accEl)   accEl.textContent = String(accs);

      // tiny bars
      const chart = qs('#anChart');
      if (chart){
        chart.innerHTML = '';
        const base = Math.max(6, posts);
        for (let i=0;i<7;i++){
          const v = Math.max(1, Math.round(base * (0.6 + Math.random()*0.8)));
          const bar = document.createElement('div');
          bar.style.height = (10 + v*6) + 'px';
          bar.style.flex = '1';
          bar.style.background = 'rgba(255,255,255,0.18)';
          bar.style.borderRadius = '6px 6px 0 0';
          chart.appendChild(bar);
        }
      }
    }

    /* ---------- Presets (optional hooks; works if buttons exist) ---------- */
    on(document, 'click', async (e)=>{
      const b = e.target.closest('[data-preset]');
      if (!b) return;
      const act = b.getAttribute('data-preset');
      if (act==='save'){
        const title = prompt('Preset name:') || 'Preset';
        const data = {
          model: genModel?.value || '',
          text: genInput?.value || '',
        };
        try{
          await api('/api/presets/save', { method:'POST', body: JSON.stringify({ title, data }) });
          toast('Preset saved ✓');
        }catch(e){ toast(e.message || 'Save failed'); }
      }
      if (act==='load'){
        try{
          const j = await api('/api/presets/list');
          const list = j.presets || [];
          if (!list.length) return toast('No presets yet');
          const names = list.map((p,i)=> `${i+1}. ${p.title}`).join('\n');
          const idx = Number(prompt('Pick preset:\n\n'+names)) - 1;
          if (isNaN(idx) || !list[idx]) return;
          const p = list[idx];
          if (genModel) genModel.value = p.data?.model || genModel.value;
          if (genInput) genInput.value = p.data?.text || genInput.value;
          toast('Preset loaded ✓');
        }catch(e){ toast(e.message || 'Load failed'); }
      }
    });

    /* ---------- Pricing buttons ---------- */
    qsa('.checkoutBtn').forEach(btn=>{
      on(btn,'click', async ()=>{
        const tier = btn.dataset.price;
        const priceIdMap = {
          starter:  '${STRIPE_PRICE_STARTER}'.replace(/\$|\{|\}/g,'') ? '${STRIPE_PRICE_STARTER}' : null,
          creator:  '${STRIPE_PRICE_CREATOR}'.replace(/\$|\{|\}/g,'') ? '${STRIPE_PRICE_CREATOR}' : null,
          business: '${STRIPE_PRICE_BUSINESS}'.replace(/\$|\{|\}/g,'') ? '${STRIPE_PRICE_BUSINESS}' : null
        };
        const price = priceIdMap[tier] || btn.getAttribute('data-stripe') || '';
        if (!price) { toast('Stripe price not configured'); return; }
        try{
          const j = await api('/api/billing/checkout', { method:'POST', body: JSON.stringify({ price }) });
          if (j.url) location.href = j.url;
        }catch(e){ toast(e.message || 'Checkout failed'); }
      });
    });

    /* ---------- Content niceties ---------- */
    // fix “r/r/xxx” → “r/xxx”
    qsa('.mono, .muted, p, div').forEach(el=>{
      el.innerHTML = el.innerHTML.replace(/r\/r\//g, 'r/');
    });

    /* ---------- Bootstrap ---------- */
    async function bootstrap(){
      await loadStatus();
      refreshGuardUI();
      setIntegrationBadges();
      renderSchedule();
      updateAnalytics();
      goHash(); // reveal correct section on load
    }

    // kick off
    bootstrap().catch(()=>{ goHash(); });

  })();
  </script>
  <!-- ======= UTILITIES (FAQ, a11y, small helpers) ======= -->
  <script>
  (function(){
    // FAQ accordion (keyboard + mouse)
    const faq = document.getElementById('faq');
    if (faq) {
      faq.addEventListener('click', (e)=>{
        const btn = e.target.closest('.faq-q');
        if (!btn) return;
        const item = btn.closest('.faq-item');
        const ans  = item.querySelector('.faq-a');
        const open = item.hasAttribute('open');
        // close all
        faq.querySelectorAll('.faq-item[open]').forEach(i=>{
          i.removeAttribute('open');
          const a = i.querySelector('.faq-a'); if (a) a.style.maxHeight = '0px';
          const b = i.querySelector('.faq-q'); if (b) b.setAttribute('aria-expanded','false');
        });
        // open target (if it was closed)
        if (!open) {
          item.setAttribute('open','');
          btn.setAttribute('aria-expanded','true');
          ans.style.maxHeight = ans.scrollHeight + 'px';
          // smooth expand
          setTimeout(()=> ans.style.maxHeight = ans.scrollHeight + 'px', 10);
        }
      });

      // Initialize max-heights for already-open items (SSR or restore)
      faq.querySelectorAll('.faq-item[open] .faq-a').forEach(a=>{
        a.style.maxHeight = a.scrollHeight + 'px';
      });

      // Keyboard support (Enter/Space toggles)
      faq.addEventListener('keydown', (e)=>{
        const k = e.key;
        if (k!=='Enter' && k!==' ') return;
        const btn = e.target.closest('.faq-q');
        if (!btn) return;
        e.preventDefault();
        btn.click();
      });
    }

    // Make external links open safely
    document.querySelectorAll('a[target="_blank"]').forEach(a=>{
      if (!/noopener|noreferrer/i.test(a.rel||'')) a.rel = (a.rel ? a.rel+' ' : '') + 'noopener noreferrer';
    });

    // Prefer reduced motion if user requests it
    if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      document.documentElement.style.scrollBehavior = 'auto';
    }

    // If we arrive with a hash, ensure the correct section is visible (safety)
    if (location.hash) {
      const id = location.hash.replace('#','');
      const el = document.getElementById(id);
      if (el) {
        document.querySelectorAll('section.view').forEach(s=> s.classList.remove('active'));
        el.classList.add('active');
      }
    }
  })();
  </script>

  <!-- ======= ACCESSIBILITY LANDMARKS & FOOTER ======= -->
  <footer class="container" style="padding:28px 0; color:#A9B1C5">
    <div class="grid-2">
      <div>
        <div class="muted">© <span id="year"></span> ContentRepurpose</div>
        <div class="tiny muted">Built for creators, teams & businesses.</div>
      </div>
      <div style="text-align:right">
        <a href="#faq" class="muted">FAQ</a>
        <span class="muted">·</span>
        <a href="#pricing" class="muted">Pricing</a>
        <span class="muted">·</span>
        <a href="#integrations" class="muted">Integrations</a>
      </div>
    </div>
    <script>document.getElementById('year').textContent = new Date().getFullYear();</script>
  </footer>

  <!-- ======= FINAL SAFETY / FALLBACKS ======= -->
  <script>
    // If sign-in is provided by an external script that fires a custom event,
    // we add a minimal fallback so your "Sign in" button is ALWAYS clickable.
    (function ensureSignInClickable(){
      const btn = document.getElementById('loginBtn');
      if (!btn) return;
      // If a handler is already attached from Part 5, do nothing.
      // Otherwise, add a very safe fallback that toggles a modal or emits an event.
      // (Part 5 already adds the primary handler; this is just belt & suspenders.)
      let bound = btn.dataset.bound;
      if (!bound) {
        btn.dataset.bound = '1';
        btn.addEventListener('click', ()=>{
          // Re-emit for any auth layer listening
          window.dispatchEvent(new CustomEvent('crp:login'));
        }, { passive:true });
      }
    })();

    // Smooth scroll for in-page #links (non-critical enhancement)
    (function smoothHash(){
      document.body.addEventListener('click', (e)=>{
        const a = e.target.closest('a[href^="#"]');
        if (!a) return;
        const id = a.getAttribute('href').slice(1);
        const target = document.getElementById(id);
        if (!target) return;
        // The router in Part 5 already toggles sections; only scroll if same section anchor
        if (target.classList.contains('view')) {
          // handled by router; no-op
        } else {
          target.scrollIntoView({ behavior:'smooth', block:'start' });
        }
      });
    })();
  </script>
</body>
</html>
